"use strict";require("../../sub-vendors.js");require("../../sub-common/78ff1c5e3249ffe8143b019acaf9acf9.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[2611],{55977:function(n,t,a){var e=a(32180),o=a(57543),s=a(77886),r=a(66058),i=a(18453),c=a(33661),l=a(12742),d=a(22700),p=a(95333),h=a(14175),u=a(3701),_=a(92954),f=a.n(_),g=a(67294),Z=a(71515),b=a(94184),m=a.n(b),w=a(75508),L=a(8173),x=a(35314),I=a(63056),k=a(64609),v=a(85893),U=function(n){(0,p.Z)(a,n);var t=(0,h.Z)(a);function a(){var n;(0,c.Z)(this,a);for(var e=arguments.length,l=new Array(e),p=0;p<e;p++)l[p]=arguments[p];return n=t.call.apply(t,[this].concat(l)),(0,u.Z)((0,d.Z)(n),"state",{switchSort:!1,bannerList:[]}),(0,u.Z)((0,d.Z)(n),"_bannerList",[]),(0,u.Z)((0,d.Z)(n),"waitUploadList",[]),(0,u.Z)((0,d.Z)(n),"onSortClick",(function(){n.setState((function(n){return{switchSort:!n.switchSort}}))})),(0,u.Z)((0,d.Z)(n),"onGoodsChange",(function(t){n._bannerList=t})),(0,u.Z)((0,d.Z)(n),"onAddClick",(function(){n._bannerList.length<9?f().chooseImage({count:9-n._bannerList.length,success:function(t){var a=[].concat((0,i.Z)(n._bannerList),(0,i.Z)(t.tempFilePaths.map((function(t,a){return{url:t,uploadId:n.waitUploadList.length+a}}))));n.waitUploadList=[].concat((0,i.Z)(n.waitUploadList),(0,i.Z)(t.tempFilePaths.map((function(t,a){return{url:t,uploadId:n.waitUploadList.length+a}})))),n._bannerList=a.map((function(n,t){return(0,r.Z)((0,r.Z)({},n),{},{styleId:"".concat(t),id:"".concat(t)})})),n.setState({bannerList:a.map((function(n,t){return(0,r.Z)((0,r.Z)({},n),{},{styleId:"".concat(t),id:"".concat(t)})}))})},fail:function(){f().hideLoading()}}):I.Z.showToast("最多可添加9张图片")})),(0,u.Z)((0,d.Z)(n),"onSaveClick",(0,s.Z)((0,o.Z)().mark((function t(){var a,e,s;return(0,o.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=[],!n.waitUploadList){t.next=11;break}f().showLoading({title:"上传中..."}),e=(0,o.Z)().mark((function t(e){return(0,o.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,L.Ix)(n.waitUploadList[e].url).then((function(t){var o=t.data,s=JSON.parse(o);a.push({url:s.data.org[0],uploadId:n.waitUploadList[e].uploadId})})).catch((function(n){f().hideLoading(),x.Z.log("上传图片失败".concat(n))}));case 2:case"end":return t.stop()}}),t)})),s=0;case 5:if(!(s<n.waitUploadList.length)){t.next=10;break}return t.delegateYield(e(s),"t0",7);case 7:s++,t.next=5;break;case 10:f().hideLoading();case 11:n._bannerList=n._bannerList.slice().map((function(n){return(0,r.Z)((0,r.Z)({},n),{},{url:n.hasOwnProperty("uploadId")?a.find((function(t){return t.uploadId===n.uploadId})).url:n.url})})),n.props.dispatch({type:"goodsManage/updataShopProfileInformation",payload:{mpErpId:n.props.mpErpId,bannerUrls:n._bannerList.map((function(n){return n.url})).join(",")||""}}),f().navigateBack();case 14:case"end":return t.stop()}}),t)})))),n}return(0,l.Z)(a,[{key:"componentDidMount",value:function(){var n=this;this.props.dispatch({type:"goodsManage/selelctShopProfileInformation",payload:{mpErpId:this.props.mpErpId}}).then((function(t){t.bannerUrls.includes(",")?n._bannerList=t.bannerUrls&&t.bannerUrls.split(",").map((function(n,t){return{url:n,id:"".concat(t),styleId:"".concat(t)}})):t.bannerUrls?n._bannerList=[{url:t.bannerUrls,id:"1",styleId:"1"}]:n._bannerList=[],n.setState({bannerList:n._bannerList})}))}},{key:"render",value:function(){var n,t=this.state,a=t.switchSort,e=t.bannerList;return(0,v.jsxs)(Z.View,{className:"shop_hot_goods",children:[(0,v.jsxs)(Z.View,{className:"shop_hot_goods__header",children:[(0,v.jsx)(Z.View,{className:"shop_hot_goods__header__title",children:"首页banner"}),(0,v.jsx)(Z.View,{className:"shop_hot_goods__header__label",children:"图片将展示在店铺首页顶部"}),(0,v.jsx)(Z.View,{onClick:this.onSortClick,className:m()("shop_hot_goods__header__actionView aic jcc",(n={},(0,u.Z)(n,"action_save",a),(0,u.Z)(n,"action_sort",!a),n)),children:a?"保存":"排序"})]}),(0,v.jsx)(Z.View,{className:"shop_hot_goods__content",children:(0,v.jsx)(k.Z,{type:"banner",data:e,sort:a,onChange:this.onGoodsChange})}),(0,v.jsxs)(Z.View,{className:"shop_hot_goods__bottom",children:[(0,v.jsx)(Z.View,{className:"shop_hot_goods__bottom__left",onClick:this.onAddClick,children:"添加图片"}),(0,v.jsx)(Z.View,{className:"shop_hot_goods__bottom__right",onClick:this.onSaveClick,children:"保存"})]})]})}}]),a}(g.Component),y=(0,w.$j)((function(n){return{mpErpId:n.goodsManage.mpErpId}}))(U);Page((0,e.createPageConfig)(y,"subpackages/manage/pages/shop_home_banner/index",{root:{cn:[]}},{navigationBarTitleText:"首页banner"}||{}))}},function(n){n.O(0,[7938,5487,2107,1216,8592],(function(){return t=55977,n(n.s=t);var t}));n.O()}]);