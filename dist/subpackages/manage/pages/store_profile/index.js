"use strict";require("../../sub-vendors.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[9787],{92975:function(e,t,o){var a=o(32180),s=o(57543),n=o(77886),r=o(33661),p=o(12742),i=o(22700),c=o(95333),l=o(14175),d=o(3701),h=o(92954),u=o.n(h),m=o(67294),g=o(71515),y=o(75508),w=o(8173),f=o(6420),k=o(63056),x=o(35314),v=o(41115),A=o(85893),L=function(e){(0,c.Z)(o,e);var t=(0,l.Z)(o);function o(e){var a;return(0,r.Z)(this,o),a=t.call(this,e),(0,d.Z)((0,i.Z)(a),"initTypeList",(function(){a.props.dispatch({type:"goodsManage/selectSpuStdPropType",payload:{mpErpId:a.props.mpErpId}}).then((function(){u().hideLoading();var e=a.props.levelList,t=[[],[],[]];e.rows.length&&(e.rows.forEach((function(e){t[0].push(e.name)})),e.rows[0].propTypeList.length&&(e.rows[0].propTypeList.forEach((function(e){t[1].push(e.name)})),e.rows[0].propTypeList[0].propTypeList.length&&e.rows[0].propTypeList[0].propTypeList.forEach((function(e){t[2].push(e.name)})))),a.setState({list:[].concat(t)})})).catch((function(e){u().hideLoading(),x.Z.log("查询失败".concat(e))}))})),(0,d.Z)((0,i.Z)(a),"init",(function(){u().showLoading({title:"请稍等..."}),a.props.dispatch({type:"goodsManage/selelctShopProfileInformation",payload:{mpErpId:a.props.mpErpId}}).then((function(e){a.setState({wechatValue:e.wxCode||"",phoneValue:e.phone||"",wxcodePath:e.wxQrUrl||"",typeName:e.style||""}),u().hideLoading(),u().eventCenter.on("WX_CODE_URL",(function(e){a.setState({wxcodePath:e})})),u().eventCenter.on("WX_CODE_URL_CLEAR",(function(){a.setState({wxcodePath:""})}))}))})),(0,d.Z)((0,i.Z)(a),"getMenu",(function(){var e=a.state,t=e.phoneValue,o=e.wechatValue,s=e.wxcodePath;return[{label:"基础信息",key:"info",items:[{label:"店铺名称",type:"input",key:"shopName",placeholder:"请输入",value:e.stateShopName},{label:"主营类目",type:"select",key:"category",placeholder:""},{label:"门店地址",type:"select",key:"address",placeholder:"请选择"}]},{label:"联系方式",key:"call",items:[{label:"微信号",type:"input",key:"wxchat",placeholder:"请输入",value:o},{label:"微信二维码",type:"select",key:"wxcode",placeholder:s?"去修改":"去上传"},{label:"联系电话",type:"input",key:"phone",placeholder:"请输入",value:t}]}]})),(0,d.Z)((0,i.Z)(a),"onItemClick",(function(e){switch(e.currentTarget.dataset.key){case"address":a.goShopAddress();break;case"wxcode":a.state.wxcodePath?u().navigateTo({url:"/subpackages/manage/pages/shop_wx_code/index?url=".concat(a.state.wxcodePath)}):a.onChooseImage("wxcode")}})),(0,d.Z)((0,i.Z)(a),"onChooseImage",(function(e){u().chooseImage({count:1,success:function(e){u().showLoading({title:"上传中..."}),(0,w.Ix)(e.tempFilePaths[0]).then((function(e){var t=e.data;u().hideLoading();var o=JSON.parse(t);a.setState({wxcodePath:o.data.org[0]}),u().navigateTo({url:"/subpackages/manage/pages/shop_wx_code/index?url=".concat(o.data.org[0])})})).catch((function(e){u().hideLoading(),x.Z.log("上传图片失败".concat(e))}))},fail:function(){u().hideLoading()}})})),(0,d.Z)((0,i.Z)(a),"goShopAddress",(function(){u().navigateTo({url:"/subpackages/manage/pages/shop_address/index"})})),(0,d.Z)((0,i.Z)(a),"onSaveClick",(0,n.Z)((0,s.Z)().mark((function e(){var t,o,n,r,p,i,c,l,d,h;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.state,o=t.wxcodePath,n=t.phoneValue,r=t.wechatValue,p=t.firstCategoryId,i=t.secondCategoryId,c=t.thirdCategoryId,l=t.typeName,d=t.stateShopName,h=a.props.shopAddress,u().showLoading({title:"请稍等..."}),e.next=5,a.props.dispatch({type:"goodsManage/updataShopProfileInformation",payload:{mpErpId:a.props.mpErpId,coverType:1,style:l,phone:n,address:h,wxCode:r,wxQrUrl:o,firstCategoryId:p,secondCategoryId:i,thirdCategoryId:c,shopName:d}});case 5:u().hideLoading(),u().navigateBack();case 7:case"end":return e.stop()}}),e)})))),(0,d.Z)((0,i.Z)(a),"onInput",(function(e){var t=e.detail.value,o=e.currentTarget.dataset.key;"wxchat"===o&&a.setState({wechatValue:t}),"phone"===o&&a.setState({phoneValue:t}),"shopName"===o&&a.setState({stateShopName:t})})),(0,d.Z)((0,i.Z)(a),"pickerChange",(function(e){var t=e.detail.value,o=a.props.levelList,s=parseInt(o.rows[t[0]].id),n=parseInt(o.rows[t[0]].propTypeList[t[1]].id),r=parseInt(o.rows[t[0]].propTypeList[t[1]].propTypeList[t[2]].id);a.setState({firstCategoryId:s,secondCategoryId:n,thirdCategoryId:r,pickerIndex:t,typeName:o.rows[t[0]].propTypeList[t[1]].propTypeList[t[2]].name})})),(0,d.Z)((0,i.Z)(a),"pickerInput",(function(e){a.pushLevelList(e.detail)})),(0,d.Z)((0,i.Z)(a),"pushLevelList",(function(e){var t=a.props.levelList,o=[[],[],[]];t.rows.length&&(t.rows.forEach((function(e){o[0].push(e.name)})),t.rows[0].propTypeList.length&&(t.rows[0].propTypeList.forEach((function(e){o[1].push(e.name)})),t.rows[0].propTypeList[0].propTypeList.length&&t.rows[0].propTypeList[0].propTypeList.forEach((function(e){o[2].push(e.name)})))),0==e.column?(o[1]=[],o[2]=[],t.rows[e.value].propTypeList.forEach((function(e){o[1].push(e.name)})),t.rows[e.value].propTypeList[0].propTypeList.forEach((function(e){o[2].push(e.name)})),a.setState({column1:e.value})):1==e.column&&(o[1]=[],o[2]=[],t.rows[a.state.column1].propTypeList.forEach((function(e){o[1].push(e.name)})),t.rows[a.state.column1].propTypeList[e.value].propTypeList.forEach((function(e){o[2].push(e.name)}))),2!=e.column&&a.setState({list:[].concat(o)})})),(0,d.Z)((0,i.Z)(a),"goCloudBillAmktH5",(function(){if((0,v.di)())k.Z.showAlert("请前往商陆花线上接单或应用市场内续费","","好的");else{var e,t=(0,f.JU)(null===(e=u().getCurrentInstance)||void 0===e?void 0:e.call(u())).mktToken;u().navigateTo({url:"/subpackages/cloud_bill/pages/cloud_bill_amkt_h5/index?mktToken="+t+"&shopId="+a.props.shopId})}})),(0,d.Z)((0,i.Z)(a),"renderActionView",(function(){return(0,A.jsx)(g.View,{className:"action_view",children:(0,A.jsx)(g.View,{className:"action_view__save",onClick:a.onSaveClick,children:"保存"})})})),(0,d.Z)((0,i.Z)(a),"renderMenu",(function(){var e=a.props,t=e.shopAddress,o=e.shop,s=a.state,n=s.typeName,r=s.pickerIndex,p=s.list,i=a.getMenu();return o&&o.industries&&i[0].items.shift(),(0,A.jsx)(g.View,{className:"store_profile_wrap__menuContent",children:i.map((function(e){return(0,A.jsxs)(g.Block,{children:[(0,A.jsx)(g.View,{className:"store_profile_wrap__menuContent___label",children:e.label}),e.items.map((function(e){return(0,A.jsxs)(g.View,{className:"store_profile_wrap__menuContent___item",children:[(0,A.jsx)(g.View,{className:"item_label",children:e.label}),(0,A.jsxs)(g.Block,{children:["input"===e.type&&(0,A.jsx)(g.Input,{placeholder:e.placeholder,className:"item_input",placeholderStyle:"color: #ccc;","data-key":e.key,onInput:a.onInput,value:e.value}),"select"===e.type&&(0,A.jsxs)(g.View,{className:"item_select_view","data-key":e.key,onClick:a.onItemClick,children:["address"===e.key&&(0,A.jsx)(g.Text,{className:"select_placeholder",style:{color:t?"#222":"#ccc"},children:t||e.placeholder}),"category"===e.key&&(0,A.jsx)(g.Picker,{value:r,className:"picker",mode:"multiSelector",range:p,onChange:a.pickerChange,onColumnChange:a.pickerInput,children:(0,A.jsx)(g.View,{style:{color:n?"#222":"#ccc"},children:n||"例：女装"})}),"address"!==e.key&&"wxchat"!==e.key&&"phone"!==e.key&&(0,A.jsx)(g.Text,{className:"select_placeholder",children:e.placeholder}),(0,A.jsx)(g.Image,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAB8ElEQVRoQ+2aP07DMBSHf66FZJW13KAXYO+SoerAyoQQGzdAQgwIDgALAwtCXICtSzNlQbBU4howdUBMJDWy1KJI/Clp7Pec2J3jp/f59zXScywQ2E8ExosI3PbEY8Ix4ZbtQFS6ZYF+w4kJ20o4TdPNTqezberN5/Pn0Wj0bqt2nTpOEh6Px12l1DmAA9OcEOJeKXUyGAze6jRrY60T4CzL+nmePwHoLYA1gCul1Ck3tBPgyWTSl1I+AthapiKEMNA3UsqzJElebKS1Tg0nwNPptDubzS4BHAKQpcY+hBB3SqkjrqSdABvALMt6eZ7fAtgpQy+SZtPbGfASuiiKCwB7WusNH/R2ClyG1lrv+6C3c2Df9CYB9klvMmBf9CYF9kFvcmBuvVmAOfVmA+bSmxWYQ292YGq9vQCm1Nsb4H/ofV0UxXHdkxOvgFfo/QpgdzgcPqwzB38NLnUWu1hrxkozYf0wbLQPeAn7yzjZLqWpDgy8+A//obH1IyF24BUaWz/0YwWm0rj8cmUDptSYHZhaY1ZgDo3ZgLk0ZgHm1JgcmFtjUmAfNCYD9kVjEmCfNHYOHNzn0uA+iAd35SG4Sy3mJRHUtSUXZ122arKNh7YAqtaJwFV3rGnPx4SblljVfmPCVXesac/HhJuWWNV+PwHAv75MPFRbxgAAAABJRU5ErkJggg==",className:"right_icon"})]})]})]},e.key)}))]},e.key)}))})})),a.state={wechatValue:"",phoneValue:"",wxcodePath:"",typeName:"",stateShopName:e.shopName,list:[[],[],[]],column1:0,firstCategoryId:0,secondCategoryId:0,thirdCategoryId:0,pickerIndex:[0,0,0]},a}return(0,p.Z)(o,[{key:"componentDidMount",value:function(){this.initTypeList(),this.init()}},{key:"render",value:function(){var e=this.props,t=e.bizStatus,o=e.expiredDate;return(0,A.jsxs)(g.View,{className:"store_profile_wrap",children:[(0,v.$L)()&&1===t&&(0,A.jsxs)(g.View,{className:"store_profile_wrap__timeLimit",children:[(0,A.jsxs)(g.View,{children:["云单有效期至 ",o&&o.split(" ")[0]]}),(0,A.jsx)(g.View,{className:"store_profile_wrap__timeLimit___renewal",onClick:this.goCloudBillAmktH5,children:"续费"})]}),this.renderMenu(),this.renderActionView()]})}}]),o}(m.PureComponent),I=(0,y.$j)((function(e){var t=e.goodsManage,o=e.shop,a=t.bizShops.find((function(e){return e.bizShopId==t.shopId})),s=a&&a.bizStatus?a.bizStatus:1,n=o.list.find((function(e){return e.id===t.mpErpId}));return{mpErpId:t.mpErpId,shopAddress:t.shopAddress,shopInfo:t.shopInfo,shopLogo:t.shopLogoUrl,shopName:t.shopName,levelList:t.levelList,bizStatus:s,expiredDate:a&&a.subscribe.expiredDate,shopId:t.shopId,shop:n}}))(L);Page((0,a.createPageConfig)(I,"subpackages/manage/pages/store_profile/index",{root:{cn:[]}},{navigationBarTitleText:"门店简介"}||{}))}},function(e){e.O(0,[2107,1216,8592],(function(){return t=92975,e(e.s=t);var t}));e.O()}]);