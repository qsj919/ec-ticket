"use strict";require("../../sub-vendors.js");require("../../sub-common/b29cd7063a909867339ec276af77ca8d.js");require("../../sub-common/78ff1c5e3249ffe8143b019acaf9acf9.js");require("../../sub-common/1710899bab9cfb6491e9c985cd531f02.js");require("../../sub-common/08a18b27d1150d5ee9d5572aa8a9c59c.js");require("../../sub-common/7c0adf770df38bf5b2cc4b3b1f616710.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[5782],{54076:function(e,s,t){var i=t(32180),o=t(66058),n=t(57543),a=t(77886),c=t(33661),r=t(12742),l=t(22700),p=t(95333),d=t(14175),u=t(3701),_=t(92954),h=t.n(_),g=t(67294),m=t(71515),w=t(94184),v=t.n(w),f=t(75508),N=t(63056),x=t(14067),k=t(19806),S=t(52131),Z=t(6420),V=t(9936),y=t(78518),j=t(18453),P=t(40068),C=t(55676),I=t(28374),b=t(94357),T="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAALVJREFUWEftlM0JwCAMRqPnrtQFuodTuUcX6Eo9SwkoiKj58SCF9Chfk8fTxMHmz23uDwZgBsyAGfiHgRjjiRszhPBwNqckTxrAYimlGxt77y8KQpqXABwA8M4gquZktpgkATDIKczJ9K6PBUBBaJtjXTbACALP8xtha69NiAB6ELmYqrnYQCFvlOPx9HHORldsoAPBGs8RhBqgXIdkQS1NAWcDajJLBjQN238MwAyYATOw3cAHmsZ7If+f59IAAAAASUVORK5CYII=",A=t(85893),L=[{label:"6折",value:6},{label:"7折",value:7},{label:"8折",value:8},{label:"9折",value:9}],M=function(e){(0,p.Z)(t,e);var s=(0,d.Z)(t);function t(e){var i;(0,c.Z)(this,t),i=s.call(this,e),(0,u.Z)((0,l.Z)(i),"state",{spuPriceRange:[],skus:[]}),(0,u.Z)((0,l.Z)(i),"onMaskClick",(function(){i.props.onClose&&i.props.onClose()})),(0,u.Z)((0,l.Z)(i),"onDiscountInput",(function(e,s){var t=e.detail.value;i.setInputPriceBySku(t,s)})),(0,u.Z)((0,l.Z)(i),"onFoodDisClick",(function(e,s){i.setInputPriceBySku(s,e)})),(0,u.Z)((0,l.Z)(i),"setInputPriceBySku",(function(e,s){var t,o=i.props.data,n=s._usePriceType,a=s.sku,c=s.sku.price,r=i.state.skus;t=void 0!==n&&n.name?(a["stdPrice".concat(n.sid)]||o["stdPrice".concat(n.sid)])*Number(e)/10:Number(c)*Number(e)/10;var l=(0,j.Z)(r);s._inputPrice=(0,I.NM)(t,3),s._discountValue=e,i.setState({skus:l})})),(0,u.Z)((0,l.Z)(i),"onSelectPriceClick",(function(e){var s=i.props,t=s.priceTypeList,o=s.data,n=i.state.skus,a=e._discountValue,c=e.sku,r=t.filter((function(e){return"1"===e.delflag})),l=r.map((function(e){return e.name+"："+(c["stdPrice".concat(e.sid)]||o["stdPrice".concat(e.sid)])}));h().showActionSheet({itemList:l,success:function(s){var t=s.tapIndex,l=(0,j.Z)(n);e._usePriceType=r[t],i.setState({skus:l},(function(){var s=(0,j.Z)(n);e._inputPrice=a,i.setState({skus:s}),a>0?i.setInputPriceBySku(a,e):e._inputPrice=String((0,I.NM)(c["stdPrice".concat(e._usePriceType.sid)]||o["stdPrice".concat(e._usePriceType.sid)],3))}))}})})),(0,u.Z)((0,l.Z)(i),"onSpecialSave",(function(){var e=i.state.skus.filter((function(e){return void 0!==e._inputPrice&&Number(e._inputPrice)>=0})),s=!1;e.forEach((function(e){var t=e._inputPrice,i=e.sku;(0,I.NM)(Number(i.originPrice||i.price)-Number(t||i.price),3)<0&&(s=!0)})),s?i.showAlert("特价不能超过原始价格",!0):e.length>0?i.props.onSaveClick&&i.props.onSaveClick(e,Number(i.props.data.styleId)):i.showAlert("请输入价格")})),(0,u.Z)((0,l.Z)(i),"showAlert",(function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?N.Z.showToast(e):N.Z.showAlert(e,"提示","好的")})),(0,u.Z)((0,l.Z)(i),"onPriceInput",(function(e,s){var t=i.state.skus,o=(0,j.Z)(t);s._inputPrice=""===e.target.value?void 0:Number(e.target.value),i.setState({skus:o})}));var o=e.data,n=new Set,a=o.price||0,r=o.price||0;return Array.isArray(o.skus)&&o.skus.forEach((function(e){n.add(e.originPrice||e.price)})),0===n.size?n.add(o.price):(a=Math.min.apply(Math,(0,j.Z)(n)),r=Math.max.apply(Math,(0,j.Z)(n))),i.state={skus:o.skus?o.skus.map((function(e){return{sku:e}})):[],spuPriceRange:a===r?[a]:[a,r]},i}return(0,r.Z)(t,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){var s=e.data,t=new Set,i=s.price||0,o=s.price||0;Array.isArray(s.skus)&&s.skus.forEach((function(e){t.add(e.originPrice||e.price)})),0===t.size?t.add(s.price):(i=Math.min.apply(Math,(0,j.Z)(t)),o=Math.max.apply(Math,(0,j.Z)(t))),console.log("data111",s),this.setState({skus:s.skus?s.skus.map((function(e){return{sku:e}})):[],spuPriceRange:i===o?[i]:[i,o]})}},{key:"render",value:function(){var e=this,s=this.state,t=s.skus,i=s.spuPriceRange,o=this.props,n=o.data,a=o.priceTypeList,c=o.showPrice,r=o.from,l=a.find((function(e){return e.sid===String(n.priceType)}));return console.log("skus",t),(0,A.jsx)(m.View,{className:"set_goods_special_wapper",onClick:this.onMaskClick,children:(0,A.jsxs)(m.View,{className:"set_goods_special_wapper__content",style:{height:"auto"},onClick:function(e){return e.stopPropagation()},children:[(0,A.jsxs)(m.View,{className:"set_goods_special_wapper__content__header",children:[(0,A.jsx)(m.View,{className:"set_goods_special_wapper__content__header__headImage",children:n.imgUrls?(0,A.jsx)(P.Z,{mode:"aspectFill",src:n.imgUrls}):(0,A.jsx)(P.Z,{mode:"aspectFill",src:n.imgUrl||C})}),(0,A.jsxs)(m.View,{className:"set_goods_special_wapper__content__header__goodsInfo",children:[(0,A.jsx)(m.View,{className:"goods_name",children:n.name}),c&&(0,A.jsxs)(m.View,{className:"goods_price_view",children:[(0,A.jsx)(m.Text,{className:"goods_price_view__label",children:"原始价格"}),(0,A.jsxs)(m.Text,{className:"goods_price_view__price",children:[(0,A.jsx)(m.Text,{className:"price_icon",children:"¥"}),2===i.length?"".concat(i[0]," ~ ").concat(i[1]):i[0]]}),l&&(0,A.jsx)(m.View,{className:"goods_price_view__type",children:l.name})]})]}),(0,A.jsx)(m.Image,{src:V,className:"delete_icon",onClick:this.onMaskClick})]}),(0,A.jsx)(m.ScrollView,{scrollY:!0,className:"set_goods_special_wapper__content__units",style:{height:"".concat(t.length>=2?300:200,"px")},onTouchMove:function(e){return e.stopPropagation()},children:t.length>0&&t.map((function(s){var t=s.sku,i=s._inputPrice,o=s._discountValue,n=s._usePriceType,a=t.sizeName,c=void 0===i?t.originPrice?Number(t.originPrice)-Number(t.price):0:Number(t.originPrice||t.price)-Number(i||0);return c=(0,I.NM)(c,3),(0,A.jsxs)(m.Block,{children:[(0,A.jsxs)(m.View,{className:"set_goods_special_wapper__content__inputView",children:[(0,A.jsxs)(m.View,{className:"set_goods_special_wapper__content__inputView__label unit_label",children:["特价价格(",a,")"]}),(0,A.jsx)(b.Z,{className:"set_goods_special_wapper__content__inputView__input",placeholderClass:"placeholder_class",placeholder:"输入价格",type:"number",value:i,onInput:function(t){return e.onPriceInput(t,s)}}),(0,A.jsxs)(m.View,{className:"set_goods_special_wapper__content__inputView__label",children:["优惠¥",c]})]}),(0,A.jsxs)(m.View,{className:"set_goods_special_wapper__content__setprice",children:[(0,A.jsx)(m.View,{className:"set_goods_special_wapper__content__setprice__title",children:"快速定价"}),(0,A.jsxs)(m.View,{className:"col",children:[(0,A.jsxs)(m.View,{className:"set_goods_special_wapper__content__setprice__setView",children:[(0,A.jsxs)(m.View,{className:"select_price_type set_price_view",onClick:function(){return e.onSelectPriceClick(s)},children:[n?n.name:"价格类型",(0,A.jsx)(m.Image,{src:T,className:"angle_bottom_icon"})]}),(0,A.jsx)(m.View,{className:"setView_label",children:"的"}),(0,A.jsx)(m.View,{className:"price_discount set_price_view",children:(0,A.jsx)(b.Z,{type:"number",placeholderClass:"placeholder_class",placeholder:"折扣数",className:"input_view",value:void 0!==o&&o>0?String(o):"",onInput:function(t){return e.onDiscountInput(t,s)}})}),(0,A.jsx)(m.View,{className:"setView_label",children:"折"})]}),(0,A.jsx)(m.View,{className:"discount_bg_view",children:L.map((function(t){return(0,A.jsx)(m.View,{"data-value":t.value,onClick:function(i){return e.onFoodDisClick(s,t.value)},className:v()("discount_bg_view__item",(0,u.Z)({},"discount_bg_view__item--active",o===t.value)),children:t.label},t.value)}))})]})]})]},a)}))}),(0,A.jsx)(m.View,{className:"set_goods_special_wapper__content__bottom__food",children:(0,A.jsx)(m.View,{className:"set_goods_special_wapper__content__bottom__food_action",onClick:this.onSpecialSave,children:"use_goods"===r?"添加为特价商品":"保存"})})]})})}}]),t}(g.Component);(0,u.Z)(M,"defaultProps",{priceTypeList:[],showPrice:!1,data:{}});var B=t(59132),G=function(e){var s=e.visible,t=e.value,i=e.onCancel,o=e.onConfirm,n=(0,g.useRef)(t);return(0,A.jsxs)(B.AtModal,{isOpened:s,children:[(0,A.jsx)(B.AtModalHeader,{children:"活动标题"}),(0,A.jsx)(B.AtModalContent,{children:s&&(0,A.jsx)(m.Input,{focus:!0,adjustPosition:!0,value:n.current,onInput:function(e){return n.current=String(e.detail.value)}})}),(0,A.jsxs)(B.AtModalAction,{children:[(0,A.jsx)(m.Button,{onClick:function(){return i()},children:"取消"}),(0,A.jsx)(m.Button,{onClick:function(){return o(n.current)},children:"确定"})]})]})},D=t(64609),U=[{label:"6折",value:6},{label:"7折",value:7},{label:"8折",value:8},{label:"9折",value:9}],E=function(e){(0,p.Z)(t,e);var s=(0,d.Z)(t);function t(){var e;(0,c.Z)(this,t);for(var i=arguments.length,o=new Array(i),n=0;n<i;n++)o[n]=arguments[n];return e=s.call.apply(s,[this].concat(o)),(0,u.Z)((0,l.Z)(e),"state",{discountValue:-1,usePriceType:{},inputPrice:""}),(0,u.Z)((0,l.Z)(e),"onMaskClick",(function(){e.props.onClose&&e.props.onClose()})),(0,u.Z)((0,l.Z)(e),"onDiscountInput",(function(s){var t=s.detail.value;e.setInputPrice(t)})),(0,u.Z)((0,l.Z)(e),"onDisClick",(function(s){var t=s.currentTarget.dataset.value;e.setInputPrice(t)})),(0,u.Z)((0,l.Z)(e),"setInputPrice",(function(s){var t,i=e.props.data,o=e.state.usePriceType;t=e.state.usePriceType.name?i["stdPrice".concat(o.sid)]*Number(s)/10:Number(i.price)*Number(s)/10,e.setState({inputPrice:String((0,I.NM)(t,3)),discountValue:Number(s)})})),(0,u.Z)((0,l.Z)(e),"onSelectPriceClick",(function(){var s=e.props,t=s.priceTypeList,i=s.data,o=t.filter((function(e){return"1"===e.delflag})),n=o.map((function(e){return e.name+"："+i["stdPrice".concat(e.sid)]}));h().showActionSheet({itemList:n,success:function(s){var t=s.tapIndex;e.setState({usePriceType:o[t]},(function(){e.state.discountValue>0?e.setInputPrice(e.state.discountValue):e.setState((function(s){return{inputPrice:String((0,I.NM)(e.props.data["stdPrice".concat(s.usePriceType.sid)],3))}}))}))}})})),(0,u.Z)((0,l.Z)(e),"onSpecialSave",(function(){var s=e.state.inputPrice,t=e.props,i=t.data,o=t.showPrice;if(s){if(Number(s)>=Number(i.originPrice||i.price)&&o)return void e.showAlert("特价不能超过原始价格",!0);e.props.onSaveClick&&e.props.onSaveClick(Number(s),Number(e.props.data.styleId))}else e.showAlert("请输入价格")})),(0,u.Z)((0,l.Z)(e),"showAlert",(function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?N.Z.showToast(e):N.Z.showAlert(e,"提示","好的")})),(0,u.Z)((0,l.Z)(e),"onPriceInput",(function(s){e.setState({inputPrice:s.detail.value})})),e}return(0,r.Z)(t,[{key:"render",value:function(){var e=this,s=this.state,t=s.discountValue,i=s.usePriceType,o=s.inputPrice,n=this.props,a=n.data,c=n.priceTypeList,r=n.showPrice,l=n.from,p=c.find((function(e){return e.sid===String(a.priceType)}));return(0,A.jsx)(m.View,{className:"set_goods_special_wapper",onClick:this.onMaskClick,children:(0,A.jsxs)(m.View,{className:"set_goods_special_wapper__content",onClick:function(e){return e.stopPropagation()},children:[(0,A.jsxs)(m.View,{className:"set_goods_special_wapper__content__header",children:[(0,A.jsx)(m.View,{className:"set_goods_special_wapper__content__header__headImage",children:a.imgUrls?(0,A.jsx)(P.Z,{mode:"aspectFill",src:a.imgUrls}):(0,A.jsx)(P.Z,{mode:"aspectFill",src:a.imgUrl||C})}),(0,A.jsxs)(m.View,{className:"set_goods_special_wapper__content__header__goodsInfo",children:[(0,A.jsx)(m.View,{className:"goods_name",children:a.name}),r&&(0,A.jsxs)(m.View,{className:"goods_price_view",children:[(0,A.jsx)(m.Text,{className:"goods_price_view__label",children:"原始价格"}),(0,A.jsxs)(m.Text,{className:"goods_price_view__price",children:[(0,A.jsx)(m.Text,{className:"price_icon",children:"¥"}),a.originPrice||a.price]}),p&&(0,A.jsx)(m.View,{className:"goods_price_view__type",children:p.name})]})]}),(0,A.jsx)(m.Image,{src:V,className:"delete_icon",onClick:this.onMaskClick})]}),(0,A.jsxs)(m.View,{className:"set_goods_special_wapper__content__inputView",children:[(0,A.jsx)(m.View,{className:"set_goods_special_wapper__content__inputView__label special_label",children:"特价价格"}),(0,A.jsx)(m.Input,{className:"set_goods_special_wapper__content__inputView__input",placeholderClass:"placeholder_class",placeholder:"输入价格",type:"number",value:o,onInput:this.onPriceInput}),(0,A.jsxs)(m.View,{className:"set_goods_special_wapper__content__inputView__label",children:["优惠¥",(0,I.NM)(Number(a.originPrice||a.price)-Number(o||a.price),3)]})]}),(0,A.jsxs)(m.View,{className:"set_goods_special_wapper__content__setprice",children:[(0,A.jsx)(m.View,{className:"set_goods_special_wapper__content__setprice__title",children:"快速定价"}),(0,A.jsxs)(m.View,{className:"col",children:[(0,A.jsxs)(m.View,{className:"set_goods_special_wapper__content__setprice__setView",children:[(0,A.jsxs)(m.View,{className:"select_price_type set_price_view",onClick:this.onSelectPriceClick,children:[i.name||"价格类型",(0,A.jsx)(m.Image,{src:T,className:"angle_bottom_icon"})]}),(0,A.jsx)(m.View,{className:"setView_label",children:"的"}),(0,A.jsx)(m.View,{className:"price_discount set_price_view",children:(0,A.jsx)(m.Input,{type:"number",placeholderClass:"placeholder_class",placeholder:"折扣数",className:"input_view",value:t>0?String(t):"",onInput:this.onDiscountInput})}),(0,A.jsx)(m.View,{className:"setView_label",children:"折"})]}),(0,A.jsx)(m.View,{className:"discount_bg_view",children:U.map((function(s){return(0,A.jsx)(m.View,{"data-value":s.value,onClick:e.onDisClick,className:v()("discount_bg_view__item",(0,u.Z)({},"discount_bg_view__item--active",t===s.value)),children:s.label},s.value)}))})]})]}),(0,A.jsx)(m.View,{className:"set_goods_special_wapper__content__bottom",children:(0,A.jsx)(m.View,{className:"set_goods_special_wapper__content__bottom_action",onClick:this.onSpecialSave,children:"use_goods"===l?"添加为特价商品":"保存"})})]})})}}]),t}(g.Component);(0,u.Z)(E,"defaultProps",{priceTypeList:[],showPrice:!1,data:{}});var R=function(e){return e.hot="爆款",e.special="特价",e}(R||{}),F=function(e){return e.hot="店长推荐",e.special="福利",e}(F||{}),J=function(e){(0,p.Z)(t,e);var s=(0,d.Z)(t);function t(){var e,i;(0,c.Z)(this,t);for(var r=arguments.length,p=new Array(r),d=0;d<r;d++)p[d]=arguments[d];return i=s.call.apply(s,[this].concat(p)),(0,u.Z)((0,l.Z)(i),"state",{switchSort:!1,goodsList:[],inputValue:"",_inputValue:"",inputSlideVisible:!1,isSpecial:!1,hotId:0,editModalVisible:!1,confirmValue:"hot"===(0,Z.JU)(null===(e=h().getCurrentInstance)||void 0===e?void 0:e.call(h())).type?i.props.shopInfo.activityNames[2]:i.props.shopInfo.activityNames[10]}),(0,u.Z)((0,l.Z)(i),"_goodsList",[]),(0,u.Z)((0,l.Z)(i),"setGoodsList",(function(e){i._goodsList=e,i.setState({goodsList:e})})),(0,u.Z)((0,l.Z)(i),"onSortClick",(function(){i.setState((function(e){return{switchSort:!e.switchSort}}))})),(0,u.Z)((0,l.Z)(i),"onAddClick",(0,a.Z)((0,n.Z)().mark((function e(){var s,t,o,a,c,r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(0,Z.JU)(null===(s=h().getCurrentInstance)||void 0===s?void 0:s.call(h())),o=t.type,h().showLoading({title:"请稍等..."}),!("special"===o&&i._goodsList.length<100||"hot"===o)){e.next=11;break}return e.next=5,i.props.dispatch({type:"goodsManage/fetchGoodsList",payload:{styleIdsNotIn:i._goodsList.map((function(e){return e.styleId}))}});case 5:i.props.dispatch({type:"goodsManage/save",payload:{useGoodsSpus:i._goodsList}}),c=(0,Z.JU)(null===(a=h().getCurrentInstance)||void 0===a?void 0:a.call(h())),r=c.type,h().hideLoading(),"hot"===r?h().navigateTo({url:"/subpackages/cloud_bill/pages/use_goods/index"}):h().navigateTo({url:"/subpackages/cloud_bill/pages/use_goods/index?from=special"}),e.next=12;break;case 11:N.Z.showToast("最多添加100个".concat(i.props.shopInfo.activityNames[10],"货品"));case 12:case"end":return e.stop()}}),e)})))),(0,u.Z)((0,l.Z)(i),"onGoodsChange",(function(e){i._goodsList=e})),(0,u.Z)((0,l.Z)(i),"onGoodsDelete",(function(e){var s;N.Z.showToast("删除成功");(0,Z.JU)(null===(s=h().getCurrentInstance)||void 0===s?void 0:s.call(h())).type})),(0,u.Z)((0,l.Z)(i),"onSettingClick",(function(e){h().showLoading({title:"请稍等..."}),i.props.dispatch({type:"goodsManage/fetchGoodsDetail",payload:{spuId:e,isSpecial:!0}}).then((function(){h().hideLoading(),i.setState({isSpecial:!0})})).catch((function(){h().hideLoading()}))})),(0,u.Z)((0,l.Z)(i),"onSaveClick",(function(){if(i._goodsList.length||i.props.specialId){var e,s=i.props,t=s.mpErpId,o=s.specialId,n=(0,Z.JU)(null===(e=h().getCurrentInstance)||void 0===e?void 0:e.call(h())).type,a=i.state,c=a.inputValue,r=a.hotId,l=a.confirmValue;"hot"===n?(h().showLoading({title:"请稍等..."}),(0,x.m$)({jsonParam:{mpErpId:t,type:2,name:l,description:"",id:r||void 0,spuList:i._goodsList.map((function(e){return{styleId:e.styleId}}))}}).then((function(){i.props.dispatch({type:"goodsManage/selelctShopProfileInformation"}),h().hideLoading(),N.Z.showToast("保存成功！"),h().navigateBack()})).catch((function(){h().hideLoading()}))):(h().showLoading({title:"请稍等..."}),(0,x.m$)({jsonParam:{mpErpId:t,type:10,name:l,description:c,id:o||void 0,spuList:i._goodsList.map((function(e){return e.skus&&e.skus.length>0?{styleId:e.styleId,price:e.price,skuList:e.skus.map((function(e){return{id:e.id,price:e.price,sizeName:e.sizeName}}))}:{styleId:e.styleId,price:e.price}}))}}).then((function(){i.props.dispatch({type:"goodsManage/selelctShopProfileInformation"}),h().hideLoading(),N.Z.showToast("保存成功！"),h().navigateBack()})).catch((function(){h().hideLoading()})))}else N.Z.showToast("请添加货品")})),(0,u.Z)((0,l.Z)(i),"onInputClick",(function(){i.state.inputValue||i.setState({inputSlideVisible:!0})})),(0,u.Z)((0,l.Z)(i),"onTextareaInput",(function(e){i.setState({_inputValue:e.detail.value})})),(0,u.Z)((0,l.Z)(i),"onTextSave",(function(){i.setState({inputValue:i.state._inputValue||"".concat(i.state.confirmValue,"清仓商品，不退不换"),inputSlideVisible:!1})})),(0,u.Z)((0,l.Z)(i),"onDescriptionEdit",(function(){i.setState({inputSlideVisible:!0})})),(0,u.Z)((0,l.Z)(i),"onSlideClose",(function(){i.setState((function(e){return{inputSlideVisible:!1,_inputValue:e.inputValue}}))})),(0,u.Z)((0,l.Z)(i),"onSpecialFoodSave",(function(e,s){var t=i._goodsList.map((function(t){var i,n=Array.isArray(t.skus)?t.skus:[],a=t.price;return t.styleId===s?(Array.isArray(t.skus)?e.forEach((function(e){var s=n.find((function(s){return s.id===e.sku.id}));s&&void 0!==e._inputPrice&&((void 0===i||i<(e.sku.originPrice||e.sku.price)-e._inputPrice)&&(i=(e.sku.originPrice||e.sku.price)-e._inputPrice,a=String(e._inputPrice)),s.price=e._inputPrice)})):a=e[0]._inputPrice||t.price,(0,o.Z)((0,o.Z)({},t),{},{price:a,skus:n})):t}));i.setGoodsList(t),i.setState({isSpecial:!1})})),(0,u.Z)((0,l.Z)(i),"handleEditTitleSave",(function(e){return e?e.length>4?h().showToast({title:"活动标题不能大于4个字",icon:"none"}):void i.setState({editModalVisible:!1,confirmValue:e}):h().showToast({title:"活动标题不能为空",icon:"none"})})),(0,u.Z)((0,l.Z)(i),"onSpecialSave",(function(e,s){var t=i._goodsList.map((function(t){return(0,o.Z)((0,o.Z)({},t),{},{price:t.styleId===s?e:t.price})}));i.setGoodsList(t),i.setState({isSpecial:!1})})),(0,u.Z)((0,l.Z)(i),"onClose",(function(){i.setState({isSpecial:!1})})),i}return(0,r.Z)(t,[{key:"UNSAFE_componentWillMount",value:function(){var e,s=this,t=this.props,i=(t.saasProductType,t.independentType,t.mpErpId);t.shopInfo;"hot"===(0,Z.JU)(null===(e=h().getCurrentInstance)||void 0===e?void 0:e.call(h())).type&&(0,x.M4)({pageSize:300,pageNo:1,type:2,mpErpId:i}).then((function(e){var t=e.data;s.setState({hotId:t.id})}))}},{key:"componentDidMount",value:function(){var e,s=this.props,t=s.saasProductType,i=s.independentType,o=s.shopInfo,n=(0,Z.JU)(null===(e=h().getCurrentInstance)||void 0===e?void 0:e.call(h())).type;this.props.dispatch({type:"goodsManage/selelctShopProfileInformation"}).then((function(){h().setNavigationBarTitle({title:"hot"===n?o.activityNames[2]:o.activityNames[10]})})),"hot"===n?(40===t&&0!==i?h().setNavigationBarTitle({title:F.hot}):h().setNavigationBarTitle({title:R.hot}),this.props.manageHotList&&this.setGoodsList(this.props.manageHotList)):(40===t&&0!==i?h().setNavigationBarTitle({title:F.special}):h().setNavigationBarTitle({title:R.special}),this.props.manageHotList&&this.setGoodsList(this.props.manageSpecialList),this.setState({inputValue:this.props.description,_inputValue:this.props.description})),this.props.dispatch({type:"goodsManage/selectShopParamSpuShowPrice",payload:{erpParamFirst:!0}}),this.props.priceTypeList.length||this.props.dispatch({type:"goodsManage/selectShopPriceTypeList"})}},{key:"componentDidUpdate",value:function(e){e.useGoodsSpus!==this.props.useGoodsSpus&&this.setGoodsList(this.props.useGoodsSpus)}},{key:"render",value:function(){var e,s,t,i,o=this,n=this.state,a=n.switchSort,c=n.goodsList,r=n.inputValue,l=n.inputSlideVisible,p=n._inputValue,d=n.isSpecial,_=n.editModalVisible,g=n.confirmValue,w=(0,Z.JU)(null===(e=h().getCurrentInstance)||void 0===e?void 0:e.call(h())).type,f=this.props,N=f.specialGoodsDetail,x=f.priceTypeList,j=f.spuShowPrice,P=f.saasProductType,C=f.independentType,I=f.shopInfo.activityNames,b=40===P&&0!==C;return console.log("activityNames",I),(0,A.jsxs)(m.View,{className:"shop_hot_goods",children:["hot"===w?(0,A.jsxs)(m.View,{className:"shop_hot_goods__header",children:[(0,A.jsxs)(m.View,{className:"shop_hot_goods__header__title",children:["活动标题：",g||I[2],(0,A.jsx)(m.Image,{className:"shop_hot_goods__header__icon",src:y,onClick:function(){return o.setState({editModalVisible:!0})}})]}),(0,A.jsxs)(m.View,{className:"shop_hot_goods__header__label",children:["主推的商品将置顶在",I[2],"栏目中"]}),(0,A.jsx)(m.View,{onClick:this.onSortClick,className:v()("shop_hot_goods__header__actionView aic jcc",(s={},(0,u.Z)(s,"action_save",a),(0,u.Z)(s,"action_sort",!a),s)),children:a?"保存":"排序"})]}):(0,A.jsxs)(m.View,{className:v()("shop_hot_goods__infoView aic",(t={},(0,u.Z)(t,"jcc",!r),(0,u.Z)(t,"jcsb",r),t)),onClick:this.onInputClick,children:[r||"点击添加公告",r&&(0,A.jsx)(m.Text,{className:"description_edit",onClick:this.onDescriptionEdit,children:"编辑"})]}),"special"===w&&(0,A.jsxs)(m.View,{className:"shop_hot_goods__special_header",children:[(0,A.jsxs)(m.View,{className:"shop_hot_goods__header__title",children:["活动标题：",g||I[10],(0,A.jsx)(m.Image,{className:"shop_hot_goods__header__icon",src:y,onClick:function(){return o.setState({editModalVisible:!0})}})]}),(0,A.jsx)(m.View,{onClick:this.onSortClick,className:v()("shop_hot_goods__header__actionView aic jcc",(i={},(0,u.Z)(i,"action_save",a),(0,u.Z)(i,"action_sort",!a),i)),children:a?"保存":"排序"})]}),(0,A.jsx)(m.View,{className:"shop_hot_goods__content",children:(0,A.jsx)(D.Z,{type:w,data:c,sort:a,needShowDiscountPrice:b,onChange:this.onGoodsChange,onDeleteImage:this.onGoodsDelete,onSettingClick:this.onSettingClick})}),(0,A.jsxs)(m.View,{className:"shop_hot_goods__bottom",style:{zIndex:101},children:[(0,A.jsxs)(m.View,{className:"shop_hot_goods__bottom__left",onClick:this.onAddClick,children:["添加","hot"===w?I[2]:I[10]]}),(0,A.jsx)(m.View,{className:"shop_hot_goods__bottom__right",onClick:this.onSaveClick,children:"保存"})]}),(0,A.jsx)(k.Z,{visible:l,direction:S.n.Bottom,onRequestClose:this.onSlideClose,children:(0,A.jsxs)(m.View,{className:"slide_container_content",children:[(0,A.jsxs)(m.View,{className:"slide_container_content__header aic jcc",children:["公告",(0,A.jsx)(m.Image,{onClick:this.onSlideClose,src:V,className:"delete_icon"})]}),(0,A.jsxs)(m.View,{className:"slide_container_content__content",children:[(0,A.jsx)(m.Textarea,{placeholder:"默认文案：".concat(I[10],"清仓商品，不退不换"),className:"slide_container_content__content__text",maxlength:20,value:p,onInput:this.onTextareaInput}),(0,A.jsxs)(m.View,{className:"slide_container_content__content__length",children:[(0,A.jsx)(m.Text,{style:"color: #222;",children:p.length}),"/20"]})]}),(0,A.jsxs)(m.View,{className:"slide_container_content__label",children:["公告会展示在",I[10],"模块内"]}),(0,A.jsx)(m.View,{className:"slide_container_content__action aic jcc",onClick:this.onTextSave,children:"保存"})]})}),d&&(b?(0,A.jsx)(M,{from:"shop_goods",showPrice:j,data:N,priceTypeList:x,onSaveClick:this.onSpecialFoodSave,onClose:this.onClose}):(0,A.jsx)(E,{from:"shop_goods",showPrice:j,data:N,priceTypeList:x,onSaveClick:this.onSpecialSave,onClose:this.onClose})),(0,A.jsx)(G,{visible:_,value:g,onCancel:function(){return o.setState({editModalVisible:!1})},onConfirm:function(e){return o.handleEditTitleSave(e)}})]})}}]),t}(g.Component),z=(0,f.$j)((function(e){var s=e.goodsManage;return{manageHotList:s.manageHotList,manageSpecialList:s.manageSpecialList,description:s.description,useGoodsSpus:s.useGoodsSpus,mpErpId:s.mpErpId,specialId:s.specialId,specialGoodsDetail:s.specialGoodsDetail,priceTypeList:s.priceTypeList,spuShowPrice:"1"===s.spuShowPrice,goodsList:s.goodsList,saasProductType:s.saasProductType,independentType:s.independentType,shopInfo:s.shopInfo}}))(J);Page((0,i.createPageConfig)(z,"subpackages/manage/pages/shop_hot_goods/index",{root:{cn:[]}},{}||{}))}},function(e){e.O(0,[7938,3199,5487,3894,1979,9746,1922,2107,1216,8592],(function(){return s=54076,e(e.s=s);var s}));e.O()}]);