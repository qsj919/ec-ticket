"use strict";(wx.webpackJsonp=wx.webpackJsonp||[]).push([[7938],{64609:function(e,t,i){i.d(t,{Z:function(){return S}});i(65712);var n=i(66058),a=i(18453),o=i(33661),s=i(12742),r=i(22700),c=i(95333),l=i(14175),d=i(3701),u=i(92954),g=i.n(u),m=i(71515),p=i(67294),h=i(94184),v=i.n(h),x=i(41115),f="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAANVJREFUaEPtlksOwyAMRDN36anSbuFQsE17qt7FOUBTCfmjyu5kjYfwnmXAlvxD8v/feIBfG6QBGjASYAsZAZrLacCM0BhQ14CIYM65i8jNCMlUDuDdWnsBkKugrwbGGHcROUy7OxUDePTen/91gPQt5GQ/PKbuFApH57QBDTiBVMfUNZB+jPImVnf1Z6HqKZG+hRwBhkbVnUKh2BzDacARpiqqroH0Y5Q3saqjr4t4EzvCdI+qO4XcUQUF0kAQ2OVYGlhGFbSQBoLALsfSwDKqoIXpDZxrzXgxagyMYgAAAABJRU5ErkJggg==",_=i(40068),I=i(55676),y=i(28374),Z=i(85893),A=function(e){(0,c.Z)(i,e);var t=(0,l.Z)(i);function i(){return(0,o.Z)(this,i),t.apply(this,arguments)}return(0,s.Z)(i,[{key:"getMaxDiscountPriceRange",value:function(e){var t,i={price:void 0,origin:void 0};return e.forEach((function(e){void 0!==e.originPrice&&void 0!==e.price&&(void 0===t?(t=e.originPrice-e.price,i.origin=e.originPrice,i.price=e.price):t<e.originPrice-e.price&&(t=e.originPrice-e.price,i={origin:e.originPrice,price:e.price}))})),i}},{key:"render",value:function(){var e=this.props,t=e.type,i=e.sort,n=e.data,a=e.onDeleteClick,o=e.onSettingClick,s=e.onManageClick,r=e.needShowDiscountPrice,c=n.price,l=n.originPrice;if(r&&Array.isArray(n.skus)&&n.skus.length>0){var d=this.getMaxDiscountPriceRange(n.skus);c=d.price?String(d.price):n.price,l=d.origin}return(0,Z.jsxs)(m.View,{className:"goods_cell",children:[(0,Z.jsx)(m.View,{className:"goods_cell__image",children:n.imgUrls?(0,Z.jsx)(_.Z,{src:n.imgUrls}):(0,Z.jsx)(m.Image,{src:I,style:"width:100%;height:100%"})}),(0,Z.jsxs)(m.View,{className:"goods_cell__content",children:[(0,Z.jsx)(m.View,{className:"goods_cell__content__goodsName",children:n.name||""}),(0,Z.jsx)(m.View,{className:"goods_cell__content__goodsCode",children:n.code||""}),(0,Z.jsxs)(m.View,{className:"aic",children:[(0,Z.jsxs)(m.Text,{className:"goods_cell__content__goodsPrice",children:["¥",c?(0,y.NM)(c,3):"0"]}),"special"===t&&(0,Z.jsxs)(m.Text,{className:"goods_cell__content__linethrough",children:["¥",l?(0,y.NM)(l,3):"0"]})]})]}),i&&(0,Z.jsx)(m.Image,{src:f,className:"sort_icon"}),!i&&("hot"===t?(0,Z.jsx)(m.View,{className:"goods_cell__actionView",children:(0,Z.jsx)(m.View,{className:"goods_cell__actionView__action",onClick:function(){a&&a(n.styleId)},children:"移除"})}):(0,Z.jsxs)(m.View,{className:"goods_cell__actionView",children:[(0,Z.jsx)(m.View,{className:"goods_cell__actionView__action",onClick:function(){o&&o(n.styleId)},children:"商品设置"}),(0,Z.jsx)(m.View,{className:"goods_cell__actionView__action",onClick:function(){s&&s(n.styleId)},children:"管理"})]}))]})}}]),i}(p.Component);(0,d.Z)(A,"defaultProps",{sort:!1,data:{}});var w={transition:"transform ease-in-out 0.3s, opacity ease-in-out 0.3s"},S=function(e){(0,c.Z)(i,e);var t=(0,l.Z)(i);function i(){var e;(0,o.Z)(this,i);for(var s=arguments.length,c=new Array(s),l=0;l<s;l++)c[l]=arguments[l];return e=t.call.apply(t,[this].concat(c)),(0,d.Z)((0,r.Z)(e),"state",{dataSource:[],activeImageIndex:-1,imageDisplayIndexArray:[],styles:[],activeImageStyle:{}}),(0,d.Z)((0,r.Z)(e),"rects",void 0),(0,d.Z)((0,r.Z)(e),"cloneItemRet",void 0),(0,d.Z)((0,r.Z)(e),"observers",[]),(0,d.Z)((0,r.Z)(e),"scale",1),(0,d.Z)((0,r.Z)(e),"isStart",!1),(0,d.Z)((0,r.Z)(e),"startPosition",{x:0,y:0}),(0,d.Z)((0,r.Z)(e),"startImagePosition",{x:0,y:0}),(0,d.Z)((0,r.Z)(e),"timer",void 0),(0,d.Z)((0,r.Z)(e),"disableClick",!1),(0,d.Z)((0,r.Z)(e),"sortable",void 0),(0,d.Z)((0,r.Z)(e),"clearTimer",(function(){e.timer&&clearTimeout(e.timer)})),(0,d.Z)((0,r.Z)(e),"disableClickEvent",(function(){e.disableClick=!0,setTimeout((function(){e.disableClick=!1}),200)})),(0,d.Z)((0,r.Z)(e),"addObserver",(function(){e.state.dataSource.forEach((function(t,i){var n=g().getCurrentInstance().page.createIntersectionObserver();n.relativeTo("#move-image").observe("#goods_view_for_judge_interaction--".concat(i),(function(t){t.intersectionRatio>0&&e.moveImages(e.state.activeImageIndex,i)})),e.observers.push(n)}))})),(0,d.Z)((0,r.Z)(e),"removeObserver",(function(){e.observers.forEach((function(e){return e.disconnect()})),e.observers=[]})),(0,d.Z)((0,r.Z)(e),"reCalculateImageDisplayIndex",(function(){var t=e.props.onChange,i=e.state.dataSource.length;e.state.imageDisplayIndexArray.length<i&&e.setState((function(e){for(var t=(0,a.Z)(e.imageDisplayIndexArray),n=t.length;n<i;n++)t.push(n);return{imageDisplayIndexArray:t}}),(function(){var i=e.getImagesInRealIndex();t&&t(i)}))})),(0,d.Z)((0,r.Z)(e),"moveImages",(function(t,i){if(e.isStart){var n=e.props.onChange,o=e.state.dataSource.length;t>o-1||i>o-1||t<0||i<0||t===i||"number"!=typeof t||"number"!=typeof i||e.setState((function(e){var n=(0,a.Z)(e.imageDisplayIndexArray),o=e.imageDisplayIndexArray[t];return n.splice(t,1),n.splice(i,0,o),{imageDisplayIndexArray:n,activeImageIndex:i}}),(function(){var t=e.getImagesInRealIndex();n&&n(t)}))}})),(0,d.Z)((0,r.Z)(e),"getImagesInRealIndex",(function(){var t=e.state,i=t.dataSource,a=t.imageDisplayIndexArray;return i.reduce((function(e,t,o){var s=a[o];return e.push((0,n.Z)({},i[s])),e}),[])})),(0,d.Z)((0,r.Z)(e),"calculatePosition",(function(){g().createSelectorQuery().in(g().getCurrentInstance().page).selectAll(".goods_sort_view__item").boundingClientRect((function(t){e.rects=t;var i=[],a=t[0];t.forEach((function(t){var o=j({x:t.left-a.left,y:t.top-a.top},e.scale);i.push((0,n.Z)({transform:o},w))})),e.setState({styles:i})})).exec()})),(0,d.Z)((0,r.Z)(e),"findImageIndexFromPosition",(function(t){for(var i=-1,n=0;n<e.rects.length;n++){var a=e.rects[n],o=t.x,s=t.y;if(a.left<o&&a.right>o&&a.top<s&&a.bottom>s){i=n;break}}return i})),(0,d.Z)((0,r.Z)(e),"deleteImage",(function(t){if(!e.disableClick){var i=e.state.dataSource.findIndex((function(e){return e.styleId===t})),n=e.props,o=n.onChange,s=n.onDeleteImage;e.state.dataSource[i];e.setState((function(e){var t=e.imageDisplayIndexArray.findIndex((function(e){return e===i})),n=(0,a.Z)(e.imageDisplayIndexArray);return n.splice(t,1),{dataSource:e.dataSource.filter((function(e,t){return t!==i})),imageDisplayIndexArray:n.map((function(e){return e>=i?e-1:e}))}}),(function(){s&&s(t);var i=e.getImagesInRealIndex();o&&o(i)}))}})),(0,d.Z)((0,r.Z)(e),"manageClick",(function(t){g().showActionSheet({itemList:["恢复成普通商品"],success:function(){e.deleteImage(t)}})})),(0,d.Z)((0,r.Z)(e),"settingClick",(function(t){e.props.onSettingClick&&e.props.onSettingClick(t)})),(0,d.Z)((0,r.Z)(e),"startMove",(function(t){var i=e.findImageIndexFromPosition(e.startPosition);if(i>-1){e.isStart=!0;var n=e.rects[0],a=e.rects[i],o=a.left-n.left,s=a.top-n.top;j({x:o,y:s},e.scale);e.startImagePosition={x:o,y:s};var r={top:"".concat(s,"px"),left:"".concat(o,"px")};e.setState({activeImageIndex:i,activeImageStyle:r})}})),(0,d.Z)((0,r.Z)(e),"onTouchStart",(function(t){if(e.props.sort){var i=t.changedTouches[0];e.startPosition={x:i.pageX,y:i.pageY},e.startMove(t)}})),(0,d.Z)((0,r.Z)(e),"onTouchEnd",(function(t){if(e.props.sort&&(e.clearTimer(),e.isStart)){e.disableClickEvent(),e.isStart=!1;var i=e.rects[0],n=e.rects[e.state.activeImageIndex],a=n.left-i.left,o=n.top-i.top;e.setState({activeImageStyle:{top:"".concat(o,"px"),left:"".concat(a,"px")}}),e.setState({activeImageIndex:-1},(function(){var t=e.state,i=t.dataSource;t.imageDisplayIndexArray.map((function(e){return i[e]}))}))}})),e}return(0,s.Z)(i,[{key:"componentDidMount",value:function(){this.setState({dataSource:this.props.data})}},{key:"componentDidUpdate",value:function(e,t){var i=this;this.state.dataSource.length!==t.dataSource.length&&(this.reCalculateImageDisplayIndex(),this.calculatePosition(),this.removeObserver(),this.addObserver()),(e.data.reduce((function(e,t,n){return e||t.id!==i.props.data[n].id}),!1)||this.props.data.length!==e.data.length||this.props.data!==e.data)&&this.setState({dataSource:(0,a.Z)(this.props.data),imageDisplayIndexArray:this.props.data.map((function(e,t){return t}))})}},{key:"componentWillUnmount",value:function(){this.removeObserver()}},{key:"render",value:function(){var e=this,t=this.props.sort,i=this.state,a=i.styles,o=i.activeImageIndex,s=i.activeImageStyle,r=i.imageDisplayIndexArray,c=i.dataSource,l=this.props,u=l.type,g=l.needShowDiscountPrice,p=c[r[o]]||{};return(0,Z.jsxs)(m.View,{className:"goods_sort_view",children:[(0,Z.jsxs)(m.Block,{children:[(0,Z.jsx)("wxs",{module:"move",src:"./move.wxs"}),(0,Z.jsx)(m.View,{children:c.map((function(e,t){return(0,Z.jsx)(m.View,{className:"goods_sort_view__item goods_sort_view__item--center","data-idx":t,style:{height:"banner"===u?"135px":"84px"},children:(0,Z.jsx)(m.View,{className:"goods_view_for_judge_interaction",id:"goods_view_for_judge_interaction--".concat(t)})},e.id)}))})]}),(0,Z.jsx)(m.View,{id:"movable_item_container",className:v()("movable_item_container",(0,d.Z)({},"movable_item_container_position",(0,x.di)())),children:c.map((function(i,s){return(0,Z.jsx)(m.View,{style:(0,n.Z)((0,n.Z)({},a[r.findIndex((function(e){return e===s}))]),{},{opacity:s===r[o]?0:1,height:"banner"===u?"135px":"84px",zIndex:t?0:100-s}),className:"movable_item","data-idx":s,onLongPress:"{{move.onTouchStart}}",onTouchMove:"{{move.onTouchMove}}",onTouchEnd:"{{move.onTouchEnd}}","data-index":s,children:"banner"===u?(0,Z.jsxs)(m.View,{className:"shop_home_banner_item",children:[(0,Z.jsx)(m.Image,{src:i.url,mode:"aspectFill",style:{width:"100%",height:"100%"}}),t?(0,Z.jsx)(m.Image,{src:f,className:"sort_icon"}):(0,Z.jsx)(m.View,{className:"goods_sort_delete_icon",onClick:function(){return e.deleteImage(i.styleId)},children:"移除"})]}):(0,Z.jsx)(A,{type:u,sort:t,data:i,needShowDiscountPrice:g,onDeleteClick:e.deleteImage,onManageClick:e.manageClick,onSettingClick:e.settingClick})},i.id)}))}),(0,Z.jsx)(m.View,{onClick:this.onTouchStart,onTouchEnd:this.onTouchEnd}),(0,Z.jsx)(m.View,{id:"move-image",className:"active_movable_item",style:(0,n.Z)({opacity:t&&o>-1?1:0,zIndex:o>-1?2:-1,height:"banner"===u?"135px":"84px"},s),children:"banner"===u?(0,Z.jsxs)(m.View,{className:"shop_home_banner_item",children:[(0,Z.jsx)(m.Image,{src:p.url,mode:"aspectFill",style:{width:"100%",height:"100%"}}),t?(0,Z.jsx)(m.Image,{src:f,className:"sort_icon"}):(0,Z.jsx)(m.View,{className:"goods_sort_delete_icon",onClick:function(){return e.deleteImage(p.styleId)},children:"移除"})]}):(0,Z.jsx)(A,{type:"hot",sort:t,data:p})}),t&&(0,Z.jsx)(m.View,{id:"goods_sort_hook"})]})}}]),i}(p.Component);function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return"translate(".concat(e.x*t,"px, ").concat(e.y*t,"px)")}(0,d.Z)(S,"defaultProps",{data:[]})}}]);