"use strict";require("../../sub-vendors.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[6795],{89178:function(e,n,t){var i=t(32180),s=t(57543),r=t(77886),a=t(33661),o=t(12742),c=t(22700),u=t(95333),l=t(14175),d=t(3701),p=t(66058),_=t(92954),m=t.n(_),h=t(67294),x=t(71515),f=t(55106),Z=t(6420),w=t(94184),g=t.n(w),b=t(49181),v=t(61270),C=t(63056),k=t(19806),V=t(52131),j=t(48839),N="index-module__container___imZVM",I="index-module__tips___uJ4Ls",S="index-module__wrapper___nNC2J",P="index-module__order_item___MgXWz",y="index-module__order_item__top___Ndki9",z="index-module__order_item__img___Aa4xG",B="index-module__row___SskU5",T="index-module__row__size___ti1_x",q="index-module__button___l8wnb",L="index-module__modal___crgBO",J="index-module__img___Q4UZ8",U=t(85893);var M=function(e){(0,u.Z)(t,e);var n=(0,l.Z)(t);function t(){var e;(0,a.Z)(this,t);for(var i=arguments.length,o=new Array(i),u=0;u<i;u++)o[u]=arguments[u];return e=n.call.apply(n,[this].concat(o)),(0,d.Z)((0,c.Z)(e),"state",{data:{},isInputVisible:!1,printNo:"",qrVisible:!1}),(0,d.Z)((0,c.Z)(e),"initData",(function(n){e.setState({data:n})})),(0,d.Z)((0,c.Z)(e),"onPrintClick",(function(){e.setState({isInputVisible:!0})})),(0,d.Z)((0,c.Z)(e),"setPrintCode",function(){var n=(0,r.Z)((0,s.Z)().mark((function n(t){return(0,s.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,(0,f.WY)(t);case 3:C.Z.showToast("设置成功"),e.fetchPrintCode(),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),e.setState({isInputVisible:!0});case 10:case"end":return n.stop()}}),n,null,[[0,7]])})));return function(e){return n.apply(this,arguments)}}()),(0,d.Z)((0,c.Z)(e),"fetchPrintCode",(0,r.Z)((0,s.Z)().mark((function n(){var t,i;return(0,s.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,f.uB)();case 2:t=n.sent,i=t.data,e.setState({printNo:i.printNo});case 5:case"end":return n.stop()}}),n)})))),(0,d.Z)((0,c.Z)(e),"onPrint",(0,r.Z)((0,s.Z)().mark((function n(){var t,i,r,a;return(0,s.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=(0,Z.JU)(null===(t=m().getCurrentInstance)||void 0===t?void 0:t.call(m())),r=i.mpErpId,0!==(a=e.state.data.rawSkus.filter((function(e){return Number(e.num)>0})).map((function(e){return{styleid:e.spuId,colorid:e.colorId,sizeid:e.sizeId,num:e.num}}))).length){n.next=4;break}return n.abrupt("return",C.Z.showToast("请选择打印数量 "));case 4:return m().showLoading(),n.prev=5,n.next=8,(0,f.XU)({mpErpId:r,jsonParam:a});case 8:m().hideLoading(),C.Z.showToast("打印任务创建成功"),n.next=16;break;case 12:n.prev=12,n.t0=n.catch(5),m().hideLoading(),(n.t0.message.includes("打印机标识有误，请重新填写")||n.t0.message.includes("请先设置打印机配置"))&&e.setState({isInputVisible:!0});case 16:case"end":return n.stop()}}),n,null,[[5,12]])})))),(0,d.Z)((0,c.Z)(e),"onStepperChange",(function(n,t){e.setState((function(e){var i=e.data,s=i.rawSkus.map((function(e){return(0,p.Z)((0,p.Z)({},e),{},{num:t===e.id?n:e.num})}));return{data:(0,p.Z)((0,p.Z)({},i),{},{rawSkus:s})}}))})),(0,d.Z)((0,c.Z)(e),"hideInput",(function(){e.setState({isInputVisible:!1})})),(0,d.Z)((0,c.Z)(e),"onTipClick",(function(){e.setState({qrVisible:!0})})),e}return(0,o.Z)(t,[{key:"componentDidMount",value:function(){var e;(null===(e=m().getCurrentInstance())||void 0===e?void 0:e.page).getOpenerEventChannel().on("print_spu",this.initData),this.fetchPrintCode()}},{key:"render",value:function(){var e=this,n=this.state,t=n.data,i=n.isInputVisible,s=n.printNo,r=n.qrVisible;return(0,U.jsxs)(x.View,{className:N,children:[(0,U.jsx)(x.View,{onClick:this.onTipClick,className:I,children:"点我添加企业微信，立享一键打印"}),(0,U.jsx)(x.View,{className:S,children:(0,U.jsxs)(x.View,{className:P,children:[(0,U.jsxs)(x.View,{className:y,children:[(0,U.jsx)(x.Image,{className:z,src:t.imgUrls}),(0,U.jsxs)(x.View,{children:[(0,U.jsx)(x.View,{style:{fontSize:"28rpx",marginBottom:"8rpx"},children:t.spuCode}),(0,U.jsx)(x.View,{style:{fontSize:"24rpx",color:"#999"},children:t.spuName})]})]}),(0,U.jsx)(x.View,{children:t.rawSkus&&t.rawSkus.map((function(n){return(0,U.jsxs)(x.View,{className:g()("jcsb aic",B),children:[(0,U.jsx)(x.View,{className:"flex1",children:n.color}),(0,U.jsx)(x.View,{className:T,children:n.size}),(0,U.jsx)(x.View,{className:"flex1 jcfe",children:(0,U.jsx)(v.Z,{sId:n.id,type:"number",onChange:e.onStepperChange,value:Number(n.num)||0,min:0})})]},n.id)}))})]})}),(0,U.jsx)(x.View,{className:q,children:(0,U.jsx)(b.Z,{labels:["设置打印机编号","打印条码"],onLeftButtonClick:this.onPrintClick,onRightButtonClick:this.onPrint})}),(0,U.jsx)(j.Z,{visible:i,title:"请输入打印机编号",onRequestClose:this.hideInput,onConfirm:this.setPrintCode,defaultInput:s}),(0,U.jsx)(k.Z,{direction:V.n.Center,visible:r,containerClass:"bg_trans",maxHeight:100,onRequestClose:function(){return e.setState({qrVisible:!1})},children:(0,U.jsx)(x.View,{className:L,children:(0,U.jsx)(x.Image,{className:J,showMenuByLongpress:!0,src:"https://webdoc.hzecool.com/webCdn/weapp/ec-ticket/src/subpackages/factory/images/3537e05525a4440b5ac0..png"})})})]})}}]),t}(h.PureComponent);Page((0,i.createPageConfig)(M,"subpackages/factory/pages/print/index",{root:{cn:[]}},{navigationBarTitleText:"商品明细"}||{}))}},function(e){e.O(0,[8017,2107,1216,8592],(function(){return n=89178,e(e.s=n);var n}));e.O()}]);