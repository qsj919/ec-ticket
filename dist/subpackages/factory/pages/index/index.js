"use strict";require("../../sub-vendors.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[3031],{89617:function(e,n,o){var t=o(32180),i=o(57543),s=o(77886),a=o(33661),r=o(12742),c=o(22700),p=o(95333),d=o(14175),l=o(3701),h=o(92954),u=o.n(h),_=o(67294),g=o(71515),f=o(19497),m=o(75508),x=o(19806),v=o(52131),k=o(35314),Z="index-module__phone_getter___yiRMd",w="index-module__phone_getter__title___sfGW0",b="index-module__phone_getter__button___qdBZG",y=o(85893),N=function(e){(0,p.Z)(o,e);var n=(0,d.Z)(o);function o(){var e;(0,a.Z)(this,o);for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return e=n.call.apply(n,[this].concat(i)),(0,l.Z)((0,c.Z)(e),"onGetPhoneNumber",(function(n){var o=e.props.onGetPhone;if(n.detail.errMsg.includes("ok")){u().showLoading();var t=n.detail,i=t.encryptedData,s=t.iv,a=t.code;if(o)return u().hideLoading(),o(i,s);e.props.dispatch({type:"user/verifyPhone",payload:{encryptedData:i,iv:s,wechat:!0,code:a}})}else k.Z.log("getPhoneNumber fail: ".concat(n.detail.errMsg))})),(0,l.Z)((0,c.Z)(e),"onGetUserInfo",(function(n){if(!e.props.sessionId){var o=n.detail,t=o.iv,i=o.encryptedData;t&&i&&(u().showLoading({title:"登录中..."}),e.props.dispatch({type:"user/login"}).then((function(){u().hideLoading()})))}})),(0,l.Z)((0,c.Z)(e),"onUpdateWXInfo",(function(){e.props.nickName||wx.getUserProfile({desc:"用于完善个人资料",success:function(n){u().showLoading({title:"正在更新信息..."});var o=n.userInfo,t=o.nickName,i=o.avatarUrl;e.props.dispatch({type:"user/updateNickNameAndAvatar",payload:{nickName:t,headimgurl:i}}).then((function(){e.props.onGetUserInfo&&e.props.onGetUserInfo(),u().hideLoading()})).catch((function(){u().hideLoading()}))}})})),e}return(0,r.Z)(o,[{key:"render",value:function(){var e=this.props,n=e.desc,o=e.nickName,t="授权手机号",i="去授权";return o?this.props.phone||(t="授权手机号",i="去授权"):(t="请先登录",i="去登录"),(0,y.jsx)(x.Z,{visible:this.props.visible,direction:v.n.Center,containerClass:"bg_trans",onRequestClose:this.props.onRequestClose,children:(0,y.jsxs)(g.View,{className:Z,children:[(0,y.jsxs)(g.View,{children:[(0,y.jsx)(g.View,{className:w,children:t}),(0,y.jsx)(g.View,{children:n})]}),(0,y.jsx)(g.Button,{className:b,openType:o?"getPhoneNumber":void 0,onGetPhoneNumber:this.onGetPhoneNumber,onGetUserInfo:this.onGetUserInfo,onClick:this.onUpdateWXInfo,children:i})]})})}}]),o}(_.PureComponent),I=(0,m.$j)((function(e){var n=e.user;return{logining:n.logining,nickName:n.nickName,phone:n.phone,sessionId:n.sessionId}}))(N),C=o(48882),j=o(55106),L=o(6420),G="index-module__shop_cell___Ees0c",P="index-module__shop_cell__logo___G0AaL",U="index-module__shop_cell__content___QFfwL",V="index-module__shop_cell__content__title___dH8WA",T="index-module__shop_cell__content__address___gkp1S",A="index-module__container___S8r2z",R="index-module__custom_btn___YOop7",D=function(e){(0,p.Z)(o,e);var n=(0,d.Z)(o);function o(){var e;(0,a.Z)(this,o);for(var t=arguments.length,r=new Array(t),p=0;p<t;p++)r[p]=arguments[p];return e=n.call.apply(n,[this].concat(r)),(0,l.Z)((0,c.Z)(e),"emptyInfo",{label:"当前手机号未找到匹配信息",image:"https://webdoc.hzecool.com/webCdn/weapp/ec-ticket/src/subpackages/factory/images/d43360cc5896093f5674..png"}),(0,l.Z)((0,c.Z)(e),"state",{shopList:[]}),(0,l.Z)((0,c.Z)(e),"init",(0,s.Z)((0,i.Z)().mark((function n(){var o,t,s,a,r,c,p,d,l,h,_,g,f,m,x,v;return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,r=(0,L.JU)(null===(a=u().getCurrentInstance)||void 0===a?void 0:a.call(u())),c=r.q,p=r.sn,d=r.epid,l=r.shopid,o=p,t=d,s=l,c&&(h=(0,L.f1)(decodeURIComponent(c)),_=h.sn,g=h.epid,f=h.shopid,o=_,t=g,s=f),!o){n.next=16;break}return n.prev=7,n.next=10,(0,j.zR)({sn:o,epid:t,shopid:s});case 10:m=n.sent,m.data,n.next=16;break;case 14:n.prev=14,n.t0=n.catch(7);case 16:return n.next=18,(0,j.vK)();case 18:x=n.sent,v=x.data,e.setState({shopList:v.rows}),u().hideLoading(),n.next=27;break;case 24:n.prev=24,n.t1=n.catch(0),u().hideLoading();case 27:case"end":return n.stop()}}),n,null,[[0,24],[7,14]])})))),(0,l.Z)((0,c.Z)(e),"onChangePhone",(function(){})),(0,l.Z)((0,c.Z)(e),"onShopClick",(function(e){u().navigateTo({url:"/subpackages/factory/pages/shop/index?mpErpId=".concat(e.id,"&shopName=").concat(encodeURIComponent(e.shopName))})})),(0,l.Z)((0,c.Z)(e),"onCustomClick",(function(){u().switchTab({url:"/pages/eTicketList/index"})})),e}return(0,r.Z)(o,[{key:"componentDidMount",value:function(){u().showLoading({title:"登录中..."}),this.props.sessionId&&this.init()}},{key:"componentDidUpdate",value:function(e){(!e.sessionId&&this.props.sessionId||e.phoneGetterVisible&&!this.props.phoneGetterVisible)&&this.init()}},{key:"render",value:function(){var e=this,n=this.props,o=n.phoneGetterVisible,t=n.logining,i=this.state.shopList;return!t&&(0,y.jsxs)(g.View,{className:A,children:[i.length>0?(0,y.jsx)(g.View,{style:{padding:"0 40rpx",backgroundColor:"white"},children:i.map((function(n){return(0,y.jsxs)(g.View,{className:G,onClick:function(){return e.onShopClick(n)},children:[(0,y.jsx)(g.Image,{className:P,src:n.logoUrl||C}),(0,y.jsxs)(g.View,{className:U,children:[(0,y.jsx)(g.View,{className:V,children:n.shopName}),(0,y.jsx)(g.Text,{className:T,children:n.phone})]})]},n.shopid)}))}):(0,y.jsx)(f.Z,{emptyInfo:this.emptyInfo,buttonLabel:"更改手机号",onButtonClick:this.onChangePhone}),(0,y.jsx)(I,{visible:o,desc:"请使用手机号登录"}),(0,y.jsx)(g.View,{className:R,onClick:this.onCustomClick,children:"进入客户版"})]})}}]),o}(_.PureComponent),S=(0,m.$j)((function(e){var n=e.user;return{phoneGetterVisible:!!n.sessionId&&!n.phone,sessionId:n.sessionId,logining:n.logining}}))(D);Page((0,t.createPageConfig)(S,"subpackages/factory/pages/index/index",{root:{cn:[]}},{navigationBarTitleText:"下游档口"}||{}))}},function(e){e.O(0,[8017,2107,1216,8592],(function(){return n=89617,e(e.s=n);var n}));e.O()}]);