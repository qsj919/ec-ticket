"use strict";require("../../sub-vendors.js");require("../../sub-common/4e87c4a63c1d15e00f139d9a26067e1c.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[1757],{76601:function(e,t,a){var s=a(32180),o=a(18453),i=a(66058),n=a(57543),c=a(77886),r=a(33661),l=a(12742),d=a(22700),p=a(95333),h=a(14175),u=a(3701),g=a(92954),m=a.n(g),f=a(67294),w=a(75508),k=a(71515),v=a(844),_=a(6617),C=a(1695),A=a(44559),Z=a(50229),S=a(53934),x=a(29748),I=a(48882),y=a(27863),N=a(22381),b=a(16269),j=a(6420),V=a(76449),D=a(94184),L=a.n(D),T=a(80170),O=a(24962),B=a(83657),F=a(85893),U=function(e){(0,p.Z)(a,e);var t=(0,h.Z)(a);function a(){var e;(0,r.Z)(this,a);for(var s=arguments.length,o=new Array(s),i=0;i<s;i++)o[i]=arguments[i];return e=t.call.apply(t,[this].concat(o)),(0,u.Z)((0,d.Z)(e),"onActionClick",(function(t){var a=t.currentTarget.dataset.type,s=e.props,o=s.goodsItem;(0,s.actionClick)(a,o)})),e}return(0,l.Z)(a,[{key:"render",value:function(){var e=this.props.goodsItem,t=e.fileOrgUrl,a=e.code,s=e.name,o=e.saleNum,i=e.marketFlag;return(0,F.jsxs)(k.View,{className:"goods_item_view",children:[(0,F.jsxs)(k.View,{className:"goods_item_view__image",onClick:this.onActionClick,"data-type":"goods",children:[(0,F.jsx)(k.Image,{src:t&&t.split(",")[0]||B,mode:"aspectFill",className:"goods_item_view__image___goodsImage"}),(0,F.jsxs)(k.View,{className:"sale_num",children:["累计",o,"件"]})]}),(0,F.jsx)(k.View,{className:"goods_item_view__styleName",children:s}),(0,F.jsx)(k.View,{className:"goods_item_view__styleCode",children:a}),(0,F.jsxs)(k.View,{className:"goods_item_view__actionView",children:[(0,F.jsxs)(k.View,{className:"goods_item_view__actionView___action",onClick:this.onActionClick,"data-type":"download",children:[(0,F.jsx)(k.Image,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAUNJREFUSEvtlb9KA0EQxr+JR2wDaSSIwT9NLMIVWllpYUQ8yWP4QL6IRAgaBcvYXh1ioZzYKIZwNrc7skcOzk32cntwheiWyzffb2dmd5ZQ8qKS/fHHAEHbY1XSht/LnXluoTL+B8zdWAaIgLjuphLpGt3E2IM39/xASHkpIbx1v/+yCBC0TptwVq4qhIs1vzdc9KaMgNe2d8/AETFGgqJDBUk3Odg924BDDwA2Ab5p+NcnVoAnt1tbZXELxn4CqcB5jk0ibibmBAyrYdSpj/oTK4AS6xAm7Kh9AsYMbC0zn2mzp1EMkWIAYC+tzGOeC6BEH2639iXlAOAYQuDHaiiOTWXRDvIzA9NrTSAEiHAadrbHd5/pSFPc3C3KGgcK8j6Zsm6eNUasAFndss6g6EekT1pjBqUBihqb4qz+gyLw3w/4BtkjrRn/fRv3AAAAAElFTkSuQmCC",className:"action_icon"}),(0,F.jsx)(k.Text,{children:"下载"})]}),"true"===i&&(0,F.jsxs)(k.View,{className:"goods_item_view__actionView___action",onClick:this.onActionClick,"data-type":"replenishment",children:[(0,F.jsx)(k.Image,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAkNJREFUSEu91E1o03AYBvDnTWf9oGrHwDWpJw8yCk3HFIaCbCCCH810YgXxqCc/QWUeRNGb+HFQ8OOiBxE9DNE1ncMdtIoXhVqaOMSTB11aJ3UX3Vbb5pWAllFp/sFac32f/H95eZIQWnxRi8/H/wWsqPaEgPshU79DgP0vtqttYKkDmwEe+3VoVgJOhAz9abNIDfjQvSO4yK6eYuAwgIXOwQweChupi80gf3TwObptVVWSzoOxC8CMvMBqp0ym/LdIw5ItVXsHoIuJesK5ZNYBPnUNdkj+6s3GGJdB0rCSG3n4O9MYiMbvgmivBOwPGfot54aiunNlCeWPrtswbImk9SFj5JWTcwOOgegygW/IRuqAE/66JrG8VJ493Qhgpj4Q1hLTSdlMXnAF8lGtjwlpgF8rRqrXSwdWTBsHYxMx7ZbN5LArUOzdsqw00zYN8A+549tSSqcrbshEJOFvb5tz8ovJV+2Us2NfXAFnOKnG3xNota/K3Z0TqZwbYKnbNwD2CwKZspFUhSU7AUvV7gHYw7a9L/x29LYbkI9pZ5hxDsBVxdCPegLysYHjzHyJiK7JueQhAfCMGf1gDCqm/sgbUCsaswAV3Ytm2fn4l7C9ImiOTnsCGGelgpp5ycA6L28RAddlQz84Pyv8XXMk4S/45jYCFBBsMCWb+vP6jBDw8uRuGSEwqcZ7JNBjBt4ohr61/jDRXAgU1PgRG3SFgAqhFAwZ49/nI6K5EJiK9AcqvsAQiHKKoT+o30A0FwIt76BZ4CeNQ90Zo7xHgAAAAABJRU5ErkJggg==",className:"action_icon"}),(0,F.jsx)(k.Text,{children:"补货"})]})]})]})}}]),a}(f.Component);(0,u.Z)(U,"defaultProps",{goodsItem:{code:"",name:"",fileOrgUrl:"",sale_num:""}});var E=a(86720),G=[{label:"拿货小票"},{label:"拿货相册"}],P=[{label:"最新",value:2},{label:"最多",value:1}],H=function(e){(0,p.Z)(a,e);var t=(0,h.Z)(a);function a(e){var s;return(0,r.Z)(this,a),s=t.call(this,e),(0,u.Z)((0,d.Z)(s),"shop",{logoUrl:"",shopName:""}),(0,u.Z)((0,d.Z)(s),"goodsSearchValue",""),(0,u.Z)((0,d.Z)(s),"ticketSearchValue",""),(0,u.Z)((0,d.Z)(s),"init",(function(){var e=s.state,t=e.startDate,a=e.endDate,o={epid:s.shop.epid,sn:s.shop.sn,shopid:s.shop.shopid,pageOffset:0,prodate1:t,prodate2:a},i={epid:s.shop.epid,sn:s.shop.sn,shopid:s.shop.shopid,pageOffset:0};s.getListData(o),s.getGoodsListDate(i),s.getShopBuyInfo()})),(0,u.Z)((0,d.Z)(s),"getShopBuyInfo",(0,c.Z)((0,n.Z)().mark((function e(){var t,a;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s.shop.id){e.next=6;break}return e.next=3,(0,V.Ks)(s.shop.id);case 3:t=e.sent,a=t.data,s.setState({buyNum:a.buyNum||0});case 6:case"end":return e.stop()}}),e)})))),(0,u.Z)((0,d.Z)(s),"onTabsClick",(function(e){s.ticketSearchValue="",s.goodsSearchValue="",0===e?T.Z.track(O.ZP.ticketHomeTabClickTicket):1===e&&T.Z.track(O.ZP.ticketHomeTabClickGoods),s.setState({activeIndex:e})})),(0,u.Z)((0,d.Z)(s),"onGoodsTabsClick",(function(e){s.setState({sortType:e.currentTarget.dataset._value},(function(){var e={epid:s.shop.epid,sn:s.shop.sn,shopid:s.shop.shopid,pageOffset:0};s.getGoodsListDate(e)}))})),(0,u.Z)((0,d.Z)(s),"onSearchInput",(function(e){0===s.state.activeIndex?(s.ticketSearchValue=e,""===s.ticketSearchValue&&s.onSearch()):(s.goodsSearchValue=e,""===s.goodsSearchValue&&s.onSearch())})),(0,u.Z)((0,d.Z)(s),"onSearch",(function(){var e=s.state,t=e.activeIndex,a=e.startDate,o=e.endDate;if(0===t){var i={epid:s.shop.epid,sn:s.shop.sn,shopid:s.shop.shopid,prodate1:a,prodate2:o,pageOffset:0,styleName:s.ticketSearchValue};s.getListData(i)}else{var n={epid:s.shop.epid,sn:s.shop.sn,shopid:s.shop.shopid,styleName:s.goodsSearchValue,pageOffset:0};s.getGoodsListDate(n)}})),(0,u.Z)((0,d.Z)(s),"onClearSearch",(function(){s.ticketSearchValue="",s.goodsSearchValue="",s.onSearch(),s.setState({searchInputed:!1})})),(0,u.Z)((0,d.Z)(s),"onSearchBlur",(function(){s.setState({searchInputed:!1})})),(0,u.Z)((0,d.Z)(s),"onSearchFocus",(function(){s.setState({searchInputed:!0})})),(0,u.Z)((0,d.Z)(s),"onActionClick",(function(e,t){s.props.dispatch({type:"replenishment/save",payload:{mpErpId:s.shop.id}}),s.props.dispatch({type:"cloudBill/save",payload:{mpErpId:s.shop.id,sn:s.shop.sn,epid:s.shop.epid,shopId:s.shop.shopid}});var a="true"===t.marketFlag;"download"===e?(s.props.dispatch({type:"imageDownload/fetchImageUrlsFormatData",payload:{mpErpId:s.shop.id,styleIds:t.styleId,sourceData:[(0,i.Z)({},t)]}}),T.Z.track(O.ZP.ticketHomeGoodsDownloadClick),m().navigateTo({url:"/subpackages/functional/pages/download_image/index?".concat(s.getQuery(),"&mpErpId=").concat(s.shop.id)})):"replenishment"===e?(T.Z.track(O.ZP.ticketHomeGoodsRepClick),s.shop.cloudBillFlag===y.PC.open&&a&&(s.props.dispatch({type:"cloudBill/fetchGoodsDetail",payload:{spuId:t.styleId}}),m().navigateTo({url:"/subpackages/cloud_bill/pages/goods_detail/index"}))):"goods"===e&&(s.props.dispatch({type:"imageDownload/fetchImageUrlsFormatData",payload:{mpErpId:s.shop.id,styleIds:t.styleId,sourceData:[(0,i.Z)({},t)]}}),T.Z.track(O.ZP.ticketHomeGoodsDownloadClick),m().navigateTo({url:"/subpackages/functional/pages/download_image/index?".concat(s.getQuery(),"&mpErpId=").concat(s.shop.id)}))})),(0,u.Z)((0,d.Z)(s),"getQuery",(function(){return"logo=".concat(s.shop.logoUrl,"&shopName=").concat(s.shop.shopName,"&cloudBillFlag=").concat(s.shop.cloudBillFlag,"&epid=").concat(s.shop.epid,"&sn=").concat(s.shop.sn)})),(0,u.Z)((0,d.Z)(s),"dateCancelClick",(function(e){s.setState({datePickerIsShow:!1})})),(0,u.Z)((0,d.Z)(s),"dateConfirmClick",(function(e){var t=e.startDate,a=e.endDate;s.setState({datePickerIsShow:!1,startDate:t,endDate:a});var o={epid:s.shop.epid,sn:s.shop.sn,shopid:s.shop.shopid,pageOffset:0,prodate1:t,prodate2:a};s.getListData(o)})),(0,u.Z)((0,d.Z)(s),"onDateUseClick",(function(){s.setState({datePickerIsShow:!0})})),(0,u.Z)((0,d.Z)(s),"getListData",(function(e){(e=(0,i.Z)((0,i.Z)({},e),{},{type:"1",prodate1:e.prodate1||void 0,prodate2:e.prodate2||void 0})).sn&&e.epid&&(0,x.g9)(e).then((function(t){m().hideLoading(),0===e.pageOffset?s.setState({ticketList:s.updateBillsType(t.data.dataList)||[],pageOffset:e.pageOffset,count:t.data.count}):s.setState((function(a){return a.ticketList.length+t.data.dataList.length>e.pageOffset+20?{}:{ticketList:[].concat((0,o.Z)(a.ticketList),(0,o.Z)(s.updateBillsType(t.data.dataList))),pageOffset:e.pageOffset,count:t.data.count}}))})).catch((function(e){m().hideLoading(),s.setState({count:"0",ticketList:[],pageOffset:0}),console.log("err :",e)}))})),(0,u.Z)((0,d.Z)(s),"getGoodsListDate",(function(e){var t=s.state.sortType;(0,x.jc)((0,i.Z)((0,i.Z)({search_count:1,charttype:1,sortType:t},e),{},{prodate1:e.prodate1||void 0,prodate2:e.prodate2||void 0})).then((function(t){0===e.pageOffset?s.setState({goodsDataList:t.data.dataList||[],goodsListPageOffset:e.pageOffset,goodsCount:t.data.count}):s.setState((function(a){return{goodsDataList:[].concat((0,o.Z)(a.goodsDataList),(0,o.Z)(t.data.dataList)),goodsListPageOffset:e.pageOffset,goodsCount:t.data.count}}))})).catch((function(e){s.setState({goodsDataList:[],goodsListPageOffset:0,goodsCount:"0"})}))})),(0,u.Z)((0,d.Z)(s),"updateBillsType",(function(e){return e.map((function(e){return{billId:e.billid,billNo:e.billno,shopId:e.shopid,totalNum:e.totalnum,totalMoney:e.totalmoney,imgUrls:e.imgUrls&&e.imgUrls.split(","),sn:e.sn,epid:e.epid,proDate:e.prodate,dwname:e.dwname}}))})),(0,u.Z)((0,d.Z)(s),"onScrollLower",(function(){var e=s.state,t=e.activeIndex,a=e.pageOffset,o=e.count,i=e.startDate,n=e.endDate,c=e.goodsCount,r=e.goodsListPageOffset;if(0===t){var l=a+20;if(l>Number(o))return;var d={epid:s.shop.epid,sn:s.shop.sn,shopid:s.shop.shopid,prodate1:i,prodate2:n,pageOffset:l,styleName:s.ticketSearchValue};s.getListData(d)}else{var p=r+20;if(p>Number(c))return;var h={epid:s.shop.epid,sn:s.shop.sn,shopid:s.shop.shopid,pageOffset:p,styleName:s.goodsSearchValue};s.getGoodsListDate(h)}})),(0,u.Z)((0,d.Z)(s),"onCheckDetailClick",(function(e){var t=s.props.sessionId,a="pk=".concat(e.billId,"&sn=").concat(e.sn,"&epid=").concat(e.epid,"&sessionId=").concat(t,"&shopId=").concat(e.shopId,"&type=",1);m().navigateTo({url:"/pages/eTicketDetail/landscapeModel?".concat(a)})})),(0,u.Z)((0,d.Z)(s),"onCloudOrderClick",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y.yK.all;s.shop.id&&(s.props.dispatch({type:"cloudBill/init",payload:{mpErpId:s.shop.id,cloudType:e,cloudSource:y.o0.TICKET_LIST}}),m().navigateTo({url:"/subpackages/cloud_bill/pages/all_goods/index?type=".concat(e,"&mpErpId=").concat(s.shop.id)}))})),(0,u.Z)((0,d.Z)(s),"renderNavigation",(function(){var e=s.shop,t=e.logoUrl,a=e.shopName,o=e.cloudBillFlag,i=s.state,n=i.activeIndex,c=i.buyNum;return(0,F.jsxs)(k.View,{className:"navigation_view",children:[(0,F.jsx)(k.View,{className:"navigation_view__shopinfo",children:(0,F.jsxs)(k.View,{style:"display: flex;align-items: center;",children:[(0,F.jsx)(k.View,{className:"shop_logo",children:t?(0,F.jsx)(k.Image,{src:t||I,mode:"aspectFill",style:"width:100%;height:100%;border-radius: 50%;"}):(0,F.jsx)(k.View,{className:L()("shop_logo_noImage","noLogoView"),children:(0,F.jsx)(k.View,{className:L()("noLogoText",{text_center:a.length<=3}),style:{fontSize:"26rpx"},children:(0,F.jsx)(k.Text,{style:{fontSize:"".concat(a.length<=3&&"32rpx")},children:a})})})}),(0,F.jsxs)(k.View,{className:"shop_information",children:[(0,F.jsx)(k.View,{className:"shopinfo_shopName",children:a}),(0,F.jsxs)(k.View,{className:"shopinfo_goodsCount",children:["累计拿货：",b.Z.toFixed(c,3)]})]})]})}),(0,F.jsxs)(k.View,{className:"tabs_view",children:[(0,F.jsx)(C.Z,{data:G,margin:60,activeIndex:n,underlineWidth:120,underlineHeight:5,activeColor:"#fff",underlineColor:"#fff",onTabItemClick:s.onTabsClick,activeFontSize:"32rpx"}),o===y.PC.open&&(0,F.jsx)(k.Image,{src:"https://webdoc.hzecool.com/webCdn/weapp/ec-ticket/src/assets/images/33955ae307327d936dd6..png",className:"go_shop_icon",onClick:function(){return s.onCloudOrderClick()}})]})]})})),s.state={activeIndex:0,sortType:2,searchInputed:!1,datePickerIsShow:!1,ticketList:[],goodsDataList:[],pageOffset:0,goodsListPageOffset:0,count:"0",goodsCount:"0",startDate:"",endDate:"",buyNum:0},s}return(0,l.Z)(a,[{key:"componentDidMount",value:function(){var e,t=(0,j.JU)(null===(e=m().getCurrentInstance)||void 0===e?void 0:e.call(m())),a=t.id,s=t.type,o=t.sn,i=t.epid,n=t.shopid;this.shop="1"===s?this.props.shopList.find((function(e){return String(e.sn)===o&&String(e.epid)===i&&String(e.shopid)===n})):this.props.shopList.find((function(e){return String(e.id)===a})),this.init()}},{key:"render",value:function(){var e=this,t=this.state,a=t.activeIndex,s=t.sortType,o=t.searchInputed,i=t.datePickerIsShow,n=t.count,c=t.goodsDataList,r=t.ticketList,l=t.startDate,d=t.endDate;return(0,F.jsxs)(v.Z,{title:"电子小票",backIcon:_,containerClass:"navigation_containerClass",children:[this.renderNavigation(),(0,F.jsxs)(k.ScrollView,{className:"ticket_home_content",scrollY:!0,lowerThreshold:500,onScrollToLower:this.onScrollLower,children:[(0,F.jsxs)(k.View,{className:"sticky_view",children:[(0,F.jsxs)(k.View,{className:"sort_search_view",children:[!o&&1===a&&(0,F.jsx)(k.View,{className:"sort_search_view__orderTabs",children:P.map((function(t){return(0,F.jsx)(k.View,{className:"sort_search_view__orderTabs___item",style:{backgroundColor:"".concat(s===t.value?"#fff":""),boxShadow:"".concat(s===t.value?"0 3px 7px rgba(0, 0, 0, 0.15)":"")},"data-_value":t.value,onClick:e.onGoodsTabsClick,children:t.label},t.value)}))}),(0,F.jsx)(k.View,{className:"sort_search_view__searchView",style:{width:"".concat(o||0===a?"100%":"180rpx")},children:0===a?(0,F.jsx)(A.Z,{placeholder:"输入款号、款号名称",backgroundColor:"#F7F7F7",onSearchClick:this.onSearch,onInput:this.onSearchInput,onClearSearchClick:this.onClearSearch,onFocus:this.onSearchFocus,onBlur:this.onSearchBlur}):(0,F.jsx)(A.Z,{placeholder:"搜商品",backgroundColor:"#F7F7F7",onSearchClick:this.onSearch,onInput:this.onSearchInput,onClearSearchClick:this.onClearSearch,onFocus:this.onSearchFocus,onBlur:this.onSearchBlur})})]}),0===a&&(0,F.jsxs)(k.View,{className:"date_picker_view",children:[(0,F.jsxs)(k.Text,{className:"ticket_count",children:["共",n,"条单据"]}),(0,F.jsxs)(k.View,{className:"date_action-view",onClick:this.onDateUseClick,children:[l+d===""?"选择时间":"".concat(l," - ").concat(d),(0,F.jsx)(k.Image,{src:S,className:"caret_down_gray"})]})]})]}),(0,F.jsxs)(k.View,{className:"ticket_home_content__list",children:[0===a?r.map((function(t){return(0,F.jsx)(N.Z,{type:3,item:t,onItemClick:e.onCheckDetailClick},t.billNo)})):(0,F.jsx)(k.View,{className:"ticket_home_content__list__goodsList",children:c.map((function(t){return(0,F.jsx)(U,{goodsItem:t,actionClick:e.onActionClick},t.code)}))}),(0===a&&0===r.length||1===a&&0==c.length)&&(0,F.jsxs)(k.View,{className:"empty_view",children:[(0,F.jsx)(k.Image,{src:E,className:"empty_view_image"}),(0,F.jsx)(k.View,{className:"empty_view_title",children:"没搜到结果"}),(0,F.jsx)(k.View,{className:"empty_view_label",children:"换个关键字再搜搜吧"})]})]})]}),(0,F.jsx)(Z.Z,{visible:i,mask:!0,initDateStart:"",onCancelClick:this.dateCancelClick,onConfirmClick:this.dateConfirmClick,type:"1"})]})}}]),a}(f.Component),Y=(0,w.$j)((function(e){var t=e.shop,a=e.user;return{shopList:t.list,sessionId:a.sessionId}}))(H);Page((0,s.createPageConfig)(Y,"subpackages/ticket/pages/ticket_home/index",{root:{cn:[]}},{navigationStyle:"custom"}||{}))}},function(e){e.O(0,[7964,3152,2107,1216,8592],(function(){return t=76601,e(e.s=t);var t}));e.O()}]);