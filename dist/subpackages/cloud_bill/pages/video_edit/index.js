"use strict";require("../../sub-vendors.js");require("../../sub-common/cca439a331419b9a94a2484c285c135b.js");require("../../vod"),(wx.webpackJsonp=wx.webpackJsonp||[]).push([[1125],{25223:function(e,o,i){var n=i(32180),r=i(33661),t=i(12742),s=i(22700),a=i(95333),c=i(14175),l=i(3701),d=i(92954),u=i.n(d),p=i(67294),_=i(71515),f=i(6420),h=i(29748),m=i(75508),g=i(63056),v=i(31254),Z=i(35314),x=i(54251),k=i(41115),w=i(2021),T=i(70200),V="index-module__page___EX4FB",y="index-module__center___r165Z",N="index-module__intro___nI1YR",C="index-module__upload_btn___XXpGH",j="index-module__videos___RNj3D",U="index-module__video_item___FZoOF",I="index-module__cover___IXlgA",S="index-module__default_cover___L1lt0",b="index-module__play___AB3Zs",M="index-module__close___K24Ps",O=i(21379),R=i(85893),D=function(e){(0,a.Z)(i,e);var o=(0,c.Z)(i);function i(){var e;(0,r.Z)(this,i);for(var n=arguments.length,t=new Array(n),a=0;a<n;a++)t[a]=arguments[a];return e=o.call.apply(o,[this].concat(t)),(0,l.Z)((0,s.Z)(e),"sign",void 0),(0,l.Z)((0,s.Z)(e),"refreshTimer",void 0),(0,l.Z)((0,s.Z)(e),"startRefreshVideoTimer",(function(){e.clearRefreshTimer(),e.refreshTimer=setTimeout((function(){e.props.dispatch({type:"goodsManage/fetchShopVideos"}).then((function(){e.props.videos[0].coverUrl||e.startRefreshVideoTimer()}))}),4e3)})),(0,l.Z)((0,s.Z)(e),"clearRefreshTimer",(function(){e.refreshTimer&&clearTimeout(e.refreshTimer)})),(0,l.Z)((0,s.Z)(e),"onUploadClick",(function(){u().chooseVideo({compressed:!1,maxDuration:v.GY,success:function(o){if(o.duration>v.GY)return g.Z.showToast("视频长度不能超过".concat(v.GY,"秒"),2e3);console.log(o),Z.Z.log("视频元信息：".concat(JSON.stringify(o))),e.uploadVideo(o)}})})),(0,l.Z)((0,s.Z)(e),"uploadVideo",(function(o,i){if(!e.sign)return g.Z.showToast("请重进页面再试");u().showLoading({title:"视频上传中..."}),Z.Z.log("开始上传视频，文件信息：".concat(JSON.stringify(o)));O.Z.start({mediaFile:o,getSignature:function(o){return o(e.sign)},mediaName:"".concat((0,f.uN)(),"_from_mp"),coverFile:i,progress:function(e){u().showLoading({title:"视频上传中(".concat(Math.floor(100*e.percent),"%)")})},finish:function(i){u().hideLoading(),Z.Z.log("上传结束，文件信息：".concat(JSON.stringify(i))),g.Z.showToast("视频上传成功"),e.props.dispatch({type:"goodsManage/uploadShopVideo",payload:{videoUrl:i.videoUrl,coverUrl:i.coverUrl||o.thumbTempFilePath,fileId:i.fileId}})},error:function(e){u().hideLoading(),g.Z.showToast(e.errMsg||e.message),Z.Z.log("上传视频失败: ".concat(e.errMsg||e.message,"，").concat(JSON.stringify(e)))}})})),(0,l.Z)((0,s.Z)(e),"onDeleteClick",(function(o){g.Z.showAlertWithCancel("是否删除该视频","提示",(function(){e.props.dispatch({type:"goodsManage/deleteShopVideo",payload:{id:o}}).then((function(){g.Z.showToast("删除成功")}))}))})),(0,l.Z)((0,s.Z)(e),"onVideoClick",(function(e){u().navigateTo({url:"/subpackages/cloud_bill/pages/video_player_page/index?videoUrl=".concat(e.videoUrl)})})),e}return(0,t.Z)(i,[{key:"componentDidMount",value:function(){var e=this;(0,h.OA)().then((function(o){var i=o.data;e.sign=i.sign}))}},{key:"componentDidShow",value:function(){(0,k.ZT)("门店视频")}},{key:"componentDidUpdate",value:function(e){this.props.videos.length>e.videos.length&&this.startRefreshVideoTimer()}},{key:"componentWillUnmount",value:function(){this.clearRefreshTimer()}},{key:"render",value:function(){var e=this,o=this.props.videos;return(0,R.jsxs)(_.View,{className:V,children:[o.length>0?(0,R.jsx)(_.View,{className:j,children:o.map((function(o){return(0,R.jsxs)(_.View,{className:U,children:[o.coverUrl?(0,R.jsx)(_.Image,{src:o.coverUrl,className:I,mode:"aspectFit",onClick:function(){return e.onVideoClick(o)}}):(0,R.jsx)(_.Image,{src:T,className:S,onClick:function(){return e.onVideoClick(o)}}),(0,R.jsx)(_.Image,{src:x,className:M,onClick:function(){return e.onDeleteClick(o.id)}}),(0,R.jsx)(_.Image,{src:w.Z.common.play_96,className:b,onClick:function(){return e.onVideoClick(o)}})]},o.videoUrl)}))}):(0,R.jsx)(_.View,{className:y,children:(0,R.jsxs)(_.View,{className:N,children:[(0,R.jsx)(_.View,{children:"档口视频名片"}),(0,R.jsx)(_.View,{children:"让客户更容易记住"})]})}),(0,R.jsx)(_.View,{onClick:this.onUploadClick,className:C,children:"上传视频"})]})}}]),i}(p.PureComponent),F=(0,m.$j)((function(e){var o=e.shop,i=(e.systemInfo,e.user,e.loading,e.goodsManage);o.list.find((function(e){return e.id===i.mpErpId}));return{videos:i.videos||[]}}))(D);Page((0,n.createPageConfig)(F,"subpackages/cloud_bill/pages/video_edit/index",{root:{cn:[]}},{navigationBarTitleText:"门店视频"}||{}))}},function(e){e.O(0,[666,1772,4618,2107,1216,8592],(function(){return o=25223,e(e.s=o);var o}));e.O()}]);