"use strict";require("../../sub-vendors.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[7890],{7741:function(e,s,a){var t=a(32180),o=a(57543),i=a(77886),n=a(33661),r=a(12742),c=a(22700),l=a(95333),d=a(14175),p=a(3701),g=a(92954),h=a.n(g),_=a(67294),u=a(71515),m=a(75508),S=a(41115),I=a(15604),f=a(14067),v=a(53252),Z=a(24962),k=a(6420),w=a(80170),x=a(63056),N=a(51958),C=a(26902),y=a(90311),j=a(51150),V=a(75150),T=a(85893),b=function(e){(0,l.Z)(a,e);var s=(0,d.Z)(a);function a(){var e;(0,n.Z)(this,a);for(var t=arguments.length,r=new Array(t),l=0;l<t;l++)r[l]=arguments[l];return e=s.call.apply(s,[this].concat(r)),(0,p.Z)((0,c.Z)(e),"state",{shareViewMask:!1,imageSource:[],shareType:"prewview",setClipSuccess:!1,groupId:-1,isSaved:!1,isStart:!1,groupLink:""}),(0,p.Z)((0,c.Z)(e),"goodImgInfo",{height:1038,type:"png",width:825}),(0,p.Z)((0,c.Z)(e),"titleValue",""),(0,p.Z)((0,c.Z)(e),"canvasIns",null),(0,p.Z)((0,c.Z)(e),"canvasImages",[]),(0,p.Z)((0,c.Z)(e),"updateImageSource",(function(s){e.canvasImages=s,e.setState({imageSource:s.map((function(e,s){return{url:e.imgUrl?e.imgUrl:"",name:e.name||"",code:e.code||"",orderBy:s,imgUrls:e.imgUrls,styleId:e.styleId,imgUrl:e.imgUrl}}))})})),(0,p.Z)((0,c.Z)(e),"onAddGoodsClick",(0,i.Z)((0,o.Z)().mark((function s(){return(0,o.Z)().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(!(e.canvasImages.length<20)){s.next=9;break}return s.next=3,e.props.dispatch({type:"goodsManage/fetchGoodsList",payload:{styleIdsNotIn:e.canvasImages.map((function(e){return e.styleId}))}});case 3:return e.props.dispatch({type:"goodsManage/save",payload:{useGoodsSpus:e.canvasImages}}),s.next=6,e.props.dispatch({type:"goodsManage/checkePartGoods",payload:{styleIds:e.canvasImages.map((function(e){return e.styleId}))}});case 6:h().navigateTo({url:"/subpackages/cloud_bill/pages/use_goods/index?from=share"}),s.next=10;break;case 9:x.Z.showToast("商品集合数量上限20");case 10:case"end":return s.stop()}}),s)})))),(0,p.Z)((0,c.Z)(e),"onMovableChange",(function(s){e.canvasImages=s})),(0,p.Z)((0,c.Z)(e),"onInput",(function(s){e.titleValue=s.detail.value})),(0,p.Z)((0,c.Z)(e),"onPreViewClick",(function(){e.canvasImages.length?e.setState({shareViewMask:!0,shareType:"prewview"}):h().showToast({title:"请选择货品",icon:"none"})})),(0,p.Z)((0,c.Z)(e),"onShareClick",(function(){var s,a=e.props,t=a.mpErpId,o=a.shopName,i=(0,k.JU)(null===(s=h().getCurrentInstance)||void 0===s?void 0:s.call(h())).type,n=e.getTitleInfo();e.canvasImages.length?e.state.isSaved?e.setState({shareViewMask:!0,shareType:"share"}):(0,f.CD)({jsonParam:{mpErpId:t,name:e.titleValue||"".concat(o).concat(n.label),spuIds:e.canvasImages.map((function(e){return e.styleId})).join(","),type:Number(i)}}).then((function(s){var a=s.data;e.setState({shareViewMask:!0,shareType:"share",groupId:a.val,isSaved:!0}),h().eventCenter.trigger("FETCH_GROUP_LIST")})):h().showToast({title:"请选择货品",icon:"none"}),w.Z.track(Z.ZP.goodsShareEditClick)})),(0,p.Z)((0,c.Z)(e),"onCloseShare",(function(){var s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e.setState({shareViewMask:!1},(function(){var a;e.state.isSaved&&s&&h().redirectTo({url:"/subpackages/cloud_bill/pages/groups_detail/index?id=".concat(e.state.groupId,"&type=").concat((0,k.JU)(null===(a=h().getCurrentInstance)||void 0===a?void 0:a.call(h())).type)})}))})),(0,p.Z)((0,c.Z)(e),"onShareItemClick",(function(s,a){"map"===s&&e.shareMiniCard(a),"monents"===s&&e.shareMonents(a),"firends"===s&&e.shareFirends(a)})),(0,p.Z)((0,c.Z)(e),"shareMonents",(function(s){"slh"===e.props.appName?(0,I.f)(JSON.stringify({eventType:"shareImageToWechat",data:{isTimeline:!0,imgDataStr:s}})):(0,I.f)(JSON.stringify({eventType:"shareWxMoments",data:s}))})),(0,p.Z)((0,c.Z)(e),"shareFirends",(function(s){"slh"===e.props.appName?(0,I.f)(JSON.stringify({eventType:"shareImageToWechat",data:{isTimeline:!1,imgDataStr:s}})):(0,I.f)(JSON.stringify({eventType:"shareImageToFriends",data:s}))})),(0,p.Z)((0,c.Z)(e),"shareMiniCard",(function(s){var a="";if(e.canvasImages[0]&&(e.canvasImages[0].url?a=e.canvasImages[0].url:e.canvasImages[0].imgUrls&&(a=e.canvasImages[0].imgUrls[0])),(0,S.$L)()){var t,o=e.getTitleInfo(),i=e.props.shopName;(0,I.f)(JSON.stringify({eventType:"shareWxMiniProgram",data:(t={title:e.titleValue||"".concat(i).concat(o.label),path:"/subpackages/cloud_bill/pages/goods_share_collection/index?mpErpId=".concat(e.props.mpErpId,"&groupId=").concat(e.state.groupId),thumImageUrl:a,desc:""},(0,p.Z)(t,"slh"===e.props.appName?"miniprogramType":"miniProgramType",2),(0,p.Z)(t,"userName",v.Z.appUserName),t)}))}})),(0,p.Z)((0,c.Z)(e),"getTitleInfo",(function(){var e,s=(0,k.JU)(null===(e=h().getCurrentInstance)||void 0===e?void 0:e.call(h())).type;return"0"===s?{title:"自定义商品集合",label:"推荐款",icon:j}:"1"===s?{title:"爆款商品集合",label:"爆款集合",icon:C}:{title:"上新商品集合",label:"上新集合",icon:y}})),(0,p.Z)((0,c.Z)(e),"setClipSuccess",(function(s){e.setState({setClipSuccess:!0,shareViewMask:!1,groupLink:s})})),(0,p.Z)((0,c.Z)(e),"onSuccessClick",(function(){e.setState({setClipSuccess:!1})})),(0,p.Z)((0,c.Z)(e),"onShart",(function(){e.setState({isStart:!0})})),(0,p.Z)((0,c.Z)(e),"onEnd",(function(){e.setState({isStart:!1})})),(0,p.Z)((0,c.Z)(e),"renderSetClipSuccess",(function(){var s=e.state.groupLink;return(0,T.jsx)(u.View,{className:"goods_share__mask",children:(0,T.jsxs)(u.View,{className:"goods_share__mask__clipSuccess",children:[(0,T.jsx)(u.View,{className:"goods_share__mask__clipSuccess__title",children:"小程序链接已复制"}),(0,T.jsx)(u.View,{className:"goods_share__mask__clipSuccess__label",children:"发送给客户或发朋友圈"}),(0,T.jsx)(u.View,{className:"goods_share__mask__clipSuccess__successContent",children:s}),(0,T.jsx)(u.View,{className:"goods_share__mask__clipSuccess__action",onClick:e.onSuccessClick,children:"好的"})]})})})),e}return(0,r.Z)(a,[{key:"componentDidMount",value:function(){var e,s=(0,k.JU)(null===(e=h().getCurrentInstance)||void 0===e?void 0:e.call(h())).type;if("1"===s)if(this.props.hotGoodsList.length){var a=this.props.hotGoodsList.filter((function(e){return""!==e.allImgUrlBig}));this.updateImageSource(a)}else this.updateImageSource(this.props.useGoodsSpus.filter((function(e){return""!==e.allImgUrlBig})));if("2"===s)if(this.props.newGoodsList.length){var t=this.props.newGoodsList.filter((function(e){return""!==e.allImgUrlBig}));this.updateImageSource(t)}else this.updateImageSource(this.props.useGoodsSpus.filter((function(e){return""!==e.allImgUrlBig})));"0"===s&&this.props.useGoodsSpus.length&&this.updateImageSource(this.props.useGoodsSpus.filter((function(e){return""!==e.allImgUrlBig})))}},{key:"componentDidUpdate",value:function(e){e.useGoodsSpus!==this.props.useGoodsSpus&&this.updateImageSource(this.props.useGoodsSpus)}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:"goodsManage/clearShareGoods"})}},{key:"onShareAppMessage",value:function(){var e=this.props,s=e.mpErpId,a=e.shopName,t=this.state,o=t.groupId,i=t.imageSource,n=this.getTitleInfo(),r="";return i[0]&&(i[0].url?r=i[0].url:i[0].imgUrls&&(r=i[0].imgUrls[0])),{title:this.titleValue||"".concat(a).concat(n.label),path:"/subpackages/cloud_bill/pages/goods_share_collection/index?mpErpId=".concat(s,"&groupId=").concat(o),imageUrl:r}}},{key:"render",value:function(){var e,s=this.state,a=s.shareViewMask,t=s.imageSource,o=s.shareType,i=s.setClipSuccess,n=s.groupId,r=(s.isStart,this.props),c=r.shopName,l=r.appName,d=this.getTitleInfo(),p=(0,k.JU)(null===(e=h().getCurrentInstance)||void 0===e?void 0:e.call(h())).type;return(0,T.jsxs)(u.View,{className:"goods_share_edit_page",children:[(0,T.jsxs)(u.View,{className:"goods_share_edit_page__wrapper flex1 scroll",children:[(0,T.jsxs)(u.View,{className:"goods_share_edit_page__top aic",children:[(0,T.jsx)(u.Image,{className:"goods_share_edit_page__top__image",src:d.icon}),(0,T.jsxs)(u.View,{className:"",children:[(0,T.jsx)(u.View,{className:"goods_share_edit_page__top__title",children:d.title}),(0,T.jsx)(u.Text,{children:"系统将为您自动拼图"})]})]}),(0,T.jsxs)(u.View,{className:"goods_share_edit_page__header",children:[(0,T.jsx)(u.View,{className:"goods_share_edit_page__header__title",children:"标题"}),(0,T.jsx)(u.Input,{maxLength:20,className:"goods_share_edit_page__header__input",placeholder:"".concat(c).concat(d.label),onInput:this.onInput})]}),(0,T.jsxs)(u.View,{className:"goods_share_edit_page__goods",children:["0"===p?(0,T.jsxs)(u.View,{className:"goods_share_edit_page__goods__header jcsb",children:[(0,T.jsx)(u.Text,{className:"goods_share_edit_page__goods__header__title",children:"商品集合"}),t.length>0&&(0,T.jsx)(u.View,{className:"goods_share_edit_page__goods__header__add",onClick:this.onAddGoodsClick,children:"添加"})]}):(0,T.jsxs)(u.View,{className:"goods_share_edit_page__goods__header jcsb",children:[(0,T.jsx)(u.Text,{className:"goods_share_edit_page__goods__header__title",children:"1"===p?"近期爆款的商品":"近期上架的商品"}),(0,T.jsx)(u.View,{className:"goods_share_edit_page__goods__header__add",onClick:this.onAddGoodsClick,children:"添加"})]}),0===t.length&&"0"===p&&(0,T.jsx)(u.View,{className:"goods_share_edit_page__goods__addgoods aic jcc",onClick:this.onAddGoodsClick,children:"+添加商品"}),t.length>=12&&(0,T.jsx)(u.View,{className:"goods_share_edit_page__goods__tips",children:(0,T.jsx)(u.Text,{children:"拼图数量上限12，请将主推款拖动调整至前12"})}),t.length>0&&(0,T.jsx)(u.View,{className:"goods_share_edit_page__goods__movable",children:(0,T.jsx)(V.Z,{onStart:this.onShart,onEnd:this.onEnd,onImageChange:this.onMovableChange,defaultImages:t,from:"goods_share"})}),(0,T.jsx)(u.View,{className:"goods_share_edit_page__goods__list"})]})]}),(0,T.jsxs)(u.View,{className:"goods_share_edit_page__bottom jcsb",children:[(0,T.jsx)(u.View,{className:"goods_share_edit_page__bottom__actionLeft aic jcc",onClick:this.onPreViewClick,children:"预览"}),(0,T.jsx)(u.View,{className:"goods_share_edit_page__bottom__actionRight aic jcc",onClick:this.onShareClick,children:"立即分享"})]}),a&&(0,T.jsx)(N.Z,{imageSource:this.canvasImages,shopName:c,onCloseShare:this.onCloseShare,onShareItemClick:this.onShareItemClick,onSetClipSuccess:this.setClipSuccess,onShareClick:this.onShareClick,shareType:o,appName:l,groupId:n}),i&&this.renderSetClipSuccess()]})}}]),a}(_.PureComponent),U=(0,m.$j)((function(e){var s=e.goodsManage;return{useGoodsSpus:s.useGoodsSpus,shopName:s.shopName,hotGoodsList:s.manageHotList,newGoodsList:s.manageNewList,mpErpId:s.mpErpId,appName:s.appName,goodsList:s.goodsList}}))(b);U.enableShareAppMessage=!0;Page((0,t.createPageConfig)(U,"subpackages/cloud_bill/pages/goods_share_edit/index",{root:{cn:[]}},{navigationBarTitleText:""}||{}))}},function(e){e.O(0,[666,1772,2107,1216,8592],(function(){return s=7741,e(e.s=s);var s}));e.O()}]);