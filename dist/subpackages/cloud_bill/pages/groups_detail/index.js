"use strict";require("../../sub-vendors.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[6661],{42591:function(e,a,s){var t=s(32180),i=s(65712),n=s(57543),r=s(77886),o=s(33661),c=s(12742),l=s(22700),p=s(95333),_=s(14175),d=s(3701),u=s(92954),g=s.n(u),h=s(71515),m=s(67294),S=s(75508),f=s(6420),C=s(14067),N=s(40068),Z=s(63056),v=s(15604),k=s(41115),w=s(53252),I=s(51958),x=s(85893),j=function(e){(0,p.Z)(s,e);var a=(0,_.Z)(s);function s(){var e;(0,o.Z)(this,s);for(var t=arguments.length,i=new Array(t),c=0;c<t;c++)i[c]=arguments[c];return e=a.call.apply(a,[this].concat(i)),(0,d.Z)((0,l.Z)(e),"state",{goodsList:[],title:"",shareViewMask:!1,shareTitle:"",setClipSuccess:!1,groupLink:""}),(0,d.Z)((0,l.Z)(e),"onShareItemClick",function(){var a=(0,r.Z)((0,n.Z)().mark((function a(s,t){return(0,n.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:"map"===s&&e.shareMiniCard(t),"monents"===s&&e.shareMonents(t),"firends"===s&&e.shareFirends(t);case 3:case"end":return a.stop()}}),a)})));return function(e,s){return a.apply(this,arguments)}}()),(0,d.Z)((0,l.Z)(e),"shareMiniCard",(function(a){var s=e.updateImageSource(e.state.goodsList)._imageSource,t="";if(s[0]&&(s[0].url?t=s[0].url:s[0].imgUrls&&(t=s[0].imgUrls[0])),(0,k.$L)()){var i,n,r=e.props.mpErpId,o=e.state.shareTitle,c=(0,f.JU)(null===(i=g().getCurrentInstance)||void 0===i?void 0:i.call(g())).id;(0,v.f)(JSON.stringify({eventType:"shareWxMiniProgram",data:(n={title:o,path:"/subpackages/cloud_bill/pages/goods_share_collection/index?mpErpId=".concat(r,"&groupId=").concat(c),thumImageUrl:t,desc:""},(0,d.Z)(n,"slh"===e.props.appName?"miniprogramType":"miniProgramType",2),(0,d.Z)(n,"userName",w.Z.appUserName),n)}))}})),(0,d.Z)((0,l.Z)(e),"shareMonents",(function(a){"slh"===e.props.appName?(0,v.f)(JSON.stringify({eventType:"shareImageToWechat",data:{isTimeline:!0,imgDataStr:a}})):(0,v.f)(JSON.stringify({eventType:"shareWxMoments",data:a}))})),(0,d.Z)((0,l.Z)(e),"shareFirends",(function(a){"slh"===e.props.appName?(0,v.f)(JSON.stringify({eventType:"shareImageToWechat",data:{isTimeline:!1,imgDataStr:a}})):(0,v.f)(JSON.stringify({eventType:"shareImageToFriends",data:a}))})),(0,d.Z)((0,l.Z)(e),"onManageClick",(function(){g().showActionSheet({itemList:["删除集合"]}).then((function(){var e,a=(0,f.JU)(null===(e=g().getCurrentInstance)||void 0===e?void 0:e.call(g())).id;Z.Z.showAlertWithCancel("删除后集合失效，确认删除吗？","提示",(function(){(0,C.F)({id:a}).then((function(e){0===e.code&&(g().eventCenter.trigger("FETCH_GROUP_LIST"),g().navigateBack())})).catch((function(e){g().hideLoading()}))}))})).catch((function(e){console.log(e,"ee")}))})),(0,d.Z)((0,l.Z)(e),"onShareClick",(function(){e.setState({shareViewMask:!0})})),(0,d.Z)((0,l.Z)(e),"onCloseShare",(function(){e.setState({shareViewMask:!1})})),(0,d.Z)((0,l.Z)(e),"onSuccessClick",(function(){e.setState({setClipSuccess:!1})})),(0,d.Z)((0,l.Z)(e),"setClipSuccess",(function(a){e.setState({shareViewMask:!1,setClipSuccess:!0,groupLink:a})})),(0,d.Z)((0,l.Z)(e),"updateImageSource",(function(e){return e.map((function(e,a){return{url:e.imgUrl?e.imgUrl:"",name:e.name||"",code:e.code||"",orderBy:a,imgUrls:e.imgUrls,styleId:e.styleId}}))})),(0,d.Z)((0,l.Z)(e),"renderSetClipSuccess",(function(){var a=e.state.groupLink;return(0,x.jsx)(h.View,{className:"goods_share__mask",children:(0,x.jsxs)(h.View,{className:"goods_share__mask__clipSuccess",children:[(0,x.jsx)(h.View,{className:"goods_share__mask__clipSuccess__title",children:"小程序链接已复制"}),(0,x.jsx)(h.View,{className:"goods_share__mask__clipSuccess__label",children:"发送给客户或发朋友圈"}),(0,x.jsx)(h.View,{className:"goods_share__mask__clipSuccess__successContent",children:a}),(0,x.jsx)(h.View,{className:"goods_share__mask__clipSuccess__action",onClick:e.onSuccessClick,children:"好的"})]})})})),e}return(0,c.Z)(s,[{key:"componentDidMount",value:function(){var e,a=this,s=(0,f.JU)(null===(e=g().getCurrentInstance)||void 0===e?void 0:e.call(g())),t=s.id,n=s.type,r="";"0"===n&&(r="自定义集合"),"1"===n&&(r="爆款集合"),"2"===n&&(r="上新集合"),g().showLoading({title:"请稍等..."}),Promise.all([(0,C.X)({pageSize:20,jsonParam:{type:8,mpErpId:this.props.mpErpId,groupId:t}}),(0,C.nP)({id:t})]).then((function(e){var s=(0,i.Z)(e,2),t=s[0],n=s[1];g().hideLoading(),a.setState({goodsList:t.data.rows,title:r,shareTitle:n.name})})).catch((function(){g().hideLoading()}))}},{key:"onShareAppMessage",value:function(){var e,a=this.state.shareTitle,s=this.props.mpErpId,t=(0,f.JU)(null===(e=g().getCurrentInstance)||void 0===e?void 0:e.call(g())).id;return{title:a,path:"/subpackages/cloud_bill/pages/goods_share_collection/index?mpErpId=".concat(s,"&groupId=").concat(t)}}},{key:"render",value:function(){var e,a=this.state,s=a.goodsList,t=a.title,i=a.shareViewMask,n=a.setClipSuccess,r=this.props,o=r.shopName,c=r.appName,l=(0,f.JU)(null===(e=g().getCurrentInstance)||void 0===e?void 0:e.call(g())).id,p=this.updateImageSource(s);return(0,x.jsxs)(h.View,{className:"group_detail_page",children:[(0,x.jsxs)(h.View,{className:"group_detail_page__content",children:[(0,x.jsx)(h.View,{className:"group_detail_page__content__header",children:t}),(0,x.jsxs)(h.View,{className:"group_detail_page__content__list",children:[s.map((function(e){return(0,x.jsxs)(h.View,{className:"group_detail_page__content__list__item",children:[(0,x.jsx)(h.View,{className:"group_detail_page__content__list__item__goodsImage",children:(0,x.jsx)(N.Z,{src:e.imgUrls,mode:"aspectFill"})}),(0,x.jsx)(h.View,{className:"group_detail_page__content__list__item__goodsName",children:e.name}),(0,x.jsx)(h.View,{className:"group_detail_page__content__list__item__goodsCode",children:e.code})]},e.id)})),s.length%3==2&&(0,x.jsx)(h.View,{className:"group_detail_page__content__list__item"})]})]}),(0,x.jsxs)(h.View,{className:"group_detail_page__bottom jcsb",children:[(0,x.jsx)(h.View,{className:"group_detail_page__bottom__actionLeft aic jcc",onClick:this.onManageClick,children:"管理"}),(0,x.jsx)(h.View,{className:"group_detail_page__bottom__actionRight aic jcc",onClick:this.onShareClick,children:"立即分享"})]}),i&&(0,x.jsx)(I.Z,{shareType:"share",imageSource:p,shopName:o,onCloseShare:this.onCloseShare,onShareItemClick:this.onShareItemClick,onSetClipSuccess:this.setClipSuccess,appName:c,groupId:Number(l)}),n&&this.renderSetClipSuccess()]})}}]),s}(m.Component),y=(0,S.$j)((function(e){var a=e.goodsManage;return{mpErpId:a.mpErpId,shopName:a.shopName,appName:a.appName}}))(j);y.enableShareAppMessage=!0;Page((0,t.createPageConfig)(y,"subpackages/cloud_bill/pages/groups_detail/index",{root:{cn:[]}},{navigationBarTitleText:"集合详情"}||{}))}},function(e){e.O(0,[666,1772,2107,1216,8592],(function(){return a=42591,e(e.s=a);var a}));e.O()}]);