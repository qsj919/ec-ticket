"use strict";require("../../sub-vendors.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[8734],{66734:function(e,s,_){var n=_(32180),t=_(33661),a=_(12742),i=_(22700),o=_(95333),u=_(14175),l=_(3701),c=_(92954),d=_.n(c),r=_(67294),p=_(96486),h=_(71515),m=_(844),x=_(49181),g=_(75508),k=_(63056),f=_(6420),N=_(19497),w=_(67190),y=_(67045),C=_(2021),j=_(91629),b=_(7567),v="index-module__navigationClass___cqB3f",Z="index-module__titleTextClass___KoTMl",S="index-module__containerClass___prDlm",V="index-module__manage-btn___WsA9O",I="index-module__manage-btn_text___FZjA6",L="index-module__page___oFAzl",A="index-module__container___WhtX_",B="index-module__footer___JHq7D",T="index-module__footer__check_all___ktfpV",P="index-module__check_icon___KqxSL",M="index-module__footer__right___pCFNu",E="index-module__footer__right__total___PlgPI",W=_(65712),O=_(59009),F=_(57858),G=_(94184),U=_.n(G),D=_(59132),H=_(61270),J=_(86889),q={sku:"index-module__sku___v3QZ5","sku--group":"index-module__sku--group___y3Yo9",sku__content:"index-module__sku__content___rSOmd",sku__name:"index-module__sku__name___BEvfD",sku__label:"index-module__sku__label___XhSC4",sku__group_label:"index-module__sku__group_label___aHxtH",sku__stepper:"index-module__sku__stepper___LuOP0",sku__stepper__group_total:"index-module__sku__stepper__group_total___vSGpI",check:"index-module__check___K2E7d",check_icon:"index-module__check_icon___SWtHU",spu:"index-module__spu___rU5Co",spu__check:"index-module__spu__check___bi7B_",spu__check_icon:"index-module__spu__check_icon___Jvaou",spu__header:"index-module__spu__header___kqyRK",spu__header__main:"index-module__spu__header__main___Yg2sY",spu__header__img:"index-module__spu__header__img___F76Xh",spu__header__img__disabled:"index-module__spu__header__img__disabled___U9gso",spu__header__content:"index-module__spu__header__content___muN2M",spu__header__code:"index-module__spu__header__code___JWVSf",spu__header__name:"index-module__spu__header__name___yT5xK",spu__header__price:"index-module__spu__header__price___u8VkA",spu__header__price_tag:"index-module__spu__header__price_tag___Wegco",spu__header__toggle_sku:"index-module__spu__header__toggle_sku___flu5d","spu__header__toggle_sku--bottom":"index-module__spu__header__toggle_sku--bottom___hkjpq",spu__skus:"index-module__spu__skus___E9BJz"},K=_(85893),X=[{text:"删除",style:{backgroundColor:J.Z.themeColor}}];function Y(e){var s=e.spu,_=e.dispatch,n=e.index,t=e.manage,a=e.spuShowPrice,i=(e.industries,s&&s.skus[0]),o=(0,r.useState)((function(){return s&&s.skus.every((function(e){return e.num<1}))})),u=(0,W.Z)(o,2),c=u[0],p=(u[1],(0,r.useMemo)((function(){return s&&0===s.flag}),[s])),m=(0,r.useMemo)((function(){return s&&s.skus.every((function(e){return e.checked}))}),[s]);(0,r.useEffect)((function(){p&&!t&&m&&_({type:"replenishment/checkSpu",payload:{index:n,checked:!m}})}),[t,s,p,_,n,m]);var x=(0,r.useMemo)((function(){var e=s&&s.skus||[];return c?e:e.filter((function(e){return e.num>0}))}),[s,c]),g=function(e){return function(s){var t=e.groupNum;if(t){var a=e.num/t;s=(t=s)*a}_({type:"replenishment/updateGoodsNumInCart",payload:{spuIndex:n,id:e.id,num:s,groupNum:t}})}};return(0,K.jsxs)(h.View,{className:q.spu,children:[(0,K.jsxs)(h.View,{className:q.spu__header,children:[(0,K.jsx)(h.View,{className:q.spu__check,onClick:function(){p&&!t||_({type:"replenishment/checkSpu",payload:{index:n,checked:!m}})},children:(0,K.jsx)(h.Image,{src:m?w:y,className:q.spu__check_icon})}),(0,K.jsxs)(h.View,{className:q.spu__header__main,children:[(0,K.jsxs)(h.View,{className:q.spu__header__img,children:[(0,K.jsx)(h.Image,{mode:"aspectFill",style:{width:"100%",height:"100%"},src:s.imgUrl||O}),p&&(0,K.jsx)(h.View,{className:q.spu__header__img__disabled,children:"已失效"})]}),(0,K.jsxs)(h.View,{className:q.spu__header__content,children:[(0,K.jsx)(h.View,{className:q.spu__header__code,children:s.code}),(0,K.jsx)(h.View,{className:q.spu__header__name,children:s.name})]})]})]}),s&&(0,K.jsxs)(h.View,{className:q.spu__skus,children:[x.map((function(e,s){return(0,K.jsx)(D.AtSwipeAction,{options:X,autoClose:!0,onClick:function(){!function(e){k.Z.showAlertWithCancel("确认删除?","",(function(){_({type:"replenishment/deleteFromCart",payload:{spuIndex:n,id:e.id}})}))}(e)},disabled:t,maxDistance:100,areaWidth:.88*d().getSystemInfoSync().windowWidth,children:(0,K.jsxs)(h.View,{className:U()(q.sku,(0,l.Z)({},q["sku--group"],e.groupNum&&e.groupNum>0&&e.groupNum!==e.num)),onClick:function(){!function(e){p||_({type:"replenishment/updateSku",payload:{spuIndex:n,id:e.id,checked:!e.checked}})}(e)},children:[(0,K.jsx)(h.View,{className:q.check,children:(0,K.jsx)(h.Image,{src:e.checked?w:y,className:q.check_icon})}),(0,K.jsxs)(h.View,{className:q.sku__content,children:[(0,K.jsxs)(h.View,{className:q.sku__name,children:[a&&(0,K.jsxs)(h.Text,{className:q.sku__label,children:["¥".concat(e.price)," "]}),(0,K.jsxs)(h.Block,{children:[(0,K.jsxs)(h.Text,{className:q.sku__label,children:[e.colorName," "]}),(0,K.jsxs)(h.View,{className:U()(q.sku__label,q["sku__label--s"]),children:[(0,K.jsx)(h.Text,{children:e.sizeName}),e.groupNum&&e.groupNum>0&&e.groupNum!==e.num&&(0,K.jsx)(h.Text,{className:q.sku__group_label,children:"(1手".concat(e.num/e.groupNum,"件)")})]})]}),(0,K.jsx)(h.Text,{style:{flex:.5},className:q.sku__label})]}),(0,K.jsxs)(h.View,{className:q.sku__stepper,children:[(0,K.jsx)(H.Z,{type:"number",value:e.groupNum?e.groupNum:e.num,min:1,onChange:g(e),disabled:p}),e.groupNum&&e.groupNum>0&&e.groupNum!==e.num&&(0,K.jsx)(h.Text,{className:q.sku__stepper__group_total,children:"共".concat(e.num,"件")})]})]})]})},e.id)})),!p&&(0,K.jsx)(h.View,{style:{marginTop:"10px",marginLeft:"24rpx"},children:(0,K.jsx)(F.Z,{rem:s.skus[0].rem,onConfirm:function(e){_({type:"replenishment/updateCartGoodsRem",payload:{spuIndex:n,id:i.id,rem:e}})}})})]})]})}var z=d().memo(Y);Y.defaultProps={spu:{},index:0,industries:!1};var R=function(e){(0,o.Z)(_,e);var s=(0,u.Z)(_);function _(){var e;(0,t.Z)(this,_);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return e=s.call.apply(s,[this].concat(a)),(0,l.Z)((0,i.Z)(e),"emptyInfo",{image:C.Z.goods.cart_no_goods,label:"进货车里空空如也"}),(0,l.Z)((0,i.Z)(e),"state",{manage:!1,firstShowLoading:!0}),(0,l.Z)((0,i.Z)(e),"onManageClick",(function(){e.setState((function(e){return{manage:!e.manage}}))})),(0,l.Z)((0,i.Z)(e),"onCheckAll",(0,p.debounce)((function(){var s=e.props,_=s.isAllChecked;s.spus.length<=0||d().showLoading({title:"加载中"}).then((function(){e.props.dispatch({type:"replenishment/toggleAllChecked",payload:{checked:!_}})}))}),200)),(0,l.Z)((0,i.Z)(e),"onConfirm",(function(){var s=e.props,_=s.totalNum,n=s.atLeastOneChecked,t=s.spuShowPrice;if(e.state.manage)k.Z.showAlertWithCancel("确认将".concat(_,"件商品删除?"),"",(function(){e.props.dispatch({type:"replenishment/deleteFromCart",payload:{ids:e.props.checkedSkuIds}})}));else{if(!n||_<=0)return k.Z.showToast("请至少选择一件商品");e.props.dispatch({type:"replenishment/confirmGoodsAndGetShopInfo",payload:{spuShowPrice:t}}),d().navigateTo({url:"/subpackages/cloud_bill/pages/replenishment_confirm/index"})}})),(0,l.Z)((0,i.Z)(e),"onReload",(function(){d().showLoading({title:"加载中"}),e.props.dispatch({type:"replenishment/fetchCartGoodsList"}).then((function(){d().hideLoading()})).catch((function(){d().hideLoading()}))})),(0,l.Z)((0,i.Z)(e),"onGoListClick",(function(){var s,_=(0,f.JU)(null===(s=d().getCurrentInstance)||void 0===s?void 0:s.call(d())),n=_.from,t=_.mpErpId;"ticketDetail"===n?(e.props.dispatch({type:"cloudBill/init",payload:{mpErpId:t}}),j.Z.redirectTo({url:"/subpackages/cloud_bill/pages/all_goods/index"})):d().navigateBack({delta:1})})),(0,l.Z)((0,i.Z)(e),"renderManageBtn",(function(){var s=e.props,_=s.statusBarHeight,n=s.gap,t=e.state.manage;return(0,K.jsx)(h.View,{className:V,style:"top: ".concat(_+n,"px"),onClick:e.onManageClick,children:(0,K.jsx)(h.Text,{className:I,children:t?"完成":"管理"})})})),e}return(0,a.Z)(_,[{key:"UNSAFE_componentWillMount",value:function(){this.state.firstShowLoading&&(this.setState({firstShowLoading:!1}),d().showLoading({title:"加载中"}))}},{key:"componentDidMount",value:function(){d().hideLoading()}},{key:"componentDidUpdate",value:function(e){e.isAllChecked!==this.props.isAllChecked&&d().hideLoading()}},{key:"render",value:function(){var e=this,s=this.props,_=s.spus,n=s.totalMoney,t=s.totalNum,a=s.isAllChecked,i=s.atLeastOneChecked,o=s.mpErpId,u=s.spuShowPrice,l=s.shopList,c=this.state.manage,d=l.find((function(e){return e.id===Number(o)}));return(0,K.jsxs)(m.Z,{enableBack:!0,stickyTop:!1,disableIphoneXPaddingBottom:!0,title:"进货车",titleTextClass:Z,containerClass:S,navigationClass:v,children:[this.renderManageBtn(),(0,K.jsxs)(h.View,{className:L,children:[_.length>0?(0,K.jsx)(h.View,{className:A,children:_.map((function(s,_){return(0,K.jsx)(z,{dispatch:e.props.dispatch,spu:s,spuShowPrice:u,index:_,manage:c,industries:!!d&&d.industries},s.code)}))}):(0,K.jsx)(h.View,{style:{flex:1},children:(0,K.jsx)(N.Z,{style:{position:"absolute",width:"100%",height:"90%",left:"50%",top:"50%",transform:"translateX(-50%) translateY(-50%)"},needShowButton:!0,onButtonClick:this.onGoListClick,emptyInfo:this.emptyInfo,buttonLabel:"去逛逛"})}),(0,K.jsxs)(h.View,{className:B,children:[(0,K.jsxs)(h.View,{className:T,onClick:this.onCheckAll,children:[(0,K.jsx)(h.Image,{src:a?w:y,className:P}),(0,K.jsx)(h.Text,{children:"全选"})]}),(0,K.jsxs)(h.View,{className:M,children:[!c&&(0,K.jsxs)(h.View,{className:E,children:["".concat(t,"件"),u&&(0,K.jsx)(h.Text,{className:"highlight_text",children:"¥".concat(n,"元")})]}),(0,K.jsx)(x.Z,{label:c?"删除":"确认下单",width:240,onButtonClick:this.onConfirm,disabled:!i})]})]})]})]})}}]),_}(r.PureComponent),$=(0,g.$j)((function(e){var s=e.systemInfo,_=e.replenishment,n=e.cloudBill,t=e.shop,a=(0,b.NU)(_.spus),i=a.totalMoney,o=a.totalNum,u=a.isAllChecked,l=a.atLeastOneChecked;return{checkedSkuIds:(0,b.M$)(_),gap:s.gap,statusBarHeight:s.statusBarHeight,spus:_.spus,totalNum:o,totalMoney:i,isAllChecked:u,atLeastOneChecked:l,mpErpId:n.mpErpId,spuShowPrice:"1"===n.shopParams.spuShowPrice,shopList:t.list}}))(R);Page((0,n.createPageConfig)($,"subpackages/cloud_bill/pages/replenishment/index",{root:{cn:[]}},{navigationStyle:"custom"}||{}))}},function(e){e.O(0,[2107,1216,8592],(function(){return s=66734,e(e.s=s);var s}));e.O()}]);