"use strict";require("../../sub-vendors.js");require("../../sub-common/1953cfd0adfeaa0d6d261e56d0b37b07.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[1805],{94070:function(e,i,s){var n=s(32180),a=s(18453),l=s(66058),t=s(33661),c=s(12742),o=s(22700),r=s(95333),d=s(14175),u=s(3701),A=s(92954),m=s.n(A),p=s(67294),h=s(71515),_=s(75508),w=s(14067),k=s(29748),f=s(35314),x=s(41115),g=s(28374),N=s(63056),j=s(64962),C=s(27863),v=s(75632),V=s(47741),I=s(6949),y=s(6420),Z=s(27484),b=s.n(Z),S=s(96999),B=s(85893),D=function(e){(0,r.Z)(s,e);var i=(0,d.Z)(s);function s(){var e;(0,t.Z)(this,s);for(var n=arguments.length,a=new Array(n),l=0;l<n;l++)a[l]=arguments[l];return e=i.call.apply(i,[this].concat(a)),(0,u.Z)((0,o.Z)(e),"goUseClerk",(function(){e.props.onItemClick&&e.props.onItemClick()})),e}return(0,c.Z)(s,[{key:"render",value:function(){var e=this.props,i=e.title,s=e.placeholderTitle;return(0,B.jsxs)(h.View,{className:"select_clerk_model_container",children:[(0,B.jsx)(h.View,{className:"title",children:i}),(0,B.jsxs)(h.View,{className:"placeholder_title_view",onClick:this.goUseClerk,children:[(0,B.jsx)(h.Text,{className:"placeholder_title",children:s}),(0,B.jsx)(h.Image,{src:S,className:"right_icon"})]})]})}}]),s}(p.Component);(0,u.Z)(D,"defaultProps",{});var E=function(e){(0,r.Z)(s,e);var i=(0,d.Z)(s);function s(){var e;(0,t.Z)(this,s);for(var n=arguments.length,a=new Array(n),l=0;l<n;l++)a[l]=arguments[l];return e=i.call.apply(i,[this].concat(a)),(0,u.Z)((0,o.Z)(e),"onCancelClick",(function(i){i.stopPropagation(),e.props.onCancelClick&&e.props.onCancelClick()})),(0,u.Z)((0,o.Z)(e),"onSaveClick",(function(i){i.stopPropagation(),e.props.onSaveClick&&e.props.onSaveClick()})),(0,u.Z)((0,o.Z)(e),"onActionClick",(function(i){i.stopPropagation();var s=i.currentTarget.dataset,n=s.type,a=s.index;e.props.onActionClick&&e.props.onActionClick(n,a)})),(0,u.Z)((0,o.Z)(e),"onModelClick",(function(e){e.stopPropagation()})),(0,u.Z)((0,o.Z)(e),"onPriceInput",(function(i){e.props.onPriceUpdate&&e.props.onPriceUpdate(i.detail.value)})),(0,u.Z)((0,o.Z)(e),"onPriceBlur",(function(i){e.props.onPriceBlur&&e.props.onPriceBlur(i.detail.value)})),e}return(0,c.Z)(s,[{key:"render",value:function(){var e=this,i=this.props.skus;return(0,B.jsx)(h.View,{className:"mask",onClick:this.onCancelClick,children:(0,B.jsxs)(h.View,{className:"skus_update_model",onClick:this.onModelClick,children:[(0,B.jsxs)(h.View,{className:"skus_update_model_header",children:[(0,B.jsx)(h.Text,{className:"header_label",children:"修改商品"}),(0,B.jsx)(h.Text,{className:"header_cancel",onClick:this.onCancelClick,children:"取消"})]}),(0,B.jsxs)(h.View,{className:"skus_update_model_priceView",children:[(0,B.jsx)(h.Text,{className:"price_label",children:"价格"}),(0,B.jsx)(h.Input,{className:"price_content",onInput:this.onPriceInput,onBlur:this.onPriceBlur,value:i&&i[0].price.toString()})]}),(0,B.jsx)(h.View,{className:"skus_update_model_skus",children:i.map((function(i,s){return(0,B.jsxs)(h.View,{className:"skus_update_model_skus__sku",children:[(0,B.jsxs)(h.View,{className:"sku_labelView",children:[(0,B.jsx)(h.View,{className:"sku",children:i.colorName}),(0,B.jsx)(h.View,{className:"sku_size",children:i.sizeName})]}),(0,B.jsxs)(h.View,{className:"sku_actionView",children:[(0,B.jsx)(h.View,{className:"action_btn","data-index":s,"data-type":"reduce",onClick:e.onActionClick,children:(0,B.jsx)(h.Image,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAXBJREFUaEPtWkFKxTAQncFWsvEKXqALCzmCuPEcbj4oCJ5DFBTceA434gnaQIWfC3gE/6bYfkZSFMoHYZqQ30Ymu8C8mXnvJdlMEHZW0zRF13UXiHgGAMcAcLQbs+f9BgA+iOg1z/PnsiztuD7+bqy1h23b3hLRCgAO9twkt9wWEZ+UUjdFUXw50EDgp/kXIjrlZpozDhHflFLnjsRAwBjzQESXczY1tTYiPmqtr9Cd+b7v3xd8bP7its2y7ASrqrpDxOupCiwhnojusa7rNQAUS2jIowfrCHwu4Kn06H2AbBwB8kUvAScE5nZBHBAHAhWQIxQoYDBcHAiWMDCBOBAoYDBcHAiWMDAB2wGtdWCpaXBjDAsgBFgyeQSJAx6izQJh34FZumMUFQIMkaKGiANR5WUkFwcYIkUNEQeiystILg4wRIoaIg5ElZeR/F8MONIeMSU/5Et+zOruSdKDbkcg+a8GIxJpfvYYP7epfbf5BjuGBNLGOQgqAAAAAElFTkSuQmCC",className:"reduces_icon"})}),(0,B.jsx)(h.Text,{className:"sku_action_price",children:i.num}),(0,B.jsx)(h.View,{className:"action_btn","data-index":s,"data-type":"plus",onClick:e.onActionClick,children:(0,B.jsx)(h.Image,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAXpJREFUaEPtWkFKxTAQncFWsvEKXiALCzmCuPEcbj4oCJ5DFBTceA438k/QBir8XsAj+DfF9jOSolILxWlK/28+013oTDLvzcs0ZYLQefI811VVXSDiGQAcA8BR12bL4zUAvBPRaxzHz0mSFO318WdQFMVhWZa3RLQAgIMtB8ldboOIT0qpG631p3NqAHwH/0JEp9yZdmmHiEul1LkD0QCw1j4Q0eUugxq6NiI+GmOu0Gm+ruu3GcumD9smiqITTNP0DhGvhzIwB3siuscsy1YAoOcQkEcMhQPwMYNS6RF747J2AMjXew5+AqAvC8aYP6+stZMkbLIMCABmviQDsgeYUukzEwmJhERCE52F5EPGlBa7CnUZZc7vbcY9OwkAb4r/cZQMjGVWqhCTQfYmZs73ayYZYDImGZDTKFMq8kMzlCipQkzGpArtbRViKmC02WQSGh0Zc4K9aHCE3WIKvskXfJvV7ZWgG90OQPBXDVogwrzs0S65oV23+QKBQUzS2C4QzQAAAABJRU5ErkJggg==",className:"reduces_icon"})})]})]},s)}))}),(0,B.jsx)(h.View,{className:"skus_update_model_saveAction",onClick:this.onSaveClick,children:"保存"})]})})}}]),s}(p.Component);(0,u.Z)(E,"defaultProps",{skus:[{colorName:"",num:0,price:0,money:"",sizeName:"",sizeid:-1}]});var R=s(54448),M=[{label:"现金",value:0,key:"cash"},{label:"刷卡",value:0,key:"card"},{label:"汇款",value:0,key:"remit"},{label:"微信",value:0,key:"finpayWeixinpay"},{label:"支付宝",value:0,key:"finpayAlipay"},{label:"扫码付",value:0,key:"mobilepay"}],P=function(e){return e.MoneyAndGoods="退货退款",e.Goods="收货",e.Money="退款",e}(P||{}),T=function(e){(0,r.Z)(s,e);var i=(0,d.Z)(s);function s(){var e;(0,t.Z)(this,s);for(var n=arguments.length,c=new Array(n),r=0;r<n;r++)c[r]=arguments[r];return e=i.call.apply(i,[this].concat(c)),(0,u.Z)((0,o.Z)(e),"state",{editSku:[],skusUpdateModelIsShow:!1,alertIsShow:!1,staffInfo:{id:-1,name:""},refundValue:"",saleDetail:[],refundViewIsShow:!1}),(0,u.Z)((0,o.Z)(e),"editIndex",void 0),(0,u.Z)((0,o.Z)(e),"prevSkuNum",void 0),(0,u.Z)((0,o.Z)(e),"cash",void 0),(0,u.Z)((0,o.Z)(e),"card",void 0),(0,u.Z)((0,o.Z)(e),"remit",void 0),(0,u.Z)((0,o.Z)(e),"finpayWeixinpay",void 0),(0,u.Z)((0,o.Z)(e),"finpayAlipay",void 0),(0,u.Z)((0,o.Z)(e),"mobilepay",void 0),(0,u.Z)((0,o.Z)(e),"skuPrice",void 0),(0,u.Z)((0,o.Z)(e),"eventUpdateBind",(function(){var i,s=(null===(i=m().getCurrentInstance)||void 0===i?void 0:i.call(m())).params;s.billId&&e.props.dispatch({type:"cloudBill/selectAuditBillDetail",payload:{billId:s.billId}})})),(0,u.Z)((0,o.Z)(e),"eventCenterCLerk",(function(i){e.setState({staffInfo:i})})),(0,u.Z)((0,o.Z)(e),"goUseClerk",(function(){m().navigateTo({url:"/subpackages/cloud_bill/pages/use_clerk_screen/index"})})),(0,u.Z)((0,o.Z)(e),"onEditClick",(function(i){var s=i.currentTarget.dataset.index;e.editIndex=s,e.setState({editSku:e.props.orderBillDetail.spus[s].skus.map((function(e,i){return(0,l.Z)({},e)})),skusUpdateModelIsShow:!0})})),(0,u.Z)((0,o.Z)(e),"onSkusCancelClick",(function(){e.setState({skusUpdateModelIsShow:!1})})),(0,u.Z)((0,o.Z)(e),"onSkusSaveClick",(function(){e.skuPrice?e.setState((function(i){return{editSku:i.editSku.map((function(i){return(0,l.Z)((0,l.Z)({},i),{},{price:Number(e.skuPrice)})}))}}),(function(){e.props.dispatch({type:"cloudBill/updateEditSkus",payload:{skus:e.state.editSku,index:e.editIndex,skuPrice:e.skuPrice}})})):e.props.dispatch({type:"cloudBill/updateEditSkus",payload:{skus:e.state.editSku,index:e.editIndex}}),e.onSkusCancelClick()})),(0,u.Z)((0,o.Z)(e),"onActionClick",(function(i,s){e.setState((function(e){return e.editSku[s].num="plus"===i?e.editSku[s].num+1>e.editSku[s].originalNum?e.editSku[s].originalNum:e.editSku[s].num+1:e.editSku[s].num-1<0?0:e.editSku[s].num-1,{editSku:(0,a.Z)(e.editSku)}}))})),(0,u.Z)((0,o.Z)(e),"onPriceInput",(function(i){e.skuPrice=i})),(0,u.Z)((0,o.Z)(e),"onPriceBlur",(function(i){e.skuPrice=i,e.setState((function(i){return{editSku:i.editSku.map((function(i){return(0,l.Z)((0,l.Z)({},i),{},{price:Number(e.skuPrice)})}))}}))})),(0,u.Z)((0,o.Z)(e),"onPayInput",(function(i){var s=i.detail.value,n=i.currentTarget.dataset.key;e[n]=s})),(0,u.Z)((0,o.Z)(e),"onCancelOrderClick",(function(i){i.stopPropagation(),N.Z.showAlertWithCancel("确认作废该订单?","提示",(function(){m().showLoading({title:"请稍等...",mask:!0}),e.props.dispatch({type:"cloudBill/clearOrderBillList"}),(0,w.Qt)({billId:e.props.orderBillDetail.bill.id}).then((function(e){m().hideLoading(),m().eventCenter.trigger("ORDER_ACTION",{type:"voided"}),m().navigateBack()})).catch((function(e){m().hideLoading(),f.Z.log("商户作废订单失败".concat(e))}))}),(function(){}))})),(0,u.Z)((0,o.Z)(e),"onMobileClick",(function(){m().makePhoneCall({phoneNumber:e.props.orderBillDetail.dwPhone})})),(0,u.Z)((0,o.Z)(e),"onHeadImageClick",(function(){var i=e.props.orderBillDetail,s=i.dwId,n=i.bill.unitId;s>0&&m().navigateTo({url:"/subpackages/cloud_bill/pages/my_client_detail/index?dwId=".concat(s,"&mpUserId=").concat(n,"&listType=1&fromOrder=1")})})),(0,u.Z)((0,o.Z)(e),"onDealRefundOrder",(function(){m().showLoading({title:"请稍等...",mask:!0}),(0,I.Nu)({billId:e.props.orderBillDetail.bill.id}).then((function(i){var s=i.data;m().hideLoading(),e.setState({saleDetail:s.rows,refundViewIsShow:!0})})).catch((function(){m().hideLoading()}))})),(0,u.Z)((0,o.Z)(e),"onConfirmRefund",(function(){N.Z.showAlertWithCancel("是否同意退款","提示",(function(){m().showLoading({title:"请稍等...",mask:!0}),(0,k.j3)({jsonParam:{billId:e.props.orderBillDetail.bill.id,refundStatus:C.ks.DOING}}).then((function(){m().hideLoading(),N.Z.showAlert("退款成功，预计1~2个工作日内到账","提示","好的",(function(){m().eventCenter.trigger("ORDER_ACTION",{type:"refund"}),m().navigateBack()}))})).catch((function(){m().hideLoading()}))}))})),(0,u.Z)((0,o.Z)(e),"onCancelRefund",(function(){e.setState({alertIsShow:!0})})),(0,u.Z)((0,o.Z)(e),"onRefundValueSave",(function(){e.state.refundValue?(m().showLoading({title:"请稍等...",mask:!0}),(0,k.j3)({jsonParam:{billId:e.props.orderBillDetail.bill.id,refundStatus:C.ks.REJECT,rejectReason:e.state.refundValue}}).then((function(){m().hideLoading(),m().eventCenter.trigger("ORDER_ACTION",{type:"voided"}),m().navigateBack()}))):N.Z.showToast("请输入拒绝原因")})),(0,u.Z)((0,o.Z)(e),"onRefundValueCancel",(function(){e.setState({refundValue:"",alertIsShow:!1})})),(0,u.Z)((0,o.Z)(e),"onRemarkInput",(function(i){e.setState({refundValue:i.detail.value})})),(0,u.Z)((0,o.Z)(e),"onClearInput",(function(){e.setState({refundValue:""})})),(0,u.Z)((0,o.Z)(e),"onConfirmClick",(function(i){i.stopPropagation();var s=(0,o.Z)(e),n=s.state.staffInfo.id,l=s.cash,t=s.card,c=s.remit,r=s.finpayWeixinpay,d=s.finpayAlipay,u=s.mobilepay,A=e.props.orderBillDetail,p=A.bill,h=A.spus,_=[],k=0;h.forEach((function(e){k+=e.skus.reduce((function(e,i){return e+i.price*i.num}),0),_=[].concat((0,a.Z)(_),(0,a.Z)(e.skus))}));var x=_.reduce((function(e,i){return e+i.num}),0),j={ownerId:-1!==n?n:e.props.staffId||void 0,cash:l,card:t,remit:c,finpayWeixinpay:r,finpayAlipay:d,mobilepay:u,bill:{id:p.id,totalNum:x,totalMoney:(0,g.NM)(k,3)},details:_.map((function(e){return{id:e.id,num:e.num,price:(0,g.NM)(e.price,3),flag:0===e.num?-1:void 0}}))};j.details.filter((function(e){return void 0===e.flag})).length>0?(m().showLoading({title:"请稍等...",mask:!0}),(0,w.gp)(j).then((function(i){var s=i.code;m().hideLoading(),e.props.dispatch({type:"cloudBill/clearOrderBillList"}),0===s&&N.Z.showAlert("订单已确认，已生成销售订单/销售单","提示","我知道了",(function(){m().eventCenter.trigger("ORDER_ACTION",{type:"confirm"}),m().navigateBack()}))})).catch((function(e){m().hideLoading(),f.Z.log("商户订单修改失败".concat(e))}))):N.Z.showAlert("不能删除全部款")})),(0,u.Z)((0,o.Z)(e),"refreshSaleDetail",(function(){m().showLoading({title:"请稍等..."}),(0,I.Nu)({billId:e.props.orderBillDetail.bill.id}).then((function(i){var s=i.data;m().hideLoading(),e.setState({saleDetail:s.rows})})).catch((function(){m().hideLoading()}))})),(0,u.Z)((0,o.Z)(e),"onRefundFailClick",(function(i,s){var n=i.currentTarget.dataset._id,a="",l="拒绝";switch(s){case P.Money:a="确认拒绝退款？",l="拒绝退款";break;case P.MoneyAndGoods:a="确认拒绝退款退货？",l="拒绝退货";break;case P.Goods:a="确认拒绝退款？",l="拒绝退款"}m().showModal({title:"操作提醒",content:a,confirmText:l,success:function(i){i.confirm&&(m().showLoading({title:"请稍等..."}),(0,k.j3)({jsonParam:{billId:e.props.orderBillDetail.bill.id,refundStatus:C.ks.REJECT,billDetailId:n}}).then((function(){m().hideLoading(),e.refreshSaleDetail()})).catch((function(){m().hideLoading()})))}})})),(0,u.Z)((0,o.Z)(e),"onRefundSuccessClick",(function(i,s){var n=i.currentTarget.dataset._id,a="",l="同意";switch(s){case P.Money:a="确认同意退款？\n\r 同意后订单金额将返还给客户",l="同意退款";break;case P.MoneyAndGoods:a="确认同意退货退款请求？\n\r 同意后请等待客户退货",l="同意退货";break;case P.Goods:a="确认收货？\n\r 确认后订单金额将返还给客户",l="确认收货"}m().showModal({title:"操作提醒",content:a,confirmText:l,success:function(i){i.confirm&&(m().showLoading({title:"请稍等...",mask:!0}),(0,k.j3)({jsonParam:{billId:e.props.orderBillDetail.bill.id,refundStatus:C.ks.DOING,billDetailId:n}}).then((function(){m().hideLoading(),e.refreshSaleDetail()})).catch((function(){m().hideLoading()})))}})})),(0,u.Z)((0,o.Z)(e),"onRefundClose",(function(){e.setState({refundViewIsShow:!1})})),(0,u.Z)((0,o.Z)(e),"renderBottom",(function(i,s,n,a,l,t,c){var o,r,d,u=V.M[c]||"",A=(0,y.JU)(null===(o=m().getCurrentInstance)||void 0===o?void 0:o.call(m()))&&(0,y.JU)(null===(r=m().getCurrentInstance)||void 0===r?void 0:r.call(m())).afterSaleTypes?JSON.parse((0,y.JU)(null===(d=m().getCurrentInstance)||void 0===d?void 0:d.call(m())).afterSaleTypes):[],p=(0,R.v)(A),_=A.includes(3);return(0,B.jsxs)(h.View,{className:"bottom_view",children:[1===i&&(0,B.jsxs)(h.View,{className:"cover_view",children:[(0,B.jsxs)(h.View,{children:[(0,B.jsxs)(h.View,{children:["总计：",n,"件 ",(0,B.jsxs)(h.Text,{style:"color: #FF5050",children:["¥",a]})]}),u.length>0&&(0,B.jsx)(h.View,{className:"bottom_view_pay_status",children:u})]}),(0,B.jsxs)(h.View,{style:{display:"flex"},children:[(0,B.jsx)(h.View,{className:"bottom_view_actionDisable",onClick:e.onCancelOrderClick,children:"作废"}),(0,B.jsx)(h.View,{className:"bottom_view_action",onClick:e.onConfirmClick,children:"确认"})]})]}),(2===i||0===i)&&l===C.ks.DEFAULT&&(0,B.jsxs)(h.View,{className:"bottom_view_confiremed",children:[u.length>0&&(0,B.jsx)(h.View,{className:"bottom_view_pay_status",children:u}),(0,B.jsx)(h.View,{className:"bottom_view_container",children:(0,B.jsxs)(h.View,{className:"skus_sum",children:[(0,B.jsxs)(h.View,{children:["批次：",s]}),(0,B.jsxs)(h.View,{children:["总计：",n,"件 ",(0,B.jsxs)(h.Text,{style:"color: #FF5050",children:["¥",a]})]})]})}),2===i&&(0,B.jsx)(h.View,{className:"bottom_view_actionDisable",children:"已确认"})]}),3===i&&(0,B.jsxs)(h.View,{className:"bottom_view_confiremed",children:[(0,B.jsxs)(h.View,{children:["总计：",n,"件 ",(0,B.jsxs)(h.Text,{style:"color: #FF5050",children:["¥",a]})]}),(0,B.jsx)(h.View,{className:"bottom_view_actionDisable",children:"已作废"})]}),(l===C.ks.APPLY||_)&&(0,B.jsxs)(h.View,{className:"cover_view",children:[(0,B.jsx)(h.View,{className:"aic",children:(0,B.jsxs)(h.View,{className:"skus_sum",children:[(0,B.jsxs)(h.View,{children:["批次：",s]}),(0,B.jsxs)(h.View,{children:["总计：",n,"件 ",(0,B.jsxs)(h.Text,{style:"color: #FF5050",children:["¥",a]}),3===c&&(0,B.jsx)(h.Text,{className:"pay_status",children:"已支付"})]})]})}),2===t?(0,B.jsxs)(h.View,{className:_?"bottom_view_actionDisable":"bottom_view_action_refund",onClick:e.onDealRefundOrder,children:[p," ",_?"":">"]}):(0,B.jsxs)(h.View,{style:{display:"flex"},children:[(0,B.jsx)(h.View,{className:"bottom_view_actionDisable",onClick:e.onConfirmRefund,children:"同意退款"}),(0,B.jsx)(h.View,{className:"bottom_view_action",onClick:e.onCancelRefund,children:"拒绝退款"})]})]})]})})),(0,u.Z)((0,o.Z)(e),"renderGoodsView",(function(i,s,n){var a=i.styleImg,l=i.styleName,t=i.styleCode,c=i.skus,o=i.price,r=i.id,d=i.rem,u=i.totalMoney,A=c.reduce((function(e,i){return e+i.num}),0),m=String((0,g.NM)(Number((0,g.DZ)(A,String((0,g.NM)(Number(o),4)))),3)),p=e.props.shop;return(0,B.jsxs)(h.View,{className:"goods_view",children:[(0,B.jsxs)(h.View,{className:"goods_info",children:[(0,B.jsx)(h.View,{className:"goods_info__image",children:(0,B.jsx)(h.Image,{src:a,className:"goods_info__image",mode:"aspectFill"})}),(0,B.jsxs)(h.View,{className:"goods_info__code",children:[(0,B.jsxs)(h.View,{style:{display:"flex"},children:[(0,B.jsx)(h.Text,{className:"style_name",children:l}),(0,B.jsx)(h.Text,{className:"style_code",children:t&&"#".concat(t)})]}),(0,B.jsxs)(h.View,{className:"style_money",children:["数量：",A]})]}),(0,B.jsxs)(h.View,{className:"goods_info__billMoney",children:["合计:",u||m]}),1===n&&(0,B.jsx)(h.Image,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAClElEQVRYCc1Xv28TMRTGR37AFMQaRtqFAQmJf6ASHSp+TdkjlGRrGKnYEFW7FRgToewRA6DAUKT+AUwwsLSVOrVrm6nk0iR8n2ufnOsld774JCw5fvZ7ft/3ns92LK4ZpdPpLPm+vyGEWJlMJmWocoY6UoTtIepqrVY7ijSIGbxOPcBEuVxujkajT+g+RL2F6qEmKbcx/7DX6/1MYhy2kRG22+11OHkXUg4QmR8au9LFvAPP8z5fUcwYQJZvIMsf4XsNc98IlfbfsL/JOVD0UF+XSqU/lUplNMNPqmEF/gWTV+kAOGc5rjnkALxerz+h0nUJg9M/MvDdA4sVDcbIteyyjQKH/91CofAiBxb82lkGTPul6O43ChyB/sjn88+q1epffunyQ8Sgn/WaMywF/pTg7CfdarS1KnMiD8DpMBMCScEzIWAD7pyALbhTAmnAnRFIC04CsbcdjeYVgg+Hw6+weWTY7ep9bowFIu6eO+Px+DnukG8LETAinwLHCScPmQAxJACc98EDHILN1NvQAJcXCzF4yMSBK7sltiBwNxWBKHD4Y9qnDhmCxBVrArPAk0QeRcaaAK7vNhwFaYfMW23umkcB6zFrAljnNT15UXD6sSaAD+ct5p2CSHeRyAnOYr0NG43GDuaxOinWGXCCajj5LwhckBDWttDtduU7wSDoXFQYReV4yD+lx6pT7Pf795wjhhwSg8FyGNgnHjp72gbyppazak0MYotWq7UM4RcAg7cBmDl9mDDtKvJNYD1WwZ1jG98X7IBEE4qppxlI8Fk2UMaLNkX4l2nXjuD/JR5B7yUBKIV6H27BQGZCG2bQngN8A6/pD2gnkoAGUcvxCorEz3M9N6a9gM9jBLqHdhuR72v7f7M3XlnlO9VuAAAAAElFTkSuQmCC",className:"edit_icon","data-index":s,onClick:e.onEditClick})]}),c.map((function(e){return(0,B.jsxs)(h.View,{className:"skus",children:[(0,B.jsxs)(h.View,{className:"skus_sku__view",children:[(0,B.jsx)(h.View,{className:"spot"}),(0,B.jsx)(h.View,{className:"sku",children:p&&p.industries?"数量":"".concat(e.colorName,"/").concat(e.sizeName)})]}),(0,B.jsx)(h.View,{className:"skus_price",children:"".concat(String((0,g.NM)(Number(e.price),4)),"*").concat(e.num,"=").concat(String((0,g.NM)(Number((0,g.DZ)(e.num,e.price)),3)),"元")})]},r)})),d&&(0,B.jsx)(h.View,{className:"remark_view",children:(0,B.jsxs)(h.Text,{className:"remark_view_input",children:["备注：",d]})})]},r)})),(0,u.Z)((0,o.Z)(e),"renderSkuCell",(function(i){return(0,B.jsxs)(h.View,{className:"sku_cell",children:[(0,B.jsxs)(h.View,{className:"sku_cell_desc",children:[(0,B.jsxs)(h.View,{className:"sku_cell_desc_title",children:[(0,B.jsx)(h.Image,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEcElEQVRYCeWXXWhcRRSA5+wmbjBuNTEVrFHBUqGoD0WoUq0PRiSCD9smeUgtElNpUZu3QkupMbQo+KAIRaWobWibEkzaDShtBbVqH1QURJFipBo1oaU0ISH9Q5Pc8ZvZe7P3Tu/d7qaPvXD2zDlz/uacMz+r1I3+yUIToHt6Ump4eLGqqrooBw5cWqidsgPQGzferMbHc0rrduABJdIIrvYdT4N/Bz6FPyT5/M/lBnTNAHRHR42anu7GWRdwS1mGRY6rVGqrHD78y7XkSwag1659DKd7gft9Q5oVfg8cVZ43Aj6Ho0XMLwFWA83IZa2siAe9U+XzO0VEJwUSCUCvWfMsNT0mAwNzjJsxMIRiBkce+KDKZF6T/v6/kozprq6MGhvbhN6ryDRYOZFBbD6Hzf/i9KIB5HI/ITTBqj7ASC9Qg/MJlU63yuDgV3EG4nh63bo6dfnyx8w9ZedF9tEXnXGyKYdpUtVEevt952MEs7IS58aeHDo0qaqrmwm+z9rX+gXK2WXHzk80gKtr1Ucj/enolEWaMqrGxg0E8a1V8LzXdVvbYlc5GoDWptbFT+ut9EIvijcVmeWPZPfuf6n/8wQxg1ZWzcyY3oh80QCiGTiDYj/S3wFpo6VzuT5AAxdJaaPhmU+3tzcQ6Lg/t7/ALfySidPY+dDndbiLqQoLMz5IzffQdF9bRWeSur6sZmfN1ryXPnmH6VYrcuXK2+DbgdOqvv4Vywv/eN5HkC8BWfSfBB8PpiO7IGCWwqz8CQI4AaRY2TMEO4PRz22aU6lV9MyPcfpkaBQdk7W3ZGhoSyATLUHALYHlyJFvcPamL/Kumpvb44+3Jzn353+1WOQen7ao4gBYyfus5G60Nfg+YCkBmUPmQbLzRti4Mz7r00vC/IoDQPkPnJ7C6b55Q1q/B28Y+u95XvIgciy7TZisVpypw7nZloUz3/BFFvE7C8wZMuG70+cHmbBk5RngZmG1pnmLDWwa0vAK/AT/6iE7ofU/YYGiEZ9LjZfT2Q0cvyfDgu5Yt7Y22e43E+n0chrwN1cmoDkfHmZc2B3sHO6F+W0YyQCCO1jFKTp7kAOjvLs/8FIKi7zoT1/gZPwyLBrtAZFPCGAXcAdBmL3aExYOj8nQF9BXZTAsY8a6pWUZtoIAet1rOZIB+5QSyVsj5h5oaXnENVgJbd8HnrcfHbPQC5yku1z9SAB2MpPZDJ4iCzUct3nKstRVKofm0VqlRkfNa+pRX347qz/v6samkEZ8HMWjCGfZYhNAGyfgCVc5iaZ/6rn5zIOkycqI7CW7G+LkYwMwgqx8Jegz4DZDEkQfDdTNKkagYz/7gJ2a2sTkDqDBCokMoLferX1gIDEAI0APrKAMpjHv8hVMID/Y7IiMcHOeY5wFzPG6GjDvyMLuWcij1HcSQbqzM6smJ7sxbK7T2shkEiFyjOC2cTZc37M8bJ+63srBsx7e0wSzClxIcUGo+Mcknc6X4ziwXbIEgVAc9v+w1Kna2unr+WsWZ/vG4v0PcKSrH4owGuIAAAAASUVORK5CYII=",className:"sku_cell_desc_title_icon"}),"用户申请".concat(i.typeDesc)]}),(0,B.jsx)(h.View,{className:"sku_cell_desc_label",children:"申请原因：".concat(i.reasonDesc)}),(0,B.jsx)(h.View,{className:"sku_cell_desc_label",children:"申请时间：".concat(b()(Number(i.create_time)).format("YYYY-MM-DD"))})]}),(0,B.jsxs)(h.View,{className:"sku_cell__top",children:[(0,B.jsx)(h.Image,{className:"sku_cell__top__goodsImage",mode:"aspectFill",src:i.detail.styleImg.includes(",")?i.detail.styleImg.split(",")[0]:i.detail.styleImg}),(0,B.jsxs)(h.View,{className:"sku_cell__top__goodsInfo",children:[(0,B.jsx)(h.View,{className:"sku_cell__top__goodsInfo__name",children:i.detail.styleName}),(0,B.jsxs)(h.View,{className:"sku_cell__top__goodsInfo__label",children:[i.detail.colorName," ",i.detail.sizeName]}),(0,B.jsxs)(h.View,{className:"sku_cell__top__goodsInfo__label",children:[i.detail.num,"件 x ",i.detail.price,"元"]})]})]}),(0,B.jsxs)(h.View,{className:"sku_cell__bottom",children:[(0,B.jsx)(h.View,{className:"sku_cell__bottom__status__desc",children:i.statusDesc}),(0,B.jsxs)(h.View,{className:"sku_cell__bottom__action",children:[(2===i.status||23===i.status)&&(0,B.jsx)(h.View,{className:"sku_cell__bottom__action__refund aic jcc","data-_id":i.detail.id,onClick:function(s){e.onRefundFailClick(s,i.status===C.P0.WAITING_TAKE_DELIVERY?P.Goods:23===i.status?P.MoneyAndGoods:P.Money)},children:"拒绝"}),(2===i.status||23===i.status)&&(0,B.jsx)(h.View,{className:"sku_cell__bottom__action__agree aic jcc","data-_id":i.detail.id,onClick:function(s){return e.onRefundSuccessClick(s,23===i.status?P.MoneyAndGoods:P.Money)},children:"同意".concat(23===i.status?"退货":"","退款")}),i.status===C.P0.WAITING_TAKE_DELIVERY&&(0,B.jsxs)(h.Block,{children:[(0,B.jsx)(h.View,{className:"sku_cell__bottom__action__refund aic jcc","data-_id":i.detail.id,onClick:function(i){return e.onRefundFailClick(i,P.Goods)},children:"拒绝"}),(0,B.jsx)(h.View,{className:"sku_cell__bottom__action__agree aic jcc","data-_id":i.detail.id,onClick:function(i){return e.onRefundSuccessClick(i,P.Goods)},children:"确认收货"})]})]})]})]})})),(0,u.Z)((0,o.Z)(e),"renderRefundView",(function(){var i=e.state.saleDetail;return(0,B.jsx)(h.View,{className:"refund_view__mask",onClick:e.onRefundClose,children:(0,B.jsxs)(h.View,{className:"refund_view__mask__content",onClick:function(e){return e.stopPropagation()},children:[(0,B.jsxs)(h.View,{className:"refund_view__mask__content__header aic jcc",children:["处理售后",(0,B.jsx)(h.Image,{src:v,onClick:e.onRefundClose,className:"refund_view__mask__content__header__close"})]}),(0,B.jsx)(h.View,{className:"refund_view__mask__content__scroll",children:i.map((function(i){return e.renderSkuCell(i)}))})]})})})),(0,u.Z)((0,o.Z)(e),"copyText",(function(e){m().setClipboardData({data:e,success:function(){m().showToast({title:"复制收货信息成功",icon:"none"})}})})),e}return(0,c.Z)(s,[{key:"componentDidMount",value:function(){m().eventCenter.on("USE_CLERK",this.eventCenterCLerk),m().eventCenter.on("UPDATE_BIND",this.eventUpdateBind),this.props.dispatch({type:"goodsManage/selectShopStaffList",payload:{curpageno:1,noBindFlag:!1}}),this.props.dispatch({type:"goodsManage/selectShopLinkUsers"}),this.props.dispatch({type:"goodsManage/selectShopViewers",payload:{pageNo:1}})}},{key:"componentDidShow",value:function(){(0,x.ZT)("订单详情")}},{key:"render",value:function(){var e,i,s=this,n=this.props,a=n.orderBillDetail,l=a.mpLogoUrl,t=a.mpNickName,c=a.dwName,o=a.dwPhone,r=a.bill,d=r.fullAddress,u=r.auditFlag,A=r.createdDate,p=r.slhBillNo,_=r.refundStatus,w=r.extProps,k=r.payStatus,f=r.proTime,x=r.deliverFlag,N=r.billNo,C=r.receiveName,v=r.receivePhone,V=r.totalMoney,I=r.id,Z=r.buyerRem,b=a.spus,R=n.showPhone,P=(0,y.JU)(null===(e=m().getCurrentInstance)||void 0===e?void 0:e.call(m())).userRemark,T=void 0===P?"":P,Q=this.state,U=Q.skusUpdateModelIsShow,F=Q.editSku,L=Q.staffInfo,G=Q.alertIsShow,Y=Q.refundValue,z=Q.refundViewIsShow,W=b.reduce((function(e,i){return e+i.totalNum}),0),K=(0,g.NM)(b.reduce((function(e,i){return e+i.totalMoney}),0),3);console.log("spus",b);var O=f;(i=w?JSON.parse(w):{})&&i.logisList&&i.logisList[0]&&i.logisList[0].logisCreatedDate&&(O=i.logisList[0].logisCreatedDate);var H="",X="dot ";2===x||3===x?(H="已发货",X+="green_mark"):1===x?(H="部分发货",X+="yellow_mark"):0===x&&(H="未发货",X+="red_mark");var J=o;J&&!R&&(J="****");var q=[];C&&q.push(C),v&&q.push(v),q.push(d||"");var $=q.join("，"),ee="number"==typeof V?V:K;return(0,B.jsxs)(h.View,{style:{display:"flex",flexDirection:"column"},children:[(0,B.jsxs)(h.ScrollView,{scrollY:!U,className:"order_bill_detail_container",children:[(0,B.jsxs)(h.View,{className:"user_view",children:[(0,B.jsxs)(h.View,{className:"user_view_information",style:{borderBottom:1===u?"1px solid #EEEEEE":"none"},children:[(0,B.jsx)(h.View,{className:"headImage",onClick:this.onHeadImageClick,children:(0,B.jsx)(h.Image,{src:l,style:{width:"100%",height:"100%"},mode:"aspectFill"})}),(0,B.jsxs)(h.View,{className:"infor",children:[(0,B.jsx)(h.View,{className:"name",children:T||t}),(0,B.jsx)(h.View,{className:"slh_info",children:c&&"商陆花档案: ".concat(c)}),(0,B.jsxs)(h.View,{className:"mobile",onClick:this.onMobileClick,children:[(0,B.jsx)(h.Text,{children:J}),o&&R&&(0,B.jsx)(h.Image,{className:"phone_icon",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAxRJREFUWEfFl0lok0EUx38v0VZcERWC4KHFg0VUClIVPBTFU1Goh1oPHqS2X0qgiEiLIFIEhepBUdImTREEQdGDovbmBm6toLiAJ5dDKbiRQrXYxMaR+bI027eQWDLXee8/v3kz780bweVQQRbjpQnYAWxCUYuw1HRXTCJ8At4AD0gwLAF+uZEWJyMVZC0eehD2A4uc7FPzUyiu8pc+CfDBzscSQF2gmmpOAodRVLlcONdMiAPniXFCuogV0ygKoIL48HIT2FrSwoVOIyRolgBf8qcKAFSYDSiGgTX/afG0zBhCkxi8y9bNAUjt/MUcLD4LkaAhOxIZAPPMq3hkE/YoEAHGgYNAfYkRGiFOY/pOzAKE6UPRXVRUuA20icEPM+vCLASeo9hYEoRwRgx6tK8JYKaal/fA/CKC4wg1YvAne06F2AncKxEgzgzrdYomAQaIIByy2P0VMThQbE6F+AjUlgShGJJO2iVV4XR6WBWZQfFjWAA8BBpLAoApEvhEhdgHXLMUUdyVTnbnz6sQm4HHwIISAbRbqwYIAx02Il/Fjy/n/AdpQXEJ5bo0W8kPaoARYIvtLjzUSwev0zYqxDHgdBk7T7uOihrgG8IqWzHhnBgcyQBcZgW/+QwsKQtC8V1HYBqodhCKEqdGupjMisJR4GxZABBzC6ArxnExOJUBuI6XKM+AhjIgYu6OILnCTxR10mmWYnOofmrx8ApYVhJE6gicL+Gs+i3x05yTEcmKqF9PfYz6pRtL1QZdrp3GqJs0zBcJiJ/+PIhtwErxc8eMTIQaZhhGqHMgMNPQvhAVKkwj7BKDJ3bi5tM+j5coVtvYtbopxcX8J/DSKO28tYWI0EaCIQubZCk2Q2b3GFmvEEWxRzp5amWiwmxHmeW6cKQfIxPA/jm226SuId3i52K+kerFg48bwN4CAd2sZj/HJoRdQ+J0l3VzIvSynPvSQkKFWYcimPpDFHrnNyQmgHNL5owBE4Bu3XSPYNXyF2/JUkeh2/HKNKXp7VW0Lc9AVPJjkoGo5Ncsp8xW6nNakNdz9D3/B/GIHIiNMpg7AAAAAElFTkSuQmCC"})]})]}),(0,B.jsx)(h.Image,{src:S,onClick:this.onHeadImageClick,className:"right_icon"})]}),1===u&&(0,B.jsx)(h.View,{className:"user_view_clerk",children:(0,B.jsx)(D,{title:"店员",onItemClick:this.goUseClerk,placeholderTitle:L.name||"选择店员"})})]}),(0,B.jsx)(h.View,{children:b.map((function(e,i){return s.renderGoodsView(e,i,u)}))}),(0,B.jsxs)(h.View,{className:"orderDetail_view",children:[(0,B.jsxs)(h.View,{className:"orderDetail_view_date",children:[(0,B.jsx)(h.Text,{className:"label_content",children:"日期"}),(0,B.jsx)(h.Text,{className:"date_content",children:A.split(" ")[0]})]}),(0,B.jsxs)(h.View,{className:"orderDetail_view_receive_info",children:[(0,B.jsx)(h.View,{className:"label_content",children:"收货信息:"}),(0,B.jsxs)(h.View,{className:"info_content",children:[(0,B.jsxs)(h.View,{className:"info_content_main",children:[(C||v)&&(0,B.jsx)(h.View,{children:"".concat(C||"","  ").concat(v||"")}),(0,B.jsx)(h.View,{children:d||""})]}),(0,B.jsx)(h.View,{className:"info_content_copy",onClick:function(){return s.copyText($)},children:"复制"})]})]}),(0,B.jsxs)(h.View,{className:"shipping_address",children:[(0,B.jsx)(h.View,{children:(0,B.jsx)(h.Text,{className:"label_content",children:"发货状态："})}),(0,B.jsx)(h.View,{className:"shipping_content",children:(0,B.jsxs)(h.View,{className:"shipping_content_deliver_status",children:[(0,B.jsx)(h.View,{className:X}),H]})})]}),(0,B.jsxs)(h.View,{className:"shipping_address",children:[(0,B.jsx)(h.View,{children:(0,B.jsx)(h.Text,{className:"label_content",children:"发货时间："})}),(0,B.jsx)(h.View,{className:"shipping_content",children:(0,B.jsx)(h.View,{children:O||""})})]}),(1===i.billSrc||2===i.billSrc)&&(0,B.jsxs)(h.View,{className:"shipping_address",children:[(0,B.jsx)(h.View,{children:(0,B.jsx)(h.Text,{className:"label_content",children:"业务单号："})}),(0,B.jsx)(h.View,{className:"shipping_content",children:(0,B.jsx)(h.View,{children:1===i.billSrc?N:I})})]}),(0,B.jsxs)(h.View,{className:"shipping_address",children:[(0,B.jsx)(h.View,{style:{flexShrink:0},children:(0,B.jsx)(h.Text,{className:"label_content",children:"客户备注："})}),(0,B.jsx)(h.View,{className:"shipping_content",children:(0,B.jsx)(h.View,{children:Z})})]})]}),!U&&1===u&&(0,B.jsxs)(h.View,{className:"pay_infomation_view",children:[(0,B.jsxs)(h.View,{className:"pay_type_item",style:"border: none",children:[(0,B.jsx)(h.View,{className:"pay_type_item_label",children:"付款信息"}),(0,B.jsx)(h.View,{className:"pay_type_item_value",style:"font-size:14px;color: #999;",children:"客户未付款请不填写"})]}),M.map((function(e){return(0,B.jsxs)(h.View,{className:"pay_type_item",children:[(0,B.jsx)(h.View,{className:"pay_type_item_label",children:e.label}),(0,B.jsx)(h.Input,{className:"pay_input","data-key":e.key,onInput:s.onPayInput,placeholderStyle:"color: #cdcdcd",placeholder:"请输入",style:{color:"".concat((e.value,"#FF5050"))}})]},e.key)}))]})]}),U&&1===u&&(0,B.jsx)(E,{skus:F,onCancelClick:this.onSkusCancelClick,onSaveClick:this.onSkusSaveClick,onActionClick:this.onActionClick,onPriceUpdate:this.onPriceInput,onPriceBlur:this.onPriceBlur}),!U&&this.renderBottom(u,p,W,ee,_,i.billSrc,k),G&&(0,B.jsx)(h.View,{className:"refund_remark_view",children:(0,B.jsxs)(h.View,{className:"alert_input_view",children:[(0,B.jsx)(h.View,{className:"alert_input_view__header",children:"拒绝原因"}),(0,B.jsxs)(h.View,{className:"alert_input_view__input",children:[(0,B.jsx)(h.Input,{placeholder:"请输入拒绝原因",className:"alert_input_view__input___com",onInput:this.onRemarkInput,value:Y,focus:G}),Y&&(0,B.jsx)(h.Image,{src:j,onClick:this.onClearInput,className:"alert_input_view__input___delete"})]}),(0,B.jsx)(h.View,{className:"alert_input_view__action",children:(0,B.jsxs)(h.View,{className:"alert_input_view__action",children:[(0,B.jsx)(h.View,{className:"alert_input_view__action__cancel",onClick:this.onRefundValueCancel,children:"取消"}),(0,B.jsx)(h.View,{className:"alert_input_view__action__confirm",onClick:this.onRefundValueSave,children:"提交"})]})})]})}),z&&this.renderRefundView()]})}}]),s}(p.PureComponent),Q=(0,_.$j)((function(e){var i=e.cloudBill,s=e.goodsManage,n=e.shop.list.find((function(e){return e.id===s.mpErpId}));return{orderBillDetail:i.orderBillDetail,shop:n,staffId:s.staffInfoH5.id,showPhone:"1"===s.allowStaffViewClientPhone||"总经理"===s.staffInfo.rolename||"總經理"===s.staffInfo.rolename}}))(T);Page((0,n.createPageConfig)(Q,"subpackages/cloud_bill/pages/order_bill_screen/order_bill_detail",{root:{cn:[]}},{}||{}))}},function(e){e.O(0,[666,1772,8272,2107,1216,8592],(function(){return i=94070,e(e.s=i);var i}));e.O()}]);