"use strict";require("../../sub-vendors.js");require("../../sub-common/60464b2b77061df0626bd7ecea16c659.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[3855],{44498:function(e,o,t){var i=t(32180),n=t(65712),a=t(33661),s=t(12742),d=t(22700),c=t(95333),p=t(14175),r=t(3701),l=t(66058),u=t(18453),h=t(92954),v=t.n(h),g=t(67294),I=t(71515),m=t(75508),f=t(844),Z=t(27863),_=t(80170),k=t(29748),C=t(31254),x=t(6420),S=t(93610),V=t(35314),E="index-module__page___mBZMA",y="index-module__fix_item___mjm0j",b="index-module__fix_all_item___AcABT",G="index-module__category_navigation___KouQA",w=t(18691),P=t(89327),A=t(85893),D=function(e){(0,c.Z)(t,e);var o=(0,p.Z)(t);function t(){var e,i,s;(0,a.Z)(this,t);for(var c=arguments.length,p=new Array(c),u=0;u<c;u++)p[u]=arguments[u];return s=o.call.apply(o,[this].concat(p)),(0,r.Z)((0,d.Z)(s),"state",{videoPaused:!1,currentVideoIndex:0,favorGuide:0,gestureGuide:!1,showVideoCover:!0,fromScreen:(0,x.JU)(null===(e=v().getCurrentInstance)||void 0===e?void 0:e.call(v())).fromScreen,showAllShop:!(0,x.JU)(null===(i=v().getCurrentInstance)||void 0===i?void 0:i.call(v())).mpErpIds}),(0,r.Z)((0,d.Z)(s),"videoIns",void 0),(0,r.Z)((0,d.Z)(s),"init",(function(){var e;s.fetchShopVideos(!0),s.fetchShopGoods(Number((0,x.JU)(null===(e=v().getCurrentInstance)||void 0===e?void 0:e.call(v())).mpErpId))})),(0,r.Z)((0,d.Z)(s),"fetchShopGoods",(function(e){s.props.dispatch({type:"cloudBill/save",payload:{mpErpId:e,goodsListPreview:[]}}),s.props.dispatch({type:"cloudBill/fetchGoodsListPreview",payload:{mpErpId:e}})})),(0,r.Z)((0,d.Z)(s),"fetchShopVideos",(function(){var e,o,t={refresh:arguments.length>0&&void 0!==arguments[0]&&arguments[0],exclusiveId:s.props.data.videoId};(0,x.JU)(null===(e=v().getCurrentInstance)||void 0===e?void 0:e.call(v())).mpErpIds&&(t={mpErpIds:(0,x.JU)(null===(o=v().getCurrentInstance)||void 0===o?void 0:o.call(v())).mpErpIds});s.props.dispatch({type:"cloudBill/fetchVideoList",payload:t})})),(0,r.Z)((0,d.Z)(s),"onShopClick",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"video",o=s.props.videoList[s.state.currentVideoIndex];s.props.dispatch({type:"cloudBill/save",payload:{shopInfo:o}}),v().navigateTo({url:"/subpackages/cloud_bill/pages/all_goods/index?mpErpId=".concat(o.mpErpId,"&tab=").concat(e)})})),(0,r.Z)((0,d.Z)(s),"onAllShopClick",(function(){v().switchTab({url:"/pages/cloud_bill_tab/index"})})),(0,r.Z)((0,d.Z)(s),"onGoodsClick",(function(e){s.props.dispatch({type:"goodsManage/cloudBillInitShopParam",payload:{mpErpId:s.props.mpErpId}}),s.props.dispatch({type:"cloudBill/fetchGoodsDetail",payload:{spuId:e.styleId,goodsDtail:(0,l.Z)((0,l.Z)({},e),{},{skus:[]})}}),v().navigateTo({url:"/subpackages/cloud_bill/pages/goods_detail/index"})})),(0,r.Z)((0,d.Z)(s),"onTicketClick",(function(){var e=s.props.data,o=e.sn,t=e.epid,i=e.billid,n=e.type;v().navigateTo({url:"/pages/eTicketDetail/landscapeModel?sn=".concat(o,"&epid=").concat(t,"&billid=").concat(i,"&type=").concat(n)})})),(0,r.Z)((0,d.Z)(s),"getVideoIns",(function(e){var o=s.state.currentVideoIndex;e="number"==typeof e?e:o;var t=s.videoIns[e];return t||v().createVideoContext("video_".concat(e))})),(0,r.Z)((0,d.Z)(s),"addVideoIns",(function(e){s.videoIns[e]||(s.videoIns[e]=v().createVideoContext("video_".concat(e)))})),(0,r.Z)((0,d.Z)(s),"removeVideoIns",(function(e){s.videoIns[e]=null})),(0,r.Z)((0,d.Z)(s),"removeUnusedIns",(function(e){s.videoIns.forEach((function(o,t){Math.abs(e-t)>1&&o&&s.removeVideoIns(t)}))})),(0,r.Z)((0,d.Z)(s),"onVideoPlay",(function(e){var o=e.target.id.split("_"),t=(0,n.Z)(o,2),i=(t[0],t[1]);s.state.currentVideoIndex===Number(i)&&s.setState({videoPaused:!1})})),(0,r.Z)((0,d.Z)(s),"onVideoPause",(function(e){var o=e.target.id.split("_"),t=(0,n.Z)(o,2),i=(t[0],t[1]);s.state.currentVideoIndex===Number(i)&&s.setState({videoPaused:!0})})),(0,r.Z)((0,d.Z)(s),"onVideoClick",(function(){var e=s.getVideoIns();s.state.videoPaused?e.play():e.pause()})),(0,r.Z)((0,d.Z)(s),"onVideoChangeButStillAnimation",(function(e){s.state.currentVideoIndex!==e&&s.props.dispatch({type:"cloudBill/save",payload:{goodsListPreview:[]}})})),(0,r.Z)((0,d.Z)(s),"onVideoChange",(function(e){if(s.state.currentVideoIndex!==e){s.setState({currentVideoIndex:e});var o=s.props.videoList[e];1===o.bindFlag&&s.fetchShopGoods(o.mpErpId),(0,k.Pt)({mpErpId:o.mpErpId,videoId:o.videoId}),s.state.gestureGuide&&(s.setState({gestureGuide:!1}),v().setStorage({key:C.tO.VIDEO_GESTURE_GUIDE,data:!0}))}s.props.videoList.length-e<=6&&!s.props.noMoreVideos&&s.fetchShopVideos()})),(0,r.Z)((0,d.Z)(s),"onFavorImage1Click",(function(){s.setState({favorGuide:2})})),(0,r.Z)((0,d.Z)(s),"onFavorImage2Click",(function(){s.setState({favorGuide:0}),v().setStorage({key:C.tO.VIDEO_PAGE_GUIDE,data:!0})})),s}return(0,s.Z)(t,[{key:"componentDidMount",value:function(){var e;if(this.videoIns=[v().createVideoContext("video_0")],this.init(),V.Z.log("videoShop => mpErpId:".concat((0,x.JU)(null===(e=v().getCurrentInstance)||void 0===e?void 0:e.call(v())).mpErpId)),this.props.shop){var o,t=this.props.shop,i=t.sn,n=t.epid,a=t.shopid;_.Z.trackToBigData({sn:i,epid:n,shop:a,data:[{key:"enter_cloud",value:1}],tag:{page:Z.G2.VIDEO,source:(0,x.JU)(null===(o=v().getCurrentInstance)||void 0===o?void 0:o.call(v())).source}})}v().getStorageSync(C.tO.VIDEO_PAGE_GUIDE)||this.setState({favorGuide:1}),v().getStorageSync(C.tO.VIDEO_GESTURE_GUIDE)||this.setState({gestureGuide:!0}),(0,k.Pt)({mpErpId:this.props.data.mpErpId,videoId:this.props.data.videoId})}},{key:"render",value:function(){var e=this.state,o=(e.videoPaused,e.currentVideoIndex,e.favorGuide),t=(e.gestureGuide,e.showVideoCover,e.fromScreen),i=e.showAllShop,n=this.props,a=n.top,s=(n.data,n.goodsList),d=n.menuRect,c=n.navigationRight,p=n.videoList,r=n.shop;return(0,A.jsxs)(f.Z,{enableBack:"manage"===t,backIcon:S,containerClass:G,stickyTop:!0,children:[(0,A.jsxs)(I.View,{className:E,children:[(0,A.jsx)(w.Z,{videoList:p,onShopClick:this.onShopClick,onAnimationFinish:this.onVideoChange,onChange:this.onVideoChangeButStillAnimation,top:a,onAllShopClick:this.onAllShopClick,showAllShop:i,goodsList:s,onGoodsClick:this.onGoodsClick,onLeftFlip:this.onShopClick,onTicketClick:this.onTicketClick}),1===o&&(0,A.jsx)(I.Image,{src:"https://webdoc.hzecool.com/webCdn/weapp/ec-ticket/src/subpackages/cloud_bill/images/47661a0c9426c10c421c..png",className:y,style:{top:"".concat(d.top+d.height+6,"px"),right:"".concat(c,"px"),width:"184px",height:"54px"},onClick:this.onFavorImage1Click}),2===o&&(0,A.jsx)(I.View,{className:b,children:(0,A.jsx)(I.Image,{src:"https://webdoc.hzecool.com/webCdn/weapp/ec-ticket/src/subpackages/cloud_bill/images/27f0a33022b4643bc03c..png",className:y,style:{top:"".concat(d.top+d.height+16,"px"),right:"".concat(c+20,"px"),width:"305px",height:"382px"},onClick:this.onFavorImage2Click})})]}),(0,A.jsx)(P.Z,{shop:r})]})}}]),t}(g.PureComponent),L=(0,m.$j)((function(e){var o=e.systemInfo,t=e.cloudBill,i=e.shop,n=t.goodsListPreview||[];return{top:o.gap+o.navigationHeight,data:t.videoPageData,goodsList:n.filter((function(e){return e.imgUrl})).slice(0,3),mpErpId:t.mpErpId,shop:i.list.find((function(e){return e.id===t.mpErpId})),menuRect:o.menuRect,navigationRight:o.navigationPadding,videoList:[(0,l.Z)({},t.videoPageData)].concat((0,u.Z)(t.videoList)),noMoreVideos:t.noMoreVideos}}))(D);Page((0,i.createPageConfig)(L,"subpackages/cloud_bill/pages/shop_video/index",{root:{cn:[]}},{navigationStyle:"custom"}||{}))}},function(e){e.O(0,[666,1772,3658,2107,1216,8592],(function(){return o=44498,e(e.s=o);var o}));e.O()}]);