"use strict";require("../../sub-vendors.js");require("../../sub-common/1953cfd0adfeaa0d6d261e56d0b37b07.js");require("../../sub-common/bb2c8c0f711cf957fde499897943f6c9.js");require("../../sub-common/b29cd7063a909867339ec276af77ca8d.js");require("../../sub-common/78ff1c5e3249ffe8143b019acaf9acf9.js");require("../../sub-common/0024d1ebaf2d54e4f329d83d74ef47eb.js");require("../../sub-common/08a18b27d1150d5ee9d5572aa8a9c59c.js");require("../../sub-common/7c0adf770df38bf5b2cc4b3b1f616710.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[8087],{14028:function(e,s,i){var t=i(32180),o=i(18453),n=i(33661),a=i(12742),c=i(22700),r=i(95333),l=i(14175),p=i(3701),d=i(66058),_=i(92954),u=i.n(_),h=i(67294),m=i(71515),g=i(75508),w=i(44559),f=i(94184),v=i.n(f),k=i(31254),Z=i(6949),C=i(6420),N=i(26142),S=i(79334),V=(0,i(20573).P1)((function(e){return e.goodsList}),(function(e){var s=e.filter((function(e){return e.checked})),i=s.length===e.length,t=s.reduce((function(e,s,i){return e+(0===i?"":",")+s.styleId}),"");return{checkedSpu:s,checkedSpuLength:s.length,isAllChecked:i,checkedSpuIds:t}})),y=i(66924),x=i(40068),j=i(9936),I=i(63056),P=i(55676),A=i(28374),L="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAALVJREFUWEftlM0JwCAMRqPnrtQFuodTuUcX6Eo9SwkoiKj58SCF9Chfk8fTxMHmz23uDwZgBsyAGfiHgRjjiRszhPBwNqckTxrAYimlGxt77y8KQpqXABwA8M4gquZktpgkATDIKczJ9K6PBUBBaJtjXTbACALP8xtha69NiAB6ELmYqrnYQCFvlOPx9HHORldsoAPBGs8RhBqgXIdkQS1NAWcDajJLBjQN238MwAyYATOw3cAHmsZ7If+f59IAAAAASUVORK5CYII=",b=i(85893),M=[{label:"6折",value:6},{label:"7折",value:7},{label:"8折",value:8},{label:"9折",value:9}],T=function(e){(0,r.Z)(i,e);var s=(0,l.Z)(i);function i(){var e;(0,n.Z)(this,i);for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return e=s.call.apply(s,[this].concat(o)),(0,p.Z)((0,c.Z)(e),"state",{discountValue:-1,usePriceType:{},inputPrice:""}),(0,p.Z)((0,c.Z)(e),"onMaskClick",(function(){e.props.onClose&&e.props.onClose()})),(0,p.Z)((0,c.Z)(e),"onDiscountInput",(function(s){var i=s.detail.value;e.setInputPrice(i)})),(0,p.Z)((0,c.Z)(e),"onDisClick",(function(s){var i=s.currentTarget.dataset.value;e.setInputPrice(i)})),(0,p.Z)((0,c.Z)(e),"setInputPrice",(function(s){var i,t=e.props.data,o=e.state.usePriceType;i=e.state.usePriceType.name?t["stdPrice".concat(o.sid)]*Number(s)/10:Number(t.price)*Number(s)/10,e.setState({inputPrice:String((0,A.NM)(i,3)),discountValue:Number(s)})})),(0,p.Z)((0,c.Z)(e),"onSelectPriceClick",(function(){var s=e.props,i=s.priceTypeList,t=s.data,o=i.filter((function(e){return"1"===e.delflag})),n=o.map((function(e){return e.name+"："+t["stdPrice".concat(e.sid)]}));u().showActionSheet({itemList:n,success:function(s){var i=s.tapIndex;e.setState({usePriceType:o[i]},(function(){e.state.discountValue>0?e.setInputPrice(e.state.discountValue):e.setState((function(s){return{inputPrice:String((0,A.NM)(e.props.data["stdPrice".concat(s.usePriceType.sid)],3))}}))}))}})})),(0,p.Z)((0,c.Z)(e),"onSpecialSave",(function(){var s=e.state.inputPrice,i=e.props,t=i.data,o=i.showPrice;if(s){if(Number(s)>=Number(t.originPrice||t.price)&&o)return void e.showAlert("特价不能超过原始价格",!0);e.props.onSaveClick&&e.props.onSaveClick(Number(s),Number(e.props.data.styleId))}else e.showAlert("请输入价格")})),(0,p.Z)((0,c.Z)(e),"showAlert",(function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?I.Z.showToast(e):I.Z.showAlert(e,"提示","好的")})),(0,p.Z)((0,c.Z)(e),"onPriceInput",(function(s){e.setState({inputPrice:s.detail.value})})),e}return(0,a.Z)(i,[{key:"render",value:function(){var e=this,s=this.state,i=s.discountValue,t=s.usePriceType,o=s.inputPrice,n=this.props,a=n.data,c=n.priceTypeList,r=n.showPrice,l=n.from,d=c.find((function(e){return e.sid===String(a.priceType)}));return(0,b.jsx)(m.View,{className:"set_goods_special_wapper",onClick:this.onMaskClick,children:(0,b.jsxs)(m.View,{className:"set_goods_special_wapper__content",onClick:function(e){return e.stopPropagation()},children:[(0,b.jsxs)(m.View,{className:"set_goods_special_wapper__content__header",children:[(0,b.jsx)(m.View,{className:"set_goods_special_wapper__content__header__headImage",children:a.imgUrls?(0,b.jsx)(x.Z,{mode:"aspectFill",src:a.imgUrls}):(0,b.jsx)(x.Z,{mode:"aspectFill",src:a.imgUrl||P})}),(0,b.jsxs)(m.View,{className:"set_goods_special_wapper__content__header__goodsInfo",children:[(0,b.jsx)(m.View,{className:"goods_name",children:a.name}),r&&(0,b.jsxs)(m.View,{className:"goods_price_view",children:[(0,b.jsx)(m.Text,{className:"goods_price_view__label",children:"原始价格"}),(0,b.jsxs)(m.Text,{className:"goods_price_view__price",children:[(0,b.jsx)(m.Text,{className:"price_icon",children:"¥"}),a.originPrice||a.price]}),d&&(0,b.jsx)(m.View,{className:"goods_price_view__type",children:d.name})]})]}),(0,b.jsx)(m.Image,{src:j,className:"delete_icon",onClick:this.onMaskClick})]}),(0,b.jsxs)(m.View,{className:"set_goods_special_wapper__content__inputView",children:[(0,b.jsx)(m.View,{className:"set_goods_special_wapper__content__inputView__label special_label",children:"特价价格"}),(0,b.jsx)(m.Input,{className:"set_goods_special_wapper__content__inputView__input",placeholderClass:"placeholder_class",placeholder:"输入价格",type:"number",value:o,onInput:this.onPriceInput}),(0,b.jsxs)(m.View,{className:"set_goods_special_wapper__content__inputView__label",children:["优惠¥",(0,A.NM)(Number(a.originPrice||a.price)-Number(o||a.price),3)]})]}),(0,b.jsxs)(m.View,{className:"set_goods_special_wapper__content__setprice",children:[(0,b.jsx)(m.View,{className:"set_goods_special_wapper__content__setprice__title",children:"快速定价"}),(0,b.jsxs)(m.View,{className:"col",children:[(0,b.jsxs)(m.View,{className:"set_goods_special_wapper__content__setprice__setView",children:[(0,b.jsxs)(m.View,{className:"select_price_type set_price_view",onClick:this.onSelectPriceClick,children:[t.name||"价格类型",(0,b.jsx)(m.Image,{src:L,className:"angle_bottom_icon"})]}),(0,b.jsx)(m.View,{className:"setView_label",children:"的"}),(0,b.jsx)(m.View,{className:"price_discount set_price_view",children:(0,b.jsx)(m.Input,{type:"number",placeholderClass:"placeholder_class",placeholder:"折扣数",className:"input_view",value:i>0?String(i):"",onInput:this.onDiscountInput})}),(0,b.jsx)(m.View,{className:"setView_label",children:"折"})]}),(0,b.jsx)(m.View,{className:"discount_bg_view",children:M.map((function(s){return(0,b.jsx)(m.View,{"data-value":s.value,onClick:e.onDisClick,className:v()("discount_bg_view__item",(0,p.Z)({},"discount_bg_view__item--active",i===s.value)),children:s.label},s.value)}))})]})]}),(0,b.jsx)(m.View,{className:"set_goods_special_wapper__content__bottom",children:(0,b.jsx)(m.View,{className:"set_goods_special_wapper__content__bottom_action",onClick:this.onSpecialSave,children:"use_goods"===l?"添加为特价商品":"保存"})})]})})}}]),i}(h.Component);(0,p.Z)(T,"defaultProps",{priceTypeList:[],showPrice:!1,data:{}});var F=i(94357),E=[{label:"6折",value:6},{label:"7折",value:7},{label:"8折",value:8},{label:"9折",value:9}],G=function(e){(0,r.Z)(i,e);var s=(0,l.Z)(i);function i(e){var t;(0,n.Z)(this,i),t=s.call(this,e),(0,p.Z)((0,c.Z)(t),"state",{spuPriceRange:[],skus:[]}),(0,p.Z)((0,c.Z)(t),"onMaskClick",(function(){t.props.onClose&&t.props.onClose()})),(0,p.Z)((0,c.Z)(t),"onDiscountInput",(function(e,s){var i=e.detail.value;t.setInputPriceBySku(i,s)})),(0,p.Z)((0,c.Z)(t),"onFoodDisClick",(function(e,s){t.setInputPriceBySku(s,e)})),(0,p.Z)((0,c.Z)(t),"setInputPriceBySku",(function(e,s){var i,n=t.props.data,a=s._usePriceType,c=s.sku,r=s.sku.price,l=t.state.skus;i=void 0!==a&&a.name?(c["stdPrice".concat(a.sid)]||n["stdPrice".concat(a.sid)])*Number(e)/10:Number(r)*Number(e)/10;var p=(0,o.Z)(l);s._inputPrice=(0,A.NM)(i,3),s._discountValue=e,t.setState({skus:p})})),(0,p.Z)((0,c.Z)(t),"onSelectPriceClick",(function(e){var s=t.props,i=s.priceTypeList,n=s.data,a=t.state.skus,c=e._discountValue,r=e.sku,l=i.filter((function(e){return"1"===e.delflag})),p=l.map((function(e){return e.name+"："+(r["stdPrice".concat(e.sid)]||n["stdPrice".concat(e.sid)])}));u().showActionSheet({itemList:p,success:function(s){var i=s.tapIndex,p=(0,o.Z)(a);e._usePriceType=l[i],t.setState({skus:p},(function(){var s=(0,o.Z)(a);e._inputPrice=c,t.setState({skus:s}),c>0?t.setInputPriceBySku(c,e):e._inputPrice=String((0,A.NM)(r["stdPrice".concat(e._usePriceType.sid)]||n["stdPrice".concat(e._usePriceType.sid)],3))}))}})})),(0,p.Z)((0,c.Z)(t),"onSpecialSave",(function(){var e=t.state.skus.filter((function(e){return void 0!==e._inputPrice&&Number(e._inputPrice)>=0})),s=!1;e.forEach((function(e){var i=e._inputPrice,t=e.sku;(0,A.NM)(Number(t.originPrice||t.price)-Number(i||t.price),3)<0&&(s=!0)})),s?t.showAlert("特价不能超过原始价格",!0):e.length>0?t.props.onSaveClick&&t.props.onSaveClick(e,Number(t.props.data.styleId)):t.showAlert("请输入价格")})),(0,p.Z)((0,c.Z)(t),"showAlert",(function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?I.Z.showToast(e):I.Z.showAlert(e,"提示","好的")})),(0,p.Z)((0,c.Z)(t),"onPriceInput",(function(e,s){var i=t.state.skus,n=(0,o.Z)(i);s._inputPrice=""===e.target.value?void 0:Number(e.target.value),t.setState({skus:n})}));var a=e.data,r=new Set,l=a.price||0,d=a.price||0;return Array.isArray(a.skus)&&a.skus.forEach((function(e){r.add(e.originPrice||e.price)})),0===r.size?r.add(a.price):(l=Math.min.apply(Math,(0,o.Z)(r)),d=Math.max.apply(Math,(0,o.Z)(r))),t.state={skus:a.skus?a.skus.map((function(e){return{sku:e}})):[],spuPriceRange:l===d?[l]:[l,d]},t}return(0,a.Z)(i,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){var s=e.data,i=new Set,t=s.price||0,n=s.price||0;Array.isArray(s.skus)&&s.skus.forEach((function(e){i.add(e.originPrice||e.price)})),0===i.size?i.add(s.price):(t=Math.min.apply(Math,(0,o.Z)(i)),n=Math.max.apply(Math,(0,o.Z)(i))),console.log("data111",s),this.setState({skus:s.skus?s.skus.map((function(e){return{sku:e}})):[],spuPriceRange:t===n?[t]:[t,n]})}},{key:"render",value:function(){var e=this,s=this.state,i=s.skus,t=s.spuPriceRange,o=this.props,n=o.data,a=o.priceTypeList,c=o.showPrice,r=o.from,l=a.find((function(e){return e.sid===String(n.priceType)}));return console.log("skus",i),(0,b.jsx)(m.View,{className:"set_goods_special_wapper",onClick:this.onMaskClick,children:(0,b.jsxs)(m.View,{className:"set_goods_special_wapper__content",style:{height:"auto"},onClick:function(e){return e.stopPropagation()},children:[(0,b.jsxs)(m.View,{className:"set_goods_special_wapper__content__header",children:[(0,b.jsx)(m.View,{className:"set_goods_special_wapper__content__header__headImage",children:n.imgUrls?(0,b.jsx)(x.Z,{mode:"aspectFill",src:n.imgUrls}):(0,b.jsx)(x.Z,{mode:"aspectFill",src:n.imgUrl||P})}),(0,b.jsxs)(m.View,{className:"set_goods_special_wapper__content__header__goodsInfo",children:[(0,b.jsx)(m.View,{className:"goods_name",children:n.name}),c&&(0,b.jsxs)(m.View,{className:"goods_price_view",children:[(0,b.jsx)(m.Text,{className:"goods_price_view__label",children:"原始价格"}),(0,b.jsxs)(m.Text,{className:"goods_price_view__price",children:[(0,b.jsx)(m.Text,{className:"price_icon",children:"¥"}),2===t.length?"".concat(t[0]," ~ ").concat(t[1]):t[0]]}),l&&(0,b.jsx)(m.View,{className:"goods_price_view__type",children:l.name})]})]}),(0,b.jsx)(m.Image,{src:j,className:"delete_icon",onClick:this.onMaskClick})]}),(0,b.jsx)(m.ScrollView,{scrollY:!0,className:"set_goods_special_wapper__content__units",style:{height:"".concat(i.length>=2?300:200,"px")},onTouchMove:function(e){return e.stopPropagation()},children:i.length>0&&i.map((function(s){var i=s.sku,t=s._inputPrice,o=s._discountValue,n=s._usePriceType,a=i.sizeName,c=void 0===t?i.originPrice?Number(i.originPrice)-Number(i.price):"0":Number(i.originPrice||i.price)-Number(t||0);return c=(0,A.NM)(c,3),(0,b.jsxs)(m.Block,{children:[(0,b.jsxs)(m.View,{className:"set_goods_special_wapper__content__inputView",children:[(0,b.jsxs)(m.View,{className:"set_goods_special_wapper__content__inputView__label unit_label",children:["特价价格(",a,")"]}),(0,b.jsx)(F.Z,{className:"set_goods_special_wapper__content__inputView__input",placeholderClass:"placeholder_class",placeholder:"输入价格",type:"number",value:t,onInput:function(i){return e.onPriceInput(i,s)}}),(0,b.jsxs)(m.View,{className:"set_goods_special_wapper__content__inputView__label",children:["优惠¥",c]})]}),(0,b.jsxs)(m.View,{className:"set_goods_special_wapper__content__setprice",children:[(0,b.jsx)(m.View,{className:"set_goods_special_wapper__content__setprice__title",children:"快速定价"}),(0,b.jsxs)(m.View,{className:"col",children:[(0,b.jsxs)(m.View,{className:"set_goods_special_wapper__content__setprice__setView",children:[(0,b.jsxs)(m.View,{className:"select_price_type set_price_view",onClick:function(){return e.onSelectPriceClick(s)},children:[n?n.name:"价格类型",(0,b.jsx)(m.Image,{src:L,className:"angle_bottom_icon"})]}),(0,b.jsx)(m.View,{className:"setView_label",children:"的"}),(0,b.jsx)(m.View,{className:"price_discount set_price_view",children:(0,b.jsx)(F.Z,{type:"number",placeholderClass:"placeholder_class",placeholder:"折扣数",className:"input_view",value:void 0!==o&&o>0?String(o):"",onInput:function(i){return e.onDiscountInput(i,s)}})}),(0,b.jsx)(m.View,{className:"setView_label",children:"折"})]}),(0,b.jsx)(m.View,{className:"discount_bg_view",children:E.map((function(i){return(0,b.jsx)(m.View,{"data-value":i.value,onClick:function(t){return e.onFoodDisClick(s,i.value)},className:v()("discount_bg_view__item",(0,p.Z)({},"discount_bg_view__item--active",o===i.value)),children:i.label},i.value)}))})]})]})]},a)}))}),(0,b.jsx)(m.View,{className:"set_goods_special_wapper__content__bottom__food",children:(0,b.jsx)(m.View,{className:"set_goods_special_wapper__content__bottom__food_action",onClick:this.onSpecialSave,children:"use_goods"===r?"添加为特价商品":"保存"})})]})})}}]),i}(h.Component);(0,p.Z)(G,"defaultProps",{priceTypeList:[],showPrice:!1,data:{}});var B=i(86792),R=function(e){(0,r.Z)(i,e);var s=(0,l.Z)(i);function i(){var e;(0,n.Z)(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return e=s.call.apply(s,[this].concat(a)),(0,p.Z)((0,c.Z)(e),"state",{invSwitch:!0,list:[],categoryValue:{}}),(0,p.Z)((0,c.Z)(e),"livePrice",void 0),(0,p.Z)((0,c.Z)(e),"columnValue",0),(0,p.Z)((0,c.Z)(e),"initCategoryList",(function(){var s=e.props.categoryList;e.setState({list:[s,s[0].childCatList,s[0].childCatList[0].childCatList]})})),(0,p.Z)((0,c.Z)(e),"onPickerChange",(function(s){var i=s.detail,t=i.column,n=i.value;0===t&&(e.columnValue=n,e.setState((function(s){var i=e.props.categoryList;return s.list[1]=i[n].childCatList,s.list[2]=i[n].childCatList[0].childCatList,{list:(0,o.Z)(s.list)}}))),1===t&&e.setState((function(s){var i=e.props.categoryList;return s.list[2]=i[e.columnValue].childCatList[n].childCatList,{list:(0,o.Z)(s.list)}}))})),(0,p.Z)((0,c.Z)(e),"onPickerConfirm",(function(s){var i=s.detail.value,t=e.props.categoryList;e.setState({categoryValue:t[i[0]].childCatList[i[1]].childCatList[i[2]]})})),(0,p.Z)((0,c.Z)(e),"onInvSwitchClick",(function(s){var i=s.currentTarget.dataset.type;e.setState({invSwitch:"real"===i})})),(0,p.Z)((0,c.Z)(e),"onPriceInput",(function(s){e.livePrice=s.detail.value})),(0,p.Z)((0,c.Z)(e),"onAddGoodsClick",(function(){var s=e.state,i=(s.invSwitch,s.categoryValue),t=e.props,o=t.data,n=t.mpErpId;i&&i.id?(u().showLoading({title:"请稍等..."}),(0,Z.Rq)({mpErpId:n,styleId:o.styleId,thirdCatId:i.id,styleName:o.name,styleCode:o.code,spec1Name:o.spec1Name,spec2Name:o.spec2Name,livePrice:e.livePrice?Number(e.livePrice):o.price,realPrice:o.price,priceType:o.priceType,invType:1,allImgUrlBigs:o.allImgUrlBigs,skus:o.skus.map((function(e){return{id:e.id,colorId:e.colorId,colorName:e.colorName,sizeId:e.sizeId,sizeName:e.sizeName,invNum:e.invNum}}))}).then((function(s){e.props.onSuccess(),u().hideLoading()})).catch((function(e){u().hideLoading()}))):I.Z.showToast("请选择商品类目")})),(0,p.Z)((0,c.Z)(e),"onClose",(function(){e.props.onClose()})),e}return(0,a.Z)(i,[{key:"componentDidMount",value:function(){this.initCategoryList()}},{key:"render",value:function(){var e=this.state,s=(e.invSwitch,e.list),i=e.categoryValue,t=this.props,o=t.data,n=t.priceTypeList.find((function(e){return e.sid===String(o.priceType)}));return(0,b.jsx)(m.View,{className:"up_goods_mask",onClick:this.onClose,children:(0,b.jsxs)(m.View,{className:"up_goods_mask__content",onClick:function(e){return e.stopPropagation()},children:[(0,b.jsxs)(m.View,{className:"up_goods_mask__content__goodsInfo",children:[(0,b.jsx)(m.View,{className:"up_goods_mask__content__goodsInfo__goodsImage",children:o&&o.imgUrls?(0,b.jsx)(x.Z,{mode:"aspectFill",src:o.imgUrls}):(0,b.jsx)(x.Z,{mode:"aspectFill",src:o&&o.imgUrl||P})}),(0,b.jsxs)(m.View,{className:"up_goods_mask__content__goodsInfo__info",children:[(0,b.jsx)(m.View,{className:"up_goods_mask__content__goodsInfo__info__name",children:o.name}),(0,b.jsxs)(m.View,{className:"up_goods_mask__content__goodsInfo__info__priceView",children:[(0,b.jsx)(m.View,{className:"up_goods_mask__content__goodsInfo__info__priceView__label",children:"原价"}),(0,b.jsxs)(m.View,{className:"up_goods_mask__content__goodsInfo__info__priceView__price",children:["¥",o.originPrice||o.price]}),n&&(0,b.jsx)(m.View,{className:"up_goods_mask__content__goodsInfo__info__priceView__priceType",children:n.name})]})]}),(0,b.jsx)(m.Image,{src:j,className:"delete_icon",onClick:this.onClose})]}),(0,b.jsxs)(m.View,{className:"up_goods_mask__content__category",children:[(0,b.jsx)(m.Text,{className:"up_goods_mask__content__category__label",children:"上架类目"}),(0,b.jsx)(m.Picker,{mode:"multiSelector",range:s,rangeKey:"name",onColumnChange:this.onPickerChange,onChange:this.onPickerConfirm,children:(0,b.jsxs)(m.View,{className:"up_goods_mask__content__category__value",children:[i.name||"选择类目",(0,b.jsx)(m.Image,{src:B,className:"angle_right_icon"})]})})]}),(0,b.jsxs)(m.View,{className:"up_goods_mask__content__goodsPrice",children:[(0,b.jsxs)(m.View,{className:"up_goods_mask__content__goodsPrice__left",children:[(0,b.jsx)(m.View,{className:"up_goods_mask__content__goodsPrice__left__title",children:"直播价格"}),(0,b.jsx)(m.View,{className:"up_goods_mask__content__goodsPrice__left__label",children:"不设置则以原价上架"})]}),(0,b.jsx)(m.View,{className:"up_goods_mask__content__goodsPrice__right",children:(0,b.jsx)(m.Input,{type:"digit",onInput:this.onPriceInput,placeholder:"输入价格",placeholderStyle:"color: #999;",className:"up_goods_mask__content__goodsPrice__right__input"})})]}),(0,b.jsx)(m.View,{className:"up_goods_mask__content__bottom",children:(0,b.jsx)(m.View,{className:"up_goods_mask__content__bottom__action",onClick:this.onAddGoodsClick,children:"上架商品"})})]})})}}]),i}(h.Component);(0,p.Z)(R,"defaultProps",{priceTypeList:[],data:{},categoryList:[]});var U=function(e){return e[e.NO_SALE=6]="NO_SALE",e[e.ON_SALE=7]="ON_SALE",e}(U||{}),O=function(e){(0,r.Z)(i,e);var s=(0,l.Z)(i);function i(){var e;(0,n.Z)(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return e=s.call.apply(s,[this].concat(a)),(0,p.Z)((0,c.Z)(e),"state",{showClassModel:!1,showFilterModel:!1,classId:0,searchValue:"",isSpecial:!1,currentSpecialGoods:{},isVideoLive:!1,categoryList:{}}),(0,p.Z)((0,c.Z)(e),"marketOptimeBegin",""),(0,p.Z)((0,c.Z)(e),"marketOptimeEnd",""),(0,p.Z)((0,c.Z)(e),"hotValue",""),(0,p.Z)((0,c.Z)(e),"filterShop",{}),(0,p.Z)((0,c.Z)(e),"brand",{}),(0,p.Z)((0,c.Z)(e),"provider",{}),(0,p.Z)((0,c.Z)(e),"season",{}),(0,p.Z)((0,c.Z)(e),"fetchList",(function(){var s=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e.props.dispatch({type:"goodsManage/fetchGoodsList",payload:{excludeChannelLive:1,classId:e.state.classId||void 0,type:U.ON_SALE,loadMore:s,brandId:e.brand.id||void 0,providerId:e.provider.id||void 0,season:e.season.id||void 0,slhMarketDateBegin:e.marketOptimeBegin||void 0,slhMarketDateEnd:e.marketOptimeEnd||void 0,styleNameLike:e.state.searchValue.trim(),styleIdsNotIn:e.props.useGoodsSpus.map((function(e){return e.styleId}))}})})),(0,p.Z)((0,c.Z)(e),"onClearClick",(function(){e.props.dispatch({type:"goodsManage/checkeAllGoods",payload:{checked:!1}})})),(0,p.Z)((0,c.Z)(e),"onSaveClick",(function(){var s=e.props,i=s.checkedSpuIds,t=s.goodsList;if(i){var n,a=(0,C.JU)(null===(n=u().getCurrentInstance)||void 0===n?void 0:n.call(u())).from,c=i.split(","),r=e.props.useGoodsSpus.map((function(e){return(0,d.Z)({},e)}));"share"===a&&e.props.useGoodsSpus.length>=40&&r.splice(r.length-c.length),"share"===a&&e.props.useGoodsSpus.length+c.length>=40&&r.splice(r.length-c.length+e.props.useGoodsSpus.length-40),e.props.dispatch({type:"goodsManage/save",payload:{useGoodsSpus:[].concat((0,o.Z)(r),(0,o.Z)(t.filter((function(e){return c.includes(String(e.styleId))}))))}})}u().navigateBack()})),(0,p.Z)((0,c.Z)(e),"onItemClick",(function(s){var i,t,o=(0,C.JU)(null===(i=u().getCurrentInstance)||void 0===i?void 0:i.call(u())).from,n=void 0===o?"":o;s.allImgUrlBig||"share"!==n?"special"===n||"live"===n?(u().showLoading({title:"请稍等..."}),e.props.dispatch({type:"goodsManage/fetchGoodsDetail",payload:{spuId:s.styleId,isSpecial:!0}}).then((function(){u().hideLoading(),"special"===n?e.setState({isSpecial:!0}):e.setState({isVideoLive:!0})}))):(t="share"===n?e.props.checkedSpuLength<40&&!s.checked:!s.checked,e.props.dispatch({type:"goodsManage/updateSpuChecked",payload:{styleId:s.styleId,checked:t}})):u().showToast({title:"请选择有图的货品",icon:"none"})})),(0,p.Z)((0,c.Z)(e),"onClassificationClick",(function(s){e.setState({classId:s.codeValue})})),(0,p.Z)((0,c.Z)(e),"onCloseClassModel",(function(){e.setState({showClassModel:!1})})),(0,p.Z)((0,c.Z)(e),"onResetClick",(function(){e.setState({classId:0})})),(0,p.Z)((0,c.Z)(e),"onConfirmClick",(function(){e.onCloseClassModel(),e.fetchList()})),(0,p.Z)((0,c.Z)(e),"onClassClick",(function(){e.setState((function(e){return{showClassModel:!e.showClassModel}}))})),(0,p.Z)((0,c.Z)(e),"onFilterClick",(function(){e.setState((function(e){return{showFilterModel:!e.showFilterModel}}))})),(0,p.Z)((0,c.Z)(e),"onCloseFilterView",(function(){e.setState({showFilterModel:!1})})),(0,p.Z)((0,c.Z)(e),"onSearchInput",(function(s){e.setState({searchValue:s})})),(0,p.Z)((0,c.Z)(e),"onClearSearchClick",(function(){e.setState({searchValue:""},e.fetchList)})),(0,p.Z)((0,c.Z)(e),"onSearchConfirm",(function(){e.fetchList()})),(0,p.Z)((0,c.Z)(e),"onFilterConfirm",(function(s){var i=s.dateValue,t=i.prodate1,o=i.prodate2;e.marketOptimeBegin=s.dateValue?t:"",e.marketOptimeEnd=s.dateValue?o:"",e.hotValue=s.hotValue,e.filterShop=s.filterShop,e.brand=s.brand,e.provider=s.provider,e.season=s.season,e.setState({showFilterModel:!1}),e.fetchList()})),(0,p.Z)((0,c.Z)(e),"onFilterReset",(function(){e.marketOptimeBegin="",e.marketOptimeEnd="",e.hotValue="",e.filterShop={},e.brand={},e.provider={},e.season={}})),(0,p.Z)((0,c.Z)(e),"onSpecialFoodSave",(function(s,i){var t=e.props.goodsList.find((function(e){return e.styleId===i})),n=Math.min.apply(Math,(0,o.Z)(s.map((function(e){return e.sku.originPrice=e.sku.price,e.sku.price=e._inputPrice,e._inputPrice}))));if(e.props.useGoodsSpus.length<100&&t){var a=s.map((function(e){return e.sku}));e.props.dispatch({type:"goodsManage/addUseGoods",payload:{good:(0,d.Z)((0,d.Z)({},t),{},{price:n,originPrice:t.price,skus:a})}}),u().navigateBack()}})),(0,p.Z)((0,c.Z)(e),"onSpecialSave",(function(s,i){var t=e.props.goodsList.find((function(e){return e.styleId===i}));e.props.useGoodsSpus.length<100&&t&&(e.props.dispatch({type:"goodsManage/addUseGoods",payload:{good:(0,d.Z)((0,d.Z)({},t),{},{price:s,originPrice:t.price})}}),u().navigateBack())})),(0,p.Z)((0,c.Z)(e),"onClose",(function(){e.setState({isSpecial:!1})})),(0,p.Z)((0,c.Z)(e),"onUpGoodsSuccess",(function(){u().eventCenter.trigger("REFRESH_CHECK_GOODS"),u().navigateBack()})),(0,p.Z)((0,c.Z)(e),"onCloseClick",(function(){e.setState({isVideoLive:!1})})),(0,p.Z)((0,c.Z)(e),"renderItem",(function(){return(0,b.jsxs)(m.View,{className:"bottom_btn",children:[(0,b.jsx)(m.View,{onClick:e.onResetClick,className:"bottom_btn_rest",children:"重置"}),(0,b.jsx)(m.View,{onClick:e.onConfirmClick,className:"bottom_btn_sure",children:"确定"})]})})),(0,p.Z)((0,c.Z)(e),"renderScreenModel",(function(){var s=e.props,i=s.brandList,t=s.providerList,o=s.seasonList,n=s.shopFilterList,a=e.state.showFilterModel;return(0,b.jsx)(y.Z,{isVisible:a,onReset:e.onFilterReset,onConfirm:e.onFilterConfirm,onClose:e.onCloseFilterView,brandList:i,shopFilterList:n,providerList:t,seasonList:o,from:"use_goods"})})),(0,p.Z)((0,c.Z)(e),"renderCategory",(function(){var s=e.props.classList,i=void 0===s?[]:s,t=e.state.classId;return(0,b.jsx)(m.View,{className:"category_mask",onClick:e.onCloseClassModel,children:(0,b.jsxs)(m.View,{className:"category_cn",onClick:function(e){return e.stopPropagation()},children:[(0,b.jsxs)(m.View,{className:"category_con_header",children:[i.map((function(s){return(0,b.jsx)(m.View,{onClick:function(){e.onClassificationClick(s)},className:v()("category_con_item",(0,p.Z)({},"category_con_item_active",s.codeValue===t)),children:s.codeName},s.codeValue)})),i.length%2!=0&&(0,b.jsx)(m.View,{className:v()("category_con_item","hide")})]}),e.renderItem()]})})})),e}return(0,a.Z)(i,[{key:"componentDidMount",value:function(){var e,s=this;this.props.priceTypeList.length||this.props.dispatch({type:"goodsManage/selectShopPriceTypeList"}),"live"===(0,C.JU)(null===(e=u().getCurrentInstance)||void 0===e?void 0:e.call(u())).from&&(0,Z.mY)({mpErpId:this.props.mpErpId}).then((function(e){var i=e.data;console.log(i),s.setState({categoryList:i.rows})})).catch((function(){})),this.fetchList()}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:"goodsManage/checkeAllGoods",payload:{checked:!1}}),this.props.dispatch({type:"goodsManage/resetList"})}},{key:"onReachBottom",value:function(){this.props.goodsList.length<k.IV*this.props.pageNo||this.fetchList(!0)}},{key:"render",value:function(){var e,s=this,i=this.props,t=i.goodsList,o=i.checkedSpuLength,n=i.specialGoodsDetail,a=i.priceTypeList,c=i.spuShowPrice,r=i.mpErpId,l=i.saasProductType,p=i.independentType,d=this.state,_=(d.showFilterModel,d.showClassModel),h=d.isSpecial,g=(d.currentSpecialGoods,d.isVideoLive),f=d.categoryList,k=(0,C.JU)(null===(e=u().getCurrentInstance)||void 0===e?void 0:e.call(u())).from,Z=void 0===k?"":k,V=40===l&&0!==p;return(0,b.jsxs)(m.View,{className:"use_goods",children:[(0,b.jsxs)(m.View,{className:"use_goods__header aic",children:[(0,b.jsx)(m.View,{className:"use_goods__header__searchView aic",children:(0,b.jsx)(w.Z,{placeholder:"搜索商品",onInput:this.onSearchInput,onClearSearchClick:this.onClearSearchClick,onSearchClick:this.onSearchConfirm})}),(0,b.jsxs)(m.View,{className:"use_goods__header__action aic",onClick:this.onClassClick,children:[(0,b.jsx)(m.Image,{src:N,className:"header_icon"}),(0,b.jsx)(m.Text,{children:"分类"})]}),(0,b.jsxs)(m.View,{className:"use_goods__header__action aic",onClick:this.onFilterClick,children:[(0,b.jsx)(m.Image,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAV1JREFUWEftlaFOxEAQhucPCGSfAYklQWDgJRowBMzOOjAkHIpDAQkG3O4aCAbSlwCDIMEieYbKE5AhTdoLabpts730zFY1s51/vv4z04KWfGHJ9SkCRAeiA50OKKUOAKyHrKuIfDvnntpyWwG01nsi8hxSvMoBsG+MefFptAIw8yERPQwBIKIja+1jEECapitJkrwD2CoFZiJyC+CnSVBEVgGcEtFacS4iH3meb2dZ9hsEUCRprTdE5LMSJaJza+11kyAzT4joqoIFsGmM+QqegSpRa30mIlXRWZNwHRTAxBhz09W+zi0oBOqtqFvbdT7YAU8r5sNVG9ZGh4Jn4H8iM98R0XEZm1prL4t7Zr4gomkZv7fWnnRZP1/Tvg82FPIBzON9tHvNQCVUe9MIEB0Y3wGl1A6A3fI7/+qce2vbjoVvgU/Qtx0RYDQHfLMxGkCfQgv5GQ0pFAF8DvwBlp/ZIbeHCNoAAAAASUVORK5CYII=",className:"header_icon"}),(0,b.jsx)(m.Text,{children:"筛选"})]})]}),(0,b.jsx)(m.View,{className:v()("good_two_container",{"good_two_container--normal":!0,"good_two_container_padding--zero":0===t.length}),children:t.map((function(e){return(0,b.jsx)(m.View,{className:"good_items",children:(0,b.jsx)(S.Z,{onItemClick:s.onItemClick,size:"small",data:e,manage:!0,showViewCount:!0,showHotIcon:!1,showInvNum:!1})},e.id)}))}),"special"!==Z&&(0,b.jsxs)(m.View,{className:"use_goods__bottom jcsb",children:[(0,b.jsx)(m.View,{className:"use_goods__bottom__actionLeft aic jcc",onClick:this.onClearClick,children:"清空"}),(0,b.jsx)(m.View,{className:"use_goods__bottom__actionRight aic jcc",onClick:this.onSaveClick,children:0===o?"请选择货品":"已选(".concat(o,")，保存")})]}),_&&this.renderCategory(),this.renderScreenModel(),h&&(V?(0,b.jsx)(G,{from:"use_goods",showPrice:c,data:n,priceTypeList:a,onSaveClick:this.onSpecialFoodSave,onClose:this.onClose}):(0,b.jsx)(T,{from:"use_goods",showPrice:c,data:n,priceTypeList:a,onSaveClick:this.onSpecialSave,onClose:this.onClose})),g&&(0,b.jsx)(R,{mpErpId:r,data:n,priceTypeList:a,categoryList:f,onClose:this.onCloseClick,onSuccess:this.onUpGoodsSuccess})]})}}]),i}(h.Component),D=(0,g.$j)((function(e){var s=e.goodsManage;return(0,d.Z)((0,d.Z)({goodsList:s.goodsList},V(s)),{},{classList:s.classList,brandList:s.brandList,providerList:s.providerList,seasonList:s.seasonList,shopFilterList:s.shopFilterList,pageNo:s.pageNo,useGoodsSpus:s.useGoodsSpus,specialGoodsDetail:s.specialGoodsDetail,priceTypeList:s.priceTypeList,spuShowPrice:"1"===s.spuShowPrice,mpErpId:s.mpErpId,saasProductType:s.saasProductType,independentType:s.independentType})}))(O);Page((0,t.createPageConfig)(D,"subpackages/cloud_bill/pages/use_goods/index",{root:{cn:[]}},{navigationBarTitleText:"选择货品"}||{}))}},function(e){e.O(0,[666,1772,8272,8936,3199,5487,4760,1979,9746,1922,2107,1216,8592],(function(){return s=14028,e(e.s=s);var s}));e.O()}]);