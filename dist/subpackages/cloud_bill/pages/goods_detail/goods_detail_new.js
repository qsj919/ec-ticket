"use strict";require("../../sub-vendors.js");require("../../sub-common/ea5651c74a764b7a53f5764aba833936.js");require("../../sub-common/60464b2b77061df0626bd7ecea16c659.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[4423],{66573:function(o,e,t){var i=t(32180),n=t(18453),s=t(33661),l=t(12742),a=t(22700),r=t(95333),d=t(14175),c=t(3701),p=t(92954),g=t.n(p),u=t(67294),h=t(71515),m=t(96486),I=t(75508),f=t(844),v=t(91629),w=t(6420),S=t(66058),x=t(23279),Z=t.n(x),C=t(86889),y=t(64401),k=t(6870),b=t(7567),_=t(22282),N=t(11688),T=t(62754),G=t(12859),B=t(72026),U=t(63372),A=t(64782),H=t(19853),j=t(85893),D=function(o){(0,r.Z)(t,o);var e=(0,d.Z)(t);function t(o){var i;return(0,s.Z)(this,t),i=e.call(this,o),(0,c.Z)((0,a.Z)(i),"config",{navigationBarTitleText:"",navigationStyle:"custom"}),(0,c.Z)((0,a.Z)(i),"getShareInfo",(function(){var o,e=(0,w.JU)(null===(o=g().getCurrentInstance)||void 0===o?void 0:o.call(g())),t=e.mpErpId,n=e.spuId;return t&&n||(t=i.props.mpErpId,n=i.props.spuId),{mpErpId:t,spuId:n}})),(0,c.Z)((0,a.Z)(i),"onColorSizeVisibleChanged",(function(o){i.props.dispatch({type:"cloudBill/save",payload:{colorSizeVisible:o}})})),(0,c.Z)((0,a.Z)(i),"showColorSizeModel",(function(o,e){i.props.onButtonClick(o,i.props.goodsDetail.styleId)})),(0,c.Z)((0,a.Z)(i),"onSaveClick",(function(o){i.props.onSaveClick(o)})),(0,c.Z)((0,a.Z)(i),"downloadImages",Z()((function(){i.props.isImageDownloading||i.props.dispatch({type:"cloudBill/fetchImageUrls",payload:{_id:i.props.goodsDetail.styleId}})}),400)),(0,c.Z)((0,a.Z)(i),"gotoCart",(function(){v.Z.navigateTo({url:"/subpackages/cloud_bill/pages/replenishment/index"})})),(0,c.Z)((0,a.Z)(i),"gotoShop",(function(){v.Z.navigateTo({url:"/subpackages/cloud_bill/pages/all_goods/index?mpErpId=".concat(i.props.mpErpId)})})),(0,c.Z)((0,a.Z)(i),"onLeftBtnClick",(function(){i.showColorSizeModel("addCart")})),(0,c.Z)((0,a.Z)(i),"onRightBtnClick",(function(){i.showColorSizeModel("buy")})),i.state={},i}return(0,l.Z)(t,[{key:"componentDidMount",value:function(){var o=this;this.props.calHeight&&g().getCurrentInstance().page.createSelectorQuery().select(".goods_detail").boundingClientRect((function(e){return o.props.onGetGoodsDetailItemHeight(e?e.height:void 0)})).exec()}},{key:"render",value:function(){var o=this.props,e=o.goodsDetail,t=(o.colorSizeVisible,o.totalNumWithoutChecked),i=(o.isSoldOut,o.showPrice),n=o.shopShowSpu,s=o.shopShowSoldOut,l=o.isHideInvText,a=o.isHideShopIcon,r=o.isHideCarIcon,d=o.currentGoodsItemIndex,c=o.goodsItemIndex,p=o.clickGoodsItemIndex,g=e.allImgUrlBigs,u=e.videoUrl,m=[];g&&(m=g.map((function(o){return{url:o,typeId:1}}))),u&&m.unshift({url:u,typeId:3,coverUrl:e.coverUrl});y.Z.t._("addToCart"),y.Z.t._("buyNow");return(0,j.jsxs)(h.View,{className:"goods_detail",children:[(0,j.jsxs)(h.View,{className:"goods_detail_page",children:[(0,j.jsxs)(h.View,{className:"goods_detail_container",children:[(0,j.jsx)(h.View,{className:"image_viewer_container",children:(0,j.jsx)(h.View,{className:"image_viewer_wrapper",children:(0,j.jsx)(N.Z,{medias:m,onDownLoadClick:this.downloadImages,goodsItemIndex:c,currentGoodsItemIndex:d,clickGoodsItemIndex:p})})}),(0,j.jsx)(h.View,{className:"goods_info",children:(0,j.jsx)(T.Z,{shopShowSoldOut:s,shopShowSpu:n,goods:e,hidePrice:!i,isHideInvText:l})}),(0,j.jsx)(h.View,{className:"divider_h"})]}),(0,j.jsx)(h.View,{className:"bottom_container",children:(0,j.jsxs)(h.View,{className:"action_button_container",children:[Boolean(!a)&&(0,j.jsx)(A.Z,{customerStyle:"margin-right: 20rpx; padding-right:10px;",src:B,imageStyle:"width: 54rpx; height: 54rpx;",textStyle:"font-size: ".concat(k.Z.font20WithTransformed,"; color: ").concat(C.Z.normalTextColor),title:y.Z.t._("tab_bar_5"),maxBadge:99,onClick:this.gotoShop}),!r&&(0,j.jsx)(A.Z,{src:G,imageStyle:"width: 54rpx; height: 54rpx;",textStyle:"font-size: ".concat(k.Z.font20WithTransformed,"; color: ").concat(C.Z.normalTextColor),title:y.Z.t._("tab_bar_3"),badge:t,maxBadge:99,onClick:this.gotoCart}),(0,j.jsx)(h.View,{style:{display:"flex",flex:1,justifyContent:"flex-end"},children:(0,j.jsx)(H.Z,{leftBtnConfig:{text:"加进货车",onClick:this.onLeftBtnClick},rightBtnConfig:{text:"立即下单",onClick:this.onRightBtnClick}})})]})})]}),(0,j.jsx)(_.Z,{})]})}}]),t}(u.PureComponent);(0,c.Z)(D,"defaultProps",{goodsDetail:{},isHideInvText:!1,isHideShopIcon:!1,isHideCarIcon:!1});var E=(0,I.$j)((function(o){var e=o.cloudBill,t=o.replenishment,i=(o.systemInfo,o.user,o.shop),n=o.imageDownload,s=o.goodsManage;return{colorSizeVisible:e.colorSizeVisible,totalNumWithoutChecked:(0,b.NU)(t.spus).totalNumWithoutChecked,shopList:i.list,mpErpId:e.mpErpId,spuId:e.spuId,isImageDownloading:n.downLoadding,isSoldOut:U.Z.goodsSoldOutSelector((0,S.Z)((0,S.Z)({},s),e)),showPrice:"1"===e.shopParams.spuShowPrice,shopShowSpu:"1"===s.shopShowSpu,shopShowSoldOut:"1"===s.shopShowSoldOut}}))(D),L=t(69558),z=function(o){(0,r.Z)(t,o);var e=(0,d.Z)(t);function t(o){var i;return(0,s.Z)(this,t),i=e.call(this,o),(0,c.Z)((0,a.Z)(i),"itemHeight",502),(0,c.Z)((0,a.Z)(i),"windowHeight",800),(0,c.Z)((0,a.Z)(i),"viewedData",[]),(0,c.Z)((0,a.Z)(i),"currentGoods",void 0),(0,c.Z)((0,a.Z)(i),"onNewGoodsListScroll",(function(o){var e=o.detail.scrollTop;i._onPageScroll(e)})),(0,c.Z)((0,a.Z)(i),"_onPageScroll",(0,m.debounce)((function(o){if(!i.props.colorSizeVisible){var e=(o-12)%i.itemHeight,t=Math.floor((o-12)/i.itemHeight);t=t<0?0:t;var n=i.itemHeight-e;i.windowHeight-n>=i.itemHeight&&(t+=1),i.setState({currentGoodsItemIndex:t})}}),100)),(0,c.Z)((0,a.Z)(i),"loadMoreData",(function(){var o=i.props.marketInfo;i.setState((function(o){return{pageNo:o.pageNo+1}}),(function(){i.props.dispatch({type:"cloudBill/fetchGoodsListToDayNew",payload:{marketOptimeBegin:o.marketDate,marketOptimeEnd:o.marketDate,pageNo:i.state.pageNo}})}))})),(0,c.Z)((0,a.Z)(i),"_onScrollEnd",(0,m.debounce)((function(){i.props.goodsListNew.length>=10*i.state.pageNo&&i.loadMoreData(),p.eventCenter.trigger("on_detail_reach_bottom")}),50)),(0,c.Z)((0,a.Z)(i),"onScrollEnd",(function(){var o,e;"allGoods"!==(0,w.JU)(null===(o=g().getCurrentInstance)||void 0===o?void 0:o.call(g())).from&&"new"===(0,w.JU)(null===(e=g().getCurrentInstance)||void 0===e?void 0:e.call(g())).from&&i._onScrollEnd()})),(0,c.Z)((0,a.Z)(i),"onGetGoodsDetailItemHeight",(function(o){o&&(i.itemHeight=o)})),(0,c.Z)((0,a.Z)(i),"onSaveClick",(function(o){i.setState({selectColorSizeType:o}),i.props.dispatch({type:"cloudBill/onColorSizeConfirm",payload:{type:o||i.state.selectColorSizeType}})})),(0,c.Z)((0,a.Z)(i),"onGoodsBtnClick",(function(o,e){e!==i.props.goodsDetail.styleId?i.props.dispatch({type:"cloudBill/showColorSizeInList",payload:{spuId:e}}):i.props.dispatch({type:"cloudBill/save",payload:{colorSizeVisible:!0}}),i.setState({selectColorSizeType:o})})),(0,c.Z)((0,a.Z)(i),"onGoShopClick",(function(){v.Z.navigateTo({url:"/subpackages/cloud_bill/pages/all_goods/index?mpErpId=".concat(i.props.mpErpId)})})),(0,c.Z)((0,a.Z)(i),"getGoodsList",(function(){var o,e;return"new"===(0,w.JU)(null===(o=g().getCurrentInstance)||void 0===o?void 0:o.call(g())).from?(0,n.Z)(i.props.goodsListNew):"allGoods"===(0,w.JU)(null===(e=g().getCurrentInstance)||void 0===e?void 0:e.call(g())).from?(0,n.Z)(i.props.toDayNewGoodsList):(0,n.Z)(i.props.shopGoodsListTop10)})),i.state={selectColorSizeType:"addCart",pageNo:1,goodsItemScrollTop:-1,currentGoodsItemIndex:0},i}return(0,l.Z)(t,[{key:"componentDidMount",value:function(){var o,e=this;this.itemHeight=this.props.windowWidth/375*490+12;var t=g().getSystemInfoSync().windowHeight;(this.windowHeight=t,Number((0,w.JU)(null===(o=g().getCurrentInstance)||void 0===o?void 0:o.call(g()))._idx))&&g().createSelectorQuery().selectAll("._idx_view").boundingClientRect((function(o){var t,i,n,s;Number((0,w.JU)(null===(t=g().getCurrentInstance)||void 0===t?void 0:t.call(g()))._idx)!==e.props.goodsListNew.length-1&&0!==Number((0,w.JU)(null===(i=g().getCurrentInstance)||void 0===i?void 0:i.call(g()))._idx)?e.setState({goodsItemScrollTop:(o&&o[0].height*Number((0,w.JU)(null===(n=g().getCurrentInstance)||void 0===n?void 0:n.call(g()))._idx)+1)-100}):e.setState({goodsItemScrollTop:o&&o[0].height*Number((0,w.JU)(null===(s=g().getCurrentInstance)||void 0===s?void 0:s.call(g()))._idx)+1})})).exec()}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:"cloudBill/save",payload:{colorSizeVisible:!1}})}},{key:"onPageScroll",value:function(o){}},{key:"onShareAppMessage",value:function(o){var e=this.props.mpErpId;if("button"===o.from){var t=o.target.dataset,i=t.id,n=t.name,s=t.img;return{path:"subpackages/cloud_bill/pages/goods_detail/index?mpErpId=".concat(e,"&spuId=").concat(i),title:n,imageUrl:s}}var l=this.currentGoods,a=l.styleId,r=l.name,d=l.imgUrl;return{path:"subpackages/cloud_bill/pages/goods_detail/index?mpErpId=".concat(e,"&spuId=").concat(a),title:r,imageUrl:d}}},{key:"onReachBottom",value:function(){}},{key:"render",value:function(){var o,e=this,t=this.props,i=t.colorSizeVisible,n=t.statusBarHeight,s=this.state,l=s.goodsItemScrollTop,a=s.selectColorSizeType,r=s.currentGoodsItemIndex,d=(0,w.JU)(null===(o=g().getCurrentInstance)||void 0===o?void 0:o.call(g())),c=d._idx,p=d.from,u=this.getGoodsList();return(0,j.jsxs)(f.Z,{enableBack:!0,children:[(0,j.jsxs)(h.ScrollView,{scrollY:!0,style:{padding:"24rpx",paddingBottom:"40rpx",height:"100vh",backgroundColor:"#000",paddingTop:"".concat(n,"px"),boxSizing:"border-box"},lowerThreshold:700,scrollTop:l,onScroll:this.onNewGoodsListScroll,onScrollToLower:this.onScrollEnd,children:[u.map((function(o,t){return(0,j.jsx)(h.View,{className:"_idx_view",style:{marginBottom:"12px"},children:(0,j.jsx)(E,{calHeight:t<3,onGetGoodsDetailItemHeight:e.onGetGoodsDetailItemHeight,goodsDetail:o,onSaveClick:e.onSaveClick,onButtonClick:e.onGoodsBtnClick,isHideInvText:true,isHideShopIcon:"allGoods"===p,isHideCarIcon:"allGoods"===p,currentGoodsItemIndex:r,goodsItemIndex:t,clickGoodsItemIndex:Number(c)})},o.id)})),"new"===p&&(0,j.jsxs)(h.View,{style:{width:"100%",height:"50px",borderRadius:"10px",backgroundColor:"#fff",display:"flex",justifyContent:"center",alignItems:"center"},onClick:this.onGoShopClick,children:[(0,j.jsx)(h.Text,{style:{color:"#E62E4D"},children:"进店浏览更多新款"}),(0,j.jsx)(h.Image,{style:{width:"30px",height:"30px"},src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6QAAAXpJREFUWEftlk9LAkEYh3+vrh0KAg9FBhF08JDteljw7N3UFuqcfZL6JtknkDI7exY62GYHbxW4/TkIgV3c3Tf2EJgI4Qwug8xeh5d59pnfO/MSFP9IcT5oQNkT0ga1QVkDsvU6g9rgLAPvZmlv0x29ENr+rPUPq3rsp8K77fvmd+wGB+aRDQR2wNzfebxtTwN4VuWcwRdEqGe6zbPYAZ/NUtpgOEQJI5Uw2hvdRn8SwstV9zkZdgCsEaiWebi5koEU6uLPvJMdh36ROfR9QmPXbQ3/QFqVUwbXAYwoSBQyvesnUUghwGiz14PDYpIoS6DhlvvVmM6jly9fMqNGQI9TKIjmURiQUTTezHWHwelZeRzY5VUao8NATiaPwoCRxTjyKAUYQS46j9KAi87j8gMqfcRKN4ny14zSF/Wiczf5LM7dxXHkTgpQ+XEr+rv/BlbPrJzwCrdEBwQpg6Jjk2jd3BkU3Ui0TgOKmvut0wa1QVkDsvU6g0tv8AeMPyo4cya5wQAAAABJRU5ErkJggg=="})]})]}),(0,j.jsx)(h.View,{style:"z-index: 500",children:(0,j.jsx)(L.Z,{onSaveClick:this.onSaveClick,visible:i,type:a},"goods_detail")})]})}}]),t}(u.PureComponent),V=(0,I.$j)((function(o){var e=o.shop,t=o.systemInfo,i=o.user,n=o.cloudBill,s=o.loading,l=o.goodsManage,a=e.list.find((function(o){return o.id===n.mpErpId}));return{windowWidth:t.windowWidth,windowHeight:t.windowHeight,navigationHeight:t.navigationHeight,platform:t.platform,statusBarHeight:t.statusBarHeight,shopGoodsListTop10:n.shopGoodsListTop10,goodsListNew:n.goodsListNew,goodsDetail:n.goodsDetail,isLoadingMore:s.effects["cloudBill/fetchGoodsList"]&&s.effects["cloudBill/fetchGoodsList"].loading&&n.pageNo>1,shop:n.shopInfo||a,shopListLoaded:e.shopListLoaded,sessionId:i.sessionId,logining:i.logining,colorSizeVisible:n.colorSizeVisible,pageNo:n.pageNo,mpErpId:n.mpErpId,shopInfo:l.shopInfo,showPrice:"1"===n.shopParams.spuShowPrice,marketInfo:n.marketInfo,toDayNewGoodsList:n.toDayNewGoodsList}}))(z);V.enableShareAppMessage=!0;Page((0,i.createPageConfig)(V,"subpackages/cloud_bill/pages/goods_detail/goods_detail_new",{root:{cn:[]}},{onReachBottomDistance:2e3,navigationBarTitleText:"货品详情",navigationStyle:"custom",navigationBarTextStyle:"white"}||{}))}},function(o){o.O(0,[666,1772,6690,3658,2107,1216,8592],(function(){return e=66573,o(o.s=e);var e}));o.O()}]);