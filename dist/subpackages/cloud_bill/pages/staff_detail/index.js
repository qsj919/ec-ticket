"use strict";require("../../sub-vendors.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[4653],{68666:function(e,t,s){var n=s(32180),a=s(57543),i=s(77886),r=s(33661),o=s(12742),c=s(22700),f=s(95333),d=s(14175),l=s(3701),p=s(92954),u=s.n(p),h=s(67294),m=s(71515),x=s(75508),I=s(1695),v=s(63056),w=s(14067),b=s(85893),_=function(e){(0,f.Z)(s,e);var t=(0,d.Z)(s);function s(){return(0,r.Z)(this,s),t.apply(this,arguments)}return(0,o.Z)(s,[{key:"onItemClick",value:function(e){this.props.onItemClick(e)}},{key:"render",value:function(){var e=this,t=this.props,s=t.item,n=t.activeTabIndex,a=t.btnIsVisible;return(0,b.jsxs)(m.View,{className:"staff_items_item",children:[(0,b.jsx)(m.View,{className:"staff_items_headImg",children:(0,b.jsx)(m.Image,{src:s.logo,className:"head_portrait"})}),(0,b.jsxs)(m.View,{className:"staff_info",children:[(0,b.jsx)(m.View,{children:s.nickName}),s.staffName&&(0,b.jsxs)(m.View,{className:"staff_role",children:["绑定员工：",s.staffName,(0,b.jsxs)(m.Text,{children:["（",s.role,"）"]})]})]}),a&&(0,b.jsx)(m.View,{className:"staff_items_btn",onClick:function(){e.onItemClick(s.mpUserId)},children:(0,b.jsx)(m.Text,{className:"staff_unbound",children:0===n?"限制访问":"允许访问"})})]},s.mpUserId)}}]),s}(h.Component);(0,l.Z)(_,"defaultProps",{data:{}});var Z=[{label:"正常访问员工",value:0},{label:"限制访问员工",value:1}],k=function(e){(0,f.Z)(s,e);var t=(0,d.Z)(s);function s(){var e;(0,r.Z)(this,s);for(var n=arguments.length,o=new Array(n),f=0;f<n;f++)o[f]=arguments[f];return e=t.call.apply(t,[this].concat(o)),(0,l.Z)((0,c.Z)(e),"state",{activeTabIndex:0,staffBindUserList:[],forbiddenUserList:[]}),(0,l.Z)((0,c.Z)(e),"init",(0,i.Z)((0,a.Z)().mark((function t(){var s;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:s=e.props.mpErpId,e.fetchShopStaffBindUserList(s),e.fetchShopForbiddenUserList(s);case 3:case"end":return t.stop()}}),t)})))),(0,l.Z)((0,c.Z)(e),"onTabClick",(function(t){e.init(),e.setState({activeTabIndex:t})})),(0,l.Z)((0,c.Z)(e),"onItemClick",(function(t){e.showAlert(t)})),(0,l.Z)((0,c.Z)(e),"filterList",function(){var t=(0,i.Z)((0,a.Z)().mark((function t(s){var n,i;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.state.activeTabIndex,i=e.props.mpErpId,u().showLoading(),0!==n){t.next=9;break}return t.next=6,(0,w.u7)({mpErpId:i,mpUserId:s});case 6:e.setState((function(e){return{staffBindUserList:e.staffBindUserList.filter((function(e){return e.mpUserId!==s}))}})),t.next=12;break;case 9:return t.next=11,(0,w.Dm)({mpErpId:i,mpUserId:s});case 11:e.setState((function(e){return{forbiddenUserList:e.forbiddenUserList.filter((function(e){return e.mpUserId!==s}))}}));case 12:u().hideLoading();case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),(0,l.Z)((0,c.Z)(e),"onUnBindclick",(0,i.Z)((0,a.Z)().mark((function t(){var s;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:s=e.props.mpErpId,v.Z.showAlertWithCancel("确定要解绑当前角色？","",(function(){(0,w.nU)({mpErpId:s}).then((function(t){e.props.dispatch({type:"goodsManage/resetIsHotUnboundTrue"}),e.props.dispatch({type:"goodsManage/fetchAuthAndDocUrl",payload:{mpErpId:s}}),e.props.dispatch({type:"goodsManage/selectShopStaffList",payload:{curpageno:1}}),e.props.dispatch({type:"goodsManage/selectShopStaffAuth"}),u().navigateBack()}))}));case 2:case"end":return t.stop()}}),t)})))),e}return(0,o.Z)(s,[{key:"componentDidMount",value:function(){this.init()}},{key:"fetchShopStaffBindUserList",value:function(e){var t=this;(0,w.fy)({mpErpId:e}).then((function(e){t.setState({staffBindUserList:e.data.rows})}))}},{key:"fetchShopForbiddenUserList",value:function(e){var t=this;(0,w.xy)({mpErpId:e}).then((function(e){t.setState({forbiddenUserList:e.data.rows})}))}},{key:"showAlert",value:function(e){var t=this,s=this.state.activeTabIndex;v.Z.showAlertWithCancel("确定".concat(0===s?"限制":"允许","该用户访问您的云单后台？"),"",(function(){t.filterList(e)}))}},{key:"render",value:function(){var e=this,t=this.state,s=t.activeTabIndex,n=t.staffBindUserList,a=t.forbiddenUserList,i=this.props,r=i.staffInfo,o=i.shopLogoUrl,c=i.shopName,f=n.filter((function(e){return e.staffId!==r.id}));return(0,b.jsxs)(m.View,{className:"staff_detail_wrap",children:[(0,b.jsxs)(m.View,{className:"staff_detail_wrap_header",children:[(0,b.jsx)(m.View,{className:"staff_detail_wrap_header_headImg",children:(0,b.jsx)(m.Image,{src:o,className:"head_portrait"})}),(0,b.jsxs)(m.View,{className:"staff_detail_wrap_header_staff_info",children:[(0,b.jsx)(m.View,{children:c}),(0,b.jsxs)(m.View,{className:"staff_role",children:["当前角色：",r.name,(0,b.jsx)(m.Text,{className:"staff_position",children:r.rolename})]})]}),(0,b.jsx)(m.View,{className:"staff_detail_wrap_header_btn",children:(0,b.jsx)(m.Text,{className:"staff_unbound",onClick:this.onUnBindclick,children:"解绑"})})]}),r.rolename&&(-1!==r.rolename.indexOf("总经理")||-1!==r.rolename.indexOf("店长"))&&(0,b.jsx)(m.View,{className:"staff_detail_wrap_body",children:(0,b.jsxs)(m.View,{className:"tabs",children:[(0,b.jsx)(I.Z,{data:Z,activeIndex:s,underlineColor:"#E62E4D",textColor:"#222",activeColor:"#E62E4D",onTabItemClick:this.onTabClick,margin:180}),(0,b.jsx)(m.View,{className:"staff_items",children:0===s?f.map((function(t){return(0,b.jsx)(_,{item:t,onItemClick:e.onItemClick,activeTabIndex:s,btnIsVisible:-1===t.role.indexOf("总经理")},t.mpUserId)})):a.map((function(t){return(0,b.jsx)(_,{item:t,onItemClick:e.onItemClick,activeTabIndex:s,btnIsVisible:!0},t.mpUserId)}))})]})})]})}}]),s}(h.Component),g=(0,x.$j)((function(e){var t=e.goodsManage;return{mpErpId:t.mpErpId,shopName:t.shopName,staffInfo:t.staffInfo,shopLogoUrl:t.shopLogoUrl,epid:t.epid,shopid:t.shopId,sn:t.sn}}))(k);Page((0,n.createPageConfig)(g,"subpackages/cloud_bill/pages/staff_detail/index",{root:{cn:[]}},{navigationBarTitleText:"我的"}||{}))}},function(e){e.O(0,[2107,1216,8592],(function(){return t=68666,e(e.s=t);var t}));e.O()}]);