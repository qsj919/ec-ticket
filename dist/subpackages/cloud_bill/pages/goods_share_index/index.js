"use strict";require("../../sub-vendors.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[2618],{93653:function(e,s,a){var t=a(32180),i=a(57543),o=a(77886),r=a(18453),c=a(33661),n=a(12742),l=a(22700),_=a(95333),p=a(14175),h=a(3701),d=a(71515),g=a(92954),u=a.n(g),m=a(67294),k=a(75508),f=a(14067),x=a(6420),S=a(31254),N=a(41115),Z=a(63056),w=a(15604),C=a(53252),y=a(24962),j=a(80170),v=a(51958),I=a(85893);function b(e){var s=e.data,a=s.spuList,t=void 0===a?[]:a,i=s.type,o=s.createdDate,r=void 0===o?"":o,c=s.name,n="";switch(i){case 0:n="自定义";break;case 1:n="爆款";break;case 2:n="新品"}return(0,I.jsxs)(d.View,{className:"share_history_cell",onClick:function(){e.onItemClick&&e.onItemClick(e.data)},children:[(0,I.jsxs)(d.View,{className:"share_history_cell__header aic",children:[(0,I.jsx)(d.Text,{children:r.split(" ")[0]}),(0,I.jsx)(d.Text,{className:"share_history_cell__header__name",children:c}),(0,I.jsx)(d.Text,{className:"share_history_cell__header__type",children:n})]}),(0,I.jsxs)(d.View,{className:"share_history_cell__content aic jcsb",children:[(0,I.jsx)(d.View,{className:"share_history_cell__content__goods aic",children:t.slice(0,3).map((function(e){return(0,I.jsx)(d.Image,{mode:"aspectFill",className:"share_history_cell__content__goods_img",src:e.imgUrl},e.imgUrl)}))}),(0,I.jsxs)(d.View,{className:"share_history_cell__content__op aic",children:[(0,I.jsx)(d.View,{className:"share_history_cell__content__op__block share_history_cell__content__op__block--more",onClick:function(s){s.stopPropagation(),e.onMoreClick&&e.onMoreClick(e.data)},children:"···"}),(0,I.jsx)(d.View,{className:"share_history_cell__content__op__block share_history_cell__content__op__block--share",onClick:function(s){s.stopPropagation(),e.onShareClick&&e.onShareClick(e.data)},children:"分享"})]})]})]})}b.defaultProps={data:{}},b.options={addGlobalClass:!0};var L=b,V=a(26902),T=a(90311),M=a(51150),G=function(e){(0,_.Z)(a,e);var s=(0,p.Z)(a);function a(){var e;(0,c.Z)(this,a);for(var t=arguments.length,n=new Array(t),_=0;_<t;_++)n[_]=arguments[_];return e=s.call.apply(s,[this].concat(n)),(0,h.Z)((0,l.Z)(e),"state",{pageNo:1,groupList:[],shareViewMask:!1,imageSource:[],setClipSuccess:!1,groupLink:""}),(0,h.Z)((0,l.Z)(e),"groupId",void 0),(0,h.Z)((0,l.Z)(e),"currentGroup",void 0),(0,h.Z)((0,l.Z)(e),"fetchNewGoodsList",(function(){var s=(0,x.cm)(15);return e.props.dispatch({type:"goodsManage/fetchManageNewGoods",payload:{slhMarketDateBegin:s.startDate,slhMarketDateEnd:s.endDate,pageSize:S.IV}})})),(0,h.Z)((0,l.Z)(e),"fetchGroupList",(function(){var s=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=e.state.pageNo,t=void 0===a?1:a,i=e.props.mpErpId,o=t;s?o+=1:o=1,u().showLoading({title:"请稍等..."}),(0,f.C)({pageNo:o,mpErpId:i,pageSize:S.IV}).then((function(s){var a=s.data;e.setState({groupList:1===o?a.rows:[].concat((0,r.Z)(e.state.groupList),(0,r.Z)(a.rows)),pageNo:o}),u().hideLoading()})).catch((function(e){u().hideLoading()}))})),(0,h.Z)((0,l.Z)(e),"goShareEdit",function(){var s=(0,o.Z)((0,i.Z)().mark((function s(a){var t;return(0,i.Z)().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(u().showLoading({title:"请稍等..."}),"2"!==(t=a.currentTarget.dataset.type)){s.next=6;break}return j.Z.track(y.ZP.goodsShareNewClick),s.next=6,e.fetchNewGoodsList();case 6:if("1"!==t){s.next=10;break}return j.Z.track(y.ZP.goodsShareHotClick),s.next=10,e.props.dispatch({type:"goodsManage/fetchManageHotGoods",payload:{pageSize:S.IV}});case 10:"0"===t&&j.Z.track(y.ZP.goodsShareCustomClick),u().hideLoading(),u().navigateTo({url:"/subpackages/cloud_bill/pages/goods_share_edit/index?type=".concat(t)});case 13:case"end":return s.stop()}}),s)})));return function(e){return s.apply(this,arguments)}}()),(0,h.Z)((0,l.Z)(e),"onMoreClick",(function(s){u().showActionSheet({itemList:["删除集合"]}).then((function(){Z.Z.showAlertWithCancel("删除后集合失效，确认删除吗？","提示",(function(){(0,f.F)({id:s.id}).then((function(a){0===a.code&&e.setState((function(e){return{groupList:(0,r.Z)(e.groupList.filter((function(e){return e.id!==s.id})))}}))})).catch((function(e){u().hideLoading()}))}))})).catch((function(e){console.log(e,"ee")}))})),(0,h.Z)((0,l.Z)(e),"onShareClick",(function(s){j.Z.track(y.ZP.goodsShareIndexShareClick);var a=s.spuList;e.groupId=s.id,e.currentGroup=s,e.updateImageSource(a)})),(0,h.Z)((0,l.Z)(e),"updateImageSource",(function(s){e.setState({imageSource:s.map((function(e,s){return{url:e.imgUrl?e.imgUrl:"",name:e.name||"",code:e.code||"",orderBy:s,imgUrls:e.imgUrls,styleId:e.styleId}})),shareViewMask:!0})})),(0,h.Z)((0,l.Z)(e),"onCloseShare",(function(){e.setState({shareViewMask:!1})})),(0,h.Z)((0,l.Z)(e),"onShareItemClick",function(){var s=(0,o.Z)((0,i.Z)().mark((function s(a,t){return(0,i.Z)().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:"map"===a&&e.shareMiniCard(t),"monents"===a&&e.shareMonents(t),"firends"===a&&e.shareFirends(t);case 3:case"end":return s.stop()}}),s)})));return function(e,a){return s.apply(this,arguments)}}()),(0,h.Z)((0,l.Z)(e),"shareMiniCard",(function(s){var a=e.state.imageSource,t="";if(a[0]&&(a[0].url?t=a[0].url:a[0].imgUrls&&(t=a[0].imgUrls[0])),(0,N.$L)()){var i,o=e.props,r=o.shopName,c=o.mpErpId;(0,w.f)(JSON.stringify({eventType:"shareWxMiniProgram",data:(i={title:e.currentGroup.name||r,path:"/subpackages/cloud_bill/pages/goods_share_collection/index?mpErpId=".concat(c,"&groupId=").concat(e.groupId),thumImageUrl:t,desc:""},(0,h.Z)(i,"slh"===e.props.appName?"miniprogramType":"miniProgramType",2),(0,h.Z)(i,"userName",C.Z.appUserName),i)}))}})),(0,h.Z)((0,l.Z)(e),"shareMonents",(function(s){"slh"===e.props.appName?(0,w.f)(JSON.stringify({eventType:"shareImageToWechat",data:{isTimeline:!0,imgDataStr:s}})):(0,w.f)(JSON.stringify({eventType:"shareWxMoments",data:s}))})),(0,h.Z)((0,l.Z)(e),"shareFirends",(function(s){"slh"===e.props.appName?(0,w.f)(JSON.stringify({eventType:"shareImageToWechat",data:{isTimeline:!1,imgDataStr:s}})):(0,w.f)(JSON.stringify({eventType:"shareImageToFriends",data:s}))})),(0,h.Z)((0,l.Z)(e),"setClipSuccess",(function(s){e.setState({setClipSuccess:!0,shareViewMask:!1,groupLink:s})})),(0,h.Z)((0,l.Z)(e),"onSuccessClick",(function(){e.setState({setClipSuccess:!1})})),(0,h.Z)((0,l.Z)(e),"onGroupItemClick",(function(e){u().navigateTo({url:"/subpackages/cloud_bill/pages/groups_detail/index?id=".concat(e.id,"&type=").concat(e.type)})})),(0,h.Z)((0,l.Z)(e),"renderSetClipSuccess",(function(){var s=e.state.groupLink;return(0,I.jsx)(d.View,{className:"goods_share__mask",children:(0,I.jsxs)(d.View,{className:"goods_share__mask__clipSuccess",children:[(0,I.jsx)(d.View,{className:"goods_share__mask__clipSuccess__title",children:"小程序链接已复制"}),(0,I.jsx)(d.View,{className:"goods_share__mask__clipSuccess__label",children:"发送给客户或发朋友圈"}),(0,I.jsx)(d.View,{className:"goods_share__mask__clipSuccess__successContent",children:s}),(0,I.jsx)(d.View,{className:"goods_share__mask__clipSuccess__action",onClick:e.onSuccessClick,children:"好的"})]})})})),e}return(0,n.Z)(a,[{key:"componentDidShow",value:function(){(0,N.ZT)("商品分享")}},{key:"onReachBottom",value:function(){this.state.groupList.length>=this.state.pageNo*S.IV&&this.fetchGroupList(!0)}},{key:"componentDidMount",value:function(){this.fetchGroupList(),this.fetchNewGoodsList(),u().eventCenter.on("FETCH_GROUP_LIST",this.fetchGroupList)}},{key:"componentWillUnmount",value:function(){u().eventCenter.off("FETCH_GROUP_LIST")}},{key:"onShareAppMessage",value:function(){var e=this.props,s=e.mpErpId,a=e.shopName,t=this.state.imageSource,i="";return t[0]&&(t[0].url?i=t[0].url:t[0].imgUrls&&(i=t[0].imgUrls[0])),{title:this.currentGroup.name||a,path:"/subpackages/cloud_bill/pages/goods_share_collection/index?mpErpId=".concat(s,"&groupId=").concat(this.groupId),imageUrl:i}}},{key:"render",value:function(){var e=this,s=this.state,a=s.groupList,t=s.shareViewMask,i=s.imageSource,o=s.setClipSuccess,r=this.props,c=r.shopName,n=r.appName,l=r.newListLength;return(0,I.jsxs)(d.View,{className:"goods_share_page",children:[(0,I.jsxs)(d.View,{className:"goods_share_page__top col aic",children:[(0,I.jsx)(d.Image,{className:"goods_share_page__top__image",src:"https://webdoc.hzecool.com/webCdn/weapp/ec-ticket/src/subpackages/cloud_bill/pages/goods_share_index/images/43fb8d48e6c330c7249f..png"}),(0,I.jsx)(d.View,{className:"goods_share_page__top__title",children:"拼图海报、小程序分享"}),(0,I.jsx)(d.Text,{className:"goods_share_page__top__text",children:"代替传统朋友圈分享，精准触达"})]}),(0,I.jsxs)(d.View,{className:"goods_share_page__middle",children:[(0,I.jsxs)(d.View,{className:"aic jcsb",children:[(0,I.jsxs)(d.View,{className:"goods_share_page__middle__block aic","data-type":"2",onClick:this.goShareEdit,children:[(0,I.jsx)(d.Image,{className:"goods_share_page__middle__block__img",src:T}),(0,I.jsx)(d.Text,{children:"上新分享"}),l>0&&(0,I.jsx)(d.View,{className:"goods_share_page__middle__block__guide-view aic jcc",children:"近期有上新，快分享给客户吧"})]}),(0,I.jsxs)(d.View,{className:"goods_share_page__middle__block aic","data-type":"1",onClick:this.goShareEdit,children:[(0,I.jsx)(d.Image,{className:"goods_share_page__middle__block__img",src:V}),(0,I.jsx)(d.Text,{children:"爆款分享"})]})]}),(0,I.jsxs)(d.View,{className:"goods_share_page__middle__block goods_share_page__middle__block--big aic","data-type":"0",onClick:this.goShareEdit,children:[(0,I.jsx)(d.Image,{className:"goods_share_page__middle__block__img",src:M}),(0,I.jsxs)(d.View,{children:[(0,I.jsx)(d.View,{children:"创建商品分享"}),(0,I.jsx)(d.Text,{className:"goods_share_page__middle__block__text",children:"自定义分享"})]})]})]}),(0,I.jsxs)(d.View,{className:"goods_share_page__history",children:[a.length>0&&(0,I.jsx)(d.Text,{className:"goods_share_page__history__title",children:"历史分享"}),(0,I.jsx)(d.View,{children:a.map((function(s){return(0,I.jsx)(L,{data:s,onItemClick:e.onGroupItemClick,onMoreClick:e.onMoreClick,onShareClick:e.onShareClick},s.id)}))})]}),t&&(0,I.jsx)(v.Z,{shareType:"share",imageSource:i,shopName:c,onCloseShare:this.onCloseShare,onShareItemClick:this.onShareItemClick,onSetClipSuccess:this.setClipSuccess,appName:n,groupId:this.groupId}),o&&this.renderSetClipSuccess()]})}}]),a}(m.PureComponent),U=(0,k.$j)((function(e){var s=e.goodsManage;return{mpErpId:s.mpErpId,shopName:s.shopName,appName:s.appName,manageNewList:s.manageNewList,newListLength:s.newListLength}}))(G);U.enableShareAppMessage=!0;Page((0,t.createPageConfig)(U,"subpackages/cloud_bill/pages/goods_share_index/index",{root:{cn:[]}},{navigationBarTitleText:"商品分享"}||{}))}},function(e){e.O(0,[666,1772,2107,1216,8592],(function(){return s=93653,e(e.s=s);var s}));e.O()}]);