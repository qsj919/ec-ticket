"use strict";require("../../sub-vendors.js");require("../../sub-common/a892c3adf072850ba48f151a38b91f33.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[326],{84345:function(e,t,i){var a={};i.r(a);var n=i(32180),s=i(66058),c=i(57543),o=i(77886),r=i(33661),l=i(12742),_=i(22700),u=i(95333),d=i(14175),h=i(3701),m=i(92954),p=i.n(m),g=i(67294),w=i(71515),f=i(44559),Z=i(1695),v=i(75508),x=i(41115),k=i(6420),C=i(42266),N=i(14067),j=i(96005),I=i(85893),V=function(e){(0,u.Z)(i,e);var t=(0,d.Z)(i);function i(){var e;(0,r.Z)(this,i);for(var a=arguments.length,n=new Array(a),l=0;l<a;l++)n[l]=arguments[l];return e=t.call.apply(t,[this].concat(n)),(0,h.Z)((0,_.Z)(e),"state",{isAlert:!1,userItem:{},pageNo:1,activeIndex:0,showPassToast:!1,curPassClientName:"",tabsMenu:[{label:"待处理",value:0},{label:"已通过",value:1}]}),(0,h.Z)((0,_.Z)(e),"searchKey",""),(0,h.Z)((0,_.Z)(e),"onTabClick",(function(t){var i=e.state.activeIndex,a=i===t?i:t;e.props.dispatch({type:"goodsManage/save",payload:{clientAuditList:[]}}),e.setState({activeIndex:a,pageNo:1},(function(){e.fetchList()}))})),(0,h.Z)((0,_.Z)(e),"onActionClick",(function(t,i){1===t.auditFlag&&e.updateStatus(t,i),2===t.auditFlag?e.state.isAlert?e.updateStatus(t,i):e.setState({isAlert:!0,userItem:t}):e.onCloseClick()})),(0,h.Z)((0,_.Z)(e),"onCloseClick",(function(){e.setState({isAlert:!1})})),(0,h.Z)((0,_.Z)(e),"onScrollToLower",(function(){e.getRightIsMoreData()&&e.setState((function(e){return{pageNo:e.pageNo+1}}),(function(){e.fetchList()}))})),(0,h.Z)((0,_.Z)(e),"fetchList",(0,o.Z)((0,c.Z)().mark((function t(){var i,a,n,s,o;return(0,c.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.state,a=i.pageNo,n=i.activeIndex,s=e.props.mpErpId,o=void 0===s?1:s,p().showLoading({title:"请稍等..."}),t.next=5,e.props.dispatch({type:"goodsManage/selectShopWaitAuditUsers",payload:{pageNo:a,jsonParam:{mpErpId:o,searchKey:e.searchKey,auditFlags:0===n?[1,2]:[3]}}});case 5:0===n&&e.changeTabMenu(),p().hideLoading();case 7:case"end":return t.stop()}}),t)})))),(0,h.Z)((0,_.Z)(e),"changeTabMenu",(function(){var t=e.props.clientAuditTotal;e.setState({tabsMenu:[{label:"待处理(".concat(t,")"),value:0},{label:"已通过",value:1}]})})),(0,h.Z)((0,_.Z)(e),"getRightIsMoreData",(function(){var t=e.props.clientAuditList,i=e.state.pageNo;return t.length>=20*i})),(0,h.Z)((0,_.Z)(e),"updateStatus",(function(t,i){var a=2;"through"===i&&(a=3,e.setState({curPassClientName:t.nickName,showPassToast:!0},(function(){setTimeout((function(){e.setState({showPassToast:!1})}),2e3)}))),(0,N.oR)({mpErpId:e.props.mpErpId,mpUserId:t.mpUserId,auditFlag:a}).then((function(){e.fetchList(),e.props.dispatch({type:"goodsManage/getShopViewData"})})),e.onCloseClick()})),(0,h.Z)((0,_.Z)(e),"onInput",(function(t){e.searchKey=t})),(0,h.Z)((0,_.Z)(e),"onSearchConfirm",(function(){e.setState({pageNo:1},e.fetchList)})),(0,h.Z)((0,_.Z)(e),"onClearClick",(function(){e.searchKey="",e.setState({pageNo:1},e.fetchList)})),(0,h.Z)((0,_.Z)(e),"onHeadImageClick",function(){var t=(0,o.Z)((0,c.Z)().mark((function t(i){return(0,c.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:1===i.auditFlag||2===i.auditFlag?p().navigateTo({url:"/subpackages/cloud_bill/pages/my_client_detail_nodata/index?logo=".concat(i.logo,"&nickName=").concat(i.nickName,"&mpUserId=").concat(i.mpUserId,"&auditFlag=").concat(i.auditFlag)}):(p().showLoading({title:"请稍等..."}),e.props.dispatch({type:"goodsManage/selectShopLinkUsers"}).then((function(e){var t=e.find((function(e){return e.mpUserId===i.mpUserId}));p().hideLoading(),p().navigateTo({url:"/subpackages/cloud_bill/pages/my_client_detail/index?mpUserId=".concat(t&&t.mpUserId,"&viewDate=").concat(t&&t.viewDate,"&listType=1")})})).catch((function(e){p().hideLoading()})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),(0,h.Z)((0,_.Z)(e),"getViewersList",(function(){var t=e.props.clientAuditList,i={};return(void 0===t?[]:t).forEach((function(e){i.hasOwnProperty(e.viewDate)?i[e.viewDate].push((0,s.Z)({},e)):i[e.viewDate]=[(0,s.Z)({},e)]})),i})),(0,h.Z)((0,_.Z)(e),"renderAlertView",(function(){var t=e.state.userItem;return(0,I.jsx)(w.View,{className:"alert_view_mask",children:(0,I.jsxs)(w.View,{className:"alert_view_mask__content",children:[(0,I.jsx)(w.View,{className:"alert_view_mask__content___title",children:"选择操作"}),(0,I.jsx)(w.View,{className:"alert_view_mask__content___label",children:"是否允许该客户访问您的云单"}),(0,I.jsxs)(w.View,{className:"alert_view_mask__content___action",children:[(0,I.jsx)(w.View,{className:"alert_view_mask__content___action___item access_denied",onClick:e.onActionClick.bind((0,_.Z)(e),t,"refused"),children:"拒绝访问"}),(0,I.jsx)(w.View,{className:"alert_view_mask__content___action___item allow_access",onClick:e.onActionClick.bind((0,_.Z)(e),t,"through"),children:"允许访问"})]}),(0,I.jsx)(w.Image,{src:C,className:"close_icon",onClick:e.onCloseClick})]})})})),(0,h.Z)((0,_.Z)(e),"renderActionView",(function(t){return(0,I.jsxs)(w.View,{children:[1===t.auditFlag&&(0,I.jsxs)(w.View,{style:"display: flex;",children:[(0,I.jsx)(w.View,{className:"audit_client__content___item___right___y",onClick:e.onActionClick.bind((0,_.Z)(e),t,"through"),children:"通过"}),(0,I.jsx)(w.View,{className:"audit_client__content___item___right___n",onClick:e.onActionClick.bind((0,_.Z)(e),t,"refused"),children:"拒绝"})]}),2===t.auditFlag&&(0,I.jsx)(w.View,{className:"audit_client__content___item___right___y",onClick:e.onActionClick.bind((0,_.Z)(e),t,"through"),children:"通过"}),3===t.auditFlag&&(0,I.jsx)(w.View,{className:"audit_client__content___item___right___yed",children:"已通过"})]})})),(0,h.Z)((0,_.Z)(e),"renderAucitClientList",(function(){var t=e.getViewersList();return(0,I.jsx)(w.View,{children:Object.keys(t).map((function(i){return(0,I.jsxs)(w.View,{children:[(0,I.jsx)(w.View,{className:"view_time",children:(0,k.DC)(i)}),t[i].map((function(t){return(0,I.jsxs)(w.View,{className:"audit_client__content___item",children:[(0,I.jsxs)(w.View,{className:"audit_client__content___item___left",children:[(0,I.jsx)(w.Image,{className:"user_logo",onClick:function(){return e.onHeadImageClick(t)},src:t.logo||j,mode:"aspectFill"}),(0,I.jsxs)(w.View,{className:"user_info",children:[(0,I.jsxs)(w.View,{className:"user_info__title",children:[(0,I.jsx)(w.Text,{className:"user_info__title__name",children:t.remark||t.nickName}),2===t.auditFlag&&(0,I.jsx)(w.View,{className:"user_info__title__tag",children:(0,I.jsx)(w.Text,{children:"已拒绝"})})]}),(0,I.jsx)(w.Text,{className:"user_info__time",children:t.viewTime})]})]}),(0,I.jsx)(w.View,{className:"audit_client__content___item___right",children:e.renderActionView(t)})]},t.mpUserId)}))]},i)}))})})),e}return(0,l.Z)(i,[{key:"componentDidShow",value:function(){(0,x.ZT)("审核客户")}},{key:"componentDidMount",value:function(){this.fetchList()}},{key:"render",value:function(){var e=this.state,t=e.isAlert,i=e.tabsMenu,n=e.activeIndex,s=e.showPassToast,c=e.curPassClientName;return(0,I.jsxs)(w.View,{className:"audit_client",children:[(0,I.jsx)(w.View,{className:"search_bar_view",children:(0,I.jsx)(f.Z,{placeholder:"搜索访客",onInput:this.onInput,onSearchClick:this.onSearchConfirm,onClearSearchClick:this.onClearClick})}),(0,I.jsx)(w.View,{className:"tab",children:(0,I.jsx)(Z.Z,{data:i,activeIndex:n,tabItemClass:a.default.tab_item,tabsBackgroundImage:"linear-gradient(to right, #FF788F , #E62E4D)",textColor:"#666666",activeColor:"#E62E4D",margin:200,underlineWidth:40,underlineHeight:6,onTabItemClick:this.onTabClick})}),(0,I.jsx)(w.ScrollView,{scrollY:!0,className:"audit_client__content",lowerThreshold:500,onScrollToLower:this.onScrollToLower,children:this.renderAucitClientList()}),t&&this.renderAlertView(),s&&(0,I.jsx)(w.View,{className:"toast",children:"已通过".concat(c,"的访客申请")})]})}}]),i}(g.Component),b=(0,v.$j)((function(e){var t=e.goodsManage;return{mpErpId:t.mpErpId,clientAuditList:t.clientAuditList,myClientList:t.myClientList,clientAuditTotal:t.myClientViewData.waitAuditCount}}))(V);Page((0,n.createPageConfig)(b,"subpackages/cloud_bill/pages/audit_client/index",{root:{cn:[]}},{navigationBarTitleText:"审核客户"}||{}))}},function(e){e.O(0,[666,1772,5771,2107,1216,8592],(function(){return t=84345,e(e.s=t);var t}));e.O()}]);