"use strict";require("../../sub-vendors.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[8695],{85729:function(e,t,n){var i=n(32180),a=n(66058),s=n(57543),r=n(77886),c=n(33661),o=n(12742),l=n(22700),h=n(95333),u=n(14175),d=n(3701),m=n(92954),p=n.n(m),f=n(67294),w=n(71515),k=n(75508),x=n(41115),_=n(14067),g=n(63056),Z=n(23279),j=n.n(Z),N=n(85893),v=["01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"],V=["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59"],C=function(e){(0,h.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;(0,c.Z)(this,n);for(var i=arguments.length,o=new Array(i),h=0;h<i;h++)o[h]=arguments[h];return e=t.call.apply(t,[this].concat(o)),(0,d.Z)((0,l.Z)(e),"pageNo",1),(0,d.Z)((0,l.Z)(e),"loading",!1),(0,d.Z)((0,l.Z)(e),"state",{switchNotifly:!1,maskIsShow:!1,timeIndex:[0,0],weeks:[{label:"每周一",value:1,flag:!1,ch:"一"},{label:"每周二",value:2,flag:!1,ch:"二"},{label:"每周三",value:3,flag:!1,ch:"三"},{label:"每周四",value:4,flag:!1,ch:"四"},{label:"每周五",value:5,flag:!1,ch:"五"},{label:"每周六",value:6,flag:!1,ch:"六"},{label:"每周日",value:7,flag:!1,ch:"日"}],timeValue:"",dateIsShow_h5:!1,timerValue_h5:""}),(0,d.Z)((0,l.Z)(e),"init",(0,r.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.loadList(),e.initWeeks();case 2:case"end":return t.stop()}}),t)})))),(0,d.Z)((0,l.Z)(e),"loadList",(0,r.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.loading){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,e.pageNo=1,t.next=6,e.props.dispatch({type:"goodsManage/selectErpLinkUsers",payload:{pageNo:e.pageNo}});case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(2),e.loading=!1;case 11:case"end":return t.stop()}}),t,null,[[2,8]])})))),(0,d.Z)((0,l.Z)(e),"loadMore",(0,r.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.loading){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,e.pageNo+=1,t.next=6,e.props.dispatch({type:"goodsManage/selectErpLinkUsers",payload:{pageNo:e.pageNo}});case 6:t.next=12;break;case 8:t.prev=8,t.t0=t.catch(2),e.loading=!1,e.pageNo-=1;case 12:case"end":return t.stop()}}),t,null,[[2,8]])})))),(0,d.Z)((0,l.Z)(e),"initWeeks",(function(){(0,_.MN)({mpErpId:e.props.mpErpId}).then((function(t){var n=[];e.setState((function(e){t.data.weeks&&t.data.weeks.forEach((function(t){e.weeks[e.weeks.findIndex((function(e){return e.value===t}))].flag=!0})),e.weeks.forEach((function(e){return e.flag&&n.push(e.ch)}));var i=t.data.time&&t.data.time.split(":");return(0,a.Z)((0,a.Z)({},e),{},{weeks:e.weeks,timeValue:n.length?"每周"+n.join("、")+((0,x.di)()?t.data.time:""):"",switchNotifly:void 0!==t.data.weeks,timerValue_h5:t.data.time||"",timeIndex:[v.findIndex((function(e){return void 0!==i&&e===i[0]})),V.findIndex((function(e){return void 0!==i&&e===i[1]}))]})}))}))})),(0,d.Z)((0,l.Z)(e),"onSettingTime",(function(){e.state.switchNotifly&&e.setState({maskIsShow:!0})})),(0,d.Z)((0,l.Z)(e),"onCloseClick",(function(t){e.setState({maskIsShow:!1,dateIsShow_h5:!1})})),(0,d.Z)((0,l.Z)(e),"onInformClick",(function(){e.onInform()})),(0,d.Z)((0,l.Z)(e),"onInform",j()((function(){(0,_.Ml)({mpErpId:e.props.mpErpId}).then((function(t){e.Alert("已经为您通知".concat(e.props.userCount,"位客户请留意来自云单的订单哦~"))}))}),200)),(0,d.Z)((0,l.Z)(e),"Alert",(function(e,t){g.Z.showAlert(e,"","好的",(function(){t&&t()}))})),(0,d.Z)((0,l.Z)(e),"onBindChange",(function(t){e.setState({timeIndex:t.target.value})})),(0,d.Z)((0,l.Z)(e),"onSwitchChange",(function(t){e.setState({switchNotifly:t.detail.value})})),(0,d.Z)((0,l.Z)(e),"onSaveClick",(0,r.Z)((0,s.Z)().mark((function t(){var n,i,a,r,c,o,l,h;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.setState({maskIsShow:!1,dateIsShow_h5:!1}),p().showLoading(),n=e.state,i=n.weeks,a=n.timerValue_h5,r=e.props.mpErpId,c=[],o=[],l="",i.forEach((function(e){e.flag&&(c.push(e.value),o.push(e.ch))})),!(0,x.di)()){t.next=13;break}h=e.state.timeIndex.map((function(e){return e<0?0:e})),l="".concat(v[h[0]],":").concat(V[h[1]]),t.next=20;break;case 13:if(!a){t.next=17;break}l=a,t.next=20;break;case 17:return e.setState({timeValue:"每周"+o.join("、")+((0,x.di)()?l:"")}),g.Z.showToast("请选择通知时间"),t.abrupt("return");case 20:if(!(c.length>0)){t.next=25;break}return t.next=23,(0,_.ko)({mpErpId:r,weeks:c,time:l});case 23:t.next=28;break;case 25:return p().hideLoading(),g.Z.showToast("请选择通知日期！"),t.abrupt("return");case 28:p().hideLoading(),g.Z.showToast("保存成功！"),e.setState({timeValue:"每周"+o.join("、")+((0,x.di)()?l:"")});case 31:case"end":return t.stop()}}),t)})))),(0,d.Z)((0,l.Z)(e),"onWeekItemClick",(function(t){e.setState((function(e){return e.weeks[t].flag=!e.weeks[t].flag,{weeks:e.weeks}}))})),(0,d.Z)((0,l.Z)(e),"onSettingDateClick",(function(){e.setState({maskIsShow:!0,dateIsShow_h5:!0})})),(0,d.Z)((0,l.Z)(e),"onTimerChange",(function(t){var n=t.detail.value;e.setState({timerValue_h5:n},(function(){e.onSaveClick()}))})),(0,d.Z)((0,l.Z)(e),"getLinkUserList",(function(){return e.props.linkUserList.filter((function(e){return e.avatar||e.nickName}))})),(0,d.Z)((0,l.Z)(e),"renderDateView",(function(){var t=e.state.weeks;return(0,N.jsxs)(w.View,{onClick:function(e){return e.stopPropagation()},children:[(0,N.jsxs)(w.View,{className:"time_picker__top",children:[(0,N.jsx)(w.Text,{style:"color: #999999",onClick:e.onCloseClick,children:"取消"}),(0,N.jsx)(w.Text,{style:"color: #2E6BE6",onClick:e.onSaveClick,children:"确定"})]}),(0,N.jsx)(w.View,{className:"mask_title",children:"选择日期"}),(0,N.jsx)(w.View,{className:"weeks_view",children:t.map((function(t,n){return(0,N.jsx)(w.View,{className:"weeks_view_item ".concat(t.flag?"item_y":"item_n"),onClick:function(){e.onWeekItemClick(n)},children:t.label},t.value)}))})]})})),e}return(0,o.Z)(n,[{key:"onReachBottom",value:function(){this.loadMore()}},{key:"componentDidMount",value:function(){this.init()}},{key:"componentWillUnmount",value:function(){this.state.switchNotifly||(0,_.ko)({mpErpId:this.props.mpErpId})}},{key:"componentDidShow",value:function(){(0,x.ZT)("通知客户")}},{key:"render",value:function(){var e=this.state,t=e.switchNotifly,n=e.maskIsShow,i=e.timeValue,a=e.timeIndex,s=e.dateIsShow_h5,r=e.timerValue_h5,c=this.props.userCount,o=this.getLinkUserList(),l=(0,x.di)();return(0,N.jsxs)(w.View,{className:"automatic_notification",children:[(0,N.jsx)(w.View,{className:"automatic_notification_header",children:(0,N.jsxs)(w.View,{className:"header_content",children:[(0,N.jsxs)(w.View,{className:"header_content_title",children:[(0,N.jsxs)(w.View,{children:["您有",(0,N.jsxs)(w.Text,{style:{fontSize:"25px"},children:[" ",c," "]}),"位客户可收到消息"]}),(0,N.jsx)(w.View,{className:"notifly",onClick:this.onInformClick,children:"一键通知"})]}),(0,N.jsxs)(w.View,{className:"header_content_setting ".concat(t?l?"transitionHeightY":"_transitionHeightY":"transitionHeightN"),children:[(0,N.jsxs)(w.View,{className:"header_content_setting_lines",children:[(0,N.jsx)(w.Text,{children:"自动通知"}),(0,N.jsx)(w.Switch,{checked:t,onChange:this.onSwitchChange})]}),l?(0,N.jsxs)(w.View,{className:"header_content_setting_lines",children:[(0,N.jsx)(w.Text,{children:"通知时间"}),(0,N.jsxs)(w.View,{style:"display:flex",children:[(0,N.jsx)(w.View,{className:"useTime",children:i}),(0,N.jsx)(w.Text,{onClick:this.onSettingTime,className:"header_content_setting_lines_btn",style:"color: #2E6BE6",children:i?"修改":"设置通知时间"})]})]}):(0,N.jsxs)(w.View,{children:[(0,N.jsxs)(w.View,{className:"header_content_setting_lines",onClick:this.onSettingDateClick,children:[(0,N.jsx)(w.Text,{children:"通知日期"}),(0,N.jsxs)(w.View,{style:"display:flex",children:[(0,N.jsx)(w.View,{className:"useTime",children:i}),(0,N.jsx)(w.Text,{onClick:this.onSettingTime,className:"header_content_setting_lines_btn",style:"color: #2E6BE6",children:i?"修改":"设置通知时间"})]})]}),(0,N.jsx)(w.Picker,{value:r,onChange:this.onTimerChange,mode:"time",children:(0,N.jsxs)(w.View,{className:"header_content_setting_lines",children:[(0,N.jsx)(w.Text,{children:"通知时间"}),(0,N.jsxs)(w.View,{style:{display:"flex",color:r?"":"#2E6BE6"},children:[r||"设置",r&&(0,N.jsx)(w.Text,{className:"header_content_setting_lines_btn",style:"color: #2E6BE6;",children:"修改"})]})]})})]})]})]})}),(0,N.jsx)(w.View,{className:"center",children:o.map((function(e){return(0,N.jsxs)(w.View,{className:"center_item",children:[(0,N.jsx)(w.View,{className:"center_item_headImg",children:(0,N.jsx)(w.Image,{className:"center_item_headImg_img",src:e.avatar})}),(0,N.jsxs)(w.View,{className:"center_item_inforMation",children:[(0,N.jsx)(w.View,{className:"center_item_inforMation_nickName",children:(0,N.jsx)(w.View,{className:"center_item_inforMation_nickName_text",children:(0,N.jsx)(w.Text,{children:e.remark||e.nickName})})}),(0,N.jsx)(w.View,{className:"center_item_inforMation_nickName"})]})]},e.mpUserId)}))}),n&&(0,N.jsx)(w.View,{className:"mask",onClick:this.onCloseClick,children:l?(0,N.jsxs)(w.View,{className:"time_picker",children:[this.renderDateView(),(0,N.jsx)(w.View,{className:"mask_title",children:"选择时间"}),(0,N.jsxs)(w.PickerView,{onChange:this.onBindChange,style:"width: 100%; height: 110px;",value:a,children:[(0,N.jsx)(w.PickerViewColumn,{children:v.map((function(e){return(0,N.jsxs)(w.View,{className:"picker_view_item",children:[e,"时"]},e)}))}),(0,N.jsx)(w.PickerViewColumn,{children:V.map((function(e){return(0,N.jsxs)(w.View,{className:"picker_view_item",children:[e,"分"]},e)}))})]})]}):(0,N.jsx)(w.View,{className:"time_picker",children:s&&this.renderDateView()})})]})}}]),n}(f.Component),I=(0,k.$j)((function(e){var t=e.goodsManage;return{linkUserList:t.linkUsers.rows,userCount:t.linkUsers.total,mpErpId:t.mpErpId}}))(C);Page((0,i.createPageConfig)(I,"subpackages/cloud_bill/pages/automatic_notification/index",{root:{cn:[]}},{navigationBarTitleText:"通知客户"}||{}))}},function(e){e.O(0,[2107,1216,8592],(function(){return t=85729,e(e.s=t);var t}));e.O()}]);