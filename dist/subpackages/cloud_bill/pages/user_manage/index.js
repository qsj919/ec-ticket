"use strict";require("../../sub-vendors.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[3338],{89020:function(e,t,n){var r=n(32180),s=n(57543),a=n(18453),u=n(77886),i=n(33661),o=n(12742),p=n(22700),c=n(95333),m=n(14175),l=n(3701),d=n(92954),g=n.n(d),f=n(67294),h=n(71515),w=n(75508),Z=n(96999),x=n(77447),y=n(22181),_=n(85893),S=function(e){(0,c.Z)(n,e);var t=(0,m.Z)(n);function n(e){var r;return(0,i.Z)(this,n),r=t.call(this,e),(0,l.Z)((0,p.Z)(r),"init",(0,u.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g().showLoading(),r.props.mpErpId&&r.props.dispatch({type:"goodsManage/selelctShopProfileInformation",payload:{mpErpId:r.props.mpErpId}}),e.next=4,r.props.dispatch({type:"goodsManage/selectUserType",payload:{mpErpId:r.props.mpErpId}}).then((function(){r.initType();var e=r.state.menu;0==r.props.rule?(r.setState((function(e){return e.menu[0].use="全部客户可见",{menu:(0,a.Z)(e.menu)}})),e.length>1&&r.setState((function(e){return e.menu.pop(),{menu:(0,a.Z)(e.menu)}}))):1==r.props.rule?r.setState((function(e){return e.menu[0].use="部分客户可见",{menu:(0,a.Z)(e.menu)}})):r.setState((function(e){return e.menu[0].use="部分客户不可见",{menu:(0,a.Z)(e.menu)}})),r.setState({typeList:r.props.userList,ruleNum:r.props.rule})}));case 4:g().hideLoading();case 5:case"end":return e.stop()}}),e)})))),(0,l.Z)((0,p.Z)(r),"onRangeItemClick",(function(e){var t=r.state.menu;if(0==e.rule&&2==t.length&&r.setState((function(e){return e.menu.pop(),{menu:(0,a.Z)(e.menu)}})),e.rule>0&&1==t.length){var n=r.props.userList.filter((function(e){return"1"==e.flag})).map((function(e){return e.name})).join("、");r.setState((function(e){return e.menu.push({text:"可见客户类型",use:n||"请选择",icon:Z}),{menu:(0,a.Z)(e.menu)}}))}-1!=e.rule&&(r.setState((function(t){return t.menu[0].use=e.text,{menu:(0,a.Z)(t.menu)}})),r.props.dispatch({type:"goodsManage/selectUserType",payload:{mpErpId:r.props.mpErpId}})),r.setState({ruleNum:-1==e.rule?r.state.ruleNum:e.rule}),r.setState({userRangeShow:!1})})),(0,l.Z)((0,p.Z)(r),"initType",(function(){var e=r.props.userList,t=r.state.menu,n=e.filter((function(e){return"1"==e.flag}));t.length>1&&n.length>0&&r.setState((function(e){return e.menu[1].use=n.map((function(e){return e.name})).join("、"),{menu:(0,a.Z)(e.menu)}}))})),(0,l.Z)((0,p.Z)(r),"onTypeItemClick",(function(e,t){if(-1!==t&&-2!==t||(r.setState({typeList:e}),r.setState({userTypeRangeShow:!1})),-2===t){var n=e.filter((function(e){return"1"===e.flag}));if(r.setState((function(e){return e.menu[1].use=n.map((function(e){return e.name})).join("、"),{menu:(0,a.Z)(e.menu)}})),0==n.length)return void r.setState((function(e){return e.menu[1].use="请选择",{menu:(0,a.Z)(e.menu)}}))}})),(0,l.Z)((0,p.Z)(r),"onCenterItemClick",(function(e){0!=e?r.setState({userTypeRangeShow:!0}):r.setState({userRangeShow:!0})})),(0,l.Z)((0,p.Z)(r),"submitBtnClick",(0,u.Z)((0,s.Z)().mark((function e(){var t,n,a,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.state,n=t.typeList,a=t.ruleNum,g().showLoading(),0!=a){e.next=7;break}return e.next=5,r.props.dispatch({type:"goodsManage/updateUserType",payload:{mpErpId:r.props.mpErpId,rule:a}});case 5:e.next=15;break;case 7:if(0!=(u=n.filter((function(e){return"1"===e.flag}))).length){e.next=13;break}return g().showToast({title:"请选择",icon:"none",duration:2e3}),e.abrupt("return");case 13:return e.next=15,r.props.dispatch({type:"goodsManage/updateUserType",payload:{mpErpId:r.props.mpErpId,rule:a,val:u.map((function(e){return e.sid})).join(",")}});case 15:g().hideLoading(),g().navigateBack();case 17:case"end":return e.stop()}}),e)})))),r.state={userRangeShow:!1,userTypeRangeShow:!1,ruleNum:-1,typeList:[],menu:[{text:"新款、爆款可见范围",use:"全部客户可见",icon:Z},{text:"可见客户类型",use:"无",icon:Z}]},r}return(0,o.Z)(n,[{key:"componentDidMount",value:function(){this.init()}},{key:"render",value:function(){var e=this,t=this.state,n=t.userRangeShow,r=t.userTypeRangeShow,s=t.menu,a=t.typeList;return(0,_.jsxs)(h.View,{className:"user_manage_wrap",children:[(0,_.jsx)(h.View,{className:"user_manage_wrap_title",children:"货品可见范围管理"}),(0,_.jsx)(h.View,{className:"user_manage_wrap_center",children:s.map((function(t,n){return(0,_.jsxs)(h.View,{className:"user_manage_wrap_center_item",onClick:e.onCenterItemClick.bind(e,n),children:[(0,_.jsx)(h.Text,{className:"item_one",children:t.text}),(0,_.jsx)(h.Text,{className:"item_two",children:t.use}),(0,_.jsx)(h.Image,{className:"item_image",src:t.icon})]},n)}))}),(0,_.jsx)(h.View,{className:"user_manage_wrap_title",children:'前往"商陆花-往来管理"中，给客户设置类别'}),(0,_.jsx)(h.View,{className:"user_manage_wrap_btn",onClick:this.submitBtnClick,children:"保存"}),(n||r)&&(0,_.jsx)(h.View,{className:"user_manage_wrap_mask",children:(0,_.jsxs)(h.View,{className:"user_manage_wrap_mask_list",children:[n&&(0,_.jsx)(x.Z,{onRangeItemClick:this.onRangeItemClick}),r&&(0,_.jsx)(y.Z,{typeList:a,onTypeItemClick:this.onTypeItemClick})]})})]})}}]),n}(f.PureComponent),k=(0,w.$j)((function(e){var t=e.goodsManage;return{userList:t.userList,rule:t.rule,mpErpId:t.mpErpId}}))(S);Page((0,r.createPageConfig)(k,"subpackages/cloud_bill/pages/user_manage/index",{root:{cn:[]}},{navigationBarTitleText:"可见客户设置"}||{}))}},function(e){e.O(0,[666,1772,2107,1216],(function(){return t=89020,e(e.s=t);var t}));e.O()}]);