"use strict";require("../../sub-vendors.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[8036],{15498:function(e,t,a){var n=a(32180),i=a(57543),r=a(77886),o=a(18453),s=a(33661),c=a(12742),l=a(22700),u=a(95333),m=a(14175),g=a(3701),d=a(92954),p=a.n(d),f=a(67294),v=a(71515),h=a(75508),Z=a(76449),I=a(60076),x=(a(65712),a(66058)),y=(a(2021),a(94184)),A=a.n(y),S="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwBAMAAAClLOS0AAAAAXNSR0IArs4c6QAAAA9QTFRFAAAA////mpqamZmZmZmZ1Y2utQAAAAR0Uk5TAAFbfyuk5J8AAAAlSURBVDjLY2AYBaQAIWM0oAiVUHFBA06EJHAaNerzUZ+PAuwAAADoMDcgc5GkAAAAAElFTkSuQmCC",b=a(85893);var w={transition:"transform ease-in-out 0.3s, opacity ease-in-out 0.3s;"};var _=function(e){(0,u.Z)(a,e);var t=(0,m.Z)(a);function a(){var e;(0,s.Z)(this,a);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i)),(0,g.Z)((0,l.Z)(e),"isStart",!1),(0,g.Z)((0,l.Z)(e),"scale",1),(0,g.Z)((0,l.Z)(e),"startPosition",{x:0,y:0}),(0,g.Z)((0,l.Z)(e),"startImagePosition",{x:0,y:0,top:0,left:0,bottom:0,right:0}),(0,g.Z)((0,l.Z)(e),"timer",void 0),(0,g.Z)((0,l.Z)(e),"rects",void 0),(0,g.Z)((0,l.Z)(e),"transitionCount",0),(0,g.Z)((0,l.Z)(e),"imageStyles",[]),(0,g.Z)((0,l.Z)(e),"imageDisplayIndexArray",[]),(0,g.Z)((0,l.Z)(e),"isDeleteClicked",!1),(0,g.Z)((0,l.Z)(e),"disableClick",!1),(0,g.Z)((0,l.Z)(e),"observers",[]),(0,g.Z)((0,l.Z)(e),"sortable",void 0),(0,g.Z)((0,l.Z)(e),"state",{activeImageIndex:-1,imageSource:[],activeImageStyle:{},imageDisplayIndexArray:[],styles:[]}),(0,g.Z)((0,l.Z)(e),"addObserver",(function(){e.state.imageSource.forEach((function(t,a){var n,i=(null===(n=p().getCurrentInstance())||void 0===n?void 0:n.page).createIntersectionObserver();i.relativeTo("#move-image").observe("#view_for_judge_interaction--".concat(a),(function(t){t.intersectionRatio>0&&e.moveImages(e.state.activeImageIndex,a)})),e.observers.push(i)}))})),(0,g.Z)((0,l.Z)(e),"removeObserver",(function(){e.observers.forEach((function(e){return e.disconnect()})),e.observers=[]})),(0,g.Z)((0,l.Z)(e),"calculateScrennScale",(function(){var t=p().getSystemInfoSync().windowWidth;e.scale=t/750})),(0,g.Z)((0,l.Z)(e),"calculatePosition",(function(){p().createSelectorQuery().in(p().getCurrentInstance().page).selectAll(".view_for_calculate_position").boundingClientRect((function(t){e.rects=t;var a=[],n=t[0];t.forEach((function(t){var i=C({x:t.left-n.left,y:t.top-n.top},e.scale);a.push((0,x.Z)({transform:i},w))})),e.setState({styles:a})})).exec()})),(0,g.Z)((0,l.Z)(e),"findImageIndexFromPosition",(function(t){for(var a=-1,n=0;n<e.rects.length;n++){var i=e.rects[n],r=t.x,o=t.y;if(i.left<r&&i.right>r&&i.top<o&&i.bottom>o){a=n;break}}return a})),(0,g.Z)((0,l.Z)(e),"startMove",(function(t){var a=e.state.imageDisplayIndexArray.findIndex((function(e){return e===t}));if(a>-1){e.isStart=!0,e.props.onStart&&e.props.onStart();var n=e.rects[0],i=e.rects[a],r=i.left-n.left,o=i.top-n.top,s=C({x:r,y:o},e.scale);e.startImagePosition=(0,x.Z)((0,x.Z)({},i),{},{x:r,y:o});var c={transform:"".concat(s," scale(1.0)")};e.setState({activeImageIndex:a,activeImageStyle:c})}})),(0,g.Z)((0,l.Z)(e),"moveImages",(function(t,a){var n=e.props.onImageChange,i=e.state.imageSource.length;t>i-1||a>i-1||t<0||a<0||t===a||"number"!=typeof t||"number"!=typeof a||e.setState((function(e){var n=(0,o.Z)(e.imageDisplayIndexArray),i=e.imageDisplayIndexArray[t];return n.splice(t,1),n.splice(a,0,i),{imageDisplayIndexArray:n,activeImageIndex:a}}),(function(){var t=e.getImagesInRealIndex();n&&n(t)}))})),(0,g.Z)((0,l.Z)(e),"reCalculateImageDisplayIndex",(function(){var t=e.props.onImageChange,a=e.state.imageSource.length;e.state.imageDisplayIndexArray.length<a&&e.setState((function(e){for(var t=(0,o.Z)(e.imageDisplayIndexArray),n=t.length;n<a;n++)t.push(n);return{imageDisplayIndexArray:t}}),(function(){var a=e.getImagesInRealIndex();t&&t(a)}))})),(0,g.Z)((0,l.Z)(e),"getImagesInRealIndex",(function(){var t=e.state,a=t.imageSource,n=t.imageDisplayIndexArray;return a.reduce((function(e,t,i){var r=void 0===n[i]?i:n[i];return e.push((0,x.Z)({},a[r])),e}),[])})),(0,g.Z)((0,l.Z)(e),"onTouchStart",(function(t){var a=t.changedTouches,n=t.currentTarget.dataset.index,i=a[0];e.startPosition={x:i.pageX,y:i.pageY},e.timer=setTimeout((function(){e.startMove(Number(n))}),500)})),(0,g.Z)((0,l.Z)(e),"onTouchMove",(function(t){t.stopPropagation();var a=t.changedTouches[0],n=a.pageX-e.startPosition.x,i=a.pageY-e.startPosition.y,r={x:e.startImagePosition.x+n,y:e.startImagePosition.y+i};e.setState({activeImageStyle:{transform:C(r,e.scale)}})})),(0,g.Z)((0,l.Z)(e),"onTouchEnd",(function(t){if(e.clearTimer(),e.isStart){var a=e.props.onDragEnd;e.disableClickEvent(),e.isStart=!1,e.props.onEnd&&e.props.onEnd();var n=e.rects[0],i=e.rects[e.state.activeImageIndex],r=i.left-n.left,o=i.top-n.top;e.setState({activeImageStyle:{transform:C({x:r,y:o},e.scale)}}),e.setState({activeImageIndex:-1},(function(){var t=e.state,n=t.imageSource,i=t.imageDisplayIndexArray.map((function(e){return n[e]}));a&&a(i)}))}})),(0,g.Z)((0,l.Z)(e),"disableClickEvent",(function(){e.disableClick=!0,setTimeout((function(){e.disableClick=!1}),200)})),(0,g.Z)((0,l.Z)(e),"onMovableImageTransitionEnd",(function(t){e.isStart&&e.transitionCount++})),(0,g.Z)((0,l.Z)(e),"clearTimer",(function(){e.timer&&clearTimeout(e.timer)})),(0,g.Z)((0,l.Z)(e),"onWrapperTouchMove",(function(t){e.isStart&&(t.preventDefault(),t.stopPropagation())})),(0,g.Z)((0,l.Z)(e),"deleteImage",(function(t){if(!e.disableClick){t.stopPropagation(),e.isDeleteClicked=!0;var a=t.target.dataset,n=Number(a.index),i=e.props,r=(i.onDeleteImage,i.onImageChange);e.state.imageSource[n];e.setState((function(e){var t=e.imageDisplayIndexArray.findIndex((function(e){return e===n})),a=(0,o.Z)(e.imageDisplayIndexArray);return a.splice(t,1),{imageSource:e.imageSource.filter((function(e,t){return t!==n})),imageDisplayIndexArray:a.map((function(e){return e>=n?e-1:e}))}}),(function(){e.isDeleteClicked=!1;var t=e.getImagesInRealIndex();r&&r(t)}))}})),e}return(0,c.Z)(a,[{key:"componentDidMount",value:function(){this.setState({imageSource:this.props.defaultImages})}},{key:"componentDidUpdate",value:function(e,t){var a=this;this.props.onImageChange;this.state.imageSource.length!==t.imageSource.length&&(this.reCalculateImageDisplayIndex(),this.calculatePosition(),this.removeObserver(),this.addObserver()),(e.defaultImages.reduce((function(e,t,n){return e&&t.codeValue===a.props.defaultImages[n].codeValue}),!1)||this.props.defaultImages.length!==e.defaultImages.length||"goods_share"===this.props.from&&this.props.defaultImages!==e.defaultImages)&&this.setState({imageSource:(0,o.Z)(this.props.defaultImages)})}},{key:"componentWillUnmount",value:function(){this.removeObserver()}},{key:"render",value:function(){var e=this,t=this.state,a=t.imageSource,n=t.styles,i=t.activeImageIndex,r=t.activeImageStyle,o=t.imageDisplayIndexArray,s=(this.props.from,"100rpx"),c=a[o[i]]||null;return console.log(r,"activeImageStyle"),(0,b.jsxs)(v.View,{className:"movable_block",style:{position:"relative"},onTouchMove:function(t){(t.target.class=e.isStart)&&t.preventDefault()},children:[(0,b.jsx)(v.View,{className:"view_for_placeholder",children:a.map((function(e,t){return(0,b.jsx)(v.View,{className:"view_for_calculate_position",style:{height:s,marginBottom:"20rpx"},children:(0,b.jsx)(v.View,{className:"view_for_judge_interaction",id:"view_for_judge_interaction--".concat(t)})},e.codeValue)}))}),(0,b.jsx)(v.View,{id:"movable_image_container",className:A()("movable_image_container",{"movable_image_container--h5":!1}),children:a.map((function(t,a){return(0,b.jsxs)(v.View,{className:"movable_image",style:(0,x.Z)((0,x.Z)({},n[o.findIndex((function(e){return e===a}))]),{},{opacity:a===o[i]?0:1,height:s}),children:[(0,b.jsx)(v.Text,{children:"".concat(t.codeName,"(").concat(t.spuCount,"件)")}),(0,b.jsx)(v.View,{className:"touch_view",onTouchStart:e.onTouchStart,onTouchMove:e.onTouchMove,onTouchEnd:e.onTouchEnd,"data-index":a,children:(0,b.jsx)(v.Image,{src:S,style:"width:100%;height:100%;"})})]},t.codeValue)}))}),(0,b.jsxs)(v.View,{id:"move-image",className:"base_image base_image--active",style:(0,x.Z)({opacity:i>-1?1:.8,zIndex:i>-1?2:-1},r),children:[c&&(0,b.jsx)(v.Text,{children:"".concat(c.codeName,"(").concat(c.spuCount,"件)")}),(0,b.jsx)(v.View,{className:"touch_view",children:(0,b.jsx)(v.Image,{src:S,style:"width:100%;height:100%;"})})]})]})}}]),a}(f.PureComponent);function C(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return"translate(".concat(e.x*t,"px, ").concat(e.y*t,"px)")}(0,g.Z)(_,"defaultProps",{defaultImages:[],from:"goods_edit"});var D=function(e){(0,u.Z)(a,e);var t=(0,m.Z)(a);function a(){var e;(0,s.Z)(this,a);for(var n=arguments.length,c=new Array(n),u=0;u<n;u++)c[u]=arguments[u];return e=t.call.apply(t,[this].concat(c)),(0,g.Z)((0,l.Z)(e),"resultList",[]),(0,g.Z)((0,l.Z)(e),"onSortChange",(function(t){var a=e.props.classList.filter((function(e){return e.hidden}));e.resultList=[].concat((0,o.Z)(t),(0,o.Z)(a))})),(0,g.Z)((0,l.Z)(e),"onSaveClick",(0,r.Z)((0,i.Z)().mark((function t(){var a,n;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,p().showLoading({title:"保存中"}),a=e.resultList,e.resultList.length!==e.props.classList.length&&(a=e.props.classList),a=a.map((function(e){return{name:e.codeName,id:e.codeValue,hidden:e.hidden,spuCount:e.spuCount,parentid:e.parentid}})),n=e.props.mpErpId,t.next=8,(0,Z.xF)({mpErpId:n,jsonParam:a});case 8:e.props.dispatch({type:"goodsManage/fetchClassList"}),p().hideLoading(),p().navigateBack(),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(0),p().hideLoading();case 16:case"end":return t.stop()}}),t,null,[[0,13]])})))),e}return(0,c.Z)(a,[{key:"render",value:function(){var e=this.props.classList.filter((function(e){return!e.hidden}));return(0,b.jsxs)(v.View,{className:I.Z.contanier,children:[(0,b.jsxs)(v.View,{className:I.Z.info,children:[(0,b.jsxs)(v.View,{children:[(0,b.jsx)(v.View,{className:I.Z.info__title,children:"管理分类"}),(0,b.jsx)(v.View,{className:I.Z.info__remind,children:"可对分类进行隐藏和排序"})]}),(0,b.jsx)(v.View,{className:I.Z["info__btn--save"],onClick:this.onSaveClick,children:"保存"})]}),(0,b.jsx)(v.ScrollView,{className:I.Z.list,children:(0,b.jsx)(_,{defaultImages:e,onImageChange:this.onSortChange})})]})}}]),a}(f.PureComponent),k=(0,h.$j)((function(e){var t=e.goodsManage;return{classList:t.classList,mpErpId:t.mpErpId}}))(D);Page((0,n.createPageConfig)(k,"subpackages/cloud_bill/pages/category_manage/category_sort",{root:{cn:[]}},{navigationBarTitleText:"管理分类"}||{}))}},function(e){e.O(0,[666,1772,2107,1216,8592],(function(){return t=15498,e(e.s=t);var t}));e.O()}]);