"use strict";require("../../sub-vendors.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[6743],{29359:function(e,t,i){var a=i(32180),s=i(66058),n=i(57543),o=i(77886),r=i(33661),c=i(12742),l=i(22700),p=i(95333),u=i(14175),h=i(3701),d=i(92954),g=i.n(d),m=i(67294),_=i(75508),w=i(71515),Z=i(44559),x=i(6420),y=i(41115),f=i(9335),k=i(86792),C=i(85893),T=function(e){(0,p.Z)(i,e);var t=(0,u.Z)(i);function i(){var e,a;(0,r.Z)(this,i);for(var c=arguments.length,p=new Array(c),u=0;u<c;u++)p[u]=arguments[u];return a=t.call.apply(t,[this].concat(p)),(0,h.Z)((0,l.Z)(a),"state",{pageNo:1,rightListPageNo:1,topDataTabIndex:Number((0,x.JU)(null===(e=g().getCurrentInstance)||void 0===e?void 0:e.call(g())).type)||0,screenTabsIndex:0,isFilterVisible:!1,todayTime:(0,x.GB)(),searchKey:""}),(0,h.Z)((0,l.Z)(a),"init",(0,o.Z)((0,n.Z)().mark((function e(){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.props.dispatch({type:"goodsManage/selectShopParamStaffViewClientPhone"}),a.props.dispatch({type:"goodsManage/selectShopLinkUsers"}),a.props.dispatch({type:"goodsManage/getShopViewData"}),a.props.dispatch({type:"goodsManage/selectUserType",payload:{mpErpId:a.props.mpErpId}}),a.requestList();case 5:case"end":return e.stop()}}),e)})))),(0,h.Z)((0,l.Z)(a),"requestRightList",(function(){var e=a.state,t=e.rightListPageNo,i=e.searchKey;a.props.dispatch({type:"goodsManage/selectShopLinkUsers",payload:{pageNo:t,searchKey:i}})})),(0,h.Z)((0,l.Z)(a),"onSearch",(function(){1===a.state.rightListPageNo?a.requestRightList():a.setState({rightListPageNo:1},(function(){a.requestRightList()}))})),(0,h.Z)((0,l.Z)(a),"requestList",(0,o.Z)((0,n.Z)().mark((function e(){var t;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=a.state.pageNo,a.props.dispatch({type:"goodsManage/selectShopViewers",payload:{pageNo:t}});case 2:case"end":return e.stop()}}),e)})))),(0,h.Z)((0,l.Z)(a),"getIsMoreData",(function(){var e=a.props.usersListValues,t=a.state.pageNo;return e.length>=20*t})),(0,h.Z)((0,l.Z)(a),"getRightIsMoreData",(function(){var e=a.props.myClientList,t=a.state.rightListPageNo;return e.length>=20*t})),(0,h.Z)((0,l.Z)(a),"getViewersList",(function(){var e=a.props.usersListValues,t={};return e.forEach((function(e){t.hasOwnProperty(e.viewDate)?t[e.viewDate].push((0,s.Z)({},e)):t[e.viewDate]=[(0,s.Z)({},e)]})),t})),(0,h.Z)((0,l.Z)(a),"_reachBottom",(function(){0===a.state.topDataTabIndex?a.getIsMoreData()&&a.setState((function(e){return{pageNo:e.pageNo+1}}),(function(){a.requestList()})):a.getRightIsMoreData()&&a.setState((function(e){return{rightListPageNo:e.rightListPageNo+1}}),(function(){a.requestRightList()}))})),(0,h.Z)((0,l.Z)(a),"onBlockClick",function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g().showLoading(),e.next=3,a.props.dispatch({type:"goodsManage/updataUserJurisdiction",payload:{mpUserId:t.mpUserId,code:"shop_black_user",val:"0"===t.shopBlackUser?"1":"0"}});case 3:g().hideLoading();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,h.Z)((0,l.Z)(a),"onItemClick",(function(e){g().navigateTo({url:"/subpackages/cloud_bill/pages/my_client_detail/index?mpUserId=".concat(e.mpUserId,"&viewDate=").concat(e.viewDate,"&listType=").concat(a.state.topDataTabIndex)})})),(0,h.Z)((0,l.Z)(a),"onTopItemClick",(function(e){a.setState({topDataTabIndex:e},(function(){g().pageScrollTo({scrollTop:0})}))})),(0,h.Z)((0,l.Z)(a),"onInput",(function(e){a.setState({searchKey:e})})),(0,h.Z)((0,l.Z)(a),"onClearInput",(function(e){a.setState({searchKey:e,rightListPageNo:1},(function(){a.requestRightList()}))})),(0,h.Z)((0,l.Z)(a),"getTopData",(function(){var e=a.props.myClientViewData;return[{label:"今日访客",value:e.todayCount,id:"001"},{label:"全部客户",value:e.totalCount,id:"002"}]})),(0,h.Z)((0,l.Z)(a),"getScreenTabs",(function(){return["全部","访问时间","浏览商品"]})),(0,h.Z)((0,l.Z)(a),"onScreenTabsClick",(function(e){a.setState({screenTabsIndex:e})})),(0,h.Z)((0,l.Z)(a),"onFilterClick",(function(){a.setState({isFilterVisible:!0})})),(0,h.Z)((0,l.Z)(a),"onFilterCencelClick",(function(){a.setState({isFilterVisible:!1})})),(0,h.Z)((0,l.Z)(a),"onAuditClientClick",(function(){g().navigateTo({url:"/subpackages/cloud_bill/pages/audit_client/index"})})),a}return(0,c.Z)(i,[{key:"componentDidMount",value:function(){this.init(),this.props.dispatch({type:"goodsManage/selectShopWaitAuditUsers",payload:{pageNo:1,jsonParam:{mpErpId:this.props.mpErpId}}}),this.props.dispatch({type:"goodsManage/selestShopParamVisitorAuth"})}},{key:"componentDidShow",value:function(){(0,y.ZT)("我的客户")}},{key:"render",value:function(){var e=this,t=this.state,i=t.topDataTabIndex,a=(t.screenTabsIndex,t.isFilterVisible,t.todayTime),s=this.props,n=(s.userTypeList,s.myClientList),o=s.clientAuditTotal,r=s.shopVisitorAuth,c=this.getViewersList();return(0,C.jsxs)(w.View,{className:"my_client_wrap",children:["1"===r&&(0,C.jsx)(w.View,{className:"my_client_wrap_visitor",children:(0,C.jsxs)(w.View,{className:"my_client_wrap_visitor__content",onClick:this.onAuditClientClick,children:[(0,C.jsxs)(w.View,{className:"my_client_wrap_visitor__content__left",children:[(0,C.jsx)(w.Text,{className:"content_title",children:"待审核客户"}),(0,C.jsx)(w.Text,{className:"content_label",children:"客户正在申请访问您的云单"})]}),(0,C.jsxs)(w.View,{className:"my_client_wrap_visitor__content__right",children:[(0,C.jsx)(w.Text,{children:o||""}),(0,C.jsx)(w.Image,{src:k,className:"angle_right"})]})]})}),(0,C.jsx)(w.View,{className:"my_client_wrap_topData",children:this.getTopData().map((function(t,a){return(0,C.jsxs)(w.View,{className:"my_client_wrap_topData_item ".concat(i===a?"topDataTabsY":""),onClick:function(){e.onTopItemClick(a)},children:[(0,C.jsx)(w.Text,{className:"my_client_wrap_topData_item_num",children:t.value}),(0,C.jsx)(w.Text,{className:"my_client_wrap_topData_item_title",children:t.label})]},t.id)}))}),0===i?(0,C.jsxs)(w.ScrollView,{className:"centerScrollView",scrollY:!0,onScrollToLower:this._reachBottom,lowerThreshold:500,children:[Object.keys(c).map((function(t){return(0,C.jsxs)(w.View,{children:[(0,C.jsx)(w.View,{className:"my_client_wrap_today",children:t===a?"今天":t}),c[t].map((function(t){return(0,C.jsx)(f.Z,{item:t,onItemClick:e.onItemClick,onBlockClick:e.onBlockClick,itemPadding:"0 25px"},t.mpUserId)}))]},t)})),(0,C.jsx)(w.View,{className:"bottom",children:this.getIsMoreData()?(0,C.jsx)(w.Text,{children:"上拉加载更多～"}):(0,C.jsx)(w.Text,{children:"没有更多数据了～"})})]}):(0,C.jsxs)(w.Block,{children:[(0,C.jsxs)(w.View,{className:"client_search_bar",children:[(0,C.jsx)(Z.Z,{onInput:this.onInput,placeholder:"搜索客户名称",onClearSearchClick:this.onClearInput,onSearchClick:this.onSearch}),(0,C.jsx)(w.View,{className:"client_search_bar__label",onClick:this.onSearch,children:"搜索"})]}),(0,C.jsxs)(w.ScrollView,{className:"centerScrollView centerScrollView--search",scrollY:!0,onScrollToLower:this._reachBottom,lowerThreshold:500,children:[n.map((function(t){return(0,C.jsx)(f.Z,{item:t,actionIsVisible:!1,onItemClick:e.onItemClick,onBlockClick:e.onBlockClick,itemPadding:"0 25px"},t.mpUserId)})),(0,C.jsx)(w.View,{className:"bottom",children:this.getRightIsMoreData()?(0,C.jsx)(w.Text,{children:"上拉加载更多～"}):(0,C.jsx)(w.Text,{children:"没有更多数据了～"})})]})]})]})}}]),i}(m.Component),I=(0,_.$j)((function(e){var t=e.goodsManage;return{myClientViewData:t.myClientViewData,usersListValues:t.viewDataViewers,userTypeList:t.userList,mpErpId:t.mpErpId,myClientList:t.myClientList,clientAuditTotal:t.myClientViewData.waitAuditCount,shopVisitorAuth:t.shopVisitorAuth}}))(T);Page((0,a.createPageConfig)(I,"subpackages/cloud_bill/pages/my_client/index",{root:{cn:[]}},{navigationBarTitleText:"我的客户"}||{}))}},function(e){e.O(0,[666,1772,2107,1216,8592],(function(){return t=29359,e(e.s=t);var t}));e.O()}]);