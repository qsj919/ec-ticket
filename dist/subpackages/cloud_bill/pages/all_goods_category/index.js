"use strict";require("../../sub-vendors.js");require("../../sub-common/ea5651c74a764b7a53f5764aba833936.js");require("../../sub-common/60464b2b77061df0626bd7ecea16c659.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[7001],{83689:function(e,t,o){var s=o(32180),i=o(57543),n=o(18453),a=o(77886),r=o(66058),c=o(33661),l=o(12742),d=o(22700),u=o(95333),p=o(14175),h=o(3701),g=o(92954),f=o.n(g),_=o(71515),m=o(75508),x=o(67294),v=o(14067),Z=o(91629),w=o(31254),I=o(6420),V="index-module__contanier___uyd1b",y="index-module__left___uVDZv",S="index-module__left__list___O2c5G",L="index-module__left__list__item___n90z3",C="index-module__left__list__item__flag___y9aaw",N="index-module__right___IcWFT",b="index-module__right__list___vmhpa",k="index-module__right__list__item___DtxCZ",G=o(3258),j=o(89893),z=o(69558),E=o(85893),P=function(e){(0,u.Z)(o,e);var t=(0,p.Z)(o);function o(){var e;(0,c.Z)(this,o);for(var s=arguments.length,l=new Array(s),u=0;u<s;u++)l[u]=arguments[u];return e=t.call.apply(t,[this].concat(l)),(0,h.Z)((0,d.Z)(e),"pageNo",1),(0,h.Z)((0,d.Z)(e),"pageSize",w.IV),(0,h.Z)((0,d.Z)(e),"state",{goodsList:[],currentCateValue:-1}),(0,h.Z)((0,d.Z)(e),"onItemClick",(function(t){e.props.dispatch({type:"cloudBill/fetchGoodsDetail",payload:{spuId:t.styleId,goodsDtail:(0,r.Z)((0,r.Z)({},t),{},{skus:[]})}}),Z.Z.navigateTo({url:"/subpackages/cloud_bill/pages/goods_detail/index?spuId=".concat(t.id)})})),(0,h.Z)((0,d.Z)(e),"fetchGoodsList",(0,a.Z)((0,i.Z)().mark((function t(){var o,s,a,r,c,l,d,u,p,h,g,f;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.props.mpErpId,s=e.state.currentCateValue,a={pageNo:e.pageNo,pageSize:e.pageSize,jsonParam:{mpErpId:o,type:1,classId:-1===s?void 0:s}},t.next=5,(0,v.X)(a);case 5:if(r=t.sent,!((c=r.data).rows.length>0)){t.next=29;break}return t.prev=8,t.next=11,(0,v.g3)({mpErpId:o,styleIds:c.rows.map((function(e){return e.styleId})).join(",")});case 11:l=t.sent,(d=l.data.dataList).length&&d.forEach((function(e,t){var o=c.rows[t];Number(e.styleId)===o.styleId&&(o.price=e.price,o.useLastPrice=!0)})),t.next=18;break;case 16:t.prev=16,t.t0=t.catch(8);case 18:u=(0,n.Z)(e.state.goodsList),e.pageNo>1?(p=u).push.apply(p,(0,n.Z)(c.rows)):u=c.rows,t.next=28;break;case 24:h=t.sent,g=h.data,f=g.spuList.map((function(e){return e.styleId})),u=u.filter((function(e){return!f.includes(e.styleId)}));case 28:e.setState({goodsList:u});case 29:case"end":return t.stop()}}),t,null,[[8,16]])})))),(0,h.Z)((0,d.Z)(e),"fetchHotSettingGood",function(){var t=(0,a.Z)((0,i.Z)().mark((function t(o){var s,n,a,r;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=e.props,n=s.dispatch,a=s.mpErpId,r=s.hotSettingGoodsList,!s.hotSettingGoodsFinished||!o){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,n({type:"cloudBill/fetchHotBySetting",payload:{mpErpId:a,loadMore:o}});case 5:e.setState({goodsList:r});case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),(0,h.Z)((0,d.Z)(e),"fetchSpecialGoodsList",(function(){var t=e.props.mpErpId;if(t){var o={pageSize:300,pageNo:1,type:10,mpErpId:t};return(0,v.M4)(o).then((function(t){var o=t.data;e.setState({goodsList:o.spuList})})).catch((function(){}))}})),(0,h.Z)((0,d.Z)(e),"onCategoryClick",(function(t){f().pageScrollTo({scrollTop:0}),e.pageNo=1;var o=function(){return e.fetchGoodsList()};-2===t?o=function(){return e.fetchHotSettingGood()}:-3===t&&(o=function(){return e.fetchSpecialGoodsList()}),e.setState({currentCateValue:t,goodsList:[]},o)})),e}return(0,l.Z)(o,[{key:"componentDidMount",value:function(){var e,t,o=this,s=Number((0,I.JU)(null===(e=f().getCurrentInstance)||void 0===e?void 0:e.call(f())).codeValue);this.setState({currentCateValue:s},(function(){-2===s?o.fetchHotSettingGood():-3===s?o.fetchSpecialGoodsList():o.fetchGoodsList()})),f().setNavigationBarTitle({title:(0,I.JU)(null===(t=f().getCurrentInstance)||void 0===t?void 0:t.call(f())).shopName})}},{key:"onReachBottom",value:function(){var e=this.state.currentCateValue;-2===e?this.fetchHotSettingGood(!0):-3===e||(this.pageNo++,this.fetchGoodsList())}},{key:"render",value:function(){var e=this,t=this.props,o=t.classList,s=t.colorSizeVisible,i=t.showPrice,n=(t.shopInfo,this.state),a=n.goodsList,r=n.currentCateValue;return console.log("classList--------------",o),(0,E.jsxs)(_.View,{className:V,children:[(0,E.jsx)(_.View,{style:{zIndex:9999},children:(0,E.jsx)(z.Z,{visible:s,type:"buttons"},"all_goods")}),(0,E.jsx)(_.View,{className:y,children:(0,E.jsxs)(_.ScrollView,{className:S,scrollY:!0,scrollIntoView:"s".concat(r),children:[(0,E.jsxs)(_.View,{onClick:function(){e.onCategoryClick(-1)},className:L,children:[(0,E.jsx)(_.Text,{children:"全部"}),-1===r&&(0,E.jsx)(_.View,{className:C})]}),o.map((function(t){return(0,E.jsxs)(_.View,{id:"s".concat(t.codeValue),onClick:function(){e.onCategoryClick(t.codeValue)},className:L,children:[(0,E.jsx)(_.Text,{children:t.codeName}),r===t.codeValue&&(0,E.jsx)(_.View,{className:C})]},t.codeValue)}))]})}),(0,E.jsx)(_.View,{className:N,children:(0,E.jsx)(G.Z,{containerstyle:0===a.length?"height: 100vh":"",noDataVisible:0===a.length,noMoreDataVisible:this.pageNo*this.pageSize>a.length&&a.length>0,children:a.length>0&&(0,E.jsx)(_.View,{className:b,children:a.map((function(t){return(0,E.jsx)(_.View,{className:k,children:(0,E.jsx)(j.Z,{isCartBtnVisible:!0,data:t,onItemClick:function(t){e.onItemClick(t)},showPrice:i,from:"allGoods"})},t.id)}))})})})]})}}]),o}(x.PureComponent),T=(0,m.$j)((function(e){var t=e.goodsManage,o=e.cloudBill;return{classList:o.classList,mpErpId:o.mpErpId,shopInfo:t.shopInfo,colorSizeVisible:o.colorSizeVisible,showPrice:"1"===o.shopParams.spuShowPrice,hotSettingGoodsList:o.hotSettingGoodsList,hotSettingGoodsFinished:o.hotSettingGoodsListFinished}}))(P);Page((0,s.createPageConfig)(T,"subpackages/cloud_bill/pages/all_goods_category/index",{root:{cn:[]}},{navigationBarTitleText:""}||{}))}},function(e){e.O(0,[666,1772,6690,3658,2107,1216,8592],(function(){return t=83689,e(e.s=t);var t}));e.O()}]);