"use strict";require("../../sub-vendors.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[58],{25264:function(t,e,a){var i=a(32180),n=a(65712),o=a(33661),s=a(12742),c=a(22700),l=a(95333),u=a(14175),h=a(3701),r=a(92954),d=a.n(r),p=a(67294),f=a(71515),g=a(13109),m=a(19497),w=a(63056),v=a(6420),b=a(75508),Z=a(91629),L="https://webdoc.hzecool.com/webCdn/weapp/ec-ticket/src/subpackages/functional/images/d6ca97c3411eddfc8706..png",x=a(18316),_="index-module__page____um3N",C="index-module__container___bbMGL",k="index-module__title___M0iUx",I=a(53252),S=a(85893),y=function(t){return t[t.None=0]="None",t[t.Fail=1]="Fail",t}(y||{}),P=function(t){(0,l.Z)(a,t);var e=(0,u.Z)(a);function a(t){var i;return(0,o.Z)(this,a),i=e.call(this,t),(0,h.Z)((0,c.Z)(i),"validatePage",(function(){var t;if(i.props.sessionId){var e=(null===(t=d().getCurrentInstance)||void 0===t?void 0:t.call(d())).params;if(e.q){var a=decodeURIComponent(e.q),n=(0,v.f1)(a);i.auth(n)}else i.fetchData()}})),(0,h.Z)((0,c.Z)(i),"auth",(function(t){var e=t.mpUserId,a=t.timestamp;d().showLoading({title:"获取授权中..."}),(0,g.X8)(e,a).then((function(t){var e=t.data;e.success?(i.fetchData(),i.props.dispatch({type:"shop/fetchShopList"})):(d().hideLoading(),i.setState({emptyInfo:{label:e.message,image:L},authStatus:y.Fail}))})).catch((function(t){d().hideLoading(),i.setState({emptyInfo:{label:t.message,image:L},authStatus:y.Fail})}))})),(0,h.Z)((0,c.Z)(i),"fetchData",(function(){d().showLoading({title:"加载数据中..."}),Promise.all([(0,g.Gj)(),(0,g.as)()]).then((function(t){var e=(0,n.Z)(t,2),a=e[0],o=e[1];i.setState({authToMeList:a.data.rows,authList:o.data.rows,fetched:!0}),d().hideLoading(),i.setState({fetched:!0})})).catch((function(){d().hideLoading()}))})),(0,h.Z)((0,c.Z)(i),"onCellClick",(function(t){Z.Z.navigateTo({url:"/subpackages/functional/pages/auth_detail/index?id=".concat(t.id)})})),(0,h.Z)((0,c.Z)(i),"onCellBtnClick",(function(t){(0,g.Si)(t.id).then((function(){w.Z.showToast("操作成功"),i.setState((function(e){return{authToMeList:e.authToMeList.filter((function(e){return e.id!==t.id}))}})),i.props.dispatch({type:"shop/fetchShopList"})}))})),i.state={authList:[],authToMeList:[],fetched:!1,authStatus:y.None,emptyInfo:{label:"暂无授权数据～"}},i}return(0,s.Z)(a,[{key:"UNSAFE_componentWillMount",value:function(){this.props.requireFollowPublic?this.setState({emptyInfo:{label:"请先关注".concat(I.Z.wxPublicName,"公众号再进行授权操作"),image:L}}):(d().showLoading({title:"加载中..."}),this.validatePage())}},{key:"componentDidShow",value:function(){this.state.fetched&&this.fetchData()}},{key:"componentDidUpdate",value:function(t){var e;!t.sessionId&&this.props.sessionId&&(0,v.JU)(null===(e=d().getCurrentInstance)||void 0===e?void 0:e.call(d())).q&&this.validatePage(),!t.requireFollowPublic&&this.props.requireFollowPublic&&(d().hideLoading(),this.setState({emptyInfo:{label:"请先关注".concat(I.Z.wxPublicName,"公众号再进行授权操作"),image:L}}))}},{key:"render",value:function(){var t=this,e=this.state,a=e.authToMeList,i=e.authList,n=e.fetched,o=e.authStatus,s=e.emptyInfo,c=this.props.requireFollowPublic,l=0===i.length&&0===a.length;return(0,S.jsxs)(f.View,{className:_,children:[a.length>0&&(0,S.jsxs)(f.View,{className:C,children:[(0,S.jsxs)(f.View,{className:k,children:["已获得以下用户的授权(","".concat(a.length,"/5"),")"]}),a.map((function(e){return(0,S.jsx)(x.Z,{data:e,showButton:!0,buttonLabel:"取消关联",onButtonClick:t.onCellBtnClick,showRem:!1},e.id)}))]}),i.length>0&&(0,S.jsxs)(f.View,{className:C,children:[(0,S.jsxs)(f.View,{className:k,children:["已授权以下用户","(".concat(i.length,"人)")]}),i.map((function(e){return(0,S.jsx)(x.Z,{data:e,showRightCaret:!0,onCellClick:t.onCellClick},e.id)}))]}),(l&&n||o===y.Fail||c)&&(0,S.jsx)(m.Z,{type:4,emptyInfo:s})]})}}]),a}(p.PureComponent),F=(0,b.$j)((function(t){var e=t.user;return{sessionId:e.sessionId,requireFollowPublic:e.requireFollowPublic}}))(P);Page((0,i.createPageConfig)(F,"subpackages/functional/pages/auth_history/index",{root:{cn:[]}},{navigationBarTitleText:"授权管理"}||{}))}},function(t){t.O(0,[9860,2107,1216,8592],(function(){return e=25264,t(t.s=e);var e}));t.O()}]);