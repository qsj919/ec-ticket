"use strict";require("../../sub-vendors.js");require("../../sub-common/c8e6ff30ff362003feb16a7df73a7387.js");require("../../sub-common/33aa75d7f7aee6c5c47f49e431bab56f.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[3072],{2079:function(e,a,o){var n=o(32180),l=o(18453),t=o(33661),i=o(12742),d=o(22700),s=o(95333),r=o(14175),c=o(3701),_=o(66058),u=o(92954),m=o.n(u),g=o(67294),p=o(75508),h=o(71515),w=o(80170),I=o(24962),f=o(43058),v=o(31254),N=o(6420),k=o(27863),b=o(48882),C=o(52010),x={header__btn:"image-module__header__btn___vU77D",header__btns:"image-module__header__btns___RA4gF",header:"image-module__header___kemFD",header__info:"image-module__header__info____k6ss",header__info__name:"image-module__header__info__name___bSaAA",header__info__code:"image-module__header__info__code___E7obU","header__btn--disabled":"image-module__header__btn--disabled___hyYn8",imgs__img:"image-module__imgs__img___Ypb38",video:"image-module__video___MCezx"},U=o(85893);function y(e){var a=e.data,o=a.code,n=a.name,l=a.allImgUrlBig,t=a.tenantSpuId,i=a.videoUrl,d=(a.coverUrl,e.onDownloadClick),s=e.onDownloadVideo,r=e.goodsLength,c=l&&l.split(",")||[];return(0,U.jsxs)(h.View,{children:[(0,U.jsxs)(h.View,{className:x.header,children:[(0,U.jsxs)(h.View,{className:x.header__info,children:[(0,U.jsx)(h.View,{className:x.header__info__name,children:n}),(0,U.jsx)(h.View,{className:x.header__info__code,children:o})]}),(0,U.jsxs)(h.View,{className:x.header__btns,children:[!!i&&(0,U.jsx)(h.View,{className:x.header__btn,onClick:function(){return s(i)},children:"下载视频"}),c.length>0&&r>1&&(0,U.jsx)(h.View,{className:x.header__btn,onClick:function(){return d(t)},children:"下载图片"})]})]}),(0,U.jsx)(h.View,{className:x.imgs,children:c.map((function(e){return(0,U.jsx)(h.Image,{mode:"aspectFill",className:x.imgs__img,src:e,onClick:function(){return m().previewImage({urls:c,current:e})}},e)}))})]})}y.defaultProps={data:{allImgUrlBig:""},onDownloadClick:function(){return null}};var Z="download-module__page___JLDA3",j="download-module__container___BRmxv",D="download-module__header___UONRj",V="download-module__header__logo___OxqDc",B="download-module__header__label___Npawl",S="download-module__header__btn___Gk27a",O="download-module__header__btn__icon___R_9Bb",A="download-module__download_all___TCNRv",E="download-module__download_all__icon___TmXqf",J="download-module__b___zMb2f",F="download-module__noti___h7gev",P="download-module__noti__label___pRUlW",T="download-module__noti__btn___Y1NAX",L="download-module__noti__btn__img___MMeqq",M="download-module__noti__cancel___Nv5OO",R=o(77550),q=function(e){(0,s.Z)(o,e);var a=(0,r.Z)(o);function o(e){var n,l;(0,t.Z)(this,o),l=a.call(this,e),(0,c.Z)((0,d.Z)(l),"getQuery",(function(){var e,a=l.state,o=a.shopName,n=a.shopLogo,t=a.cloudBillFlag,i=(0,N.JU)(null===(e=m().getCurrentInstance)||void 0===e?void 0:e.call(m())),d=i.mpErpId,s=i.sn,r=i.epid,c=l.props.sourceData,_=[];c.forEach((function(e){_.push(e.styleId||e.tenantSpuId)}));var u=c.map((function(e){return{name:e.name,code:e.code,allImgUrlBig:e.allImgUrlBig||e.imgUrl,tenantSpuId:e.styleId||e.tenantSpuId}}));return"?shopName=".concat(encodeURIComponent(o),"&logo=").concat(n,"&cloudBillFlag=").concat(t,"&mpErpId=").concat(d,"&styleIds=").concat(_.join(","),"&from=share&_sourceData=").concat(JSON.stringify(u),"&epid=").concat(c[0].epid||r,"&sn=").concat(c[0].sn||s)})),(0,c.Z)((0,d.Z)(l),"ignoreNotiClick",(function(){var e;m().setStorage({key:"".concat(v.tO.NO_NOTIFICATION_IMAGE,":").concat((0,N.JU)(null===(e=m().getCurrentInstance)||void 0===e?void 0:e.call(m())).mpErpId),data:!0}),l.setState({ignoreNoti:!0})})),(0,c.Z)((0,d.Z)(l),"downloadImages",(function(e){var a,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(0,N.JU)(null===(a=m().getCurrentInstance)||void 0===a?void 0:a.call(m())),t=n.sn,i=n.epid,d=n.pk,s=void 0===d?"":d;o||(w.Z.track(I.ZP.downloadImageClick,{sn:t,epid:i,pk:s,tenantspuId:String(e)}),w.Z.track(I.ZP.downloadImageDownloadClick)),m().showLoading({title:"获取图片资源..."}),l.props.dispatch({type:"imageDownload/fetchImageUrls",payload:{sn:t,epid:i,styleIds:e}})})),(0,c.Z)((0,d.Z)(l),"downloadVideo",(function(e){"https"!==e.substr(0,5)&&(e="https".concat(e.substr(4))),l.props.dispatch({type:"imageDownload/downloadSaveFiles",payload:{imageList:[e]}})})),(0,c.Z)((0,d.Z)(l),"downloadAllImages",(function(){var e,a=(0,N.JU)(null===(e=m().getCurrentInstance)||void 0===e?void 0:e.call(m())),o=a.sn,n=a.epid,t=a.pk,i=void 0===t?"":t;w.Z.track(I.ZP.downloadImageClick,{sn:o,epid:n,pk:i}),w.Z.track(I.ZP.downloadImageDownloadClick),l.props.sourceData.filter((function(e){return"string"==typeof e.allImgUrlBig&&""!==e.allImgUrlBig})).forEach((function(e){return l.downloadImages(e.tenantSpuId||e.styleId,!0)}))})),(0,c.Z)((0,d.Z)(l),"isImagesMoreThanOne",(function(){return l.props.sourceData.some((function(e){return e.allImgUrlBig&&e.allImgUrlBig.split(",").length>0}))})),(0,c.Z)((0,d.Z)(l),"onShareClick",(function(){w.Z.track(I.ZP.downloadImageInvitationClick)}));var i=(0,N.JU)(null===(n=m().getCurrentInstance)||void 0===n?void 0:n.call(m())),s=i.logo,r=i.shopName,_=i.cloudBillFlag;return l.state={shopLogo:decodeURIComponent(s),shopName:decodeURIComponent(r),cloudBillFlag:_,ignoreNoti:!1},l}return(0,i.Z)(o,[{key:"onShareAppMessage",value:function(e){var a=this.props.sourceData,o=a&&a[0].allImgUrlBig.split(",")[0];return"button"===e.from?{title:"亲爱的老板，该更新模特图啦",path:"subpackages/functional/pages/image_share/index",imageUrl:R}:{title:"".concat(this.state.shopName,"门店的商品相册"),path:"subpackages/functional/pages/download_image/index".concat(this.getQuery()),imageUrl:o||R}}},{key:"componentDidMount",value:function(){var e,a,o=this;m().getStorage({key:"".concat(v.tO.NO_NOTIFICATION_IMAGE,":").concat((0,N.JU)(null===(e=m().getCurrentInstance)||void 0===e?void 0:e.call(m())).mpErpId)}).then((function(e){o.setState({ignoreNoti:e.data})})).catch((function(){}));var n=(0,N.JU)(null===(a=m().getCurrentInstance)||void 0===a?void 0:a.call(m())),t=n.mpErpId,i=n.styleIds,d=n._sourceData,s=n.from,r=decodeURIComponent(d);"share"===s&&this.props.dispatch({type:"imageDownload/fetchImageUrlsFormatData",payload:{mpErpId:t,styleIds:i,sourceData:(0,l.Z)(JSON.parse(r))}})}},{key:"componentDidUpdate",value:function(){var e=this.props,a=e.downLoadding,o=e.percent;a&&m().showLoading({title:"正在下载第".concat(o+1,"个图片/视频")})}},{key:"componentWillUnmount",value:function(){this.props.dispatch({type:"imageDownload/reset"})}},{key:"render",value:function(){var e=this,a=this.props.sourceData,o=this.state,n=o.shopLogo,l=o.shopName,t=o.cloudBillFlag,i=o.ignoreNoti,d=1===a.length&&a.some((function(e){return e.allImgUrlBig.split(",").length<=1})),s=a.length<=1&&a.some((function(e){return""===e.allImgUrlBig}));return(0,U.jsxs)(h.View,{className:Z,children:[(0,U.jsxs)(h.View,{className:D,children:[(0,U.jsx)(h.Image,{className:V,src:n||b}),(0,U.jsx)(h.View,{className:B,children:l}),Number(t)===k.PC.open&&(0,U.jsxs)(h.View,{className:S,onClick:function(){var a;e.props.dispatch({type:"cloudBill/init",payload:{mpErpId:Number((0,N.JU)(null===(a=m().getCurrentInstance)||void 0===a?void 0:a.call(m())).mpErpId)}}),m().navigateTo({url:"/subpackages/cloud_bill/pages/all_goods/index"})},children:[(0,U.jsx)(h.Image,{className:O,src:f}),"进店"]})]}),(0,U.jsx)(h.View,{className:j,children:a.map((function(o){return(0,U.jsx)(h.View,{className:J,children:(0,U.jsx)(y,{data:o,onDownloadClick:e.downloadImages,onDownloadVideo:e.downloadVideo,goodsLength:a.length})},o.tenantSpuId)}))}),(0,U.jsxs)(h.View,{className:A,onClick:function(){return!s&&e.downloadAllImages()},style:{background:"".concat(s?"gray":"linear-gradient(137deg, #ff788f 0%, #e62e4d 100%)")},children:[(0,U.jsx)(h.Image,{src:C,className:E}),"一键下载所有图片"]}),!i&&d&&(0,U.jsxs)(h.View,{className:F,children:[(0,U.jsxs)(h.Button,{openType:"share",className:T,onClick:this.onShareClick,children:[(0,U.jsx)(h.Image,{src:"https://webdoc.hzecool.com/webCdn/weapp/ec-ticket/src/subpackages/functional/pages/download_image/images/fd64c011b5fe1208b6ab..png",className:L}),(0,U.jsx)(h.View,{className:P,children:"去通知"})]}),(0,U.jsx)(h.View,{className:M,onClick:this.ignoreNotiClick,children:"此商家不再提醒"})]})]})}}]),o}(g.PureComponent);(0,c.Z)(q,"defaultProps",{sourceData:[]});var z=(0,p.$j)((function(e){var a=e.imageDownload;return(0,_.Z)({},a)}))(q);z.enableShareAppMessage=!0;Page((0,n.createPageConfig)(z,"subpackages/functional/pages/download_image/index",{root:{cn:[]}},{navigationBarTitleText:"商品相册"}||{}))}},function(e){e.O(0,[9860,1683,1459,2107,1216,8592],(function(){return a=2079,e(e.s=a);var a}));e.O()}]);