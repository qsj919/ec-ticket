"use strict";require("../../sub-vendors.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[8160],{84106:function(e,s,a){var n=a(32180),i=a(33661),t=a(12742),o=a(22700),c=a(95333),l=a(14175),d=a(3701),h=a(92954),r=a.n(h),m=a(67294),_=a(71515),p=a(89728),u=a(65941),C=a(91629),g=a(29748),w=a(6420),x=a(48882),N="shopChange-module__modalWrapper___NiYfo",j="shopChange-module__modal___FDXpu",k="shopChange-module__body___uatMS",f="shopChange-module__list___Om461",V="shopChange-module__scrollView___ZZFDe",v="shopChange-module__shopItem___XRQe_",S="shopChange-module__shopInfo___yy5X7",I="shopChange-module__shopLogo___en1Xq",Z="shopChange-module__check___NlG4W",b="shopChange-module__noData___Ihpi7",y="shopChange-module__btns___tHuYP",D="shopChange-module__cancle___jmeVS",B="shopChange-module__confirm___cHxo_",E=a(85893),L=function(e){(0,c.Z)(a,e);var s=(0,l.Z)(a);function a(e){var n;(0,i.Z)(this,a),n=s.call(this,e),(0,d.Z)((0,o.Z)(n),"onMaskClick",(function(e){e.preventDefault(),e.stopPropagation()})),(0,d.Z)((0,o.Z)(n),"shopItemClick",(function(e,s){n.setState({shopItem:e,isCheck:s})}));for(var t=0,c=0;c<e.dataList.length;c++){if(e.dataList[c].shopid==e.shopId){t=c;break}}return n.state={isCheck:t,shopItem:e.dataList[t]},n}return(0,t.Z)(a,[{key:"render",value:function(){var e=this,s=this.state,a=s.isCheck,n=s.shopItem,i=this.props,t=i.dataList,o=i.onConfirm,c=i.onCancel;return(0,E.jsxs)(_.View,{className:N,onTouchMove:this.onMaskClick,children:[(0,E.jsx)(_.View,{className:j}),(0,E.jsxs)(_.View,{className:k,children:[(0,E.jsx)(_.View,{className:f,children:t.length>0?(0,E.jsx)(_.ScrollView,{scrollY:!0,className:V,children:t.map((function(s,n){return(0,E.jsxs)(_.View,{className:v,onClick:e.shopItemClick.bind(e,s,n),children:[(0,E.jsxs)(_.View,{className:S,children:[(0,E.jsx)(_.Image,{src:s.logoUrl?s.logoUrl:x,className:I}),(0,E.jsx)(_.View,{children:s.shopName})]}),a===n&&(0,E.jsx)(_.View,{className:Z,children:(0,E.jsx)(_.View,{className:"at-icon at-icon-check"})})]},s.id)}))}):(0,E.jsx)(_.View,{className:b,children:"暂无数据"})}),(0,E.jsxs)(_.View,{className:y,children:[(0,E.jsx)(_.View,{className:D,onClick:function(){c()},children:"取 消"}),(0,E.jsx)(_.View,{className:B,onClick:function(){o(n)},children:"确 定"})]})]})]})}}]),a}(m.Component);(0,d.Z)(L,"defaultProps",{dataList:[]});var T="index-module__mergeBillWrapper___AuG1U",M="index-module__top___vjQNu",P="index-module__body___WZQBL",U="index-module__bodyItem___LIdQS",G="index-module__right___jjxlo",Q="index-module__check___YaF04",W="index-module__unCheck___IBXps",X="index-module__btn___Dva9V",F="index-module__confirm___m4Enm",Y="index-module__noDataPage___eNqqC",q="index-module__img___LQetw",J=function(e){(0,c.Z)(a,e);var s=(0,l.Z)(a);function a(e){var n,t;(0,i.Z)(this,a),t=s.call(this,e),(0,d.Z)((0,o.Z)(t),"onShopChangeClick",(function(){t.setState({showShopChange:!0})})),(0,d.Z)((0,o.Z)(t),"onCancelClick",(function(){t.setState({showShopChange:!1})})),(0,d.Z)((0,o.Z)(t),"onConfirmClick",(function(e){t.setState((function(s){return{params:{sessionId:s.params.sessionId,subscribe:s.params.subscribe,shopName:e.shopName,shopId:e.shopid,epid:e.epid,sn:e.sn},showShopChange:!1}}),(function(){t.isBtnCanClick()}))})),(0,d.Z)((0,o.Z)(t),"onMergeTypeClick",(function(e){var s=(0,w.GB)();if("month"===e){var a=s.split("-");s="".concat(a[0],"-").concat(a[1])}t.setState({type:e,dateStart:s,dateEnd:s},(function(){t.isBtnCanClick()}))})),(0,d.Z)((0,o.Z)(t),"isBtnCanClick",(function(){var e=t.state,s=e.dateEnd,a=e.dateStart,n=e.params;a&&s&&n.shopId?t.setState({canClick:!0}):t.setState({canClick:!1})})),(0,d.Z)((0,o.Z)(t),"onDateStartChange",(function(e){var s=t.state.dateEnd;s?new Date(e.detail.value.replace(/-/g,"/")).getTime()>new Date(s.replace(/-/g,"/")).getTime()?r().showToast({title:(0,u.t)("dateGtTip"),icon:"none",duration:3e3}):t.setState({dateStart:e.detail.value},(function(){t.isBtnCanClick()})):t.setState({dateStart:e.detail.value},(function(){t.isBtnCanClick()}))})),(0,d.Z)((0,o.Z)(t),"onDateEndChange",(function(e){var s=t.state.dateStart;s?new Date(s.replace(/-/g,"/")).getTime()>new Date(e.detail.value.replace(/-/g,"/")).getTime()?r().showToast({title:(0,u.t)("dateLtTip"),icon:"none",duration:3e3}):t.setState({dateEnd:e.detail.value},(function(){t.isBtnCanClick()})):t.setState({dateEnd:e.detail.value},(function(){t.isBtnCanClick()}))})),(0,d.Z)((0,o.Z)(t),"onMergePageClick",(function(){var e=t.state,s=e.params,a=e.canClick,n=e.dateStart,i=e.dateEnd,o=e.type,c="",l="";if("day"===o)c=n,l=i;else if("month"===o){c="".concat(n,"-01");var d=(0,w.nx)(i).getDate();l="".concat(i,"-").concat(d)}var h="sn=".concat(s.sn,"&epid=").concat(s.epid,"&sessionId=").concat(s.sessionId,"&shopId=").concat(s.shopId,"&shopName=").concat(s.shopName,"&dateStart=").concat(c,"&dateEnd=").concat(l);a&&C.Z.navigateTo({url:"/pages/mergeBill/mergeBill?".concat(h)})}));var c=(0,w.JU)(null===(n=r().getCurrentInstance)||void 0===n?void 0:n.call(r()));return void 0===c.shopName?c.shopName="":c.shopName=decodeURIComponent(c.shopName),t.state={showNoData:!1,type:"day",showShopChange:!1,shopList:[],dateStart:"",dateEnd:"",canClick:!1,params:{subscribe:c.subscribe,sessionId:c.sessionId,shopName:c.shopName||"",shopId:c.shopId,epid:c.epid,sn:c.sn}},t}return(0,t.Z)(a,[{key:"UNSAFE_componentWillMount",value:function(){var e=this,s=this.state.params,a=(0,w.GB)();(0,g.IU)({sessionId:s.sessionId}).then((function(n){var i=n.data.rows||[],t=i[0];i.length>0?e.setState({shopList:n.data.rows,params:{sessionId:s.sessionId,subscribe:s.subscribe,shopName:t.shopName,shopId:t.shopid,epid:t.epid,sn:t.sn},dateStart:a,dateEnd:a},(function(){e.isBtnCanClick()})):e.setState({showNoData:!0})})).catch((function(e){return console.log(e)}))}},{key:"render",value:function(){var e=this.state,s=e.showNoData,a=e.type,n=e.showShopChange,i=e.shopList,t=e.dateStart,o=e.dateEnd,c=e.canClick,l=e.params;return(0,E.jsxs)(_.View,{children:[!s&&(0,E.jsxs)(_.View,{className:T,children:[(0,E.jsx)(_.View,{className:M,children:(0,E.jsx)(_.View,{children:"小票汇总"})}),(0,E.jsxs)(_.View,{className:P,children:[(0,E.jsxs)(_.View,{className:U,children:[(0,E.jsx)(_.View,{children:"店铺"}),(0,E.jsxs)(_.View,{className:G,onClick:this.onShopChangeClick,children:[(0,E.jsx)(_.View,{children:l.shopName?l.shopName:"选择店铺"}),(0,E.jsx)(_.View,{className:"at-icon at-icon-chevron-right"})]})]}),(0,E.jsxs)(_.View,{className:U,children:[(0,E.jsx)(_.View,{children:"汇总方式"}),(0,E.jsxs)(_.View,{className:G,onClick:this.onMergeTypeClick.bind(this,"day"),children:[(0,E.jsx)(_.View,{className:"day"===a?Q:W,children:(0,E.jsx)(_.View,{className:"at-icon at-icon-check"})}),(0,E.jsx)(_.View,{children:"按日"})]}),(0,E.jsxs)(_.View,{className:G,onClick:this.onMergeTypeClick.bind(this,"month"),children:[(0,E.jsx)(_.View,{className:"month"===a?Q:W,children:(0,E.jsx)(_.View,{className:"at-icon at-icon-check"})}),(0,E.jsx)(_.View,{children:"按月"})]})]}),(0,E.jsxs)(_.View,{className:U,children:[(0,E.jsx)(_.View,{children:"开始日期"}),(0,E.jsx)(_.Picker,{mode:"date",fields:a,value:t,onChange:this.onDateStartChange,children:(0,E.jsxs)(_.View,{className:G,children:[(0,E.jsx)(_.View,{children:t||"选择日期"}),(0,E.jsx)(_.View,{className:"at-icon at-icon-chevron-right"})]})})]}),(0,E.jsxs)(_.View,{className:U,children:[(0,E.jsx)(_.View,{children:"结束日期"}),(0,E.jsx)(_.Picker,{mode:"date",fields:a,value:o,onChange:this.onDateEndChange,children:(0,E.jsxs)(_.View,{className:G,children:[(0,E.jsx)(_.View,{children:o||"选择日期"}),(0,E.jsx)(_.View,{className:"at-icon at-icon-chevron-right"})]})})]})]}),(0,E.jsx)(_.View,{className:X,children:(0,E.jsxs)(_.View,{className:F,style:c?{}:{opacity:.49},onClick:this.onMergePageClick,children:[" ","确定"]})}),n&&(0,E.jsx)(L,{shopId:l.shopId,dataList:i,onCancel:this.onCancelClick,onConfirm:this.onConfirmClick})]}),s&&(0,E.jsxs)(_.View,{className:Y,children:[(0,E.jsx)(_.Image,{src:p,className:q}),(0,E.jsx)(_.View,{children:"暂无数据"})]})]})}}]),a}(m.Component);Page((0,n.createPageConfig)(J,"subpackages/mine/pages/mergeBill/index",{root:{cn:[]}},{}||{}))}},function(e){e.O(0,[2107,1216,8592],(function(){return s=84106,e(e.s=s);var s}));e.O()}]);