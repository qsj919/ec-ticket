"use strict";require("../../sub-vendors.js");require("../../sub-common/ea5651c74a764b7a53f5764aba833936.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[2266],{89016:function(e,t,i){var a=i(32180),n=i(18453),s=i(33661),o=i(12742),l=i(22700),r=i(95333),c=i(14175),d=i(3701),p=i(92954),u=i.n(p),h=i(67294),m=i(29748),f=i(75508),g=i(71515),v=i(1695),_=i(4385),y=i(63056),x=i(91629),C=i(14067),w=i(6420),V=i(27484),N=i.n(V),Z=i(79262),b=i(96486),S=i(94184),k=i.n(S),j=i(85893),I=function(e){(0,r.Z)(i,e);var t=(0,c.Z)(i);function i(){return(0,s.Z)(this,i),t.apply(this,arguments)}return(0,o.Z)(i,[{key:"render",value:function(){var e=this.props,t=e.title,i=e.isSelected,a=e.onClick,n=e.customStyle;return(0,j.jsx)(g.View,{className:i?"filter-button_selected":"filter-button",onClick:a,style:n,children:(0,j.jsx)(g.Text,{className:"filter-button__text ".concat(i?"filter-button__text--selected":"filter-button__text--normal"),children:t})})}}]),i}(h.PureComponent);(0,d.Z)(I,"defaultProps",{isSelected:!1});var A=function(e){(0,r.Z)(i,e);var t=(0,c.Z)(i);function i(e){var a;(0,s.Z)(this,i),a=t.call(this,e);var n=e.items,o=void 0===n?[]:n,l=e.wrapLines,r=void 0===l?2:l,c=o.length/3>r;return a.state={isCollapse:!1,showCollapse:c},a}return(0,o.Z)(i,[{key:"UNSAFE_componentWillReceiveProps",value:function(e,t){if(e.items!==this.props.items){var i=e.items.length/3>e.wrapLines;this.setState({showCollapse:i})}}},{key:"onItemClick",value:function(e){var t=this.props,i=t.onClick,a=t.typeValue;i&&i(a,e)}},{key:"onCollapse",value:function(){this.setState({isCollapse:!this.state.isCollapse})}},{key:"render",value:function(){var e=this,t=this.props,i=t.typeName,a=t.items,n=this.state,s=n.isCollapse,o=n.showCollapse,l=a;return o&&s&&(l=a.slice(0,3)),(0,j.jsx)(g.View,{children:l&&l.length>0&&(0,j.jsxs)(g.View,{className:"filter-tag-view",children:[(0,j.jsxs)(g.View,{className:"filter-tag-view__header",children:[(0,j.jsx)(g.Text,{className:"filter-tag-view__header__title",children:i}),o&&(0,j.jsx)(g.Image,{className:k()("filter-tag-view__header__action",(0,d.Z)({},"filter-tag-view__header__action--default",s)),src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAP1BMVEUAAAAAAACAgICqqqqAgICfn5+dnZ2YmJibm5uYmJiYmJiYmJiZmZmZmZmZmZmZmZmZmZmZmZmYmJiZmZmZmZm+JTm+AAAAFHRSTlMAAQIDBBgaKi4vNDlfZqOq7u/x8TcvbYsAAABYSURBVDjLY2AYBbQBbKz45bmFBLjwyguLiAhy4ZXn48ejAiTPzIJbBViegQGnCqg8ThVweRwqkOSxquBEloeoYEdRwIsiD1bBg6KAkZMR1UgmjtFkR2UAAIZLBLVEqEeNAAAAAElFTkSuQmCC",onClick:this.onCollapse.bind(this)})]}),(0,j.jsx)(g.View,{className:"filter-tag-view__tags",children:l.map((function(t){return(0,j.jsx)(I,{title:t.codeName,isSelected:t.isSelected,onClick:e.onItemClick.bind(e,t),customStyle:"margin-bottom: ".concat(u().pxTransform(32),"; margin-right: ").concat(u().pxTransform(20),";")},"codeValue")}))}),(0,j.jsx)(g.View,{className:"filter-tag-view__divider"})]})})}}]),i}(h.PureComponent);(0,d.Z)(A,"defaultProps",{items:[]});var T=i(16269),P=N()().format("YYYY-MM-DD"),O=function(e){(0,r.Z)(i,e);var t=(0,c.Z)(i);function i(e){var a;(0,s.Z)(this,i),a=t.call(this,e),(0,d.Z)((0,l.Z)(a),"onStartChange",(function(e){var t=a.props,i=t.onValueChanged,n=t.typeValue,s=t.endValue,o=void 0===s?"":s,l=e.detail.value;if(!l)return a.state.startTime;a.setState({startTime:l}),i(n,l,o)})),(0,d.Z)((0,l.Z)(a),"onEndChange",(function(e){var t=a.props,i=t.onValueChanged,n=t.typeValue,s=t.startValue,o=void 0===s?"":s,l=e.detail.value;if(!l)return a.state.endTime;a.setState({endTime:l}),i(n,o,l)})),(0,d.Z)((0,l.Z)(a),"onItemClick",(function(e,t){var i=a.props;(0,i.onValueChanged)(i.typeValue,N()().subtract(e.day1,"days").format("YYYY-MM-DD"),N()().subtract(e.day2,"days").format("YYYY-MM-DD"),t)}));var n=e.startValue,o=void 0===n?"":n,r=e.endValue,c=void 0===r?"":r;return a.state={start:o,end:c,startTime:o,endTime:c},a}return(0,o.Z)(i,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=e.startValue,i=void 0===t?"":t,a=e.endValue,n=void 0===a?"":a;this.setState({start:i,end:n,startTime:i,endTime:n})}},{key:"onStartValueChanged",value:function(e){var t=this.props,i=t.onValueChanged,a=t.typeValue,n=t.endValue,s=void 0===n?"":n;if(!T.Z.isNumber(e.detail.value))return this.state.start;this.setState({start:e.detail.value}),i(a,e.detail.value,s)}},{key:"onEndValueChanged",value:function(e){var t=this.props,i=t.onValueChanged,a=t.typeValue,n=t.startValue,s=void 0===n?"":n;if(!T.Z.isNumber(e.detail.value))return this.state.end;this.setState({end:e.detail.value}),i(a,s,e.detail.value)}},{key:"render",value:function(){var e=this,t=this.props,i=t.typeName,a=t.typeValue,n=t.startPlaceholder,s=t.endPlaceholder,o=t.buttonValue,l=this.state,r=l.start,c=l.end,d=l.startTime,p=l.endTime,h=17===a;return(0,j.jsxs)(g.View,{className:"filter-range-view",style:h?"margin-bottom: 20px":"",children:[(0,j.jsx)(g.View,{className:"filter-range-view__header",children:(0,j.jsx)(g.Text,{className:"filter-range-view__header__title",children:i})}),(0,j.jsx)(g.View,{className:"filter-tag-view__tags",children:[{codeName:"今日",day1:0,day2:0},{codeName:"昨日",day1:1,day2:1},{codeName:"近7日",day1:7,day2:0},{codeName:"近30日",day1:30,day2:0}].map((function(t,i){return(0,j.jsx)(I,{title:t.codeName,isSelected:o===i,onClick:e.onItemClick.bind(e,t,i),customStyle:"margin-bottom: ".concat(u().pxTransform(32),"; margin-right: ").concat(u().pxTransform(20),";")},"codeValue")}))}),(0,j.jsxs)(g.View,{className:"filter-range-view__main",children:[!h&&(0,j.jsx)(g.Input,{type:"digit",className:"filter-range-view__main__input",placeholder:n,value:r,placeholderStyle:"font-size: 15px; color: #cccccc; text-align: center;",onInput:this.onStartValueChanged.bind(this)}),h&&(0,j.jsx)(g.View,{className:"filter-range-view__main__picker",children:(0,j.jsx)(g.Picker,{className:"picker",mode:"date",value:d,start:"1900-09-01",end:P,onChange:this.onStartChange,children:(0,j.jsx)(g.View,{className:d?"has_text":"text",children:d||"开始日期"})})}),(0,j.jsx)(g.View,{className:"filter-rang-view__main__divider"}),!h&&(0,j.jsx)(g.Input,{type:"digit",className:"filter-range-view__main__input",placeholder:s,value:c,disabled:h,placeholderStyle:"font-size: 15px; color: #cccccc; text-align: center;",onInput:this.onEndValueChanged.bind(this)}),h&&(0,j.jsx)(g.View,{className:"filter-range-view__main__picker",children:(0,j.jsx)(g.Picker,{className:"picker",mode:"date",value:p,start:"1900-09-01",end:P,onChange:this.onEndChange,children:(0,j.jsx)(g.View,{className:p?"has_text":"text",children:p||"结束日期"})})})]}),!h&&(0,j.jsx)(g.View,{className:"filter-tag-view__divider"})]})}}]),i}(h.PureComponent),L=function(e){(0,r.Z)(i,e);var t=(0,c.Z)(i);function i(e){var a;(0,s.Z)(this,i),a=t.call(this,e);var n=e.configOptions,o=void 0===n?[]:n;return a.state={defaultOptions:o,options:(0,b.cloneDeep)(o),displayOptions:(0,b.cloneDeep)(o)},a}return(0,o.Z)(i,[{key:"UNSAFE_componentWillReceiveProps",value:function(e,t){var i=e.configOptions,a=e.updateOption;if(i!==this.props.configOptions&&0===this.state.defaultOptions.length&&this.setState({defaultOptions:i,options:(0,b.cloneDeep)(i),displayOptions:(0,b.cloneDeep)(i)}),a!==this.props.updateOption&&a){var n=(0,b.cloneDeep)(this.state.displayOptions);n.find((function(e){return e.typeValue===a.typeValue}))&&n.splice(a.position,1),a.isRemove||n.splice(a.position,0,(0,b.cloneDeep)(a)),this.setState({displayOptions:n})}}},{key:"componentDidMount",value:function(){var e=this;u().eventCenter.on("resetData",(function(){e.onReset()}))}},{key:"componentWillUnmount",value:function(){u().eventCenter.off("resetData")}},{key:"onItemClick",value:function(e,t){var i=this,a=(0,b.cloneDeep)(this.state.displayOptions),n=a.find((function(t){return t.typeValue===e}));if(n){var s,o=(0,Z.Z)(n.items);try{for(o.s();!(s=o.n()).done;){var l=s.value;if(l.codeValue===t.codeValue){if(l.isSelected=!t.isSelected,n.multipleSelect)break}else t.isSelected||n.multipleSelect||(l.isSelected=!1)}}catch(e){o.e(e)}finally{o.f()}this.setState({displayOptions:a},(function(){i.props.onItemChanged&&i.props.onItemChanged((0,b.cloneDeep)(n))}))}}},{key:"onRangeValueChanged",value:function(e,t,i,a){var n=(0,b.cloneDeep)(this.state.displayOptions),s=n.find((function(t){return t.typeValue===e}));if(s&&"range"===s.type){var o=s.items;o[0]=t,o[1]=i,o[4]=void 0!==a?a:-1,this.setState({displayOptions:n})}}},{key:"onInputChanged",value:function(e){var t=(0,b.cloneDeep)(this.state.displayOptions),i=t.find((function(e){return"input"===e.type}));i&&(i.items[0]=e.target.value,this.setState({displayOptions:t}))}},{key:"onClose",value:function(){this.setState({displayOptions:(0,b.cloneDeep)(this.state.options)}),this.props.onClose()}},{key:"onReset",value:function(){this.setState({displayOptions:(0,b.cloneDeep)(this.state.defaultOptions)})}},{key:"onConfirm",value:function(){var e=this.state.displayOptions[0].items;if(e[0]&&e[1]){var t=N()(e[0]),i=N()(e[1]);if(t.diff(i)>0)return void y.Z.showToast("开始时间选择不能晚于结束时间！")}this.setState({options:(0,b.cloneDeep)(this.state.displayOptions)}),this.props.onValueChanged((0,b.cloneDeep)(this.state.displayOptions)),this.props.onClose()}},{key:"render",value:function(){var e=this,t=this.props,i=(t.isOpened,t.wrapLines),a=t.statusBarHeight,n=this.state.displayOptions;return(0,j.jsxs)(g.View,{className:"filter-view",children:[(0,j.jsx)(g.View,{className:"filter-view__content",style:a?"top: ".concat(44+a,"px"):"",children:(0,j.jsx)(g.ScrollView,{scrollY:!0,style:"height: 100%;",children:n.map((function(t,a){return"input"===t.type?(0,j.jsxs)(g.View,{className:"filter-input-view",children:[(0,j.jsx)(g.Text,{className:"filter-input-view__title",children:t.typeName}),(0,j.jsx)(g.Input,{className:"filter-input-view__input",placeholder:"请输入"+t.typeName,value:t.items[0],placeholderStyle:"font-size: 15px; color: #cccccc; text-align: center;",onInput:e.onInputChanged.bind(e)})]}):"tag"===t.type?(0,j.jsx)(A,{typeName:t.typeName,typeValue:t.typeValue,items:t.items,wrapLines:i,onClick:e.onItemClick.bind(e)},"typeValue"):(0,j.jsx)(O,{typeName:t.typeName,typeValue:t.typeValue,startValue:t.items[0],endValue:t.items[1],startPlaceholder:t.items[2],endPlaceholder:t.items[3],buttonValue:t.items[4],onValueChanged:e.onRangeValueChanged.bind(e)},"typeValue")}))})}),(0,j.jsx)(g.View,{className:"bottom_view_wrap",children:(0,j.jsxs)(g.View,{className:"filter-view__action-button",children:[(0,j.jsx)(g.View,{className:"filter-view__action-button__reset",onClick:this.onReset.bind(this),children:(0,j.jsx)(g.Text,{className:"filter-view__action-button__reset___text",children:"重置"})}),(0,j.jsx)(g.View,{className:"filter-view__action-button__confirm",onClick:this.onConfirm.bind(this),children:(0,j.jsx)(g.Text,{className:"filter-view__action-button__confirm___text",children:"确认"})})]})})]})}}]),i}(h.PureComponent);(0,d.Z)(L,"defaultProps",{wrapLines:2});var D=L,E=i(48882),Y=i(27863),R=function(e){(0,r.Z)(i,e);var t=(0,c.Z)(i);function i(){var e;(0,s.Z)(this,i);for(var a=arguments.length,n=new Array(a),o=0;o<a;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n)),(0,d.Z)((0,l.Z)(e),"onClick",(function(){var t=e.props,i=t.onItemClick,a=t.item;i&&i(a)})),(0,d.Z)((0,l.Z)(e),"orderCancel",(function(t){var i=e.props.orderCancel;t.stopPropagation(),i(e.state.item.billId)})),(0,d.Z)((0,l.Z)(e),"addShoppingCart",(function(t){var i=e.props.addShoppingCart;t.stopPropagation(),i(e.state.item.billId)})),(0,d.Z)((0,l.Z)(e),"onPayClick",(function(t){t.stopPropagation(),e.props.onPayPropsClick&&e.props.onPayPropsClick(e.state.item.billId,e.state.item.mpErpId)})),e}return(0,o.Z)(i,[{key:"render",value:function(){var e,t=this.props,i=t.item,a=t.orderPay;return i.extProps&&(e=JSON.parse(i.extProps)),(0,j.jsxs)(g.View,{onClick:this.onClick,className:"item",children:[(0,j.jsxs)(g.View,{className:"item__header",children:[(0,j.jsxs)(g.View,{className:"item__header__left",children:[(0,j.jsx)(g.Image,{className:"item__header__left__img",src:i.logoUrl||E}),(0,j.jsx)(g.Text,{className:"item__header__left__text",children:i.shopName})]}),(0,j.jsx)(g.Text,{className:"item__header__status",children:i.flagName})]}),(0,j.jsx)(g.View,{className:"item__img",children:i.styleImg&&i.styleImg.map((function(e){return(0,j.jsx)(g.Image,{src:e,className:"item__img__item",mode:"aspectFill"},e)}))}),(0,j.jsxs)(g.View,{className:"item__total",children:["共",i.totalNum,"件 总金额: ",(0,j.jsx)(g.Text,{children:"¥"}),(0,j.jsx)(g.Text,{children:i.totalMoney})]}),(0,j.jsxs)(g.View,{className:"item__bottom",children:[(0,j.jsx)(g.Text,{className:"item__bottom__text",children:i.proTime&&i.proTime.split(" ")[0]}),(0,j.jsxs)(g.View,{className:"aic",children:[i.flag>=0&&0===i.deliverFlag&&i.payStatus!==Y.aU.WAITING&&(0===e.billSrc||1===e.billSrc&&a)&&(0,j.jsx)(g.View,{className:"item__bottom__button",onClick:this.orderCancel,children:"取消订货"}),(0,j.jsx)(g.View,{className:"item__bottom__button",onClick:this.addShoppingCart,children:"再补一单"})]}),i.payStatus===Y.aU.WAITING&&i.flag>=0&&a&&(0,j.jsx)(g.View,{className:"item__bottom__button",onClick:this.onPayClick,children:"立即支付"})]})]},i.billno)}}]),i}(h.PureComponent);(0,d.Z)(R,"defaultProps",{item:{details:{sub:[]}},orderPay:!1});var F=function(e){(0,r.Z)(i,e);var t=(0,c.Z)(i);function i(e){var a;return(0,s.Z)(this,i),a=t.call(this,e),(0,d.Z)((0,l.Z)(a),"onTabClick",(function(e){a.setState({activeTabIndex:e},(function(){a.onRefresh()}))})),(0,d.Z)((0,l.Z)(a),"onNewScrollEnd",(function(){a.state.orderList.length<a.state.total&&a.setState((function(e){return{pageNo:e.pageNo+1}}),(function(){a.getOrderList()}))})),(0,d.Z)((0,l.Z)(a),"onCheckDetailClick",(function(e){var t=a.state.activeTabIndex,i=e.billId,n=0;1===t?n=2:2===t?n=3:3===t&&(n=1);var s=a.state.orderPay,o="billId=".concat(i,"&type=").concat(n,"&mpErpId=").concat(e.mpErpId,"&orderPay=").concat(s);x.Z.navigateTo({url:"/subpackages/mine/pages/order_list/order_list_detail/index?".concat(o)})})),(0,d.Z)((0,l.Z)(a),"addShoppingCart",(function(e){(0,m.DH)(e).then((function(e){u().hideLoading(),y.Z.showAlertWithCancel("商品已加入进货车,是否前往进货车？","",(function(){u().switchTab({url:"/pages/stock_bar/index"})}))})).catch((function(e){console.log("err :",e)}))})),(0,d.Z)((0,l.Z)(a),"orderCancel",(function(e){y.Z.showAlertWithCancel("确认取消订单？取消后订单将作废","",(function(){(0,m.nt)(e).then((function(e){u().hideLoading(),a.onRefresh()})).catch((function(e){console.log("err :",e)}))}))})),(0,d.Z)((0,l.Z)(a),"showFilterView",(function(){a.setState({isFilterVisible:!0})})),(0,d.Z)((0,l.Z)(a),"hideFilterView",(function(){a.setState({isFilterVisible:!1})})),(0,d.Z)((0,l.Z)(a),"onFilterValueChanged",(function(e){a.setState({filterOptions:e},(function(){a.onRefresh()}))})),(0,d.Z)((0,l.Z)(a),"onPayClick",(function(e,t){var i=(0,l.Z)(a);u().showLoading({title:"请稍等..."}),(0,m.Nf)({mpErpId:t,billId:e}).then((function(e){var t=e.data;wx.requestPayment({timeStamp:t.timeStamp,nonceStr:t.nonceStr,package:t.package,signType:t.signType,paySign:t.paySign,success:function(e){u().hideLoading(),i.onRefresh()},fail:function(e){u().hideLoading()}})})).catch((function(e){u().hideLoading()}))})),a.state={orderList:[],orderLoading:!1,pageNo:1,total:0,activeTabIndex:0,isFilterVisible:!1,orderPay:!1,filterOptions:[{typeValue:17,type:"range",typeName:"日期",multipleSelect:!1,items:[]},{typeValue:17,type:"input",typeName:"档口名称",multipleSelect:!1,items:[]}]},a}return(0,o.Z)(i,[{key:"componentDidMount",value:function(){var e,t=this,i=(0,w.JU)(null===(e=u().getCurrentInstance)||void 0===e?void 0:e.call(u())).activeTabIndex;i&&this.setState({activeTabIndex:Number(i)}),this.setState({orderLoading:!0}),this.props.mpErpId&&(0,C._9)({code:"order_pay",mpErpId:this.props.mpErpId}).then((function(e){var i=e.data;t.setState({orderPay:"1"===i.val})}))}},{key:"componentDidShow",value:function(){var e=u().getCurrentPages(),t=e[e.length-1];t.__data__&&t.__data__.cancelBillFlag&&(this.onRefresh(),t.setData({cancelBillFlag:0}))}},{key:"onRefresh",value:function(){var e=this;this.setState({orderLoading:!0,pageNo:1,total:0,orderList:[]},(function(){e.getOrderList()}))}},{key:"getOrderList",value:function(){var e=this,t=this.state,i=t.activeTabIndex,a=t.pageNo,s=t.filterOptions,o={type:0,pageNo:a};1===i?o.type=2:2===i?o.type=3:3===i&&(o.type=1);var l=s[0].items;l[0]&&(o.proTimeStart=l[0]),l[1]&&(o.proTimeEnd=N()(l[1]).add(1,"days").format("YYYY-MM-DD"));var r=s[1].items;r[0]&&(o.searchKey=r[0]),(0,m.Fw)(o).then((function(t){u().hideLoading(),1===a?e.setState({orderList:t.data.rows,pageNo:a,total:t.data.total,orderLoading:!1}):e.setState((function(e){return{orderList:[].concat((0,n.Z)(e.orderList),(0,n.Z)(t.data.rows)),pageNo:a,total:t.data.total,orderLoading:!1}}))})).catch((function(t){u().hideLoading(),e.setState({pageNo:1,total:0,orderList:[],orderLoading:!1}),console.log("err :",t)}))}},{key:"render",value:function(){var e=this,t=this.state,i=t.orderList,a=t.activeTabIndex,n=t.orderLoading,s=t.total,o=t.isFilterVisible,l=t.filterOptions,r=t.orderPay;return(0,j.jsxs)(g.View,{className:"orderWrapper",children:[(0,j.jsxs)(g.View,{className:"header",children:[(0,j.jsx)(v.Z,{data:[{label:"全部"},{label:"未发货"},{label:"已发货"},{label:"已取消"}],activeIndex:a,onTabItemClick:this.onTabClick}),(0,j.jsx)(g.View,{className:"header__btn",onClick:this.showFilterView,children:"筛选"})]}),(0,j.jsxs)(g.ScrollView,{className:"orderWrapper__list",scrollY:!0,onRefresherRefresh:this.onRefresh,refresherEnabled:!0,onScrollToLower:this.onNewScrollEnd,refresherTriggered:n,children:[i.map((function(t,i){return(0,j.jsx)(R,{item:t,index:i,onItemClick:e.onCheckDetailClick,addShoppingCart:e.addShoppingCart,orderCancel:e.orderCancel,onPayPropsClick:e.onPayClick,orderPay:r},i)})),i.length>0&&i.length>=s&&!n&&(0,j.jsx)(g.View,{className:"bottom_tip",children:"已经到底啦~"}),0===i.length&&!n&&(0,j.jsxs)(g.View,{className:"empty",children:[(0,j.jsx)(g.Image,{src:_,className:"empty_img"}),(0,j.jsx)(g.Text,{children:"暂无数据"})]})]}),(0,j.jsx)(D,{isOpened:o,onClose:this.hideFilterView,onValueChanged:this.onFilterValueChanged,configOptions:l})]})}}]),i}(h.Component),B=(0,f.$j)((function(e){return{mpErpId:e.cloudBill.mpErpId}}))(F);Page((0,a.createPageConfig)(B,"subpackages/mine/pages/order_list/index",{root:{cn:[]}},{navigationBarTitleText:"订单列表"}||{}))}},function(e){e.O(0,[6690,2107,1216,8592],(function(){return t=89016,e(e.s=t);var t}));e.O()}]);