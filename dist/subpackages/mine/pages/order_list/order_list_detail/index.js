"use strict";require("../../../sub-vendors.js");require("../../../sub-common/b29cd7063a909867339ec276af77ca8d.js");require("../../../sub-common/a892c3adf072850ba48f151a38b91f33.js");require("../../../sub-common/4e87c4a63c1d15e00f139d9a26067e1c.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[191],{11889:function(e,t,i){var a=i(32180),s=i(18453),l=i(57543),n=i(77886),o=i(33661),c=i(12742),r=i(22700),d=i(95333),m=i(14175),_=i(3701),u=i(92954),g=i.n(u),h=i(67294),p=i(71515),A=i(75508),f=i(29748),x=i(6420),N=i(94184),I=i.n(N),w=i(40068),j=i(14067),y=i(91629),C=i(6617),v=i(63056),b=i(42266),S=i(86792),V=i(48882),k=i(27863),L=i(9936),T=i(31254),D="detail-module__contanier___DnByJ",U="detail-module__bg___vrTw0",E="detail-module__bg_logistics___dAdAR",B="detail-module__topInfo___aoOgp",M="detail-module__topInfo__tipSingle___z4RL8",Z="detail-module__topInfo__tip___z3mt8",P="detail-module__topInfo__tip__top___PvWKV",R="detail-module__topInfo__btn___Hil4H",J="detail-module__topInfo__btn__item___EHloX",z="detail-module__logistics___TMwiz",Q="detail-module__show_logis___fMMmp",O="detail-module__angle_right___zpP88",F="detail-module__goodsInfo___GeY32",W="detail-module__goodsInfo__mainInfo___HIT58",Y="detail-module__goodsInfo__mainInfo__item___pRbg9",G="detail-module__goodsInfo__baseInfo___di11t",H="detail-module__goodsInfo__baseInfo__img___mb3DE",K="detail-module__goodsInfo__baseInfo__right___VLecD",q="detail-module__goodsInfo__singleInfo___JD8Az",X="detail-module__goodsInfo__singleInfo__goodImg___rBKzt",$="detail-module__goodsInfo__singleInfo__info___ChimR",ee="detail-module__goodsInfo__singleInfo__info__left___PyG_C",te="detail-module__goodsInfo__singleInfo__info__right___qF_ov",ie="detail-module__table___T8g73",ae="detail-module__table__sizeHeader___SvW6g",se="detail-module__table__cell___PkdZR",le="detail-module__list_new_style___piRy1",ne="detail-module__list_new_style__col___ji1Na",oe="detail-module__list_new_style__col__item___bBWV0",ce="detail-module__bottom___lwt1f",re="detail-module__bottom__item___GDhLG",de="detail-module__jump_btn____BUb9",me="detail-module__mask___qJq5S",_e="detail-module__bottomModal___SSbVi",ue="detail-module__bottomModal__card___b6yI8",ge="detail-module__bottomModal__card__header___Nzh7j",he="detail-module__bottomModal__card__header__img___hTbVP",pe="detail-module__bottomModal__card__top___Jo_Aa",Ae="detail-module__bottomModal__card__img___sGvcN",fe="detail-module__bottomModal__card__bottom___u7_u7",xe="detail-module__pay_success___ixitu",Ne="detail-module__delete_icon___e3aK3",Ie="detail-module__logis_info_mask___rQVNv",we="detail-module__logis_info_mask__content___sQaHP",je="detail-module__logis_info_mask__content__header___RZeZZ",ye="detail-module__logis_info_mask__content__loginList___PGvq_",Ce="detail-module__logis_info_mask__content__loginList__item___S14g0",ve="detail-module__logis_info_mask__content__loginList__item--active___QKvPB",be="detail-module__logis_info_mask__content__info___lXKI0",Se="detail-module__logis_info_copy___iM1rw",Ve="detail-module__logis_info_mask__content__logis___JMnA4",ke="detail-module__logis_info_mask__content__logis__item___jH4Dt",Le="detail-module__logis_info_mask__content__logis__item__round___m6HVK",Te="detail-module__logis_info_mask__content__logis__item__timer___as9Ee",De="detail-module__logis_info_mask__content__logis__item__content___XEkYX",Ue=i(85893),Ee=function(e){(0,d.Z)(i,e);var t=(0,m.Z)(i);function i(e){var a;(0,o.Z)(this,i),a=t.call(this,e),(0,_.Z)((0,r.Z)(a),"timer",void 0),(0,_.Z)((0,r.Z)(a),"loadData",(function(e){var t,i=(0,x.JU)(null===(t=g().getCurrentInstance)||void 0===t?void 0:t.call(g())).shareFlag;(0,f.Wh)({billId:e,showDwName:"1"===i}).then((function(t){g().hideLoading();var i=t.data,s=i.shopName,l=i.shopLogoUrl,n=i.details,o=i.bill,c=i.dwName;o.payStatus===k.aU.WAITING&&new Date(o.payExpireDate).getTime()-(new Date).getTime()>0&&(a.timer=setInterval((function(){var t=new Date,i=new Date(o.payExpireDate).getTime()-t.getTime();if(i>0){var s=new Date(i);a.setState({timeValue:"".concat(s.getMinutes(),":").concat(s.getSeconds(),"后自动取消")})}else a.timer&&(a.setState({timeValue:"订单已超时"}),a.loadData(e),clearInterval(a.timer))}),1e3)),a.setState({billData:n,shop:{shopName:s,shopLogo:l},bottomInfo:[{title:"总数",value:o.totalNum},{title:"总额",value:o.totalMoney},{title:"收货地址",value:o.fullAddress},{title:"备注",value:o.buyerRem}],slhBillNo:o.slhBillNo||"-",bill:o,dwName:c},(function(){a.classifyByStyle(),a.setBillState(t.data),a.getPartSendOrder()}))}))})),(0,_.Z)((0,r.Z)(a),"getPartSendOrder",(function(){var e;(0,f.wA)({billId:Number((0,x.JU)(null===(e=g().getCurrentInstance)||void 0===e?void 0:e.call(g())).billId)}).then((function(e){if(e.data){var t=e.data.rows,i=a.state.bill,s=0;if(t){t.forEach((function(e){e.styleImgs&&(e.styleImgs=e.styleImgs.map((function(e){return e.split(" ")[0]})))})),s=t.length;var l=i.totalNum;Number(l);a.setState({partSendData:t})}}}))})),(0,_.Z)((0,r.Z)(a),"onCancelApply",(function(){var e;g().showLoading({title:"请稍等..."}),(0,f.j3)({jsonParam:{billId:(0,x.JU)(null===(e=g().getCurrentInstance)||void 0===e?void 0:e.call(g())).billId,refundStatus:k.ks.CANCEL}}).then((function(){var e;g().hideLoading(),a.loadData((0,x.JU)(null===(e=g().getCurrentInstance)||void 0===e?void 0:e.call(g())).billId)}))})),(0,_.Z)((0,r.Z)(a),"onPayClick",(0,n.Z)((0,l.Z)().mark((function e(){var t,i,s,n,o,c,d,m,_,u;return(0,l.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(0,x.JU)(null===(t=g().getCurrentInstance)||void 0===t?void 0:t.call(g())),s=i.mpErpId,n=i.billId,o=a.state.bill,c=(0,r.Z)(a),d=JSON.parse(o.extProps),m={val:"0"},2!==d.billSrc){e.next=9;break}m.val="1",e.next=14;break;case 9:return e.next=11,(0,j._9)({mpErpId:s,code:"order_pay"});case 11:_=e.sent,u=_.data,m.val=u.val;case 14:"1"===m.val&&(g().showLoading({title:"请稍等..."}),(0,f.Nf)({mpErpId:s,billId:n}).then((function(e){var t=e.data,i=a.state.bill,s=JSON.parse(i.extProps),l={timeStamp:t.timeStamp.toString(),nonceStr:t.nonceStr,package:t.package,signType:t.signType,paySign:t.paySign,success:function(e){g().hideLoading(),c.loadData(n)},fail:function(e){console.log("支付fail回调",e),g().hideLoading()}};2===s.billSrc?(console.log("requestOrderPayment"),wx.requestOrderPayment(l)):(console.log("requestPayment"),wx.requestPayment(l))})).catch((function(e){g().hideLoading()})));case 15:case"end":return e.stop()}}),e)})))),(0,_.Z)((0,r.Z)(a),"renderTopInfo",(function(){var e=a.state,t=e.billState,i=e.bill,s=e.timeValue,l=e.isFromVideo,n=JSON.parse(i.extProps);if(-1===t)return(0,Ue.jsxs)(p.View,{className:B,children:[(0,Ue.jsx)(p.View,{className:M,children:(0,Ue.jsx)(p.View,{className:P,children:"订单已取消"})}),(0,Ue.jsx)(p.View,{className:R,children:(0,Ue.jsx)(p.View,{onClick:a.addShoppingCart,className:J,style:{marginRight:"10px"},children:"再补一单"})})]});if(-2===t)return(0,Ue.jsxs)(p.View,{className:B,children:[(0,Ue.jsxs)(p.View,{className:Z,style:{justifyContent:"flex-start"},children:[(0,Ue.jsx)(p.View,{className:P,children:"商家已取消订单"}),(0,Ue.jsx)(p.View,{children:"您可以联系商家确认"})]}),(0,Ue.jsx)(p.View,{className:R,children:(0,Ue.jsx)(p.View,{className:J,style:{marginRight:"10px"},onClick:a.addShoppingCart,children:"再补一单"})})]});if(!(0!==t&&1!==t||i.payStatus!==k.aU.SUCCESS||i.refundStatus!==k.ks.APPLY&&i.refundStatus!==k.ks.DOING&&i.refundStatus!==k.ks.FAILURE&&i.refundStatus!==k.ks.REJECT))return(0,Ue.jsxs)(p.View,{className:B,children:[(0,Ue.jsxs)(p.View,{className:Z,style:{justifyContent:"flex-start"},children:[(0,Ue.jsx)(p.View,{className:P,children:"售后中"}),(0,Ue.jsxs)(p.View,{children:[i.refundStatus===k.ks.APPLY?"等待商家同意退款":"",i.refundStatus===k.ks.REJECT?"商家拒绝退款: ".concat(JSON.parse(i.extProps).refundRejectReason||"无"):"",i.refundStatus===k.ks.DOING?"退款成功，预计1~2个工作日内到账":""]})]}),(0,Ue.jsxs)(p.View,{className:R,children:[(0,Ue.jsx)(p.View,{onClick:a.addShoppingCart,className:J,style:{marginRight:"10px"},children:"再补一单"}),i.payStatus===k.aU.SUCCESS&&i.refundStatus===k.ks.DEFAULT&&(0,Ue.jsx)(p.View,{className:J,onClick:a.onRefundClick,children:"申请退款"}),i.refundStatus===k.ks.APPLY&&(0,Ue.jsx)(p.View,{className:J,style:{marginRight:"10px"},onClick:a.onCancelApply,children:"取消退款"})]})]});if(1===t){var o;return"true"===(0,x.JU)(null===(o=g().getCurrentInstance)||void 0===o?void 0:o.call(g())).orderPay&&!0,(0,Ue.jsxs)(p.View,{className:B,children:[(0,Ue.jsxs)(p.View,{className:Z,children:[(0,Ue.jsxs)(p.View,{className:P,children:[i.payStatus===k.aU.WAITING?"订单未付款":"",i.payStatus===k.aU.SUCCESS||i.payStatus===k.aU.DEFAULT?"订单未发货":"",i.payStatus===k.aU.SUCCESS&&(0,Ue.jsx)(p.Text,{className:xe,children:"已付款"})]}),(0,Ue.jsxs)(p.View,{children:[i.payStatus===k.aU.WAITING&&s?"".concat(s):"",i.payStatus===k.aU.DEFAULT||i.payStatus===k.aU.SUCCESS?"您可以联系商家报单":""]})]}),(0,Ue.jsxs)(p.View,{className:R,children:[!l&&(0,Ue.jsx)(p.Button,{className:J,style:{marginRight:"10px",height:"31px"},openType:"share",children:"去报单"}),i.payStatus===k.aU.SUCCESS&&(i.refundStatus===k.ks.DEFAULT||i.refundStatus===k.ks.CANCEL)&&2!==n.billSrc&&(0,Ue.jsx)(p.View,{className:J,onClick:a.onRefundClick,children:"申请退款"}),i.payStatus===k.aU.DEFAULT&&(0,Ue.jsx)(p.View,{className:J,onClick:a.cancelBill,children:"取消订货"}),i.payStatus===k.aU.WAITING&&(0,Ue.jsx)(p.View,{className:J,onClick:a.onPayClick,style:{backgroundColor:"#fff",color:"#E62E4D"},children:"立即支付"})]})]})}return 2===t?(0,Ue.jsxs)(p.View,{className:B,children:[(0,Ue.jsxs)(p.View,{className:Z,children:[(0,Ue.jsx)(p.View,{className:P,children:"订单部分发货"}),(0,Ue.jsx)(p.View,{children:"发货情况请以小票为准"})]}),(0,Ue.jsxs)(p.View,{className:R,children:[(0,Ue.jsx)(p.View,{onClick:a.onLookTicket,className:J,style:{marginRight:"10px"},children:"查看小票"}),(0,Ue.jsx)(p.View,{className:J,onClick:a.addShoppingCart,children:"再补一单"})]})]}):3===t?(0,Ue.jsxs)(p.View,{className:"col aic",children:[(0,Ue.jsxs)(p.View,{className:B,style:{paddingBottom:"20px",width:"94%"},children:[(0,Ue.jsx)(p.View,{className:Z,children:(0,Ue.jsxs)(p.View,{className:P,children:["订单已发货",i.payStatus===k.aU.SUCCESS&&(0,Ue.jsx)(p.Text,{className:xe,children:"已付款"})]})}),2!==n.billSrc?(0,Ue.jsxs)(p.View,{className:R,children:[(0,Ue.jsx)(p.View,{className:J,onClick:a.onLookTicket,style:{marginRight:"10px"},children:"查看小票"}),(0,Ue.jsx)(p.View,{className:J,onClick:a.addShoppingCart,children:"再补一单"})]}):(0,Ue.jsxs)(p.View,{className:R,children:[(0,Ue.jsx)(p.View,{className:J,onClick:a.addShoppingCart,children:"再补一单"}),(0,Ue.jsx)(p.View,{className:J,style:{backgroundColor:"#fff",color:"#E62E4D",marginLeft:"10px"},onClick:a.onConfirmReceive,children:"确认收货"})]})]}),n.logisList&&(0,Ue.jsxs)(p.View,{className:z,children:[(0,Ue.jsx)(p.Text,{children:1===n.logisList.length?"".concat(n.logisList[0].logisProviderName,"：").concat(n.logisList[0].logisBillNo):"本单包含".concat(n.logisList.length,"个包裹")}),(0,Ue.jsxs)(p.View,{className:"aic",style:"height:100%;",onClick:a.onLogisticsClick,children:[(0,Ue.jsx)(p.Text,{className:Q,children:"查看物流轨迹"}),(0,Ue.jsx)(p.Image,{src:S,className:O})]})]})]}):4===t?(0,Ue.jsxs)(p.View,{className:"col aic",children:[(0,Ue.jsxs)(p.View,{className:B,style:{paddingBottom:"20px",width:"94%"},children:[(0,Ue.jsx)(p.View,{className:M,children:(0,Ue.jsx)(p.View,{className:P,children:"订单已完成"})}),(0,Ue.jsx)(p.View,{className:R,children:(0,Ue.jsx)(p.View,{className:J,onClick:a.addShoppingCart,children:"再补一单"})})]}),n.logisList&&(0,Ue.jsxs)(p.View,{className:z,children:[(0,Ue.jsx)(p.Text,{children:1===n.logisList.length?"".concat(n.logisList[0].logisProviderName,"：").concat(n.logisList[0].logisBillNo):"本单包含".concat(n.logisList.length,"个包裹")}),(0,Ue.jsxs)(p.View,{className:"aic",style:"height:100%;",onClick:a.onLogisticsClick,children:[(0,Ue.jsx)(p.Text,{className:Q,children:"查看物流轨迹"}),(0,Ue.jsx)(p.Image,{src:S,className:O})]})]})]}):void 0})),(0,_.Z)((0,r.Z)(a),"renderNumTable",(function(e){var t=[],i=new Map;e.forEach((function(e){var t=e.colorId,a={};i.get(t)||(a={colorName:e.colorName,colorId:e.colorId,sizeNum:["".concat(e.colorName)]},i.set(t,a))})),t=Array.from(i.values());var a=[],s=new Map;e.forEach((function(e){var t=e.sizeId,i={};s.get(t)||(i={sizeName:e.sizeName,sizeId:e.sizeId},s.set(t,i))})),a=Array.from(s.values());var l=new Map;return e.forEach((function(e){var t="".concat(e.colorId,"_").concat(e.sizeId),i={colorName:e.colorName,sizeName:e.sizeName,colorId:e.colorId,sizeId:e.sizeId,num:e.num,groupNum:e.groupNum},a=l.get(t);a&&(i.num+=a.num),l.set(t,i)})),t.forEach((function(e){a.forEach((function(t){var i="".concat(e.colorId,"_").concat(t.sizeId),a=l.get(i),s=0;a&&(s=a.groupNum&&a.groupNum!==a.num?"".concat(a.groupNum,"手").concat(a.num,"件"):a.num),e.sizeNum.push(s)}))})),(0,Ue.jsxs)(p.View,{className:ie,children:[(0,Ue.jsxs)(p.View,{className:ae,children:[(0,Ue.jsx)(p.View,{className:se}),a&&a.map((function(e){return(0,Ue.jsx)(p.View,{className:se,children:e.sizeName},e.sizeId)}))]}),t&&t.map((function(e){var t=e.sizeNum;return(0,Ue.jsx)(p.View,{className:ae,children:t&&t.map((function(e,t){return(0,Ue.jsx)(p.View,{className:se,children:e},"".concat(e,"_").concat(t))}))},e.colorId)}))]})})),(0,_.Z)((0,r.Z)(a),"renderInfoTable",(function(){var e,t=a.state.billData,i=a.props.shopList,s=(0,x.JU)(null===(e=g().getCurrentInstance)||void 0===e?void 0:e.call(g())).mpErpId,l=i.find((function(e){return e.id===Number(s)})),n=t.reduce((function(e,t,i){var a=t.groupNum&&t.groupNum!==Number(t.num)?"".concat(t.groupNum,"手").concat(t.num,"件"):t.num;return e[0].push(t.styleCode),e[1].push(t.styleName),e[2].push(t.colorName),e[3].push(t.sizeName),e[4].push(a),e[5].push(t.price),e[6].push(t.money),e}),[["款号"],["名称"],["颜色"],["尺码"],["数量"],["单价"],["小计"]]);return l&&l.industries&&(n[0][0]="货号",n.splice(2,2)),t.length>0&&(0,Ue.jsx)(p.View,{className:le,children:n.map((function(e,t){return(0,Ue.jsx)(p.View,{className:ne,children:e.map((function(e,t){return(0,Ue.jsx)(p.View,{className:oe,children:(0,Ue.jsx)(p.Text,{selectable:!0,children:e})},t)}))},t)}))})})),(0,_.Z)((0,r.Z)(a),"renderBottom",(function(){var e=a.state.bottomInfo;return(0,Ue.jsx)(p.View,{className:ce,children:e&&e.map((function(e,t){return(0,Ue.jsxs)(p.View,{className:re,children:[(0,Ue.jsx)(p.View,{style:{color:"#999",fontSize:"12px"},children:e.title}),(0,Ue.jsx)(p.View,{style:{color:"#333",fontSize:"12px"},children:e.value})]},"".concat(t,"_").concat(e.value))}))})})),(0,_.Z)((0,r.Z)(a),"onLogisClose",(function(){a.setState({logisIsShow:!1})})),(0,_.Z)((0,r.Z)(a),"onCopyWayBillNo",(function(){g().setClipboardData({data:a.state.logisInfo.waybillNo})})),(0,_.Z)((0,r.Z)(a),"onLogisItemClick",(function(e){var t=e.currentTarget.dataset,i=t.logisno,s=t.logisid;g().showLoading({title:"请稍等..."}),(0,f.iy)(i,s).then((function(e){var t=e.data;g().hideLoading(),a.setState({logisInfo:t,logisIsShow:!0})})).catch((function(){return g().hideLoading()}))})),(0,_.Z)((0,r.Z)(a),"renderLogisInfo",(function(){var e=a.state,t=e.logisInfo,i=e.bill,s=JSON.parse(i.extProps);return(0,Ue.jsx)(p.View,{className:Ie,onClick:a.onLogisClose,children:(0,Ue.jsxs)(p.View,{className:we,onClick:function(e){return e.stopPropagation()},children:[(0,Ue.jsxs)(p.View,{className:je,children:["物流轨迹",(0,Ue.jsx)(p.Image,{src:L,className:Ne,onClick:a.onLogisClose})]}),(0,Ue.jsx)(p.View,{className:ye,children:s.logisList.map((function(e,i){return(0,Ue.jsxs)(p.View,{className:I()(Ce,(0,_.Z)({},ve,e.logisBillNo===t.waybillNo)),"data-logisno":e.logisBillNo,"data-logisid":e.logisProviderId,onClick:a.onLogisItemClick,children:["包裹",i+1]},e.logisBillNo)}))}),(0,Ue.jsxs)(p.View,{className:be,children:[t.logisCompName,"：",t.waybillNo,(0,Ue.jsx)(p.Text,{className:Se,onClick:a.onCopyWayBillNo,children:"复制"})]}),(0,Ue.jsx)(p.View,{className:Ve,children:t.traces.reverse().map((function(e){return(0,Ue.jsxs)(p.View,{className:ke,children:[(0,Ue.jsx)(p.View,{className:Le}),(0,Ue.jsxs)(p.View,{className:Te,children:[(0,Ue.jsx)(p.Text,{children:(0,x.OR)(e.acceptTime)}),(0,Ue.jsx)(p.Text,{children:e.acceptTime.split(" ")[1].substring(0,5)})]}),(0,Ue.jsx)(p.View,{className:De,children:e.acceptStation})]},e.acceptTime)}))})]})})})),(0,_.Z)((0,r.Z)(a),"renderBottomModal",(function(){var e=a.state,t=e.partSendData,i=e.shop,s=a.props.screenWidth;return(0,Ue.jsxs)(p.ScrollView,{scrollY:!0,style:{width:s},className:_e,children:[(0,Ue.jsxs)(p.View,{className:ge,children:[(0,Ue.jsx)(p.View,{style:{fontSize:"16px",color:"#999999"},children:"选择销售单"}),(0,Ue.jsx)(p.Image,{onClick:function(){a.setState({needMask:!1})},src:b,className:he})]}),t&&t.map((function(e){return(0,Ue.jsxs)(p.View,{className:ue,onClick:function(){a.goToCheckDetail(e)},children:[(0,Ue.jsxs)(p.View,{className:pe,children:[(0,Ue.jsx)(p.View,{style:{fontSize:"15px",color:"#222"},children:i.shopName}),(0,Ue.jsx)(p.View,{style:{fontSize:"13px",color:"#999"},children:e.proDate.split(" ")[0]})]}),(0,Ue.jsx)(p.View,{className:Ae,children:e.styleImgs&&e.styleImgs.map((function(e){return(0,Ue.jsx)(p.Image,{style:{width:"80px",height:"80px",borderRadius:"8px",marginRight:"4px"},src:e},e)}))}),(0,Ue.jsxs)(p.View,{className:fe,children:[(0,Ue.jsx)(p.View,{style:{color:"#999",fontSize:"13px"},children:"NO.".concat(e.billNo)}),(0,Ue.jsxs)(p.View,{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,Ue.jsx)(p.View,{children:"共".concat(e.totalNum,"件")}),(0,Ue.jsxs)(p.View,{style:{display:"flex",alignItems:"center"},children:[(0,Ue.jsx)(p.View,{children:"总金额：￥"}),(0,Ue.jsx)(p.View,{style:{fontSize:"24px",fontWeight:"bold"},children:e.totalMoney})]})]})]})]},e.billId)}))]})})),(0,_.Z)((0,r.Z)(a),"classifyByStyle",(function(){var e=a.state.billData,t=new Map,i=function(e){return void 0===e.money?Number(e.num)*Number(e.price):Number(e.money)};e.forEach((function(e){var a=e.styleId,l=t.get(a);if(l){var n={key:e.id,styleImg:(0,x.Fk)(e.styleImg),styleCode:e.styleCode,styleName:e.styleName,price:e.price,num:l.baseInfo.num+Number(e.num),totalMoney:i(e)+Number(l.baseInfo.totalMoney)};t.set(a,{baseInfo:n,data:[].concat((0,s.Z)(l.data),[e])})}else{var o={key:e.id,styleImg:(0,x.Fk)(e.styleImg),styleCode:e.styleCode,styleName:e.styleName,price:e.price,num:Number(e.num),totalMoney:i(e)};t.set(a,{baseInfo:o,data:[e]})}})),a.setState({styleData:Array.from(t.values())})})),(0,_.Z)((0,r.Z)(a),"setBillState",(function(e){var t=e.bill,i=a.state.billState;if(t){var s=t.deliverFlag,l=t.flag;l<0?i=l:0===s?i=1:1===s?i=2:2===s?i=3:3===s&&(i=4),a.setState({billState:i})}})),(0,_.Z)((0,r.Z)(a),"cancelBill",(function(){v.Z.showAlertWithCancel("确认取消订单？取消后订单将作废","",(function(){var e;(0,f.nt)(Number((0,x.JU)(null===(e=g().getCurrentInstance)||void 0===e?void 0:e.call(g())).billId)).then((function(e){var t;g().hideLoading();var i=g().getCurrentPages();i[i.length-2].setData({cancelBillFlag:1}),a.loadData(Number((0,x.JU)(null===(t=g().getCurrentInstance)||void 0===t?void 0:t.call(g())).billId))})).catch((function(e){console.log("err :",e)}))}))})),(0,_.Z)((0,r.Z)(a),"onRefundClick",(function(){v.Z.showAlertWithCancel("已付款订单，需商家同意后退款","提示",(function(){var e;g().showLoading({title:"请稍等..."}),(0,f.j3)({jsonParam:{billId:(0,x.JU)(null===(e=g().getCurrentInstance)||void 0===e?void 0:e.call(g())).billId,refundStatus:k.ks.APPLY}}).then((function(){var e;g().hideLoading(),a.loadData((0,x.JU)(null===(e=g().getCurrentInstance)||void 0===e?void 0:e.call(g())).billId)}))}))})),(0,_.Z)((0,r.Z)(a),"addShoppingCart",(function(){var e;(0,f.DH)(Number((0,x.JU)(null===(e=g().getCurrentInstance)||void 0===e?void 0:e.call(g())).billId)).then((function(e){g().hideLoading(),v.Z.showAlertWithCancel("商品已加入进货车,是否前往进货车？","",(function(){g().switchTab({url:"/pages/stock_bar/index"})}))})).catch((function(e){console.log("err :",e)}))})),(0,_.Z)((0,r.Z)(a),"addShoppingCartSingle",(function(e){var t=e.data,i={mpErpId:"".concat(t[0].mpErpId)},s=[];t&&t.forEach((function(e){var t={styleId:e.styleId,styleCode:e.styleCode,styleName:e.styleName,styleImg:e.styleImg,sizeId:e.sizeId,sizeName:e.sizeName,colorId:e.colorId,colorName:e.colorName,num:e.num,price:e.price};s.push(t)})),i.jsonParam=s,(0,f.hK)(i).then((function(){v.Z.showToast("添加成功"),a.props.dispatch({type:"replenishment/fetchCartGoodsList"})})).catch((function(e){console.log(e)}))})),(0,_.Z)((0,r.Z)(a),"onJumpShopClick",(function(){g().switchTab({url:"/pages/stock_bar/index"})})),(0,_.Z)((0,r.Z)(a),"onLookTicket",(function(){var e=a.state.partSendData;if(e){if(1===e.length){var t=e[0],i="pk=".concat(t.billId,"&sn=").concat(t.sn,"&epid=").concat(t.epid,"&type=").concat(t.billType);return void y.Z.navigateTo({url:"/pages/eTicketDetail/landscapeModel?".concat(i)})}a.setState({needMask:!0})}})),(0,_.Z)((0,r.Z)(a),"onConfirmReceive",(function(){var e;g().showLoading({title:"请稍等..."}),(0,f.TG)({billId:(0,x.JU)(null===(e=g().getCurrentInstance)||void 0===e?void 0:e.call(g())).billId}).then((function(e){var t;e.data;g().hideLoading(),a.loadData((0,x.JU)(null===(t=g().getCurrentInstance)||void 0===t?void 0:t.call(g())).billId)})).catch((function(){return g().hideLoading()}))})),(0,_.Z)((0,r.Z)(a),"onLogisticsClick",(function(){var e=a.state.bill,t=JSON.parse(e.extProps);g().showLoading({title:"请稍等..."}),(0,f.iy)(t.logisList[0].logisBillNo,t.logisList[0].logisProviderId).then((function(e){var t=e.data;g().hideLoading(),a.setState({logisInfo:t,logisIsShow:!0})})).catch((function(){return g().hideLoading()}))})),(0,_.Z)((0,r.Z)(a),"goToCheckDetail",(function(e){var t="pk=".concat(e.billId,"&sn=").concat(e.sn,"&epid=").concat(e.epid,"&type=").concat(e.billType);y.Z.navigateTo({url:"/pages/eTicketDetail/landscapeModel?".concat(t)})}));var c=wx.getEnterOptionsSync(),d=T.MW.includes(c.scene);return a.state={billData:[],shop:{shopName:"",shopLogo:""},styleData:[],tableMode:1,bottomInfo:[],billState:0,partSendData:[],needMask:!1,slhBillNo:"-",bill:{extProps:"{}"},timeValue:"",logisInfo:{},logisIsShow:!1,isFromVideo:d,dwName:"-"},a}return(0,c.Z)(i,[{key:"componentDidUpdate",value:function(e){var t;!e.sessionId&&this.props.sessionId&&this.loadData((0,x.JU)(null===(t=g().getCurrentInstance)||void 0===t?void 0:t.call(g())).billId)}},{key:"componentDidMount",value:function(){if(this.props.sessionId){var e,t=(0,x.JU)(null===(e=g().getCurrentInstance)||void 0===e?void 0:e.call(g())).billId;this.loadData(t)}}},{key:"componentWillUnmount",value:function(){this.timer&&clearInterval(this.timer)}},{key:"onShareAppMessage",value:function(e){var t,i=this.state,a=i.shop,s=i.billData[0].billId,l=(0,x.JU)(null===(t=g().getCurrentInstance)||void 0===t?void 0:t.call(g())).mpErpId;return{title:"".concat(a.shopName,",您有一份来自云单的订单"),path:"/subpackages/mine/pages/order_list/order_list_detail/index?billId=".concat(s,"&shareFlag=1&mpErpId=").concat(l),imageUrl:a.shopLogo}}},{key:"render",value:function(){var e,t,i,a=this,s=this.props,l=s.statusBarHeight,n=s.navigationHeight,o=(s.gap,s.shopList),c=this.state,r=c.shop,d=(c.billData,c.styleData),m=c.tableMode,u=c.needMask,h=c.slhBillNo,A=c.billState,f=c.logisIsShow,N=c.bill,j=c.dwName,y=0;(0,x.JU)(null===(e=g().getCurrentInstance)||void 0===e?void 0:e.call(g())).shareFlag&&(y=Number((0,x.JU)(null===(i=g().getCurrentInstance)||void 0===i?void 0:i.call(g())).shareFlag));var v=(0,x.JU)(null===(t=g().getCurrentInstance)||void 0===t?void 0:t.call(g())).mpErpId,b=o.find((function(e){return e.id===Number(v)}));return(0,Ue.jsxs)(p.View,{className:D,children:[(0,Ue.jsx)(p.Image,{src:"https://webdoc.hzecool.com/webCdn/weapp/ec-ticket/src/assets/images/b7c6f29e9f3a46f62dc4..png",className:I()(U,(0,_.Z)({},E,(3===A||4===A)&&!1))}),u&&(0,Ue.jsx)(p.View,{className:me,onClick:function(){a.setState({needMask:!1})}}),u&&this.renderBottomModal(),(0,Ue.jsx)(p.View,{className:de,onClick:this.onJumpShopClick,children:"进货车"}),1!=y?(0,Ue.jsx)(p.Image,{style:{position:"absolute",top:"".concat(l+.5*n-16,"px"),width:"32px",height:"32px",left:"20px"},src:C,onClick:function(){g().navigateBack()}}):(0,Ue.jsx)(p.Image,{style:{position:"absolute",top:"".concat(l+.5*n-16,"px"),width:"32px",height:"32px",left:"20px"},src:"data:image/png;base64,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",onClick:function(){g().switchTab({url:"/pages/cloud_bill_tab/index"})}}),(0,Ue.jsx)(p.View,{style:{marginTop:"".concat(l,"px"),display:"flex",justifyContent:"center",alignItems:"center",height:"".concat(n,"px"),color:"white",fontSize:"17px"},children:1!=y?"":"云单订单"}),1!=y&&this.renderTopInfo(),(0,Ue.jsx)(p.ScrollView,{scrollY:!0,children:(0,Ue.jsxs)(p.View,{className:F,children:[(0,Ue.jsxs)(p.View,{className:G,children:[(0,Ue.jsxs)(p.View,{style:{display:"flex",alignItems:"center"},children:[(0,Ue.jsx)(p.Image,{src:r.shopLogo||V,className:H}),(0,Ue.jsx)(p.View,{style:{fontSize:"22px"},children:r.shopName})]}),(0,Ue.jsxs)(p.View,{className:K,onClick:function(){a.setState({tableMode:1===m?0:1})},children:["切换样式",(0,Ue.jsx)(p.Image,{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAA0klEQVRYCe1UQQ6EIAyUjW8FXrGi+wp4LGwxxoPiWMCbNTHRDtNpB8owyCMOiAPiQKUD1lpXSYHLPxA9gFrrKcY4HcJdv+wCsjgpuS61AlkVYqdQQTydFl0EQgiwyfGCt4cL4hljFb4nAR+wOmPMl7gO8Lsh2ElKCeIcdaUUe7s4+WTN4w7APaYJiJ2KM43hjHLcjSEsECWmw7d476F45sMxRAII28RZVzbssGYM6c5Yt6tG/NaBPMPcd3PkR7azOkcONmF0YJcmopDEAXHg9Q78AbwWOMdzJV7/AAAAAElFTkSuQmCC",style:{width:"16px",height:"16px"}})]})]}),1===y?(0,Ue.jsxs)(p.View,{className:W,children:[(0,Ue.jsxs)(p.View,{className:Y,children:[(0,Ue.jsx)(p.Text,{children:"批次"}),(0,Ue.jsx)(p.Text,{children:h})]}),(0,Ue.jsxs)(p.View,{className:Y,children:[(0,Ue.jsx)(p.Text,{children:"客户"}),(0,Ue.jsx)(p.Text,{children:j})]}),(0,Ue.jsxs)(p.View,{className:Y,children:[(0,Ue.jsx)(p.Text,{children:"日期"}),(0,Ue.jsx)(p.Text,{children:N.createdDate?N.createdDate.slice(0,10):"-"})]})]}):(0,Ue.jsx)(p.View,{style:{fontSize:"15px",color:"#333333",paddingBottom:"12px"},children:"批次:".concat(h)}),d&&d.map((function(e){var t=e.baseInfo,i=e.data;return 1===m?(0,Ue.jsxs)(p.View,{style:{borderRadius:"10px",backgroundColor:"#f9f9f9",padding:"10px",marginBottom:"10px"},children:[(0,Ue.jsxs)(p.View,{className:q,children:[(0,Ue.jsx)(p.View,{className:X,children:(0,Ue.jsx)(w.Z,{onClick:function(){return g().previewImage({urls:Array.isArray(t.styleImg)?t.styleImg:[t.styleImg]})},src:t.styleImg})}),(0,Ue.jsxs)(p.View,{className:$,children:[(0,Ue.jsxs)(p.View,{className:ee,children:[(0,Ue.jsx)(p.View,{children:t.styleCode}),(0,Ue.jsxs)(p.View,{children:[(0,Ue.jsx)(p.View,{children:t.styleName}),b&&b.industries?(0,Ue.jsx)(p.View,{children:i.map((function(e){return(0,Ue.jsxs)(p.View,{children:["￥".concat(e.price,"/").concat(e.sizeName),(0,Ue.jsx)(p.Text,{style:"margin-left:10px",children:"X".concat(e.num)})]})}))}):(0,Ue.jsx)(p.View,{children:"￥".concat(t.price,"*").concat(t.num)})]})]}),(0,Ue.jsxs)(p.View,{className:te,children:[(0,Ue.jsx)(p.View,{children:t.totalMoney}),1!=y&&(0,Ue.jsx)(p.Image,{style:{width:"20px",height:"20px"},src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAAXNSR0IArs4c6QAAAutJREFUWEfVmT1MU1EUx//nlRa/IBExaWujg4MM8BiEqIkDTg62oBESSIyDLmDQGQYTEgacxdAuMhgTYiBRBAcnGUw0AQdaBhgc1NI2oWICftCvd8x9UvJairzHK+b61nvOub937r3nnHsuYQ8fA0pUbWt2Ei4x81kAZwD2MFAlzBGwDlAcwBIRfcgw3vjCk7MEaFanIysKyUb/ibRGvSC+AZDPii7AUTA9dSn8qHZ+etmsrinAaN21Y4orMwjQLQCVZo3vIJcCeFRLO+/7Fp9/3c3WroDLamsngYcB1O5mzOJ4UiGl1z0/+exvejsCcktLRXy1ehjgbosTWxSnkKdm7S7NzGRLKZYE5AsdBxM/U+PMfMXibHsSJ6JX7kOVHfRu/FexgW2AwnOJb9Uv/hVcHkiHPLp2tdiT2wBjamtw/5d1J0dTyBt+2WMcLQDcPBBje1qnMikppHQaD84W4J9Qkl3ch9NqFT2ppSvq8iFoCzCu+kcYVOBeK5YdPjdqggO6ymrPAHLRhBX1IlkOesPTdzazEqBnCKaPdoLw4dvtqL53U59o7eET/Hg8YQMQKRfxaZFxdA/GGgJDIPTZsXikuwtVPV26ifXgGL6HbG5lxgNvZKqfROKPq/5P1nNr4e+UHRAc9YSnT9EXte2cA9p7O94TuuUHBHJQzlOisa1PY21IRkCFlH6KqQGxm6/LCEigCQEYAVAvIyCABYqrgRU2UUqJOHfg8kWQ01nyX1xN9ahsbtDHUrMRpOcWSspxJoON129NxUkCksKDG2bi3/GpECpOeu06WtfPfo5hJWCqikvJD/g/LLG0h4RAEYqrreMMbre7ufYjUOthRvpALX2qk75YkL7cEoDSF6y6F1X/CGQt+QWg9JcmASn1tTMfqKW+uAtI6VsfOqTMzaP8UkvdfjMWDtI2MI2QIgQ5XJlBLlMLmMCjuXK1gI2g0jbRi2tF4zOExlqTeIYgwG18hmBAdI+WFFLm7DxD/AYD18b1B29OKwAAAABJRU5ErkJggg==",onClick:function(){a.addShoppingCartSingle(e)}})]})]})]}),b&&!b.industries&&a.renderNumTable(i)]},t.key):null})),0===m?this.renderInfoTable():null,this.renderBottom()]})}),f&&this.renderLogisInfo()]})}}]),i}(h.PureComponent),Be=(0,A.$j)((function(e){var t=e.user,i=e.shop,a=e.systemInfo;e.replenishment;return{phone:t.phone,nickName:t.nickName,buyGoodsData:t.buyGoodsData,avatar:t.avatar,firstShop:i.list[0],shopNum:i.list.length,sessionId:t.sessionId,statusBarHeight:a.statusBarHeight,gap:a.gap,navigationHeight:a.navigationHeight,screenWidth:a.screenWidth,shopList:i.list}}))(Ee);Be.enableShareAppMessage=!0;Page((0,a.createPageConfig)(Be,"subpackages/mine/pages/order_list/order_list_detail/index",{root:{cn:[]}},{navigationStyle:"custom"}||{}))}},function(e){e.O(0,[3199,5771,3152,2107,1216,8592],(function(){return t=11889,e(e.s=t);var t}));e.O()}]);