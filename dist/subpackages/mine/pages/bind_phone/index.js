"use strict";require("../../sub-vendors.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[1784],{57020:function(e,n,t){var o=t(32180),i=t(33661),s=t(12742),u=t(22700),c=t(95333),a=t(14175),_=t(3701),r=t(92954),p=t.n(r),l=t(67294),d=t(71515),h=t(49181),A=t(6420),m=t(94184),x=t.n(m),w=t(29748),f=t(65941),b=t(75508),C=t(63056),v={container:"index-module__container___rgEb0",title:"index-module__title___OqomB",sub_title:"index-module__sub_title___aSxWh",phones:"index-module__phones___jkZXw",FadeIn:"index-module__FadeIn___lBEkQ",phones__phone:"index-module__phones__phone___bEAZ7",inputs:"index-module__inputs___MOoEQ",input:"index-module__input___VssRu",input__icon:"index-module__input__icon___S6Wtj",input__input:"index-module__input__input___Vp9wb",input__code:"index-module__input__code___Yeu8h","input__code--active":"index-module__input__code--active___PVskg","input__code--wait":"index-module__input__code--wait___spUfk",tips:"index-module__tips___UzCkH",tips__error:"index-module__tips__error___YAL7D",tips__back:"index-module__tips__back___eAn7P",button:"index-module__button___t0PBX",confirm_button:"index-module__confirm_button___bqsC3",phone_button:"index-module__phone_button___T9TOw"},g=t(85893),I=[{title:(0,f.t)("selectPhone"),sub:(0,f.t)("bindPhoneTip")},{title:(0,f.t)("verifyPhone"),sub:(0,f.t)("bindPhoneTip")}],Z=function(e){return e[e.None=-1]="None",e[e.PhoneList=0]="PhoneList",e[e.Inputs=1]="Inputs",e}(Z||{}),B=function(e){(0,c.Z)(t,e);var n=(0,a.Z)(t);function t(){var e;(0,i.Z)(this,t);for(var o=arguments.length,s=new Array(o),c=0;c<o;c++)s[c]=arguments[c];return e=n.call.apply(n,[this].concat(s)),(0,_.Z)((0,u.Z)(e),"timer",null),(0,_.Z)((0,u.Z)(e),"from","normal"),(0,_.Z)((0,u.Z)(e),"state",{countDownNumber:0,errorMessage:"",phone:"",code:"",disableCodeInput:!0,disablePhoneInput:!1,codeIpnutFocus:!1,step:Z.None}),(0,_.Z)((0,u.Z)(e),"onPhoneInput",(function(n){e.setState({phone:n.detail.value,errorMessage:""})})),(0,_.Z)((0,u.Z)(e),"validatePhone",(function(){return(0,A.jv)(e.state.phone)})),(0,_.Z)((0,u.Z)(e),"onPhoneBlur",(function(){e.validatePhone()||e.setState({errorMessage:(0,f.t)("inputCorrectPhone")})})),(0,_.Z)((0,u.Z)(e),"onCodeInput",(function(n){e.setState({code:n.detail.value})})),(0,_.Z)((0,u.Z)(e),"onGetCodeClick",(function(){0===e.state.countDownNumber&&e.validatePhone()&&(e.setState({disableCodeInput:!1,codeIpnutFocus:!0},(function(){e.setState({codeIpnutFocus:!1})})),p().showLoading(),(0,w.W_)(e.state.phone).then((function(){p().showToast({title:(0,f.t)("smsSent"),duration:1e3,icon:"none"}),e.countDown()})))})),(0,_.Z)((0,u.Z)(e),"countDown",(function(){e.stopCountDown(),e.setState({countDownNumber:60}),e.timer=setInterval((function(){if(0===e.state.countDownNumber)return e.stopCountDown();e.setState((function(e){return{countDownNumber:e.countDownNumber-1}}))}),1e3)})),(0,_.Z)((0,u.Z)(e),"stopCountDown",(function(){e.setState({countDownNumber:0}),e.timer&&clearInterval(e.timer)})),(0,_.Z)((0,u.Z)(e),"onPhoneClick",(function(n){n?e.setState({phone:n,disablePhoneInput:!0,code:""}):e.stopCountDown(),e.setState({step:Z.Inputs,code:""})})),(0,_.Z)((0,u.Z)(e),"onBackClick",(function(){e.setState({disablePhoneInput:!1,step:Z.PhoneList,phone:""})})),(0,_.Z)((0,u.Z)(e),"onBtnClick",(function(){var n=e.state,t=n.phone,o=n.code;p().showLoading({title:"加载中"}),e.props.dispatch({type:"user/verifyPhone",payload:{phone:t,captcha:o,from:e.from}}).then(e.onBindSuccess)})),(0,_.Z)((0,u.Z)(e),"onGetPhone",(function(n){if(n.detail.errMsg.includes("ok")){var t=n.detail,o=t.encryptedData,i=t.iv,s=t.code;e.props.dispatch({type:"user/verifyPhone",payload:{encryptedData:o,iv:i,from:e.from,wechat:!0,code:s}}).then(e.onBindSuccess)}})),(0,_.Z)((0,u.Z)(e),"onBindSuccess",(function(e){e&&(p().navigateBack(),C.Z.showToast("手机号绑定成功"))})),(0,_.Z)((0,u.Z)(e),"renderPhoneList",(function(){var n=e.props.phoneList;return(0,g.jsxs)(d.View,{className:v.phones,children:[n.map((function(n){return(0,g.jsx)(d.View,{className:v.phones__phone,onClick:function(){return e.onPhoneClick(n)},children:(0,g.jsx)(d.Text,{className:v.phones__phone__text,children:(0,A.xA)(n)})},n)})),(0,g.jsx)(d.View,{className:v.phones__phone,onClick:function(){return e.onPhoneClick("")},children:(0,g.jsx)(d.Text,{className:v.phones__phone__text,children:(0,f.t)("otherPhone")})})]})})),(0,_.Z)((0,u.Z)(e),"renderInputs",(function(){var n,t=e.state,o=t.countDownNumber,i=t.disableCodeInput,s=t.disablePhoneInput,u=t.phone,c=t.code,a=t.codeIpnutFocus,r=s?(0,A.xA)(u):u;return(0,g.jsxs)(d.View,{className:v.inputs,children:[(0,g.jsxs)(d.View,{className:v.input,children:[(0,g.jsx)(d.Image,{className:v.input__icon,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAD1BMVEW7u7tHcEy8vLy7u7u+vr6GKBShAAAABXRSTlP+AIjDO4uVzxwAAABESURBVCjPYxBEAwxArMAABUwQASEGOFAECwiwwJQ7MEIEGGECAkgCBsyEBDC0DFsBRBDiEiDOUBLDFD2iMKISI7JRAQD9GhvD88RGtQAAAABJRU5ErkJggg=="}),(0,g.jsx)(d.Input,{type:s?"text":"number",value:r,maxLength:11,className:v.input__input,placeholder:(0,f.t)("inputPhone"),onInput:e.onPhoneInput,onBlur:e.onPhoneBlur,disabled:s}),s&&(0,g.jsx)(d.Text,{className:x()(v.input__code,v["input__code--active"]),onClick:e.onBackClick,children:(0,f.t)("reselect")})]}),(0,g.jsxs)(d.View,{className:v.input,children:[(0,g.jsx)(d.Image,{className:v.input__icon,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAJ1BMVEVHcEy7u7u9vb2+vr68vLy7u7u8vLyzs7O+vr68vLy7u7u9vb27u7tWC78WAAAADHRSTlMA7ywSS6mIBTrL5HaB1BQoAAAAeklEQVQoz2NgoAlgTzwDB2IFQAG2M0ggASjAeAKhukcASPAcQAiA2WQLsIMRTCBSiFlGmklmCVwg9RCzU4yx0ky4AMshBoY9BhZTkQWYRBliJJAFtMIZmKOQBFhEm4yVJiIJAH3ofWYJmsOM2cn2C0YAYQQhRiDTAAAAVC5SQhJTMTIAAAAASUVORK5CYII="}),(0,g.jsx)(d.Input,{type:"number",disabled:i,onInput:e.onCodeInput,className:v.input__input,placeholder:(0,f.t)("inputCode"),focus:a,value:c}),(0,g.jsx)(d.Text,{className:x()(v.input__code,(n={},(0,_.Z)(n,v["input__code--wait"],0!==o),(0,_.Z)(n,v["input__code--active"],11===u.length),n)),onClick:e.onGetCodeClick,children:0===o?(0,f.t)("fetchCode"):"".concat(o,"s")})]})]})})),e}return(0,s.Z)(t,[{key:"componentDidMount",value:function(){var e,n=this.props.phoneList,t=(0,A.JU)(null===(e=p().getCurrentInstance)||void 0===e?void 0:e.call(p())),o=t.phone,i=t.from;this.from=i,"search"===i&&C.Z.showToast("请先绑定手机",1e3),o?this.setState({phone:o,step:Z.Inputs},this.onGetCodeClick):n&&n.length>0?this.setState({step:Z.PhoneList}):this.setState({step:Z.Inputs})}},{key:"componentWillUnmount",value:function(){this.stopCountDown()}},{key:"render",value:function(){var e=this.state,n=e.errorMessage,t=e.code,o=e.step;return o!==Z.None&&(0,g.jsxs)(d.View,{className:v.container,children:[(0,g.jsx)(d.View,{className:v.title,children:I[o].title}),(0,g.jsx)(d.View,{className:v.sub_title,children:I[o].sub}),(0,g.jsxs)(d.View,{children:[o===Z.PhoneList&&this.renderPhoneList(),o===Z.Inputs&&this.renderInputs()]}),(0,g.jsx)(d.View,{className:v.tips,children:(0,g.jsx)(d.View,{className:v.tips__error,children:n})}),o===Z.Inputs&&(0,g.jsxs)(d.View,{className:v.button,children:[(0,g.jsx)(d.View,{style:{flex:1},children:(0,g.jsx)(h.Z,{label:(0,f.t)("confirm"),size:"large",disabled:0===t.length,onButtonClick:this.onBtnClick,buttonClass:v.confirm_button})}),(0,g.jsx)(d.Button,{className:v.phone_button,openType:"getPhoneNumber",onGetPhoneNumber:this.onGetPhone,children:"微信获取"})]})]})}}]),t}(l.PureComponent),P=(0,b.$j)((function(e){var n=e.user;e.language;return{phoneList:n.phoneList}}))(B);Page((0,o.createPageConfig)(P,"subpackages/mine/pages/bind_phone/index",{root:{cn:[]}},{navigationBarTitleText:"验证手机号"}||{}))}},function(e){e.O(0,[2107,1216,8592],(function(){return n=57020,e(e.s=n);var n}));e.O()}]);