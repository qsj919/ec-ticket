"use strict";require("../../sub-common/1953cfd0adfeaa0d6d261e56d0b37b07.js");require("../../sub-common/b29cd7063a909867339ec276af77ca8d.js");(wx.webpackJsonp=wx.webpackJsonp||[]).push([[7360],{27183:function(e,t,o){var a=o(32180),i=o(66058),n=o(18453),s=o(57543),c=o(77886),r=o(33661),l=o(12742),d=o(22700),p=o(95333),u=o(14175),_=o(3701),h=o(92954),m=o.n(h),w=o(67294),g=o(71515),f=o(44559),N=o(1695),v=o(6949),Z=o(37001),x=o(27863),C=o(6420),k=o(96486),P=o(9936),I=o(85893),L=function(e){(0,p.Z)(o,e);var t=(0,u.Z)(o);function o(){var e;(0,r.Z)(this,o);for(var a=arguments.length,i=new Array(a),n=0;n<a;n++)i[n]=arguments[n];return e=t.call.apply(t,[this].concat(i)),(0,_.Z)((0,d.Z)(e),"priceValue",void 0),(0,_.Z)((0,d.Z)(e),"onPriceInput",(function(t){e.priceValue=Number(t.detail.value)})),(0,_.Z)((0,d.Z)(e),"onSaveClick",(function(){e.props.onCallback(e.priceValue)})),(0,_.Z)((0,d.Z)(e),"onClose",(function(){e.props.onCloseClick()})),e}return(0,l.Z)(o,[{key:"render",value:function(){var e=this.props.realPrice;return(0,I.jsx)(g.View,{className:"update_price_mask",onClick:this.onClose,children:(0,I.jsxs)(g.View,{className:"update_price_mask__content",onClick:function(e){return e.stopPropagation()},children:[(0,I.jsxs)(g.View,{className:"update_price_mask__content__title",children:[(0,I.jsx)(g.Text,{children:"改价"}),(0,I.jsx)(g.Image,{src:P,onClick:this.onClose,className:"delete_icon"})]}),(0,I.jsxs)(g.View,{className:"update_price_mask__content__price_item",children:[(0,I.jsx)(g.Text,{className:"update_price_mask__content__price_item__label",children:"原价"}),(0,I.jsxs)(g.Text,{className:"update_price_mask__content__price_item__value",children:["¥",e]})]}),(0,I.jsxs)(g.View,{className:"update_price_mask__content__price_item",children:[(0,I.jsx)(g.Text,{className:"update_price_mask__content__price_item__label",children:"直播价格"}),(0,I.jsx)(g.Input,{type:"digit",onInput:this.onPriceInput,placeholder:"请输入",placeholderStyle:"color: #ccc;",className:"update_price_mask__content__price_item__input"})]}),(0,I.jsx)(g.View,{className:"update_price_mask__content__action",onClick:this.onSaveClick,children:"保存"})]})})}}]),o}(w.Component);(0,_.Z)(L,"defaultProps",{realPrice:0});var S=o(63056),j=o(94184),b=o.n(j),V=function(e){(0,p.Z)(o,e);var t=(0,u.Z)(o);function o(){var e;(0,r.Z)(this,o);for(var a=arguments.length,i=new Array(a),n=0;n<a;n++)i[n]=arguments[n];return e=t.call.apply(t,[this].concat(i)),(0,_.Z)((0,d.Z)(e),"onUpdateClick",(function(){e.props.onActionClick(x.JU.UPDATE,e.props.data)})),(0,_.Z)((0,d.Z)(e),"onUpClick",(function(){e.props.onActionClick(x.JU.UP,e.props.data)})),(0,_.Z)((0,d.Z)(e),"onDownClick",(function(){S.Z.showAlertWithCancel("确定下架商品?","提示",(function(){e.props.onActionClick(x.JU.DELETE,e.props.data)}))})),(0,_.Z)((0,d.Z)(e),"onAsyncClick",(function(){e.props.onActionClick(x.JU.ASYNC,e.props.data)})),(0,_.Z)((0,d.Z)(e),"onEditClick",(function(){e.props.onActionClick(x.JU.EDIT)})),e}return(0,l.Z)(o,[{key:"render",value:function(){var e,t=this.props,o=t.type,a=t.data,i=""!==a.auditData&&JSON.parse(a.auditData),n=0;return i.skus&&(n=i.skus.reduce((function(e,t){return e+=t.invNum}),0)),(0,I.jsxs)(g.View,{className:"goods_com_wrapper",children:[(0,I.jsxs)(g.View,{className:"goods_com_wrapper__top",children:[(0,I.jsx)(g.Image,{src:a.imgData&&Object.keys(JSON.parse(a.imgData))[0],mode:"aspectFill",className:"goods_com_wrapper__top__goodsImage"}),(0,I.jsxs)(g.View,{className:"goods_com_wrapper__top__goodsInfo",children:[(0,I.jsx)(g.View,{className:"goods_com_wrapper__top__goodsInfo__goodsName",children:a.styleName}),(0,I.jsxs)(g.View,{className:"goods_com_wrapper__top__goodsInfo__goodsInv",children:["库存：",n||0]}),(0,I.jsxs)(g.View,{className:"goods_com_wrapper__top__goodsInfo__goodsPrice",children:[(0,I.jsxs)(g.Text,{children:["直播价格",(0,I.jsxs)(g.Text,{className:"goods_price_color",children:["¥",a.livePrice]})]}),(0,I.jsxs)(g.Text,{style:"margin-left: 8px;",children:["原价 ¥",a.realPrice]})]})]}),0===o&&(0,I.jsx)(g.View,{className:"sync_invnum",onClick:this.onAsyncClick,children:"同步库存"}),1===o&&(0,I.jsxs)(g.View,{className:b()("audit_flag_status",(e={},(0,_.Z)(e,"AUDITING",a.auditFlag===x.vC.AUDITING),(0,_.Z)(e,"FAILURE",a.auditFlag===x.vC.FAILURE),e)),children:[a.auditFlag===x.vC.AUDITING?"审核中":"",a.auditFlag===x.vC.FAILURE?"审核失败":""]})]}),(0,I.jsxs)(g.View,{className:"goods_com_wrapper__bottom",children:[(0,I.jsx)(g.View,{}),0===o&&(0,I.jsxs)(g.View,{className:"goods_com_wrapper__bottom__actionView",children:[(0,I.jsx)(g.View,{className:"goods_com_wrapper__bottom__actionView__item",onClick:this.onDownClick,children:"下架"}),(0,I.jsx)(g.View,{className:"goods_com_wrapper__bottom__actionView__item",onClick:this.onUpdateClick,children:"改价"})]}),2===o&&(0,I.jsx)(g.View,{className:"goods_com_wrapper__bottom__actionView",children:(0,I.jsx)(g.View,{className:"goods_com_wrapper__bottom__actionView__item",onClick:this.onUpClick,children:"上架"})})]})]})}}]),o}(w.Component);(0,_.Z)(V,"defaultProps",{type:0,data:{auditData:"{}"}});var y=[{label:"在售",value:1},{label:"审核中",value:1}],U=function(e){(0,p.Z)(o,e);var t=(0,u.Z)(o);function o(){var e;(0,r.Z)(this,o);for(var a=arguments.length,l=new Array(a),p=0;p<a;p++)l[p]=arguments[p];return e=t.call.apply(t,[this].concat(l)),(0,_.Z)((0,d.Z)(e),"state",{activeTabsIndex:0,upGoodsList:[],auditGoodsList:[],downGoodsList:[],upPageNo:1,auditPageNo:1,downPageNo:1,loading:!1,updatePriceIsShow:!1,realPrice:0,searchKey:""}),(0,_.Z)((0,d.Z)(e),"updatePriceData",void 0),(0,_.Z)((0,d.Z)(e),"init",(0,c.Z)((0,s.Z)().mark((function t(){var o,a,i,n;return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return m().showLoading({title:"请稍等..."}),o=e.state,a=o.upPageNo,i=o.auditPageNo,n=o.downPageNo,t.next=4,e.fetchList(1,a);case 4:return t.next=6,e.fetchList(2,i);case 6:e.fetchList(3,n),m().hideLoading();case 8:case"end":return t.stop()}}),t)})))),(0,_.Z)((0,d.Z)(e),"fetchList",(function(t,o){var a,i=(0,C.JU)(null===(a=m().getCurrentInstance)||void 0===a?void 0:a.call(m())).mpErpId;return e.setState({loading:!0}),(0,v.oW)({mpErpId:i,status:t,pageNo:o,searchKey:e.state.searchKey||void 0}).then((function(o){var a=o.data,i=e.state,s=i.upPageNo,c=i.auditPageNo,r=i.downPageNo;1===t&&e.setState((function(e){return{upGoodsList:1===s?a.rows:[].concat((0,n.Z)(e.upGoodsList),(0,n.Z)(a.rows)),loading:!1}})),2===t&&e.setState((function(e){return{auditGoodsList:1===c?a.rows:[].concat((0,n.Z)(e.auditGoodsList),(0,n.Z)(a.rows)),loading:!1}})),3===t&&e.setState((function(e){return{downGoodsList:1===r?a.rows:[].concat((0,n.Z)(e.downGoodsList),(0,n.Z)(a.rows)),loading:!1}}))}))})),(0,_.Z)((0,d.Z)(e),"onTabClick",(function(t){e.setState({activeTabsIndex:t})})),(0,_.Z)((0,d.Z)(e),"onSwiperChange",(function(t){e.setState({activeTabsIndex:t.detail.current})})),(0,_.Z)((0,d.Z)(e),"_onScrollLower",(0,k.debounce)((function(){var t=e.state.activeTabsIndex;0===t&&e.state.upGoodsList.length>=20*e.state.upPageNo&&e.setState((function(e){return{upPageNo:e.upPageNo+1}}),(function(){e.fetchList(1,e.state.upPageNo)})),1===t&&e.state.auditGoodsList.length>=20*e.state.auditPageNo&&e.setState((function(e){return{auditPageNo:e.auditPageNo+1}}),(function(){e.fetchList(2,e.state.auditPageNo)})),2===t&&e.state.downGoodsList.length>=20*e.state.downPageNo&&e.setState((function(e){return{downPageNo:e.downPageNo+1}}),(function(){e.fetchList(2,e.state.downPageNo)}))}),100)),(0,_.Z)((0,d.Z)(e),"onScrollLower",(function(){e._onScrollLower()})),(0,_.Z)((0,d.Z)(e),"onItemClick",(function(t,o){switch(t){case x.JU.UP:e.operationGoods(o.styleId,x.JU.UP);break;case x.JU.EDIT:break;case x.JU.DOWN:e.operationGoods(o.styleId,x.JU.DOWN);break;case x.JU.ASYNC:e.asyncGoodsInv(o);break;case x.JU.UPDATE:e.updatePrice(o);break;case x.JU.DELETE:e.operationGoods(o.styleId,x.JU.DELETE)}})),(0,_.Z)((0,d.Z)(e),"asyncGoodsInv",(function(e){m().showLoading({title:"请稍等..."}),Z.Z.getDispatch()({type:"goodsManage/fetchGoodsDetail",payload:{spuId:e.styleId,isSpecial:!0}}).then((function(t){var o;m().hideLoading(),(0,v.e3)({mpErpId:(0,C.JU)(null===(o=m().getCurrentInstance)||void 0===o?void 0:o.call(m())).mpErpId,styleId:e.styleId,invType:1,skus:t.skus.map((function(e){return{id:e.id,colorId:e.colorId,colorName:e.colorName,sizeId:e.sizeId,sizeName:e.sizeName,invNum:e.invNum}}))}).then((function(){m().hideLoading()})).catch((function(){m().hideLoading()}))}))})),(0,_.Z)((0,d.Z)(e),"updatePrice",(function(t){e.updatePriceData=t,e.setState({realPrice:t.realPrice,updatePriceIsShow:!0})})),(0,_.Z)((0,d.Z)(e),"onUpdateCallBack",(function(t){var o=JSON.parse(e.updatePriceData.auditData);m().showLoading({title:"请稍等..."}),(0,v.e3)((0,i.Z)((0,i.Z)({},o),{},{livePrice:Number(t)||void 0})).then((function(t){e.onCloseUpdatePrice(),m().hideLoading(),e.init()})).catch((function(t){e.onCloseUpdatePrice(),m().hideLoading()}))})),(0,_.Z)((0,d.Z)(e),"onCloseUpdatePrice",(function(){e.updatePriceData={},e.setState({updatePriceIsShow:!1})})),(0,_.Z)((0,d.Z)(e),"operationGoods",(function(t,o){var a;m().showLoading({title:"请稍等..."});var i=v.Cu;o===x.JU.DOWN&&(i=v.om),o===x.JU.DELETE&&(i=v.nq),i({mpErpId:(0,C.JU)(null===(a=m().getCurrentInstance)||void 0===a?void 0:a.call(m())).mpErpId,styleId:t}).then((function(t){t.data;m().hideLoading(),e.init()})).catch((function(e){console.log(e),m().hideLoading()}))})),(0,_.Z)((0,d.Z)(e),"onAddClick",(function(){m().navigateTo({url:"/subpackages/cloud_bill/pages/use_goods/index?from=live"})})),(0,_.Z)((0,d.Z)(e),"onGoodsListRefresh",(function(){var t=e.state,o=t.activeTabsIndex,a=t.upPageNo,i=t.auditPageNo,n=t.downPageNo;0===o&&e.setState({upPageNo:1},(function(){e.fetchList(o+1,a)})),1===o&&e.setState({auditPageNo:1},(function(){e.fetchList(o+1,i)})),2===o&&e.setState({downPageNo:1},(function(){e.fetchList(o+1,n)}))})),(0,_.Z)((0,d.Z)(e),"refreshAll",(function(){var t=e.state,o=t.upPageNo,a=t.auditPageNo,i=t.downPageNo;e.setState({upPageNo:1,auditPageNo:1,downPageNo:1},(function(){e.fetchList(1,o),e.fetchList(2,a),e.fetchList(3,i)}))})),(0,_.Z)((0,d.Z)(e),"debounceSearchRefresh",(0,k.debounce)((function(){return e.refreshAll()}),500)),(0,_.Z)((0,d.Z)(e),"handleSearchInput",(function(t){e.setState({searchKey:t}),""===t?e.refreshAll():e.debounceSearchRefresh()})),e}return(0,l.Z)(o,[{key:"componentDidMount",value:function(){var e=this;this.init(),m().eventCenter.on("REFRESH_CHECK_GOODS",(function(){e.setState({auditPageNo:1},(0,c.Z)((0,s.Z)().mark((function t(){return(0,s.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return m().showLoading({title:"请稍等..."}),t.next=3,e.fetchList(2,1);case 3:m().hideLoading();case 4:case"end":return t.stop()}}),t)}))))}))}},{key:"componentWillUnmount",value:function(){m().eventCenter.off("REFRESH_CHECK_GOODS")}},{key:"render",value:function(){var e=this,t=this.state,o=t.activeTabsIndex,a=t.loading,i=t.updatePriceIsShow,n=t.realPrice,s=this.state,c=s.upGoodsList,r=s.auditGoodsList;s.downGoodsList;return(0,I.jsxs)(g.View,{className:"create_live__wrapper",children:[(0,I.jsxs)(g.View,{className:"create_live__wrapper__header",children:[(0,I.jsx)(g.View,{className:"create_live__wrapper__header__searchView",children:(0,I.jsx)(f.Z,{placeholder:"搜索商品",onInput:this.handleSearchInput,onClearSearchClick:this.handleSearchInput})}),(0,I.jsx)(g.View,{className:"create_live__wrapper__header__tabsView aic jcc",children:(0,I.jsx)(N.Z,{data:y,margin:150,underlineHeight:7,underlineColor:"#E62E4D",activeIndex:o,onTabItemClick:this.onTabClick})})]}),(0,I.jsx)(g.View,{className:"create_live__wrapper__content",children:(0,I.jsxs)(g.Swiper,{className:"swiper_viewer",current:o,onChange:this.onSwiperChange,children:[(0,I.jsx)(g.SwiperItem,{className:"swiper_viewer__item",children:(0,I.jsxs)(g.ScrollView,{scrollY:!0,refresherEnabled:!0,scrollAnchoring:!0,lowerThreshold:300,refresherTriggered:a,onRefresherRefresh:this.onGoodsListRefresh,onScrollToLower:this.onScrollLower,className:"swiper_viewer__item__scroll",children:[(0,I.jsx)(g.View,{style:"height:12px;"}),c.map((function(t){return(0,I.jsx)(V,{type:o,data:t,onActionClick:e.onItemClick},t.id)}))]})}),(0,I.jsx)(g.SwiperItem,{className:"swiper_viewer__item",children:(0,I.jsxs)(g.ScrollView,{scrollY:!0,refresherEnabled:!0,scrollAnchoring:!0,lowerThreshold:300,refresherTriggered:a,onRefresherRefresh:this.onGoodsListRefresh,onScrollToLower:this.onScrollLower,className:"swiper_viewer__item__scroll",children:[(0,I.jsx)(g.View,{style:"height:12px;"}),r.map((function(t){return(0,I.jsx)(V,{type:o,data:t,onActionClick:e.onItemClick},t.id)}))]})})]})}),(0,I.jsx)(g.View,{className:"create_live__wrapper__bottom",children:(0,I.jsx)(g.View,{className:"create_live__wrapper__bottom__action",onClick:this.onAddClick,children:"添加商品"})}),i&&(0,I.jsx)(L,{realPrice:n,onCloseClick:this.onCloseUpdatePrice,onCallback:this.onUpdateCallBack})]})}}]),o}(w.Component);Page((0,a.createPageConfig)(U,"subpackages/live/pages/live_goods_manage/index",{root:{cn:[]}},{navigationBarTitleText:"商品管理"}||{}))}},function(e){e.O(0,[8272,3199,2107,1216,8592],(function(){return t=27183,e(e.s=t);var t}));e.O()}]);