"use strict";(wx.webpackJsonp=wx.webpackJsonp||[]).push([[8254],{14964:function(e,s,n){var _=n(32180),t=n(33661),o=n(12742),i=n(22700),a=n(95333),c=n(14175),u=n(3701),r=n(92954),d=n.n(r),l=n(67294),p=n(96486),h=n(71515),m=n(844),k=n(49181),x=n(75508),g=n(63056),f=n(19497),w=n(67190),I=n(67045),N=n(91629),y=n(27863),C=n(7567),j=n(31254),S="index-module__titleTextClass___ZurLn",b="index-module__containerClass___WMseR",v="index-module__manage-btn___iNg_R",Z="index-module__manage-btn_text___mFn2_",B="index-module__page___wwCTY",L="index-module__container___f7YPT",V="index-module__footer___oC7Lw",T="index-module__footer__check_all___upSIk",A="index-module__check_icon___eTulv",P="index-module__footer__right___a0LJC",M=n(86792),E=n(48882),O="index-module__shopItem___scdNR",U="index-module__shopItem__shop___neCXP",W="index-module__shopItem__shop_info___eQ4Ei",D="index-module__shopItem__shop_info_image___iFM9a",F="index-module__shopItem__shop_info_text___L0sfa",G="index-module__shopItem__shop_info_icon___m2I8a",Y="index-module__shopItem__check___tg5Vg",q="index-module__shopItem__check_icon___ycGEm",H=n(65712),R=n(59009),X=n(57858),J=n(86889),$=n(59132),Q=n(61270),z=n(94184),K=n.n(z),ee={sku:"index-module__sku___vI3ZR","sku--group":"index-module__sku--group___u4qBy",sku__content:"index-module__sku__content___CiXI3",sku__name:"index-module__sku__name___ayIlh",sku__label:"index-module__sku__label___N_6pP",sku__group_label:"index-module__sku__group_label___QvH4v",sku__stepper:"index-module__sku__stepper___SCDgi",sku__stepper__group_total:"index-module__sku__stepper__group_total___dsXOn",check:"index-module__check___nYNTM",check_icon:"index-module__check_icon___Hw4kB",spu:"index-module__spu___MkqCs",spu__check:"index-module__spu__check___Pwh9j",spu__check_icon:"index-module__spu__check_icon___vIAup",spu__header:"index-module__spu__header___qI6h4",spu__header__main:"index-module__spu__header__main___qyu7r",spu__header__img:"index-module__spu__header__img___vtP0A",spu__header__img__disabled:"index-module__spu__header__img__disabled___vGrdg",spu__header__content:"index-module__spu__header__content___rkIaG",spu__header__code:"index-module__spu__header__code___x_hiJ",spu__header__name:"index-module__spu__header__name___IlY22",spu__header__price:"index-module__spu__header__price___yQS7t",spu__header__price_tag:"index-module__spu__header__price_tag___mccUo",spu__header__toggle_sku:"index-module__spu__header__toggle_sku___q4fUP","spu__header__toggle_sku--bottom":"index-module__spu__header__toggle_sku--bottom___bbcwV",spu__skus:"index-module__spu__skus___YaErL"},se=n(85893),ne=[{text:"删除",style:{backgroundColor:J.Z.themeColor}}];function _e(e){var s=e.spu,n=e.dispatch,_=e.shopIndex,t=e.index,o=e.manage,i=e.spuShowPrice,a=(e.industries,s&&s.skus&&s.skus[0]),c=(0,l.useState)((function(){return s&&s.skus&&s.skus.every((function(e){return e.num<1}))}),[s]),r=(0,H.Z)(c,2),p=r[0],m=(r[1],(0,l.useMemo)((function(){return s&&0===s.flag}),[s])),k=(0,l.useMemo)((function(){return s&&s.skus&&s.skus.every((function(e){return e.checked}))}),[s]);(0,l.useEffect)((function(){m&&!o&&k&&n({type:"replenishment/checkSpu",payload:{index:t,checked:!k}})}),[o,s,m,n,t,k]);var x=(0,l.useCallback)((function(e){n({type:"replenishment/updateCartGoodsRemInStockBar",payload:{shopIndex:_,spuIndex:t,id:a.id,rem:e}})}),[t,_,a,n]),f=(0,l.useCallback)((function(){var e=s.skus.reduce((function(e,s){return e.push(s.id),e}),[]);g.Z.showAlertWithCancel("确认删除?","",(function(){n({type:"replenishment/deleteSpu",payload:{shopIndex:_,spuIndex:t,ids:e}})}))}),[s,n,_,t]),N=(0,l.useMemo)((function(){var e=s&&s.skus||[];return p?e:e.filter((function(e){return e.num>0}))}),[s,p]),y=function(e){return function(s){var o=e.groupNum;if(o){var i=e.num/o;s=(o=s)*i}n({type:"replenishment/updateGoodsNumInStockBar",payload:{shopIndex:_,spuIndex:t,id:e.id,num:s,groupNum:o}})}};return(0,se.jsxs)(h.View,{className:ee.spu,children:[(0,se.jsx)($.AtSwipeAction,{options:ne,autoClose:!0,onClick:f,maxDistance:100,areaWidth:.88*d().getSystemInfoSync().windowWidth,children:(0,se.jsxs)(h.View,{className:ee.spu__header,children:[(0,se.jsx)(h.View,{className:ee.spu__check,onClick:function(){m&&!o||n({type:"replenishment/checkSpuInStockBar",payload:{index:t,shopIndex:_,checked:!k}})},children:(0,se.jsx)(h.Image,{src:k?w:I,className:ee.spu__check_icon})}),(0,se.jsxs)(h.View,{className:ee.spu__header__main,children:[(0,se.jsxs)(h.View,{className:ee.spu__header__img,children:[(0,se.jsx)(h.Image,{mode:"aspectFill",style:{width:"100%",height:"100%"},src:s.imgUrl||R}),m&&(0,se.jsx)(h.View,{className:ee.spu__header__img__disabled,children:"已失效"})]}),(0,se.jsxs)(h.View,{className:ee.spu__header__content,children:[(0,se.jsx)(h.View,{className:ee.spu__header__code,children:s.code}),(0,se.jsx)(h.View,{className:ee.spu__header__name,children:s.name})]})]})]})}),s&&s.skus&&(0,se.jsxs)(h.View,{className:ee.spu__skus,children:[N.map((function(e,s){return(0,se.jsx)($.AtSwipeAction,{options:ne,autoClose:!0,onClick:function(){!function(e){g.Z.showAlertWithCancel("确认删除?","",(function(){n({type:"replenishment/deleteFromCartInStockBar",payload:{shopIndex:_,spuIndex:t,id:e.id}})}))}(e)},disabled:o,maxDistance:100,areaWidth:.88*d().getSystemInfoSync().windowWidth,children:(0,se.jsxs)(h.View,{className:K()(ee.sku,(0,u.Z)({},ee["sku--group"],e.groupNum&&e.groupNum>0&&e.groupNum!==e.num)),onClick:function(){!function(e){m||n({type:"replenishment/updateSkuInStockBar",payload:{spuIndex:t,shopIndex:_,id:e.id,checked:!e.checked}})}(e)},children:[(0,se.jsx)(h.View,{className:ee.check,children:(0,se.jsx)(h.Image,{src:e.checked?w:I,className:ee.check_icon})}),(0,se.jsxs)(h.View,{className:ee.sku__content,children:[(0,se.jsxs)(h.View,{className:ee.sku__name,children:[i&&(0,se.jsxs)(h.Text,{className:ee.sku__label,children:["¥".concat(e.price)," "]}),(0,se.jsxs)(h.Block,{children:[(0,se.jsxs)(h.Text,{className:ee.sku__label,children:[e.colorName," "]}),(0,se.jsxs)(h.View,{className:K()(ee.sku__label,ee["sku__label--s"]),children:[(0,se.jsx)(h.Text,{children:e.sizeName}),e.groupNum&&e.groupNum>0&&e.groupNum!==e.num&&(0,se.jsx)(h.Text,{className:ee.sku__group_label,children:"(1手".concat(e.num/e.groupNum,"件)")})]})]}),(0,se.jsx)(h.Text,{style:{flex:.5},className:ee.sku__label})]}),(0,se.jsxs)(h.View,{className:ee.sku__stepper,children:[(0,se.jsx)(Q.Z,{type:"number",value:e.groupNum?e.groupNum:e.num,min:1,onChange:y(e),disabled:m}),e.groupNum&&e.groupNum>0&&e.groupNum!==e.num&&(0,se.jsx)(h.Text,{className:ee.sku__stepper__group_total,children:"共".concat(e.num,"件")})]})]})]})},e.id)})),!m&&s&&s.skus&&s.skus.length&&(0,se.jsx)(h.View,{style:{marginTop:"10px",paddingLeft:"24rpx"},children:(0,se.jsx)(X.Z,{rem:s.skus[0].rem,onConfirm:x})})]})]})}var te=(0,x.$j)((function(e,s){e.replenishment,e.goodsManage;return{}}))(_e);_e.defaultProps={spu:{},index:0,shopIndex:0,spuShowPrice:0,industries:!1};function oe(e){var s=e.shopItem,n=e.shopIndex,_=e.checkShop,t=e.onShopClick,o=e.manage,i=e.industries,a=(0,l.useMemo)((function(){return(0,C.NU)(s.spus)}),[s.spus]),c=(0,l.useMemo)((function(){return a.isAllChecked}),[a]);return(0,se.jsxs)(h.View,{className:O,children:[(0,se.jsxs)(h.View,{className:U,children:[(0,se.jsx)(h.View,{className:Y,onClick:function(){return _(n,!c)},children:(0,se.jsx)(h.Image,{src:c?w:I,className:q})}),(0,se.jsxs)(h.View,{className:W,onClick:function(){return t(s)},children:[(0,se.jsx)(h.Image,{className:D,src:s.logoUrl||E}),(0,se.jsx)(h.Text,{className:F,children:s.shopName}),(0,se.jsx)(h.Image,{src:M,className:G})]})]}),s.spus.map((function(e,_){return e.skus&&e.skus.length&&(0,se.jsx)(te,{index:_,shopIndex:n,spu:e,spuShowPrice:s.spuShowPrice,manage:o,industries:i},e.code)}))]},s.shopName)}var ie=(0,x.$j)((function(){return{}}))((0,l.memo)(oe));oe.defaultProps={shopItem:{spus:[]},industries:!1};var ae=function(e){(0,a.Z)(n,e);var s=(0,c.Z)(n);function n(){var e;(0,t.Z)(this,n);for(var _=arguments.length,o=new Array(_),a=0;a<_;a++)o[a]=arguments[a];return e=s.call.apply(s,[this].concat(o)),(0,u.Z)((0,i.Z)(e),"emptyInfo",{image:"https://webdoc.hzecool.com/webCdn/weapp/ec-ticket/src/assets/images/empty/0ce41521b90ac2fb99fc..png",label:"进货车里空空如也"}),(0,u.Z)((0,i.Z)(e),"state",{manage:!1,firstShowLoading:!0}),(0,u.Z)((0,i.Z)(e),"getList",(function(){d().showLoading({title:"加载中"}),e.props.dispatch({type:"replenishment/fetchStockBarList"}).then((function(){d().hideLoading()})).catch((function(){d().hideLoading()}))})),(0,u.Z)((0,i.Z)(e),"onManageClick",(function(){e.setState((function(e){return{manage:!e.manage}}))})),(0,u.Z)((0,i.Z)(e),"onCheckAll",(0,p.debounce)((function(){var s=e.props,n=s.isAllChecked;s.spus.length<=0||d().showLoading({title:"加载中"}).then((function(){e.props.dispatch({type:"replenishment/toggleAllCheckedInStockBar",payload:{checked:!n}})}))}),200)),(0,u.Z)((0,i.Z)(e),"checkShop",(function(s,n){e.props.dispatch({type:"replenishment/checkShopInStockBar",payload:{shopIndex:s,checked:n}})})),(0,u.Z)((0,i.Z)(e),"onConfirm",(function(){var s=e.props,n=s.totalNum,_=s.atLeastOneChecked;if(e.state.manage)g.Z.showAlertWithCancel("确认将".concat(n,"件商品删除?"),"",(function(){e.props.dispatch({type:"replenishment/deleteFromCartInStockBar",payload:{ids:e.props.checkedSkuIds}})}));else{if(!_||n<=0)return g.Z.showToast("请至少选择一件商品");e.props.dispatch({type:"replenishment/confirmGoodsInStockBar"}),d().navigateTo({url:"/subpackages/cloud_bill/pages/replenishment_confirm/index?from=stockBar"})}})),(0,u.Z)((0,i.Z)(e),"renderManageBtn",(function(){var s=e.props,n=s.statusBarHeight,_=s.gap,t=e.state.manage;return(0,se.jsx)(h.View,{className:v,style:"top: ".concat(n+_,"px"),onClick:e.onManageClick,children:(0,se.jsx)(h.Text,{className:Z,children:t?"完成":"管理"})})})),(0,u.Z)((0,i.Z)(e),"onShopClick",(function(s){var n=e.props.shopList.find((function(e){return e.id===s.mpErpId}));if(n){var _=n.cloudBillFlag===y.PC.never||n.cloudBillFlag===y.PC.expire?y.yK.replenishment:y.yK.all;e.props.dispatch({type:"cloudBill/init",payload:{mpErpId:s.mpErpId,cloudType:_,cloudSource:y.o0.CLOUD_TAB}}),N.Z.navigateTo({url:"/subpackages/cloud_bill/pages/all_goods/index?type=".concat(_)})}})),(0,u.Z)((0,i.Z)(e),"renderShop",(function(){var s=e.props,n=s.stockBarList,_=s.shopList,t=e.state.manage;return n.map((function(s,n){var o=_.find((function(e){return e.id===s.mpErpId}));return(0,se.jsx)(ie,{index:n,shopIndex:n,shopItem:s,manage:t,checkShop:e.checkShop,onShopClick:e.onShopClick,industries:!!o&&o.industries},s.mpErpId)}))})),e}return(0,o.Z)(n,[{key:"shouldComponentUpdate",value:function(){this.state.firstShowLoading&&(this.setState({firstShowLoading:!1}),d().showLoading({title:"加载中"}))}},{key:"componentDidUpdate",value:function(){d().hideLoading()}},{key:"componentDidShow",value:function(){this.getList()}},{key:"render",value:function(){var e=this.props,s=e.stockBarList,n=e.isAllChecked,_=e.atLeastOneChecked,t=this.state.manage;return(0,se.jsxs)(m.Z,{enableBack:!1,stickyTop:!1,disableIphoneXPaddingBottom:!0,title:"进货车",titleTextClass:S,containerClass:b,children:[this.renderManageBtn(),(0,se.jsxs)(h.View,{className:B,children:[s.length>0?(0,se.jsx)(h.View,{className:L,children:this.renderShop()}):(0,se.jsx)(h.View,{style:{flex:1},children:(0,se.jsx)(f.Z,{style:{position:"absolute",width:"100%",height:"90%",left:"50%",top:"50%",transform:"translateX(-50%) translateY(-50%)"},needShowButton:!0,onButtonClick:this.getList,emptyInfo:this.emptyInfo})}),(0,se.jsxs)(h.View,{className:V,style:j.$L?{marginBottom:"50px"}:{},children:[(0,se.jsxs)(h.View,{className:T,onClick:this.onCheckAll,children:[(0,se.jsx)(h.Image,{src:n?w:I,className:A}),(0,se.jsx)(h.Text,{children:"全选"})]}),(0,se.jsx)(h.View,{className:P,children:(0,se.jsx)(k.Z,{label:t?"删除":"立即下单",width:240,onButtonClick:this.onConfirm,disabled:!_})})]})]})]})}}]),n}(l.PureComponent),ce=(0,x.$j)((function(e){var s=e.systemInfo,n=e.replenishment,_=e.shop,t=(0,C.G_)(n.stockBarList),o=t.totalMoney,i=t.totalNum,a=t.isAllChecked,c=t.atLeastOneChecked;return{checkedSkuIds:(0,C.Du)(n),gap:s.gap,statusBarHeight:s.statusBarHeight,spus:n.spus,stockBarList:n.stockBarList,totalNum:i,totalMoney:o,isAllChecked:a,atLeastOneChecked:c,shopList:_.list}}))(ae);Page((0,_.createPageConfig)(ce,"pages/stock_bar/index",{root:{cn:[]}},{navigationStyle:"custom"}||{}))}},function(e){e.O(0,[2107,1216,8592],(function(){return s=14964,e(e.s=s);var s}));e.O()}]);